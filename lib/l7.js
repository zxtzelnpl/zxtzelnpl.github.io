!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("mapbox-gl"),require("maplibre-gl")):"function"==typeof define&&define.amd?define(["mapbox-gl","maplibre-gl"],t):"object"==typeof exports?exports.L7=t(require("mapbox-gl"),require("maplibre-gl")):e.L7=t(e.mapboxgl,e.maplibregl)}(self,(function(e,t){return function(){var n={9743:function(e,t,n){"use strict";n.d(t,{N:function(){return b},Z:function(){return b}});var r=n(4528),i=n.n(r),o=n(8798),a=n.n(o),s=n(6626),u=n.n(s),l=n(746),c=n.n(l),h=n(378),f=n.n(h),p=n(7267),d=n.n(p),v=n(9913),m=n.n(v),g=n(9057),y=n.n(g),_=n(6490),b=function(e){d()(n,e);var t=m()(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),y()(u()(e),"isDisable",!1),y()(u()(e),"button",void 0),y()(u()(e),"buttonText",void 0),y()(u()(e),"buttonIcon",void 0),e}return a()(n,[{key:"setIsDisable",value:function(e){var t,n;(this.isDisable=e,e)?null===(t=this.button)||void 0===t||t.setAttribute("disabled","true"):null===(n=this.button)||void 0===n||n.removeAttribute("disabled")}},{key:"createButton",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return _.SO.create("button","l7-button-control ".concat(e))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var e=this.controlOption,t=e.title,n=e.btnText,r=e.btnIcon;return this.setBtnTitle(t),this.setBtnText(n),this.setBtnIcon(r),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(e){var t=e.title,r=e.btnText,i=e.btnIcon;this.checkUpdateOption(e,["title"])&&this.setBtnTitle(t),this.checkUpdateOption(e,["btnIcon"])&&this.setBtnIcon(i),this.checkUpdateOption(e,["btnText"])&&this.setBtnText(r),c()(f()(n.prototype),"setOptions",this).call(this,e)}},{key:"setBtnTitle",value:function(e){var t;null===(t=this.button)||void 0===t||t.setAttribute("title",null!=e?e:"")}},{key:"setBtnIcon",value:function(e){if(this.buttonIcon&&_.SO.remove(this.buttonIcon),e){var t,n,r,i=null===(t=this.button)||void 0===t?void 0:t.firstChild;if(i)null===(n=this.button)||void 0===n||n.insertBefore(e,i);else null===(r=this.button)||void 0===r||r.appendChild(e);this.buttonIcon=e}}},{key:"setBtnText",value:function(e){if(this.button)if(_.SO.removeClass(this.button,"l7-button-control--row"),_.SO.removeClass(this.button,"l7-button-control--column"),e){var t,n=this.buttonText;if(!n)n=_.SO.create("div","l7-button-control__text"),null===(t=this.button)||void 0===t||t.appendChild(n),this.buttonText=n;n.innerText=e,_.SO.addClass(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!e&&this.buttonText&&(_.SO.remove(this.buttonText),this.buttonText=void 0)}}]),n}(n(866).ZP)},866:function(e,t,n){"use strict";n.d(t,{ZP:function(){return E},d:function(){return _.PositionType},oT:function(){return E}});var r=n(3100),i=n.n(r),o=n(1448),a=n.n(o),s=n(4528),u=n.n(s),l=n(8798),c=n.n(l),h=n(6626),f=n.n(h),p=n(7267),d=n.n(p),v=n(9913),m=n.n(v),g=n(9057),y=n.n(g),_=n(3292),b=n(6490),x=n(2490),E=function(e){d()(n,e);var t=m()(n);function n(e){var r;return u()(this,n),r=t.call(this),y()(f()(r),"controlOption",void 0),y()(f()(r),"container",void 0),y()(f()(r),"isShow",void 0),y()(f()(r),"sceneContainer",void 0),y()(f()(r),"scene",void 0),y()(f()(r),"mapsService",void 0),y()(f()(r),"renderService",void 0),y()(f()(r),"layerService",void 0),y()(f()(r),"controlService",void 0),y()(f()(r),"configService",void 0),n.controlCount++,r.controlOption=a()(a()({},r.getDefault(e)),e||{}),r}return c()(n,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(e){var t=this.getDefault(e);Object.entries(e).forEach((function(n){var r=i()(n,2),o=r[0];void 0===r[1]&&(e[o]=t[o])})),"position"in e&&this.setPosition(e.position),"className"in e&&this.setClassName(e.className),"style"in e&&this.setStyle(e.style),this.controlOption=a()(a()({},this.controlOption),e)}},{key:"addTo",value:function(e){this.mapsService=e.mapService,this.renderService=e.rendererService,this.layerService=e.layerService,this.controlService=e.controlService,this.configService=e.globalConfigService,this.scene=e.sceneService,this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd(),b.SO.addClass(this.container,"l7-control");var t=this.controlOption,n=t.className,r=t.style;return n&&this.setClassName(n),r&&this.setStyle(r),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;b.SO.remove(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return b.SO.create("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var e=this.container;b.SO.removeClass(e,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var e=this.container;b.SO.addClass(e,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(e){return{position:_.PositionType.TOPRIGHT,name:"".concat(n.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){var t=this.mapsService.getContainer();null!==t&&t.focus()}}},{key:"setPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_.PositionType.TOPLEFT,t=this.controlService;return t&&t.removeControl(this),this.controlOption.position=e,t&&t.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(e){var t=this.container,n=this.controlOption.className;n&&b.SO.removeClass(t,n),e&&b.SO.addClass(t,e)}},{key:"setStyle",value:function(e){var t=this.container;e?t.setAttribute("style",e):t.removeAttribute("style")}},{key:"insertContainer",value:function(){var e=this.controlOption.position,t=this.container;if(e instanceof Element)e.appendChild(t);else{var n=this.controlService.controlCorners[e];["bottomleft","bottomright","righttop","rightbottom"].includes(e)?n.insertBefore(t,n.firstChild):n.appendChild(t)}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}]),n}(n.n(x)());y()(E,"controlCount",0)},830:function(e,t,n){"use strict";n.d(t,{NA:function(){return r.N},Yw:function(){return a.Y},d:function(){return i.d},oT:function(){return i.oT},p4:function(){return o.p}});var r=n(9743),i=n(866),o=n(4489),a=n(6633)},4489:function(e,t,n){"use strict";n.d(t,{p:function(){return w}});var r=n(1448),i=n.n(r),o=n(4528),a=n.n(o),s=n(8798),u=n.n(s),l=n(6626),c=n.n(l),h=n(746),f=n.n(h),p=n(378),d=n.n(p),v=n(7267),m=n.n(v),g=n(9913),y=n.n(g),_=n(9057),b=n.n(_),x=n(3100),E=n.n(x),S=n(6490),A=function(e){m()(n,e);var t=y()(n);function n(e,r){var i;return a()(this,n),i=t.call(this),b()(c()(i),"popperDOM",void 0),b()(c()(i),"contentDOM",void 0),b()(c()(i),"button",void 0),b()(c()(i),"option",void 0),b()(c()(i),"isShow",!1),b()(c()(i),"content",void 0),b()(c()(i),"timeout",null),b()(c()(i),"show",(function(){return i.isShow||!i.contentDOM.innerHTML||(i.resetPopperPosition(),S.SO.removeClass(i.popperDOM,"l7-popper-hide"),i.isShow=!0,i.option.unique&&n.conflictPopperList.forEach((function(e){e!==c()(i)&&e.isShow&&e.hide()})),i.emit("show"),window.addEventListener("pointerdown",i.onPopperUnClick)),c()(i)})),b()(c()(i),"hide",(function(){return i.isShow?(S.SO.addClass(i.popperDOM,"l7-popper-hide"),i.isShow=!1,i.emit("hide"),window.removeEventListener("pointerdown",i.onPopperUnClick),c()(i)):c()(i)})),b()(c()(i),"setHideTimeout",(function(){i.timeout||(i.timeout=window.setTimeout((function(){i.isShow&&(i.hide(),i.timeout=null)}),300))})),b()(c()(i),"clearHideTimeout",(function(){i.timeout&&(window.clearTimeout(i.timeout),i.timeout=null)})),b()(c()(i),"onBtnClick",(function(){i.isShow?i.hide():i.show()})),b()(c()(i),"onPopperUnClick",(function(e){S.SO.findParentElement(e.target,[".l7-button-control",".l7-popper-content"])||i.hide()})),b()(c()(i),"onBtnMouseLeave",(function(){i.setHideTimeout()})),b()(c()(i),"onBtnMouseMove",(function(){i.clearHideTimeout(),i.isShow||i.show()})),i.button=e,i.option=r,i.init(),r.unique&&n.conflictPopperList.push(c()(i)),i}return u()(n,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(e){"string"==typeof e?this.contentDOM.innerHTML=e:e instanceof HTMLElement&&(S.SO.clearChildren(this.contentDOM),this.contentDOM.appendChild(e)),this.content=e}},{key:"init",value:function(){var e=this.option.trigger;this.popperDOM=this.createPopper(),"click"===e?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),S.SO.remove(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var e={},t=this.option,n=t.container,r=t.offset,i=void 0===r?[0,0]:r,o=t.placement,a=E()(i,2),s=a[0],u=a[1],l=this.button.getBoundingClientRect(),c=n.getBoundingClientRect(),h=S.SO.getDiffRect(l,c),f=h.left,p=h.right,d=h.top,v=h.bottom,m=!1,g=!1;/^(left|right)/.test(o)?(o.includes("left")?e.right="".concat(l.width+p,"px"):o.includes("right")&&(e.left="".concat(l.width+f,"px")),o.includes("start")?e.top="".concat(d,"px"):o.includes("end")?e.bottom="".concat(v,"px"):(e.top="".concat(d+l.height/2,"px"),g=!0,e.transform="translate(".concat(s,"px, calc(").concat(u,"px - 50%))"))):/^(top|bottom)/.test(o)&&(o.includes("top")?e.bottom="".concat(l.height+v,"px"):o.includes("bottom")&&(e.top="".concat(l.height+d,"px")),o.includes("start")?e.left="".concat(f,"px"):o.includes("end")?e.right="".concat(p,"px"):(e.left="".concat(f+l.width/2,"px"),m=!0,e.transform="translate(calc(".concat(s,"px - 50%), ").concat(u,"px)"))),e.transform="translate(calc(".concat(s,"px - ").concat(m?"50%":"0%","), calc(").concat(u,"px - ").concat(g?"50%":"0%",")");var y=o.split("-");y.length&&S.SO.addClass(this.popperDOM,y.map((function(e){return"l7-popper-".concat(e)})).join(" ")),S.SO.addStyle(this.popperDOM,S.SO.css2Style(e))}},{key:"createPopper",value:function(){var e=this.option,t=e.container,n=e.className,r=void 0===n?"":n,i=e.content,o=S.SO.create("div","l7-popper l7-popper-hide ".concat(r)),a=S.SO.create("div","l7-popper-content"),s=S.SO.create("div","l7-popper-arrow");return o.appendChild(a),o.appendChild(s),t.appendChild(o),this.popperDOM=o,this.contentDOM=a,i&&this.setContent(i),o}}]),n}(n(2490).EventEmitter);b()(A,"conflictPopperList",[]);var T=n(9743),C={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},w=function(e){m()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),b()(c()(e),"popper",void 0),e}return u()(n,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),f()(d()(n.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(e){var t,r=f()(d()(n.prototype),"getDefault",this).call(this,e),o=null!==(t=null==e?void 0:e.position)&&void 0!==t?t:r.position;return i()(i()({},f()(d()(n.prototype),"getDefault",this).call(this,e)),{},{popperPlacement:o instanceof Element?"bottom":C[o],popperTrigger:"click"})}},{key:"onAdd",value:function(){var e=f()(d()(n.prototype),"onAdd",this).call(this);return this.initPopper(),e}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var e=this,t=this.controlOption,n=t.popperClassName,r=t.popperPlacement,i=t.popperTrigger,o=this.mapsService.getMapContainer();return this.popper=new A(this.button,{className:n,placement:r,trigger:i,container:o,unique:!0}),this.popper.on("show",(function(){e.emit("popperShow",e)})).on("hide",(function(){e.emit("popperHide",e)})),this.popper}},{key:"setOptions",value:function(e){if(f()(d()(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["popperPlacement","popperTrigger","popperClassName"])){var t=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(t)}}}]),n}(T.Z)},6633:function(e,t,n){"use strict";n.d(t,{Y:function(){return A},Z:function(){return A}});var r=n(4479),i=n.n(r),o=n(4528),a=n.n(o),s=n(8798),u=n.n(s),l=n(6626),c=n.n(l),h=n(746),f=n.n(h),p=n(378),d=n.n(p),v=n(7267),m=n.n(v),g=n(9913),y=n.n(g),_=n(9057),b=n.n(_),x=n(6490),E=n(4489),S=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(S||{}),A=function(e){m()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return e=t.call.apply(t,[this].concat(o)),b()(c()(e),"selectValue",[]),b()(c()(e),"optionDOMList",void 0),b()(c()(e),"createNormalOption",(function(t){var n=e.selectValue.includes(t.value),r=x.SO.create("div","l7-select-control-item ".concat(n?S.ActiveOptionClassName:""));e.getIsMultiple()?r.appendChild(e.createCheckbox(n)):r.appendChild(e.createRadio(n)),t.icon&&r.appendChild(t.icon);var i=x.SO.create("span");return i.innerText=t.text,r.appendChild(i),r})),b()(c()(e),"onItemClick",(function(t){if(e.getIsMultiple()){var n=e.selectValue.findIndex((function(e){return e===t.value}));n>-1?e.selectValue.splice(n,1):e.selectValue=[].concat(i()(e.selectValue),[t.value])}else e.selectValue=[t.value];e.setSelectValue(e.selectValue)})),e}return u()(n,[{key:"setOptions",value:function(e){f()(d()(n.prototype),"setOptions",this).call(this,e);var t=e.options;t&&this.popper.setContent(this.getPopperContent(t))}},{key:"onAdd",value:function(){var e=f()(d()(n.prototype),"onAdd",this).call(this),t=this.controlOption.defaultValue;return t&&(this.selectValue=this.transSelectValue(t)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),e}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.transSelectValue(e);this.optionDOMList.forEach((function(e){var t=e.getAttribute(S.OptionValueAttrKey),r=e.querySelector("input[type=checkbox]"),i=e.querySelector("input[type=radio]"),o=n.includes(t),a=function(t,n){x.SO.toggleClass(e,S.ActiveOptionClassName,n),t&&x.SO.setChecked(t,n)};a(r,o),a(i,o)})),this.selectValue=n,t&&this.emit("selectChange",this.getIsMultiple()?n:n[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(e){var t=this,n=this.isImageOptions(),r=x.SO.create("div",n?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&x.SO.addClass(r,"l7-select-control--multiple");var o=e.map((function(e,r){var i=n?t.createImageOption(e):t.createNormalOption(e);return i.setAttribute(S.OptionValueAttrKey,e.value),i.setAttribute(S.OptionIndexAttrKey,window.String(r)),i.addEventListener("click",t.onItemClick.bind(t,e)),i}));return r.append.apply(r,i()(o)),this.optionDOMList=o,r}},{key:"createImageOption",value:function(e){var t=this.selectValue.includes(e.value),n=x.SO.create("div","l7-select-control-item ".concat(t?S.ActiveOptionClassName:"")),r=x.SO.create("img");r.setAttribute("src",e.img),x.SO.setUnDraggable(r),n.appendChild(r);var i=x.SO.create("div","l7-select-control-item-row");this.getIsMultiple()&&n.appendChild(this.createCheckbox(t));var o=x.SO.create("span");return o.innerText=e.text,i.appendChild(o),n.appendChild(i),n}},{key:"createCheckbox",value:function(e){var t=x.SO.create("input");return t.setAttribute("type","checkbox"),e&&x.SO.setChecked(t,!0),t}},{key:"createRadio",value:function(e){var t=x.SO.create("input");return t.setAttribute("type","radio"),e&&x.SO.setChecked(t,!0),t}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find((function(e){return e.img}))}},{key:"transSelectValue",value:function(e){return Array.isArray(e)?e:[e]}}]),n}(E.p)},773:function(e,t,n){"use strict";n.d(t,{d:function(){return R}});var r=n(4479),i=n.n(r),o=n(1448),a=n.n(o),s=n(9558),u=n.n(s),l=n(9989),c=n.n(l),h=n(4528),f=n.n(h),p=n(8798),d=n.n(p),v=n(6626),m=n.n(v),g=n(746),y=n.n(g),_=n(378),b=n.n(_),x=n(7267),E=n.n(x),S=n(9913),A=n.n(S),T=n(9057),C=n.n(T),w=n(9210),R=function(e){E()(r,e);var t,n=A()(r);function r(){var e;f()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),C()(m()(e),"onClick",c()(u()().mark((function t(){var n;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.controlOption.onExport,t.t0=null==n,t.t0){t.next=8;break}return t.t1=n,t.next=6,e.getImage();case 6:t.t2=t.sent,(0,t.t1)(t.t2);case 8:case"end":return t.stop()}}),t)})))),C()(m()(e),"mergeImage",c()(u()().mark((function t(){var n,r,i,o,a,s,l,c,h,f,p,d,v,m=arguments;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=e.controlOption.imageType,o=null!==(n=null===(r=e.mapsService.getContainer())||void 0===r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},a=o.width,s=void 0===a?0:a,l=o.height,c=void 0===l?0:l,(h=document.createElement("canvas")).width=s,h.height=c,f=h.getContext("2d"),p=m.length,d=new Array(p),v=0;v<p;v++)d[v]=m[v];return t.next=9,Promise.all(d.map((function(e){return new Promise((function(t){var n=new Image;n.onload=function(){t(n)},n.src=e}))})));case 9:return t.sent.forEach((function(e){null==f||f.drawImage(e,0,0,s,c)})),t.abrupt("return",h.toDataURL("image/".concat(i)));case 12:case"end":return t.stop()}}),t)})))),e}return d()(r,[{key:"onAdd",value:function(){var e=y()(b()(r.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}},{key:"getDefault",value:function(e){return a()(a()({},y()(b()(r.prototype),"getDefault",this).call(this,e)),{},{title:"导出图片",btnIcon:(0,w.Q)("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:(t=c()(u()().mark((function e(){var t,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mapsService.exportMap("png");case 2:return t=e.sent,e.next=5,this.scene.exportPng("png");case 5:return n=e.sent,e.abrupt("return",this.mergeImage.apply(this,i()([t,n].filter((function(e){return e})))));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(n(9743).Z)},7669:function(e,t,n){"use strict";n.d(t,{i:function(){return D}});var r=n(1448),i=n.n(r),o=n(9558),a=n.n(o),s=n(9989),u=n.n(s),l=n(4528),c=n.n(l),h=n(8798),f=n.n(h),p=n(6626),d=n.n(p),v=n(746),m=n.n(v),g=n(378),y=n.n(g),_=n(7267),b=n.n(_),x=n(9913),E=n.n(x),S=n(9057),A=n.n(S),T=n(6490),C=n(9210),w=n(3100),R=n.n(w),M=n(6970),k=n.n(M),L=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],O=function(){if("undefined"==typeof document)return!1;for(var e=L[0],t={},n=0,r=L;n<r.length;n++){var i=r[n];if((null==i?void 0:i[1])in document){var o,a=k()(i.entries());try{for(a.s();!(o=a.n()).done;){var s=R()(o.value,2),u=s[0],l=s[1];t[e[u]]=l}}catch(e){a.e(e)}finally{a.f()}return t}}return!1}(),P={change:O.fullscreenchange,error:O.fullscreenerror},I={request:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise((function(n,r){var i=function e(){I.off("change",e),n()};I.on("change",i);var o=e[O.requestFullscreen](t);o instanceof Promise&&o.then(i).catch(r)}))},exit:function(){return new Promise((function(e,t){if(I.isFullscreen){var n=function t(){I.off("change",t),e()};I.on("change",n);var r=document[O.exitFullscreen]();r instanceof Promise&&r.then(n).catch(t)}else e()}))},toggle:function(e,t){return I.isFullscreen?I.exit():I.request(e,t)},onchange:function(e){I.on("change",e)},onerror:function(e){I.on("error",e)},on:function(e,t){var n=P[e];n&&document.addEventListener(n,t,!1)},off:function(e,t){var n=P[e];n&&document.removeEventListener(n,t,!1)},raw:O};Object.defineProperties(I,{isFullscreen:{get:function(){return Boolean(document[O.fullscreenElement])}},element:{enumerable:!0,get:function(){var e;return null!==(e=document[O.fullscreenElement])&&void 0!==e?e:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[O.fullscreenEnabled])}}}),O||(I={isEnabled:!1});var N=I,D=function(e){b()(n,e);var t=E()(n);function n(e){var r;return c()(this,n),r=t.call(this,e),A()(d()(r),"isFullscreen",!1),A()(d()(r),"mapContainer",void 0),A()(d()(r),"toggleFullscreen",u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!N.isEnabled){e.next=3;break}return e.next=3,N.toggle(r.mapContainer);case 3:case"end":return e.stop()}}),e)})))),A()(d()(r),"onClick",(function(){r.toggleFullscreen()})),A()(d()(r),"onFullscreenChange",(function(){r.isFullscreen=!!document.fullscreenElement;var e=r.controlOption,t=e.btnText,n=e.btnIcon,i=e.title,o=e.exitBtnText,a=e.exitBtnIcon,s=e.exitTitle;r.isFullscreen?(r.setBtnTitle(s),r.setBtnText(o),r.setBtnIcon(a)):(r.setBtnTitle(i),r.setBtnText(t),r.setBtnIcon(n)),r.emit("fullscreenChange",r.isFullscreen)})),N.isEnabled||console.warn("当前浏览器环境不支持对地图全屏化"),r}return f()(n,[{key:"setOptions",value:function(e){var t=e.exitBtnText,r=e.exitBtnIcon,i=e.exitTitle;this.isFullscreen&&(this.checkUpdateOption(e,["exitBtnIcon"])&&this.setBtnIcon(r),this.checkUpdateOption(e,["exitBtnText"])&&this.setBtnText(t),this.checkUpdateOption(e,["exitTitle"])&&this.setBtnTitle(i)),m()(y()(n.prototype),"setOptions",this).call(this,e)}},{key:"onAdd",value:function(){var e=m()(y()(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),this.mapContainer=T.SO.getContainer(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),e}},{key:"onRemove",value:function(){m()(y()(n.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(e){return i()(i()({},m()(y()(n.prototype),"getDefault",this).call(this,e)),{},{title:"全屏",btnIcon:(0,C.Q)("l7-icon-fullscreen"),exitTitle:"退出全屏",exitBtnIcon:(0,C.Q)("l7-icon-exit-fullscreen")})}}]),n}(n(9743).Z)},6506:function(e,t,n){"use strict";n.d(t,{v:function(){return C}});var r=n(1448),i=n.n(r),o=n(9558),a=n.n(o),s=n(9989),u=n.n(s),l=n(4528),c=n.n(l),h=n(8798),f=n.n(h),p=n(6626),d=n.n(p),v=n(746),m=n.n(v),g=n(378),y=n.n(g),_=n(7267),b=n.n(_),x=n(9913),E=n.n(x),S=n(9057),A=n.n(S),T=n(9210),C=function(e){b()(n,e);var t=E()(n);function n(e){var r;return c()(this,n),r=t.call(this,e),A()(d()(r),"getGeoLocation",(function(){return new Promise((function(e,t){window.navigator.geolocation.getCurrentPosition((function(n){var r=n.coords,i=null!=r?r:{},o=i.longitude,a=i.latitude;isNaN(o)||isNaN(a)?t():e([o,a])}),(function(e){t(e)}))}))})),A()(d()(r),"onClick",u()(a()().mark((function e(){var t,n,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.navigator.geolocation){e.next=2;break}return e.abrupt("return");case 2:return t=r.controlOption.transform,e.next=5,r.getGeoLocation();case 5:if(n=e.sent,i=r.mapsService.getZoom(),e.t0=r.mapsService,e.t1=i>15?i:15,!t){e.next=15;break}return e.next=12,t(n);case 12:e.t2=e.sent,e.next=16;break;case 15:e.t2=n;case 16:e.t3=e.t2,e.t0.setZoomAndCenter.call(e.t0,e.t1,e.t3);case 18:case"end":return e.stop()}}),e)})))),window.navigator.geolocation||console.warn("当前浏览器环境不支持获取地理定位"),r}return f()(n,[{key:"getDefault",value:function(e){return i()(i()({},m()(y()(n.prototype),"getDefault",this).call(this,e)),{},{title:"定位",btnIcon:(0,T.Q)("l7-icon-reposition")})}},{key:"onAdd",value:function(){var e=m()(y()(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}}]),n}(n(9743).Z)},8727:function(e,t,n){"use strict";n.d(t,{F:function(){return S}});var r=n(1448),i=n.n(r),o=n(4528),a=n.n(o),s=n(8798),u=n.n(s),l=n(6626),c=n.n(l),h=n(746),f=n.n(h),p=n(378),d=n.n(p),v=n(7267),m=n.n(v),g=n(9913),y=n.n(g),_=n(9057),b=n.n(_),x=n(9210);function E(e){return Object.keys(null!=e?e:{}).every((function(e){return["layer","name","img"].includes(e)}))}var S=function(e){m()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),b()(c()(e),"onLayerChange",(function(){var t;null!==(t=e.controlOption.layers)&&void 0!==t&&t.length||(e.selectValue=e.getLayerVisible(),e.setOptions({options:e.getLayerOptions()}))})),b()(c()(e),"onLayerVisibleChane",(function(){e.setSelectValue(e.getLayerVisible())})),b()(c()(e),"onSelectChange",(function(){e.layers.forEach((function(t){var n=e.selectValue.includes(t.name),r=t.isVisible();n&&!r&&t.show(),!n&&r&&t.hide()}))})),e}return u()(n,[{key:"layers",get:function(){var e=this.layerService,t=this.controlOption.layers;if(Array.isArray(t)&&t.length){var n=[];return t.forEach((function(t){if(t instanceof Object&&(E(t)?n.push(t.layer):n.push(t)),"string"==typeof t){var r=e.getLayer(t)||e.getLayerByName(t);r&&n.push(r)}})),n}return e.getLayers()||[]}},{key:"getDefault",value:function(e){var t;return i()(i()({},f()(d()(n.prototype),"getDefault",this).call(this,e)),{},{title:"图层控制",btnIcon:(0,x.Q)("l7-icon-layer"),options:[],multiple:null===(t=null==e?void 0:e.multiple)||void 0===t||t})}},{key:"getLayerVisible",value:function(){return this.layers.filter((function(e){return e.isVisible()})).map((function(e){return e.name}))}},{key:"getLayerOptions",value:function(){var e=this,t=this.controlOption.layers,n=null==t?void 0:t.every((function(e){return e.img}));return t?null==t?void 0:t.map((function(t){if(E(t))return{text:t.name||t.layer.name,value:t.layer.name,img:n?t.img:void 0};if("string"==typeof t){var r=e.layerService.getLayer(t)||e.layerService.getLayerByName(t);return{text:null==r?void 0:r.name,value:null==r?void 0:r.name}}return{text:t.name,value:t.name}})):this.layers.map((function(e){return{text:e.name,value:e.name}}))}},{key:"setOptions",value:function(e){var t=this.checkUpdateOption(e,["layers","multiple"]);f()(d()(n.prototype),"setOptions",this).call(this,e),t&&(!1===this.controlOption.multiple&&this.handleSingleSelection(),this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"handleSingleSelection",value:function(){this.layers.forEach((function(e,t){0===t?e.show():e.hide()}))}},{key:"onAdd",value:function(){var e;return!1===this.controlOption.multiple&&this.handleSingleSelection(),null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),f()(d()(n.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return this.controlOption.multiple}}]),n}(n(6633).Z)},1658:function(e,t,n){"use strict";n.d(t,{T:function(){return g}});var r=n(4528),i=n.n(r),o=n(8798),a=n.n(o),s=n(746),u=n.n(s),l=n(378),c=n.n(l),h=n(7267),f=n.n(h),p=n(9913),d=n.n(p),v=n(6490),m=n(830),g=function(e){f()(n,e);var t=d()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getDefault",value:function(){return{position:m.d.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var e=v.SO.create("div","l7-control-logo");return this.setLogoContent(e),e}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(e){u()(c()(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["img","href"])&&(v.SO.clearChildren(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(e){var t=this.controlOption,n=t.href,r=t.img,i=v.SO.create("img");if(i.setAttribute("src",r),i.setAttribute("aria-label","AntV logo"),v.SO.setUnDraggable(i),n){var o=v.SO.create("a","l7-control-logo-link");o.target="_blank",o.href=n,o.rel="noopener nofollow",o.setAttribute("rel","noopener nofollow"),o.appendChild(i),e.appendChild(o)}else e.appendChild(i)}}]),n}(m.oT)},4059:function(e,t,n){"use strict";n.d(t,{Y:function(){return C}});var r=n(3100),i=n.n(r),o=n(1448),a=n.n(o),s=n(4528),u=n.n(s),l=n(8798),c=n.n(l),h=n(6626),f=n.n(h),p=n(746),d=n.n(p),v=n(378),m=n.n(v),g=n(7267),y=n.n(g),_=n(9913),b=n.n(_),x=n(9057),E=n.n(x),S={normal:{text:"标准",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"月光银",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"幻影黑",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"草色青",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"雅士灰",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"涂鸦",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"马卡龙",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"极夜蓝",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"酱籽",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},A={normal:{text:"标准",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"亮",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"暗",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"卫星",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"户外",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}},T=n(9210),C=function(e){y()(n,e);var t=b()(n);function n(){var e;u()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),E()(f()(e),"onMapThemeChange",(function(){e.mapsService.setMapStyle(e.selectValue[0])})),e}return c()(n,[{key:"getDefault",value:function(e){return a()(a()({},d()(m()(n.prototype),"getDefault",this).call(this,e)),{},{title:"地图样式",btnIcon:(0,T.Q)("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var e="mapbox"===this.mapsService.getType()?A:S;return Object.entries(this.mapsService.getMapStyleConfig()).filter((function(e){var t=i()(e,2),n=t[0];return"string"==typeof t[1]&&"blank"!==n})).map((function(t){var n,r=i()(t,2),o=r[0],a=r[1],s=null!==(n=e[o])&&void 0!==n?n:{},u=s.text;return{text:null!=u?u:o,value:a,img:s.img,key:o}}))}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var e,t=this;if(null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var r,i,o=this.controlOption.defaultValue;this.controlOption.defaultValue=null!==(r=null===(i=this.controlOption.options.find((function(e){return e.key===o})))||void 0===i?void 0:i.value)&&void 0!==r?r:o}else{var a=this.getMapStyle();a?this.controlOption.defaultValue=a:this.mapsService.map.once("styledata",(function(){var e=t.mapsService.getMapStyle();t.controlOption.defaultValue=e,t.setSelectValue(e,!1)}))}return this.on("selectChange",this.onMapThemeChange),d()(m()(n.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),n}(n(6633).Z)},8113:function(e,t,n){"use strict";n.d(t,{A:function(){return T}});var r=n(3100),i=n.n(r),o=n(1448),a=n.n(o),s=n(4528),u=n.n(s),l=n(8798),c=n.n(l),h=n(6626),f=n.n(h),p=n(746),d=n.n(p),v=n(378),m=n.n(v),g=n(7267),y=n.n(g),_=n(9913),b=n.n(_),x=n(9057),E=n.n(x),S=n(3292),A=n(6490),T=function(e){y()(n,e);var t=b()(n);function n(){var e;u()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),E()(f()(e),"location",[0,0]),E()(f()(e),"onMouseMove",(function(t){var n=e.location,r=t.lngLat||t.lnglat,i=e.controlOption.transform;r&&(n=[r.lng,r.lat]),e.location=n,i&&(n=i(n)),e.insertLocation2HTML(n),e.emit("locationChange",n)})),e}return c()(n,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(e){return a()(a()({},d()(m()(n.prototype),"getDefault",this).call(this,e)),{},{position:S.PositionType.BOTTOMLEFT,transform:function(e){var t=i()(e,2),n=t[0],r=t[1];return[+(+n).toFixed(6),+(+r).toFixed(6)]}})}},{key:"onAdd",value:function(){var e=A.SO.create("div","l7-control-mouse-location");return e.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),e}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(e){this.container.innerText=e.join(", ")}}]),n}(n(866).ZP)},3956:function(e,t,n){"use strict";n.d(t,{C:function(){return S}});var r=n(1448),i=n.n(r),o=n(4528),a=n.n(o),s=n(8798),u=n.n(s),l=n(6626),c=n.n(l),h=n(746),f=n.n(h),p=n(378),d=n.n(p),v=n(7267),m=n.n(v),g=n(9913),y=n.n(g),_=n(9057),b=n.n(_),x=n(6490),E=n(830),S=function(e){m()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),b()(c()(e),"mScale",void 0),b()(c()(e),"iScale",void 0),b()(c()(e),"update",(function(){var t=e.mapsService,n=e.controlOption.maxWidth,r=t.getSize()[1]/2,i=t.containerToLngLat([0,r]),o=t.containerToLngLat([n,r]),a=(0,x.yM)([i.lng,i.lat],[o.lng,o.lat]);e.updateScales(a)})),e}return u()(n,[{key:"getDefault",value:function(e){return i()(i()({},f()(d()(n.prototype),"getDefault",this).call(this,e)),{},{name:"scale",position:E.d.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var e=x.SO.create("div","l7-control-scale");this.resetScaleLines(e);var t=this.controlOption.updateWhenIdle;return this.mapsService.on(t?"moveend":"mapmove",this.update),this.mapsService.on(t?"zoomend":"zoomchange",this.update),e}},{key:"onRemove",value:function(){var e=this.controlOption.updateWhenIdle;this.mapsService.off(e?"zoomend":"zoomchange",this.update),this.mapsService.off(e?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(e){f()(d()(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(e){var t=this.controlOption,n=t.metric,r=t.imperial;n&&e&&this.updateMetric(e),r&&e&&this.updateImperial(e)}},{key:"resetScaleLines",value:function(e){x.SO.clearChildren(e);var t=this.controlOption,n=t.metric,r=t.imperial,i=t.maxWidth;t.lockWidth&&x.SO.addStyle(e,"width: ".concat(i,"px")),n&&(this.mScale=x.SO.create("div","l7-control-scale-line",e)),r&&(this.iScale=x.SO.create("div","l7-control-scale-line",e)),this.update()}},{key:"updateScale",value:function(e,t,n){var r=this.controlOption.maxWidth;e.style.width=Math.round(r*n)+"px",e.innerHTML=t}},{key:"getRoundNum",value:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"updateMetric",value:function(e){var t=this.getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this.updateScale(this.mScale,n,t/e)}},{key:"updateImperial",value:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this.getRoundNum(t),this.updateScale(this.iScale,n+" mi",n/t)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}}]),n}(E.oT)},4271:function(e,t,n){"use strict";n.d(t,{o:function(){return R}});var r=n(4479),i=n.n(r),o=n(3100),a=n.n(o),s=n(1448),u=n.n(s),l=n(4528),c=n.n(l),h=n(8798),f=n.n(h),p=n(6626),d=n.n(p),v=n(746),m=n.n(v),g=n(378),y=n.n(g),_=n(7267),b=n.n(_),x=n(9913),E=n.n(x),S=n(9057),A=n.n(S),T=n(3292),C=n(7702),w=n(6490),R=function(e){b()(n,e);var t=E()(n);function n(){var e;c()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),A()(d()(e),"isMoving",!1),A()(d()(e),"maskLayer",void 0),A()(d()(e),"move",(function(t){switch(t.stopPropagation(),t.type){case"touchcancel":case"touchend":case"mouseup":var n;e.isMoving=!1,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach((function(t){document.removeEventListener(t,e.move)})),null===(n=e.scene)||void 0===n||n.render();break;case"mousedown":case"touchstart":e.isMoving=!0,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach((function(t){document.addEventListener(t,e.move)}));case"mousemove":case"touchmove":if(e.isMoving)if("vertical"===e.controlOption.orientation){var r;if("pageX"in t?r=t.pageX:t.touches&&t.touches.length&&t.touches[0].pageX?r=t.touches[0].pageX:t.changedTouches&&t.changedTouches.length&&(r=t.changedTouches[0].pageX),!r)break;var i=e.getContainerDOMRect(),o=e.getContainerSize(),a=o[0],s=r-((null==i?void 0:i.left)||0)+window.scrollX-document.documentElement.clientLeft,u=a-Math.min(Math.max(0,a-s),a),l=u/a;e.setOptions({ratio:l}),e.emit("moving",{size:[u,o[1]],ratio:[l,0]})}else{var c;if("pageY"in t?c=t.pageY:t.touches&&t.touches.length&&t.touches[0].pageY?c=t.touches[0].pageY:t.changedTouches&&t.changedTouches.length&&(c=t.changedTouches[0].pageY),!c)break;var h=e.getContainerDOMRect(),f=e.getContainerSize(),p=f[1],d=c-((null==h?void 0:h.top)||0)+window.scrollY-document.documentElement.clientTop,v=p-Math.min(Math.max(0,p-d),p),m=v/p;e.setOptions({ratio:m}),e.emit("moving",{size:[f[0],v],ratio:[0,m]})}}})),A()(d()(e),"getMaskLayer",(function(){return console.log(e.getMaskGeoData()),new C.Z({visible:!1}).source(e.getMaskGeoData()).shape("fill").color("red").style({opacity:.1})})),A()(d()(e),"updateMask",(function(){var t;if(e.mapsService){var n=e.getMaskGeoData();null===(t=e.maskLayer)||void 0===t||t.setData(n)}})),e}return f()(n,[{key:"getDefault",value:function(){return u()(u()({},m()(y()(n.prototype),"getDefault",this).call(this)),{},{layers:[],rightLayers:[],ratio:.5,orientation:"vertical"})}},{key:"onAdd",value:function(){var e=w.SO.create("div","l7-control-swipe");w.SO.create("button","l7-control-swipe__button",e);var t=this.controlOption,n=t.orientation,r=void 0===n?"vertical":n,i=t.ratio,o=void 0===i?.5:i;return"horizontal"===r?(e.style.top=100*o+"%",e.style.left=""):(e.style.left=100*o+"%",e.style.top=""),e.classList.add(r),e}},{key:"addTo",value:function(e){this.mapsService=e.mapService,this.renderService=e.rendererService,this.layerService=e.layerService,this.controlService=e.controlService,this.configService=e.globalConfigService,this.scene=e.sceneService,this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd();var t=this.controlOption,n=t.className,r=t.style,i=t.layers,o=t.rightLayers;n&&this.setClassName(n),r&&this.setStyle(r),this.mapsService.getMarkerContainer().appendChild(this.container),this.maskLayer=this.getMaskLayer(),this.registerEvent();var a=(0,T.createLayerContainer)(e);return this.maskLayer.setContainer(a),this.scene.addLayer(this.maskLayer),this.addMaskToLayers(i,!1),this.addMaskToLayers(o,!0),this.emit("add",this),this}},{key:"onRemove",value:function(){if(this.maskLayer){var e,t=this.controlOption,n=t.layers,r=t.rightLayers;this.removeMaskFromLayers(n),this.removeMaskFromLayers(r),null===(e=this.layerService)||void 0===e||e.remove(this.maskLayer)}this.unRegisterEvent(),this.removeAllListeners()}},{key:"show",value:function(){var e,t=this.container;w.SO.removeClass(t,"l7-control-swipe_hide");var n=this.controlOption,r=n.layers,i=n.rightLayers;r.forEach((function(e){return e.enableMask()})),i.forEach((function(e){return e.enableMask()})),null===(e=this.scene)||void 0===e||e.render(),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var e,t=this.container;w.SO.addClass(t,"l7-control-swipe_hide");var n=this.controlOption,r=n.layers,i=n.rightLayers;r.forEach((function(e){return e.disableMask()})),i.forEach((function(e){return e.disableMask()})),null===(e=this.scene)||void 0===e||e.render(),this.isShow=!1,this.emit("hide",this)}},{key:"setOptions",value:function(e){var t=u()(u()({},this.controlOption),e);if(e.className&&this.setClassName(e.className),e.style&&this.setStyle(e.style),(e.orientation||void 0!==e.ratio)&&this.setOrientationAndRatio(t.orientation,t.ratio),e.layers){var n=e.layers,r=this.controlOption.layers;this.setLayers(n,r,!1)}if(e.rightLayers){var i=e.rightLayers,o=this.controlOption.rightLayers;this.setLayers(i,o,!0)}this.controlOption=t,this.updateMask()}},{key:"registerEvent",value:function(){this.container.addEventListener("mousedown",this.move),this.container.addEventListener("touchstart",this.move),this.mapsService.on("camerachange",this.updateMask)}},{key:"unRegisterEvent",value:function(){var e;this.container.removeEventListener("mousedown",this.move),this.container.removeEventListener("touchstart",this.move),null===(e=this.mapsService)||void 0===e||e.off("camerachange",this.updateMask)}},{key:"setOrientationAndRatio",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertical",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;this.container.classList.remove("horizontal","vertical"),this.container.classList.add(e),"horizontal"===e?(this.container.style.top=100*t+"%",this.container.style.left=""):(this.container.style.left=100*t+"%",this.container.style.top="")}},{key:"setLayers",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.filter((function(e){return!1===t.includes(e)})),i=t.filter((function(t){return!1===e.includes(t)}));this.addMaskToLayers(r,n),this.removeMaskFromLayers(i)}},{key:"addMaskToLayers",value:function(e,t){var n=this;e.forEach((function(e){e.updateLayerConfig({maskInside:!t}),e.addMask(n.maskLayer)}))}},{key:"removeMaskFromLayers",value:function(e){var t=this;e.forEach((function(e){e.updateLayerConfig({maskInside:!0}),e.removeMask(t.maskLayer)}))}},{key:"getMaskGeoData",value:function(){var e,t=this.controlOption,n=t.ratio,r=void 0===n?.5:n,i=t.orientation,o="vertical"===(void 0===i?"vertical":i),s=this.getBounds(),u=a()(s,2),l=u[0],c=u[1],h=a()(l,2),f=h[0],p=h[1],d=a()(c,2),v=d[0],m=d[1];if(o){var g=f+(v-f)*r;e=[[f,m],[g,m],[g,p],l,[f,m]]}else{var y=this.getContainerSize(),_=this.mapsService.containerToLngLat([y[0],y[1]*r]).lat;e=[[f,m],c,[v,_],[f,_],[f,m]]}return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[e]}}]}}},{key:"getContainerDOMRect",value:function(){var e;return null===(e=this.mapsService.getContainer())||void 0===e?void 0:e.getBoundingClientRect()}},{key:"getContainerSize",value:function(){return this.mapsService.getSize()}},{key:"getBounds",value:function(){return this.mapsService.getBounds()}},{key:"addLayer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Array.isArray(e)?e:[e];if(t){var r,o=(r=this.controlOption.rightLayers).concat.apply(r,i()(n));this.setOptions({rightLayers:o})}else{var a,s=(a=this.controlOption.layers).concat.apply(a,i()(n));this.setOptions({layers:s})}}},{key:"removeLayer",value:function(e){var t=Array.isArray(e)?e:[e],n=this.controlOption.layers.filter((function(e){return t.includes(e)})),r=this.controlOption.rightLayers.filter((function(e){return t.includes(e)}));this.setOptions({layers:n,rightLayers:r})}},{key:"removeLayers",value:function(){this.setOptions({layers:[],rightLayers:[]})}}]),n}(n(830).oT)},6467:function(e,t,n){"use strict";n.d(t,{L:function(){return A}});var r=n(1448),i=n.n(r),o=n(4528),a=n.n(o),s=n(8798),u=n.n(s),l=n(6626),c=n.n(l),h=n(746),f=n.n(h),p=n(378),d=n.n(p),v=n(7267),m=n.n(v),g=n(9913),y=n.n(g),_=n(9057),b=n.n(_),x=n(3292),E=n(6490),S=n(9210),A=function(e){m()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),b()(c()(e),"disabled",void 0),b()(c()(e),"zoomInButton",void 0),b()(c()(e),"zoomOutButton",void 0),b()(c()(e),"zoomNumDiv",void 0),b()(c()(e),"zoomIn",(function(){!e.disabled&&e.mapsService.getZoom()<e.mapsService.getMaxZoom()&&e.mapsService.zoomIn()})),b()(c()(e),"zoomOut",(function(){!e.disabled&&e.mapsService.getZoom()>e.mapsService.getMinZoom()&&e.mapsService.zoomOut()})),b()(c()(e),"updateDisabled",(function(){var t=e.mapsService;e.zoomInButton.removeAttribute("disabled"),e.zoomOutButton.removeAttribute("disabled"),(e.disabled||t.getZoom()<=t.getMinZoom())&&e.zoomOutButton.setAttribute("disabled","true"),e.controlOption.showZoom&&e.zoomNumDiv&&(e.zoomNumDiv.innerText=String(Math.floor(t.getZoom()))),(e.disabled||t.getZoom()>=t.getMaxZoom())&&e.zoomInButton.setAttribute("disabled","true")})),e}return u()(n,[{key:"getDefault",value:function(e){return i()(i()({},f()(d()(n.prototype),"getDefault",this).call(this,e)),{},{position:x.PositionType.BOTTOMRIGHT,name:"zoom",zoomInText:(0,S.Q)("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:(0,S.Q)("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(e){f()(d()(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var e=E.SO.create("div","l7-control-zoom");return this.resetButtonGroup(e),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(e){E.SO.clearChildren(e),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",e,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",e)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",e,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(e,t,n,r,i){var o=E.SO.create("button",n,r);return"string"==typeof e?o.innerHTML=e:o.append(e),o.title=t,i&&o.addEventListener("click",i),o}}]),n}(n(830).oT)},4278:function(e,t,n){"use strict";n.r(t),n.d(t,{ButtonControl:function(){return o.NA},Control:function(){return o.oT},ExportImage:function(){return a.d},Fullscreen:function(){return s.i},GeoLocate:function(){return u.v},LayerPopup:function(){return _.K},LayerSwitch:function(){return l.F},Logo:function(){return c.T},MapTheme:function(){return h.Y},Marker:function(){return r.Z},MarkerLayer:function(){return i.Z},MouseLocation:function(){return f.A},PopperControl:function(){return o.p4},Popup:function(){return b.G},PositionType:function(){return o.d},Scale:function(){return p.C},SelectControl:function(){return o.Yw},Swipe:function(){return d.o},Zoom:function(){return v.L}});var r=n(8281),i=n(635),o=(n(6325),n(830)),a=n(773),s=n(7669),u=n(6506),l=n(8727),c=n(1658),h=n(4059),f=n(8113),p=n(3956),d=n(4271),v=n(6467),m=n(9858),g={};for(var y in m)["default","ExportImage","Fullscreen","GeoLocate","LayerSwitch","Logo","MapTheme","MouseLocation","Scale","Swipe","Zoom","LayerPopup","Popup","Marker","MarkerLayer","ButtonControl","Control","PopperControl","PositionType","SelectControl"].indexOf(y)<0&&(g[y]=function(e){return m[e]}.bind(0,y));n.d(t,g);var _=n(5847),b=n(8535);!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".l7-marker-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n.l7-marker-cluster {\n  width: 40px;\n  height: 40px;\n  background-color: rgba(181, 226, 140, 0.6);\n  background-clip: padding-box;\n  border-radius: 20px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-top: 5px;\n  margin-left: 5px;\n  font:\n    12px 'Helvetica Neue',\n    Arial,\n    Helvetica,\n    sans-serif;\n  text-align: center;\n  background-color: rgba(110, 204, 57, 0.6);\n  border-radius: 15px;\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  background-clip: padding-box;\n  border: 2px solid rgba(0, 0, 0, 0.2);\n}\n.mapboxgl-ctrl-logo,\n.amap-logo {\n  display: none !important;\n}\n.l7-select-box {\n  border: 3px dashed gray;\n  border-radius: 2px;\n  position: absolute;\n  z-index: 999;\n  box-sizing: border-box;\n}\n.l7-control-container {\n  font:\n    12px/1.5 'Helvetica Neue',\n    Arial,\n    Helvetica,\n    sans-serif;\n}\n.l7-control-container .l7-control {\n  position: relative;\n  z-index: 999;\n  float: left;\n  clear: both;\n  color: #595959;\n  font-size: 12px;\n  pointer-events: visiblePainted;\n  /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control-container .l7-control.l7-control--hide {\n  display: none;\n}\n.l7-control-container .l7-top {\n  top: 0;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {\n  margin-top: 8px;\n}\n.l7-control-container .l7-right {\n  right: 0;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {\n  margin-right: 8px;\n}\n.l7-control-container .l7-bottom {\n  bottom: 0;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-left {\n  left: 0;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {\n  margin-left: 8px;\n}\n.l7-control-container .l7-center {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n}\n.l7-control-container .l7-center.l7-top,\n.l7-control-container .l7-center.l7-bottom {\n  width: 100%;\n}\n.l7-control-container .l7-center.l7-left,\n.l7-control-container .l7-center.l7-right {\n  height: 100%;\n}\n.l7-control-container .l7-center .l7-control {\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-row {\n  flex-direction: row;\n}\n.l7-control-container .l7-row.l7-top {\n  align-items: flex-start;\n}\n.l7-control-container .l7-row.l7-bottom {\n  align-items: flex-end;\n}\n.l7-control-container .l7-column {\n  flex-direction: column;\n}\n.l7-control-container .l7-column.l7-left {\n  align-items: flex-start;\n}\n.l7-control-container .l7-column.l7-right {\n  align-items: flex-end;\n}\n.l7-button-control {\n  min-width: 28px;\n  height: 28px;\n  background-color: #fff;\n  border-width: 0;\n  border-radius: 2px;\n  outline: 0;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 0 6px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  line-height: 16px;\n}\n.l7-button-control .l7-iconfont {\n  fill: #595959;\n  color: #595959;\n  width: 16px;\n  height: 16px;\n}\n.l7-button-control.l7-button-control--row {\n  padding: 0 16px 0 13px;\n}\n.l7-button-control.l7-button-control--row * + .l7-button-control__text {\n  margin-left: 8px;\n}\n.l7-button-control.l7-button-control--column {\n  height: 44px;\n  flex-direction: column;\n}\n.l7-button-control.l7-button-control--column .l7-iconfont {\n  margin-top: 3px;\n}\n.l7-button-control.l7-button-control--column .l7-button-control__text {\n  margin-top: 3px;\n  font-size: 10px;\n  -webkit-transform: scale(0.83333);\n          transform: scale(0.83333);\n}\n.l7-button-control:not(:disabled):hover {\n  background-color: #f3f3f3;\n}\n.l7-button-control:not(:disabled):active {\n  background-color: #f3f3f3;\n}\n.l7-button-control:disabled {\n  background-color: #fafafa;\n  color: #bdbdbd;\n  cursor: not-allowed;\n}\n.l7-button-control:disabled .l7-iconfont {\n  fill: #bdbdbd;\n  color: #bdbdbd;\n}\n.l7-button-control:disabled:hover {\n  background-color: #fafafa;\n}\n.l7-button-control:disabled:active {\n  background-color: #fafafa;\n}\n.l7-popper {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 5;\n  color: #595959;\n}\n.l7-popper.l7-popper-hide {\n  display: none;\n}\n.l7-popper .l7-popper-content {\n  min-height: 28px;\n  background: #fff;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper .l7-popper-arrow {\n  width: 0;\n  height: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-top-color: transparent;\n  border-bottom-color: transparent;\n  border-left-color: transparent;\n  border-right-color: transparent;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper.l7-popper-left {\n  flex-direction: row;\n}\n.l7-popper.l7-popper-left .l7-popper-arrow {\n  border-left-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-right {\n  flex-direction: row-reverse;\n}\n.l7-popper.l7-popper-right .l7-popper-arrow {\n  border-right-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-top {\n  flex-direction: column;\n}\n.l7-popper.l7-popper-top .l7-popper-arrow {\n  border-top-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-bottom {\n  flex-direction: column-reverse;\n}\n.l7-popper.l7-popper-bottom .l7-popper-arrow {\n  border-bottom-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-start {\n  align-items: flex-start;\n}\n.l7-popper.l7-popper-end {\n  align-items: flex-end;\n}\n.l7-select-control--normal {\n  padding: 4px 0;\n}\n.l7-select-control--normal .l7-select-control-item {\n  display: flex;\n  align-items: center;\n  height: 24px;\n  padding: 0 16px;\n  font-size: 12px;\n  line-height: 24px;\n}\n.l7-select-control--normal .l7-select-control-item > * + * {\n  margin-left: 6px;\n}\n.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {\n  width: 14px;\n  height: 14px;\n}\n.l7-select-control--normal .l7-select-control-item:hover {\n  background-color: #f3f3f3;\n}\n.l7-select-control--image {\n  display: flex;\n  flex-wrap: wrap;\n  align-items: flex-start;\n  box-sizing: content-box;\n  max-width: 460px;\n  max-height: 400px;\n  margin: 12px 0 0 12px;\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.l7-select-control--image .l7-select-control-item {\n  position: relative;\n  display: flex;\n  flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);\n  flex-direction: column;\n  justify-content: center;\n  box-sizing: content-box;\n  margin-right: 12px;\n  margin-bottom: 12px;\n  overflow: hidden;\n  font-size: 12px;\n  border: 1px solid #fff;\n  border-radius: 2px;\n}\n.l7-select-control--image .l7-select-control-item img {\n  width: 100%;\n  height: 80px;\n}\n.l7-select-control--image .l7-select-control-item input[type='checkbox'] {\n  position: absolute;\n  top: 0;\n  right: 0;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  line-height: 26px;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {\n  margin-left: 8px;\n}\n.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {\n  border-color: #0370fe;\n}\n.l7-select-control-item {\n  cursor: pointer;\n}\n.l7-select-control-item input[type='checkbox'] {\n  margin: 0;\n  cursor: pointer;\n}\n.l7-select-control--multiple .l7-select-control-item:hover {\n  background-color: transparent;\n}\n.l7-control-logo {\n  width: 89px;\n  height: 16px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.l7-control-logo img {\n  height: 100%;\n  width: 100%;\n}\n.l7-control-logo .l7-control-logo-link {\n  display: block;\n  cursor: pointer;\n}\n.l7-control-logo .l7-control-logo-link img {\n  cursor: pointer;\n}\n.l7-control-mouse-location {\n  background-color: #fff;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  padding: 2px 4px;\n  min-width: 130px;\n}\n.l7-control-zoom {\n  overflow: hidden;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-control-zoom .l7-button-control {\n  font-size: 16px;\n  border-bottom: 1px solid #f0f0f0;\n  border-radius: 0;\n  box-shadow: 0 0 0;\n}\n.l7-control-zoom .l7-button-control .l7-iconfont {\n  width: 14px;\n  height: 14px;\n}\n.l7-control-zoom .l7-button-control:last-child {\n  border-bottom: 0;\n}\n.l7-control-zoom .l7-control-zoom__number {\n  color: #595959;\n  padding: 0;\n}\n.l7-control-zoom .l7-control-zoom__number:hover {\n  background-color: #fff;\n}\n.l7-control-scale {\n  display: flex;\n  flex-direction: column;\n}\n.l7-control-scale .l7-control-scale-line {\n  box-sizing: border-box;\n  padding: 2px 5px 1px;\n  overflow: hidden;\n  color: #595959;\n  font-size: 10px;\n  line-height: 1.1;\n  white-space: nowrap;\n  background: #fff;\n  border: 2px solid #000;\n  border-top: 0;\n  transition: width 0.1s;\n}\n.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {\n  margin-top: -2px;\n  border-top: 2px solid #777;\n  border-bottom: none;\n}\n.l7-right .l7-control-scale {\n  display: flex;\n  align-items: flex-end;\n}\n.l7-right .l7-control-scale .l7-control-scale-line {\n  text-align: right;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n}\n.l7-popup.l7-popup-hide {\n  display: none;\n}\n.l7-popup .l7-popup-content {\n  position: relative;\n  padding: 16px;\n  font-size: 14px;\n  background: #fff;\n  border-radius: 3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.l7-popup .l7-popup-content .l7-popup-content__title {\n  margin-bottom: 8px;\n  font-weight: bold;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button,\n.l7-popup .l7-popup-content .l7-popup-content__title,\n.l7-popup .l7-popup-content .l7-popup-content__panel {\n  white-space: normal;\n  -webkit-user-select: text;\n     -moz-user-select: text;\n      -ms-user-select: text;\n          user-select: text;\n  pointer-events: initial;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 18px;\n  height: 18px;\n  padding: 0;\n  font-size: 14px;\n  line-height: 18px;\n  text-align: center;\n  background-color: transparent;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n}\n.l7-popup .l7-popup-tip {\n  position: relative;\n  z-index: 1;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n}\n.l7-popup.l7-popup-anchor-bottom,\n.l7-popup.l7-popup-anchor-bottom-left,\n.l7-popup.l7-popup-anchor-bottom-right {\n  flex-direction: column-reverse;\n}\n.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {\n  bottom: 1px;\n}\n.l7-popup.l7-popup-anchor-top,\n.l7-popup.l7-popup-anchor-top-left,\n.l7-popup.l7-popup-anchor-top-right {\n  flex-direction: column;\n}\n.l7-popup.l7-popup-anchor-top .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {\n  top: 1px;\n}\n.l7-popup.l7-popup-anchor-left {\n  flex-direction: row;\n}\n.l7-popup.l7-popup-anchor-right {\n  flex-direction: row-reverse;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  position: relative;\n  align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-tip {\n  align-self: flex-start;\n  border-top: none;\n  border-bottom-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-top-right .l7-popup-tip {\n  align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-bottom .l7-popup-tip {\n  align-self: center;\n  border-top-color: #fff;\n  border-bottom: none;\n}\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  align-self: flex-start;\n  border-top-color: #fff;\n  border-bottom: none;\n  border-left: none;\n}\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  align-self: flex-end;\n  border-top-color: #fff;\n  border-right: none;\n  border-bottom: none;\n}\n.l7-popup-anchor-left .l7-popup-tip {\n  align-self: center;\n  border-right-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-right .l7-popup-tip {\n  right: 1px;\n  align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n.l7-popup-track-pointer {\n  display: none;\n}\n.l7-popup-track-pointer * {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  pointer-events: none;\n}\n.l7-map:hover .l7-popup-track-pointer {\n  display: flex;\n}\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n.l7-layer-popup__row {\n  font-size: 12px;\n}\n.l7-layer-popup__row + .l7-layer-popup__row {\n  margin-top: 4px;\n}\n.l7-control-swipe {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  z-index: 6;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  touch-action: none;\n}\n.l7-control-swipe_hide {\n  display: none;\n}\n.l7-control-swipe:before {\n  position: absolute;\n  top: -5000px;\n  bottom: -5000px;\n  left: 50%;\n  z-index: -1;\n  width: 4px;\n  background: #fff;\n  -webkit-transform: translate(-2px, 0);\n          transform: translate(-2px, 0);\n  content: '';\n}\n.l7-control-swipe.horizontal:before {\n  top: 50%;\n  right: -5000px;\n  bottom: auto;\n  left: -5000px;\n  width: auto;\n  height: 4px;\n}\n.l7-control-swipe__button {\n  display: block;\n  width: 28px;\n  height: 28px;\n  margin: 0;\n  padding: 0;\n  color: #595959;\n  font-weight: bold;\n  font-size: inherit;\n  text-align: center;\n  text-decoration: none;\n  background-color: #fff;\n  border: none;\n  border-radius: 2px;\n  outline: none;\n}\n.l7-control-swipe,\n.l7-control-swipe__button {\n  cursor: ew-resize;\n}\n.l7-control-swipe.horizontal,\n.l7-control-swipe.horizontal button {\n  cursor: ns-resize;\n}\n.l7-control-swipe:after,\n.l7-control-swipe__button:before,\n.l7-control-swipe__button:after {\n  position: absolute;\n  top: 25%;\n  bottom: 25%;\n  left: 50%;\n  width: 2px;\n  background: currentColor;\n  -webkit-transform: translate(-1px, 0);\n          transform: translate(-1px, 0);\n  content: '';\n}\n.l7-control-swipe__button:after {\n  -webkit-transform: translateX(4px);\n          transform: translateX(4px);\n}\n.l7-control-swipe__button:before {\n  -webkit-transform: translateX(-6px);\n          transform: translateX(-6px);\n}\n")},9858:function(){},635:function(e,t,n){"use strict";n.d(t,{Z:function(){return S}});var r=n(1448),i=n.n(r),o=n(4528),a=n.n(o),s=n(8798),u=n.n(s),l=n(6626),c=n.n(l),h=n(7267),f=n.n(h),p=n(9913),d=n.n(p),v=n(9057),m=n.n(v),g=n(6490),y=n(2490),_=n(4068),b=n.n(_),x=n(8281),E=g.rU.merge,S=function(e){f()(n,e);var t=d()(n);function n(e){var r,i;return a()(this,n),i=t.call(this),m()(c()(i),"markers",[]),m()(c()(i),"markerLayerOption",void 0),m()(c()(i),"clusterIndex",void 0),m()(c()(i),"points",[]),m()(c()(i),"clusterMarkers",[]),m()(c()(i),"mapsService",void 0),m()(c()(i),"scene",void 0),m()(c()(i),"zoom",void 0),m()(c()(i),"bbox",void 0),m()(c()(i),"inited",void 0),m()(c()(i),"containerSize",void 0),i.markerLayerOption=E(i.getDefault(),e),(0,g.Ev)(["update"],c()(i)),i.zoom=(null===(r=i.markerLayerOption.clusterOption)||void 0===r?void 0:r.zoom)||-99,i}return u()(n,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(e){return this.scene=e,this.mapsService=e.mapService,this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(this.mapsService){var e=this.mapsService.getContainer();this.containerSize={containerWidth:(null==e?void 0:e.scrollWidth)||0,containerHeight:(null==e?void 0:e.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(e){var t=this.markerLayerOption.cluster;if(e.getMarkerLayerContainerSize=this.getContainerSize.bind(this),t&&(this.addPoint(e,this.markers.length),this.mapsService)){var n=this.mapsService.getZoom(),r=this.mapsService.getBounds();this.bbox=(0,g.yA)(r,.5),this.zoom=Math.floor(n),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(e)}},{key:"removeMarker",value:function(e){this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&(this.markers.splice(t,1),this.markerLayerOption.cluster&&(this.removePoint(t),this.mapsService&&this.getClusterMarker(this.bbox,this.zoom)))}},{key:"hide",value:function(){this.markers.map((function(e){e.getElement().style.opacity="0"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="0"}))}},{key:"show",value:function(){this.markers.map((function(e){e.getElement().style.opacity="1"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="1"}))}},{key:"getMarkers",value:function(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}},{key:"getOriginMarkers",value:function(){return this.markers}},{key:"addMarkers",value:function(){var e=this;this.getMarkers().forEach((function(t){t.addTo(e.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(e){e.remove()})),this.clusterMarkers.forEach((function(e){e.remove()})),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(e,t){var n=e.getLnglat(),r={geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:i()(i()({},e.getExtData()),{},{marker_id:t})};this.points.push(r),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"removePoint",value:function(e){var t=this.points.findIndex((function(t){return t.properties.marker_id===e}));t>-1&&this.points.splice(t,1),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var e=this.markerLayerOption.clusterOption,t=e.radius,n=e.minZoom,r=void 0===n?0:n,i=e.maxZoom;this.clusterIndex=new(b())({radius:t,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(e,t){var n=this,r=e[0].concat(e[1]),i=this.clusterIndex.getClusters(r,t);this.clusterMarkers.forEach((function(e){e.remove()})),this.clusterMarkers=[],i.forEach((function(e){var t,r=n.markerLayerOption.clusterOption,i=r.field,o=r.method;if(null!==(t=e.properties)&&void 0!==t&&t.cluster_id){var a,s=n.getLeaves(null===(a=e.properties)||void 0===a?void 0:a.cluster_id);if(e.properties.clusterData=s,i&&o){var u=null==s?void 0:s.map((function(e){return m()({},i,e.properties[i])})),l=g.a5.getColumn(u,i),c=g.a5.getSatByColumn(o,l),h="point_"+o;e.properties[h]=c.toFixed(2)}}var f=n.clusterMarker(e);n.clusterMarkers.push(f),f.addTo(n.scene)}))}},{key:"getLeaves",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e?this.clusterIndex.getLeaves(e,t,n):null}},{key:"clusterMarker",value:function(e){var t=this.markerLayerOption.clusterOption.element,n=void 0===t?this.generateElement.bind(this):t;return new x.Z({element:n(e)}).setLnglat({lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]})}},{key:"normalMarker",value:function(e){var t=e.properties.marker_id;return this.markers[t]}},{key:"update",value:function(){if(this.mapsService&&0!==this.markers.length){var e=this.mapsService.getZoom(),t=this.mapsService.getBounds();(!this.bbox||Math.abs(e-this.zoom)>=1||!(0,g.oO)(this.bbox,t))&&(this.bbox=(0,g.yA)(t,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(e){var t=g.SO.create("div","l7-marker-cluster"),n=g.SO.create("div","",t),r=g.SO.create("span","",n),i=this.markerLayerOption.clusterOption,o=i.field,a=i.method;e.properties.point_count=e.properties.point_count||1;var s=o&&a?e.properties["point_"+a]||e.properties[o]:e.properties.point_count;return r.textContent=s,t}}]),n}(y.EventEmitter)},8281:function(e,t,n){"use strict";n.d(t,{Z:function(){return _}});var r=n(1448),i=n.n(r),o=n(4528),a=n.n(o),s=n(8798),u=n.n(s),l=n(6626),c=n.n(l),h=n(7267),f=n.n(h),p=n(9913),d=n.n(p),v=n(9057),m=n.n(v),g=n(6490),y=n(2490),_=function(e){f()(n,e);var t=d()(n);function n(e){var r;return a()(this,n),r=t.call(this),m()(c()(r),"markerOption",void 0),m()(c()(r),"popup",void 0),m()(c()(r),"mapsService",void 0),m()(c()(r),"lngLat",void 0),m()(c()(r),"scene",void 0),m()(c()(r),"added",!1),m()(c()(r),"preLngLat",{lng:0,lat:0}),m()(c()(r),"onMarkerDragStart",(function(e){var t=r.mapsService.getContainer();if(t){r.mapsService.setMapStatus({dragEnable:!1,zoomEnable:!1});var n=t.getClientRects()[0],i=n.left,o=n.top,a=e.x,s=e.y;r.preLngLat=r.mapsService.containerToLngLat([a-i,s-o]),r.mapsService.on("mousemove",r.onMarkerDragMove),document.addEventListener("mouseup",r.onMarkerDragEnd),r.emit("dragstart",r.lngLat)}})),m()(c()(r),"onMarkerDragMove",(function(e){var t=r.preLngLat,n=t.lng,i=t.lat,o=e.lnglat,a=o.lng,s=o.lat,u={lng:r.lngLat.lng+a-n,lat:r.lngLat.lat+s-i};r.setLnglat(u),r.preLngLat=e.lnglat,r.emit("dragging",u)})),m()(c()(r),"onMarkerDragEnd",(function(){r.mapsService.setMapStatus({dragEnable:!0,zoomEnable:!0}),r.mapsService.off("mousemove",r.onMarkerDragMove),document.removeEventListener("mouseup",r.onMarkerDragEnd),r.emit("dragend",r.lngLat)})),m()(c()(r),"eventHandle",(function(e){r.polyfillEvent(e),r.emit(e.type,{target:e,data:r.markerOption.extData,lngLat:r.lngLat})})),m()(c()(r),"touchStartTime",void 0),r.markerOption=i()(i()({},r.getDefault()),e),(0,g.Ev)(["update","onMove","onMapClick","updatePositionWhenZoom"],c()(r)),r.init(),r}return u()(n,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:g.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(e){this.scene=e,this.mapsService=e.mapService;var t=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.mapsService.on("camerachange",this.update),this.update(),this.updateDraggable(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var e=this.markerOption.element;return e&&g.SO.remove(e),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(e){var t=this;if(!this.added)return this.once("added",(function(){t.setElement(e)})),this;var n=this.markerOption.element;return n&&g.SO.remove(n),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.updateDraggable(),this.update(),this}},{key:"openPopup",value:function(){var e=this;if(!this.added)return this.once("added",(function(){e.openPopup()})),this;var t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var e=this;this.added||this.once("added",(function(){e.closePopup()}));var t=this.popup;return t&&t.remove(),this}},{key:"setPopup",value:function(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var e=this.popup;return e?(e.isOpen()?e.remove():e.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(e){this.markerOption.draggable=e,this.updateDraggable()}},{key:"getDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(e){this.markerOption.extData=e}},{key:"update",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.anchor;this.updatePosition(),g.SO.setTransform(t,"".concat(g.rQ[n]))}}},{key:"updatePositionWhenZoom",value:function(e){if(this.mapsService){var t=this.markerOption,n=t.element,r=t.offsets,i=this.lngLat,o=i.lng,a=i.lat;if(n){n.style.display="block",n.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,l=s.containerWidth,c=s.bounds;if(!c)return;var h=e.map,f=e.center,p=e.zoom,d=h.DE(this.lngLat,p,f);if(d.x=Math.round(d.x+r[0]),d.y=Math.round(d.y-r[1]),Math.abs(c[0][0])>180||Math.abs(c[1][0])>180){if(d.x>l){var v=this.mapsService.lngLatToContainer([o-360,a]);d.x=v.x}if(d.x<0){var m=this.mapsService.lngLatToContainer([o+360,a]);d.x=m.x}}(d.x>l||d.x<0||d.y>u||d.y<0)&&(n.style.display="none"),n.style.left=d.x+"px",n.style.top=d.y+"px",n.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)"}}}},{key:"onMapClick",value:function(e){var t=this.markerOption.element;this.popup&&t&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var e=this.mapsService.getContainer();return{containerHeight:(null==e?void 0:e.scrollHeight)||0,containerWidth:(null==e?void 0:e.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updateDraggable",value:function(){var e=this.markerOption.element;null==e||e.removeEventListener("mousedown",this.onMarkerDragStart),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.markerOption.draggable&&(null==e||e.addEventListener("mousedown",this.onMarkerDragStart))}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.lngLatToContainer([i,o]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,l=s.containerWidth,c=s.bounds;if(!c)return;if(Math.abs(c[0][0])>180||Math.abs(c[1][0])>180){if(a.x>l){var h=this.mapsService.lngLatToContainer([i-360,o]);a.x=h.x}if(a.x<0){var f=this.mapsService.lngLatToContainer([i+360,o]);a.x=f.x}}(a.x>l||a.x<0||a.y>u||a.y<0)&&(t.style.display="none"),t.style.left=a.x+n[0]+"px",t.style.top=a.y-n[1]+"px"}}}},{key:"init",value:function(){var e=this,t=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!t){t=g.SO.create("div"),this.markerOption.element=t;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),t.appendChild(o)}g.SO.addClass(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,o=(null===(r=e.markerOption)||void 0===r?void 0:r.style)&&(null===(i=e.markerOption)||void 0===i?void 0:i.style[n]);t&&(t.style[n]=o)})),(0,g.zi)(t,i,"marker")}},{key:"registerMarkerEvent",value:function(e){e.addEventListener("click",this.onMapClick),e.addEventListener("mousemove",this.eventHandle),e.addEventListener("click",this.eventHandle),e.addEventListener("mousedown",this.eventHandle),e.addEventListener("mouseup",this.eventHandle),e.addEventListener("dblclick",this.eventHandle),e.addEventListener("contextmenu",this.eventHandle),e.addEventListener("mouseover",this.eventHandle),e.addEventListener("mouseout",this.eventHandle),e.addEventListener("touchstart",this.eventHandle),e.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var e=this.getElement();e.removeEventListener("click",this.onMapClick),e.removeEventListener("mousemove",this.eventHandle),e.removeEventListener("click",this.eventHandle),e.removeEventListener("mousedown",this.eventHandle),e.removeEventListener("mouseup",this.eventHandle),e.removeEventListener("dblclick",this.eventHandle),e.removeEventListener("contextmenu",this.eventHandle),e.removeEventListener("mouseover",this.eventHandle),e.removeEventListener("mouseout",this.eventHandle),e.removeEventListener("touchstart",this.eventHandle),e.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(e){this.mapsService&&"GAODE2.x"===this.mapsService.version&&((0,g.Ro)()||("touchstart"===e.type&&(this.touchStartTime=Date.now()),"touchend"===e.type&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:e,data:this.markerOption.extData,lngLat:this.lngLat})))}},{key:"addDragHandler",value:function(e){return null}},{key:"onUp",value:function(e){throw new Error("Method not implemented.")}}]),n}(y.EventEmitter)},5847:function(e,t,n){"use strict";n.d(t,{K:function(){return A}});var r=n(1448),i=n.n(r),o=n(4528),a=n.n(o),s=n(8798),u=n.n(s),l=n(6626),c=n.n(l),h=n(746),f=n.n(h),p=n(378),d=n.n(p),v=n(7267),m=n.n(v),g=n(9913),y=n.n(g),_=n(9057),b=n.n(_),x=n(6490),E=n(8535),S=x.rU.get,A=function(e){m()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),b()(c()(e),"layerClickCountByFrame",0),b()(c()(e),"layerConfigMap",new WeakMap),b()(c()(e),"displayFeatureInfo",void 0),b()(c()(e),"onLayerClick",(function(t,n){requestAnimationFrame((function(){if(e.popupOption.closeOnClick&&e.layerClickCountByFrame++,e.isShow&&e.isSameFeature(t,n.featureId))e.hide();else{var r=e.getLayerInfoFrag(t,n),i=r.title,o=r.content;e.setDOMContent(o),e.setLnglat(n.lngLat),e.setTitle(i),e.setDisplayFeatureInfo({layer:t,featureId:n.featureId}),e.show()}}))})),b()(c()(e),"onSceneClick",(function(){e.layerClickCountByFrame=0,requestAnimationFrame((function(){e.layerClickCountByFrame||e.hide()}))})),b()(c()(e),"onLayerHide",(function(){e.hide(),e.setDisplayFeatureInfo(void 0)})),b()(c()(e),"updateCloseOnClick",(function(){})),e}return u()(n,[{key:"layerConfigItems",get:function(){var e,t=this.popupOption,n=t.config,r=t.items;return null!==(e=null!=n?n:r)&&void 0!==e?e:[]}},{key:"addTo",value:function(e){return f()(d()(n.prototype),"addTo",this).call(this,e),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return f()(d()(n.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(e){this.unbindLayerEvent();var t=i()({},e),r=t.trigger||this.popupOption.trigger,o=t.items||this.popupOption.items,a=0===(null==o?void 0:o.length);t.followCursor="hover"===r&&!a;var s=this.isShow;return f()(d()(n.prototype),"setOptions",this).call(this,t),this.bindLayerEvent(),!a&&s||this.hide(),this}},{key:"getDefault",value:function(e){var t="hover"===e.trigger;return i()(i()({},f()(d()(n.prototype),"getDefault",this).call(this,e)),{},{trigger:"hover",followCursor:t,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var e=this,t=this.popupOption,n=t.trigger,r=t.closeOnClick;this.layerConfigItems.forEach((function(t){var o,a=e.getLayerByConfig(t);if(a){var s=i()({},t);if("hover"===n){var u=e.onLayerMouseMove.bind(e,a),l=e.onLayerMouseOut.bind(e,a);s.onMouseMove=u,s.onMouseOut=l,null==a||a.on("mousemove",u),null==a||a.on("mouseout",l)}else{var c,h=e.onLayerClick.bind(e,a);s.onClick=h,null==a||a.on("click",h);var f=null===(c=e.mapsService)||void 0===c?void 0:c.getMapContainer();f&&r&&f.addEventListener("click",e.onSceneClick)}var p=null==a||null===(o=a.getSource)||void 0===o?void 0:o.call(a),d=e.onSourceUpdate.bind(e);null==p||p.on("update",d),s.onSourceUpdate=d,e.layerConfigMap.set(a,s)}}))}},{key:"unbindLayerEvent",value:function(){var e=this;this.layerConfigItems.forEach((function(t){var n,r=e.getLayerByConfig(t),i=r&&e.layerConfigMap.get(r);if(i){var o,a=i.onMouseMove,s=i.onMouseOut,u=i.onClick,l=i.onSourceUpdate;if(a&&r.off("mousemove",a),s&&r.off("mouseout",s),u&&r.off("click",u),l)null==r||null===(o=r.getSource())||void 0===o||o.off("update",l);var c=null===(n=e.mapsService)||void 0===n?void 0:n.getMapContainer();c&&c.removeEventListener("click",e.onSceneClick)}}))}},{key:"onLayerMouseMove",value:function(e,t){if(!this.isSameFeature(e,t.featureId)){var n=this.getLayerInfoFrag(e,t),r=n.title,i=n.content;this.setDOMContent(i),this.setTitle(r),this.setDisplayFeatureInfo({layer:e,featureId:t.featureId}),this.show()}}},{key:"onLayerMouseOut",value:function(e,t){this.setDisplayFeatureInfo(void 0),this.isShow&&this.hide()}},{key:"onSourceUpdate",value:function(){this.hide(),this.setDisplayFeatureInfo(void 0)}},{key:"getLayerInfoFrag",value:function(e,t){var n,r=this.layerConfigMap.get(e),i=document.createDocumentFragment();if(r){var o=t.feature;"Feature"===o.type&&"properties"in o&&"geometry"in o&&(o=o.properties);var a=r.title,s=r.fields,u=r.customContent;if(a){n=document.createDocumentFragment();var l=a instanceof Function?a(o):a;x.SO.appendElementType(n,l)}if(u){var c=u instanceof Function?u(o):u;x.SO.appendElementType(i,c)}else null!=s&&s.length&&(null==s||s.forEach((function(e){var n,r,a="string"==typeof e?{field:e}:e,s=a.field,u=a.formatField,l=a.formatValue,c=a.getValue,h=x.SO.create("div","l7-layer-popup__row"),f=c?c(t.feature):S(o,s),p=null!==(n=u instanceof Function?u(s,o):u)&&void 0!==n?n:s,d=null!==(r=l instanceof Function?l(f,o):l)&&void 0!==r?r:f,v=x.SO.create("span","l7-layer-popup__key",h);x.SO.appendElementType(v,p),x.SO.appendElementType(v,document.createTextNode("："));var m=x.SO.create("span","l7-layer-popup__value",h);Array.isArray(d)&&d.every((function(e){return!(e instanceof Object)}))&&(d=d.map((function(e){return String(e)})).join(",")),x.SO.appendElementType(m,d),i.appendChild(h)})))}return{title:n,content:i}}},{key:"getLayerByConfig",value:function(e){var t=e.layer;return t instanceof Object?t:"string"==typeof t?this.layerService.getLayer(t)||this.layerService.getLayerByName(t):void 0}},{key:"isSameFeature",value:function(e,t){var n=this.displayFeatureInfo;return n&&e===n.layer&&t===n.featureId}},{key:"setDisplayFeatureInfo",value:function(e){var t=this.displayFeatureInfo;t&&t.layer.off("hide",this.onLayerHide),e&&e.layer.on("hide",this.onLayerHide),this.displayFeatureInfo=e}}]),n}(E.Z)},8535:function(e,t,n){"use strict";n.d(t,{G:function(){return b},Z:function(){return b}});var r=n(1448),i=n.n(r),o=n(4528),a=n.n(o),s=n(8798),u=n.n(s),l=n(6626),c=n.n(l),h=n(7267),f=n.n(h),p=n(9913),d=n.n(p),v=n(9057),m=n.n(v),g=n(6490),y=n(2490),_=n(9210),b=function(e){f()(n,e);var t=d()(n);function n(e){var r;a()(this,n),r=t.call(this),m()(c()(r),"popupOption",void 0),m()(c()(r),"mapsService",void 0),m()(c()(r),"sceneService",void 0),m()(c()(r),"layerService",void 0),m()(c()(r),"scene",void 0),m()(c()(r),"closeButton",void 0),m()(c()(r),"container",void 0),m()(c()(r),"content",void 0),m()(c()(r),"contentTitle",void 0),m()(c()(r),"contentPanel",void 0),m()(c()(r),"tip",void 0),m()(c()(r),"isShow",!0),m()(c()(r),"onMouseMove",(function(e){var t,n=r.mapsService.getMapContainer(),i=null!==(t=null==n?void 0:n.getBoundingClientRect())&&void 0!==t?t:{},o=i.left,a=void 0===o?0:o,s=i.top,u=void 0===s?0:s;r.setPopupPosition(e.clientX-a,e.clientY-u)})),m()(c()(r),"updateLngLatPosition",(function(){if(r.mapsService&&!r.popupOption.followCursor){var e=r.lngLat,t=e.lng,n=e.lat,i=r.mapsService.lngLatToContainer([t,n]),o=i.x,a=i.y;r.setPopupPosition(o,a)}})),m()(c()(r),"updateLngLatPositionWhenZoom",(function(e){if(r.mapsService&&!r.popupOption.followCursor){var t=e.map,n=t.getSize();n.x=n.x/2,n.y=n.y/2;var i=e.center,o=e.zoom,a=t.DE(r.lngLat,o,i);a.x=Math.round(a.x),a.y=Math.round(a.y),r.setPopupPosition(a.x,a.y,!0)}})),m()(c()(r),"onKeyDown",(function(e){27===e.keyCode&&r.remove()})),m()(c()(r),"onCloseButtonClick",(function(e){e.stopPropagation&&e.stopPropagation(),r.hide()})),m()(c()(r),"updatePosition",(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!!r.lngLat,i=r.popupOption,o=i.className,a=i.style,s=i.maxWidth,u=i.anchor,l=i.stopPropagation;if(r.mapsService&&n&&r.content){var c=r.mapsService.getMarkerContainer();if(!r.container&&c&&(r.container=g.SO.create("div","l7-popup ".concat(null!=o?o:""," ").concat(r.isShow?"":"l7-popup-hide"),c),a&&r.container.setAttribute("style",a),r.tip=g.SO.create("div","l7-popup-tip",r.container),r.container.appendChild(r.content),l&&["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(e){r.container.addEventListener(e,(function(e){e.stopPropagation()}))})),r.container.style.whiteSpace="nowrap"),t?r.updateLngLatPositionWhenZoom(e):r.updateLngLatPosition(),g.SO.setTransform(r.container,"".concat(g.rQ[u])),(0,g.zi)(r.container,u,"popup"),s){var h=r.container.getBoundingClientRect(),f=h.width;f>parseFloat(s)&&(r.container.style.width=s)}else r.container.style.removeProperty("width")}})),m()(c()(r),"updateWhenZoom",(function(e){r.updatePosition(e,!0)})),m()(c()(r),"update",(function(){r.updatePosition(null,!1)})),r.popupOption=i()(i()({},r.getDefault(null!=e?e:{})),e);var o=r.popupOption.lngLat;return o&&(r.lngLat=o),r}return u()(n,[{key:"lngLat",get:function(){var e;return null!==(e=this.popupOption.lngLat)&&void 0!==e?e:{lng:0,lat:0}},set:function(e){this.popupOption.lngLat=e}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(e){this.mapsService=e.mapService,this.sceneService=e.sceneService,this.layerService=e.layerService,this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=e,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var t=this.popupOption,n=t.html,r=t.text,i=t.title;return n?this.setHTML(n):r&&this.setText(r),i&&this.setTitle(i),this.emit("open"),this}},{key:"remove",value:function(){if(null!=this&&this.isOpen())return this.content&&g.SO.remove(this.content),this.container&&(g.SO.remove(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(e){return this.show(),this.popupOption=i()(i()({},this.popupOption),e),this.checkUpdateOption(e,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(g.SO.remove(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(e,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(e,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(e,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(e,["html"])&&e.html?this.setHTML(e.html):this.checkUpdateOption(e,["text"])&&e.text&&this.setText(e.text),this.checkUpdateOption(e,["lngLat"])&&e.lngLat&&this.setLnglat(e.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&g.SO.removeClass(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&g.SO.addClass(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(e){return this.popupOption.html=e,this.setDOMContent(e)}},{key:"setText",value:function(e){return this.popupOption.text=e,this.setDOMContent(window.document.createTextNode(e))}},{key:"setTitle",value:function(e){this.show(),this.popupOption.title=e,e?(this.contentTitle||(this.contentTitle=g.SO.create("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),g.SO.clearChildren(this.contentTitle),g.SO.appendElementType(this.contentTitle,e)):this.contentTitle&&(g.SO.remove(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var e=this.lngLat,t=e.lng,n=e.lat;return this.popupOption.autoPan&&this.mapsService.panTo([t,n]),this}},{key:"setLngLat",value:function(e){return this.setLnglat(e)}},{key:"setLnglat",value:function(e){var t=this;return this.show(),this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout((function(){t.panToPopup()}),0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(e){return this.popupOption.maxWidth=e,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(e){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:g.bV.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(e){return this.show(),this.createContent(),g.SO.appendElementType(this.contentPanel,e),this.update(),this}},{key:"updateCloseOnClick",value:function(e){var t=this,n=this.mapsService;n&&(null==n||n.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!e&&requestAnimationFrame((function(){null==n||n.on("click",t.onCloseButtonClick)})))}},{key:"updateCloseOnEsc",value:function(e){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!e&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(e){var t,n=null===(t=this.mapsService)||void 0===t?void 0:t.getContainer();n&&(null==n||n.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!e&&(null==n||n.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var e=this;if(this.content&&g.SO.remove(this.content),this.contentTitle=void 0,this.content=g.SO.create("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var t=(0,_.Q)("l7-icon-guanbi");g.SO.addClass(t,"l7-popup-close-button"),this.content.appendChild(t),this.popupOption.closeButtonOffsets&&(t.style.right=this.popupOption.closeButtonOffsets[0]+"px",t.style.top=this.popupOption.closeButtonOffsets[1]+"px"),t.setAttribute("aria-label","Close popup"),t.addEventListener("click",(function(){e.hide()})),t.addEventListener("pointerup",(function(e){e.stopPropagation()})),t.addEventListener("pointerdown",(function(e){e.stopPropagation()})),this.closeButton=t}else this.closeButton=void 0;this.contentPanel=g.SO.create("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.container){var r=this.popupOption.offsets;this.container.style.left=e+r[0]+"px",this.container.style.top=t-r[1]+"px",this.container.style.transition=n?"left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)":""}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}]),n}(y.EventEmitter)},9210:function(e,t,n){"use strict";n.d(t,{Q:function(){return r}});var r=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(e)),t.appendChild(n),t}},3292:function(e,t,n){"use strict";n.r(t),n.d(t,{AttributeType:function(){return x.GC},BasePostProcessingPass:function(){return r.Z},BlendType:function(){return b.h0},CameraUniform:function(){return h.l},CoordinateSystem:function(){return m.l},CoordinateUniform:function(){return m.k},IDebugLog:function(){return g.O},ILayerStage:function(){return b.KD},InteractionEvent:function(){return y.s},MapServiceEvent:function(){return E.I},MaskOperation:function(){return b.lE},PassType:function(){return k.G},PositionType:function(){return f.d},RasterTileType:function(){return B.n},ScaleTypes:function(){return x.vY},SceneEventList:function(){return N.P},StencilType:function(){return b.yn},StyleScaleType:function(){return x.ee},TextureUsage:function(){return P.v},createLayerContainer:function(){return A.e7},createSceneContainer:function(){return A.Hp},gl:function(){return S.gl},globalConfigService:function(){return A.cO},packCircleVertex:function(){return o.wL},removeDuplicateUniforms:function(){return i.Vb}});var r=n(8881),i=n(5594),o=n(1951),a=n(8224),s={};for(var u in a)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms"].indexOf(u)<0&&(s[u]=function(e){return a[e]}.bind(0,u));n.d(t,s);var l=n(2942);s={};for(var u in l)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms"].indexOf(u)<0&&(s[u]=function(e){return l[e]}.bind(0,u));n.d(t,s);var c=n(2919);s={};for(var u in c)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms"].indexOf(u)<0&&(s[u]=function(e){return c[e]}.bind(0,u));n.d(t,s);var h=n(4970),f=n(9974),p=n(1315);s={};for(var u in p)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType"].indexOf(u)<0&&(s[u]=function(e){return p[e]}.bind(0,u));n.d(t,s);var d=n(9636);s={};for(var u in d)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType"].indexOf(u)<0&&(s[u]=function(e){return d[e]}.bind(0,u));n.d(t,s);var v=n(6178);s={};for(var u in v)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType"].indexOf(u)<0&&(s[u]=function(e){return v[e]}.bind(0,u));n.d(t,s);var m=n(7497),g=n(9376),y=n(2477),_=n(780);s={};for(var u in _)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent"].indexOf(u)<0&&(s[u]=function(e){return _[e]}.bind(0,u));n.d(t,s);var b=n(7212),x=n(5146),E=n(9253),S=n(609),A=n(521),T=n(124);s={};for(var u in T)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService"].indexOf(u)<0&&(s[u]=function(e){return T[e]}.bind(0,u));n.d(t,s);var C=n(2549);s={};for(var u in C)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService"].indexOf(u)<0&&(s[u]=function(e){return C[e]}.bind(0,u));n.d(t,s);var w=n(7648);s={};for(var u in w)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService"].indexOf(u)<0&&(s[u]=function(e){return w[e]}.bind(0,u));n.d(t,s);var R=n(7856);s={};for(var u in R)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService"].indexOf(u)<0&&(s[u]=function(e){return R[e]}.bind(0,u));n.d(t,s);var M=n(9439);s={};for(var u in M)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService"].indexOf(u)<0&&(s[u]=function(e){return M[e]}.bind(0,u));n.d(t,s);var k=n(4857),L=n(8819);s={};for(var u in L)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService","PassType"].indexOf(u)<0&&(s[u]=function(e){return L[e]}.bind(0,u));n.d(t,s);var O=n(4518);s={};for(var u in O)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService","PassType"].indexOf(u)<0&&(s[u]=function(e){return O[e]}.bind(0,u));n.d(t,s);var P=n(1567),I=n(1780);s={};for(var u in I)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService","PassType","TextureUsage"].indexOf(u)<0&&(s[u]=function(e){return I[e]}.bind(0,u));n.d(t,s);var N=n(1624),D=n(8104);s={};for(var u in D)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService","PassType","TextureUsage","SceneEventList"].indexOf(u)<0&&(s[u]=function(e){return D[e]}.bind(0,u));n.d(t,s);var B=n(6386)},521:function(e,t,n){"use strict";n.d(t,{e7:function(){return xt},Hp:function(){return bt},cO:function(){return yt}});var r=n(1448),i=n.n(r),o=n(6970),a=n.n(o),s=n(4528),u=n.n(s),l=n(8798),c=n.n(l),h=n(6626),f=n.n(h),p=n(7267),d=n.n(p),v=n(9913),m=n.n(v),g=n(9057),y=n.n(g),_=n(6490),b=n(6641),x=n.n(b),E=n(2490),S=n.n(E);function A(e,t,n){var r,o=a()(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.icon,l=s.xOffset;e[u.id]=i()(i()({},u),{},{x:l,y:n,image:u.image,width:u.width,height:u.height})}}catch(e){o.e(e)}finally{o.f()}}function T(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var C=function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}();function w(e,t,n,r){e.font="".concat(r," ").concat(n,"px ").concat(t),e.fillStyle="black",e.textBaseline="middle"}function R(e,t){for(var n=0;n<e.length;n++)t.data[4*n+3]=e[n]}var M=function(e){d()(n,e);var t=m()(n);function n(){var e;u()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),y()(f()(e),"fontAtlas",void 0),y()(f()(e),"iconFontMap",void 0),y()(f()(e),"iconFontGlyphs",{}),y()(f()(e),"fontOptions",void 0),y()(f()(e),"key",void 0),y()(f()(e),"cache",new _.z6(3)),e}return c()(n,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var e=this.cache.get(this.key);return e&&e.data}},{key:"mapping",get:function(){var e=this.cache.get(this.key);return e&&e.mapping||{}}},{key:"getCanvasByKey",value:function(e){var t=this.cache.get(e);return t&&t.data}},{key:"getMappingByKey",value:function(e){var t=this.cache.get(e);return t&&t.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:C,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(e){var t=this;e.forEach((function(e){t.iconFontGlyphs[e.name]=e.unicode}))}},{key:"addIconFont",value:function(e,t){this.iconFontMap.set(e,t)}},{key:"getIconFontKey",value:function(e){return this.iconFontMap.get(e)||e}},{key:"getGlyph",value:function(e){return this.iconFontGlyphs[e]?String.fromCharCode(parseInt(this.iconFontGlyphs[e],16)):""}},{key:"setFontOptions",value:function(e){this.fontOptions=i()(i()({},this.fontOptions),e),this.key=this.getKey();var t=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==t.length){var r=this.generateFontAtlas(this.key,t,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"addFontFace",value:function(e,t){var n=this,r=document.createElement("style");r.type="text/css",r.innerText="\n        @font-face{\n            font-family: '".concat(e,"';\n            src: url('").concat(t,"') format('woff2'),\n            url('").concat(t,"') format('woff'),\n            url('").concat(t,"') format('truetype');\n        }"),r.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(e),"L7text"),document.fonts.ready.then((function(){n.emit("fontloaded",{fontFamily:e})}))}catch(e){console.warn("当前环境不支持 document.fonts !"),console.warn("当前环境不支持 iconfont !"),console.warn(e)}},document.getElementsByTagName("head")[0].appendChild(r)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(e,t,n){var r=this.fontOptions,o=r.fontFamily,s=r.fontWeight,u=r.fontSize,l=r.buffer,c=r.sdf,h=r.radius,f=r.cutoff,p=r.iconfont,d=n&&n.data;d||((d=window.document.createElement("canvas")).width=1024);var v=d.getContext("2d",{willReadFrequently:!0});w(v,o,u,s);var m=function(e){var t=e.characterSet,n=e.getFontWidth,r=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,s=void 0===a?{}:a,u=e.xOffset,l=void 0===u?0:u,c=e.yOffset,h=void 0===c?0:c,f=0,p=l;Array.from(t).forEach((function(e,t){if(!s[e]){var r=n(e,t);p+30>o&&(p=0,f++),s[e]={x:p,y:h+30*f,width:30,height:30,advance:r},p+=30}}));var d=r+2*i;return{mapping:s,xOffset:p,yOffset:h+f*d,canvasHeight:T(h+(f+1)*d)}}(i()({getFontWidth:function(e){return v.measureText(e).width},fontHeight:1*u,buffer:l,characterSet:t,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),g=m.mapping,y=m.canvasHeight,_=m.xOffset,b=m.yOffset,E=v.getImageData(0,0,d.width,d.height);if(d.height=y,v.putImageData(E,0,0),w(v,o,u,s),c){var S,A=new(x())(u,l,h,f,o,s),C=v.getImageData(0,0,A.size,A.size),M=a()(t);try{for(M.s();!(S=M.n()).done;){var k=S.value;if(p){var L=String.fromCharCode(parseInt(k.replace("&#x","").replace(";",""),16));R(A.draw(L),C)}else R(A.draw(k),C);v.putImageData(C,g[k].x,g[k].y)}}catch(e){M.e(e)}finally{M.f()}}else{var O,P=a()(t);try{for(P.s();!(O=P.n()).done;){var I=O.value;v.fillText(I,g[I].x,g[I].y+1*u)}}catch(e){P.e(e)}finally{P.f()}}return{xOffset:_,yOffset:b,mapping:g,data:d,width:d.width,height:d.height}}},{key:"getKey",value:function(){var e=this.fontOptions,t=e.fontFamily,n=e.fontWeight;return"".concat(t,"_").concat(n)}},{key:"getNewChars",value:function(e,t){var n=this.cache.get(e);if(!n)return t;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(t).forEach((function(e){o.has(e)||r.push(e)})),r}}]),n}(E.EventEmitter),k=n(9558),L=n.n(k),O=n(9989),P=n.n(O),I=function(e){d()(r,e);var t,n=m()(r);function r(){var e;u()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),y()(f()(e),"canvasHeight",128),y()(f()(e),"texture",void 0),y()(f()(e),"canvas",void 0),y()(f()(e),"iconData",void 0),y()(f()(e),"iconMap",void 0),y()(f()(e),"ctx",void 0),y()(f()(e),"loadingImageCount",0),e}return c()(r,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:(t=P()(L()().mark((function e(t,n){var r,i;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Image,this.loadingImageCount++,this.hasImage(t)?console.warn("Image Id already exists"):this.iconData.push({id:t,size:64}),this.updateIconMap(),e.next=6,this.loadImage(n);case 6:r=e.sent,(i=this.iconData.find((function(e){return e.id===t})))&&(i.image=r,i.width=r.width,i.height=r.height),this.update();case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"addImageMini",value:function(e,t,n){var r=this,i=n.getSceneConfig().canvas,o=i.createImage();if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:64}),this.updateIconMap(),this.loadImageMini(t,i).then((function(t){o=t;var n=r.iconData.find((function(t){return t.id===e}));n&&(n.image=o,n.width=o.width,n.height=o.height),r.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(e){return this.iconMap.hasOwnProperty(e)}},{key:"removeImage",value:function(e){this.hasImage(e)&&(this.iconData=this.iconData.filter((function(t){return t.id!==e})),delete this.iconMap[e],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(e){return new Promise((function(t,n){if(e instanceof HTMLImageElement)t(e);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t(r)},r.onerror=function(){n(new Error("Could not load image at "+e))},r.src=e instanceof File?URL.createObjectURL(e):e}}))}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var e=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(t){var n=e.iconMap[t],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,l=void 0===u?64:u,c=Math.max(s,l)/64,h=l/c,f=s/c;o&&e.ctx.drawImage(o,r+(64-f)/2,i+(64-h)/2,f,h)}))}},{key:"updateIconMap",value:function(){var e=function(e,t,n){var r,i=0,o=0,s=0,u=[],l={},c=a()(e);try{for(c.s();!(r=c.n()).done;){var h=r.value;if(!l[h.id]){var f=h.size;i+f+t>n&&(A(l,u,o),i=0,o=s+o+t,s=0,u=[]),u.push({icon:h,xOffset:i}),i=i+f+t,s=Math.max(s,f)}}}catch(e){c.e(e)}finally{c.f()}return u.length>0&&A(l,u,o),{mapping:l,canvasHeight:T(s+o+t)}}(this.iconData,3,1024),t=e.mapping,n=e.canvasHeight;this.iconMap=t,this.canvasHeight=n}},{key:"loadImageMini",value:function(e,t){return new Promise((function(n,r){var i=t.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(new Error("Could not load image at "+e))},i.src=e}))}}]),r}(E.EventEmitter),N=n(3100),D=n.n(N),B=n(3311),F=function(){function e(){u()(this,e),y()(this,"viewport",void 0),y()(this,"overridedViewProjectionMatrix",void 0),y()(this,"jitteredViewProjectionMatrix",void 0),y()(this,"jitteredProjectionMatrix",void 0),y()(this,"viewMatrixInverse",void 0),y()(this,"cameraPosition",void 0)}return c()(e,[{key:"init",value:function(){}},{key:"update",value:function(e){this.viewport=e,this.viewMatrixInverse=B.create(),B.invert(this.viewMatrixInverse,e.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var e=this.viewport.getCenter(),t=D()(e,2);return[t[0],t[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}},{key:"setViewProjectionMatrix",value:function(e){this.overridedViewProjectionMatrix=e}},{key:"jitterProjectionMatrix",value:function(e,t){var n=B.fromTranslation(B.create(),[e,t,0]);this.jitteredProjectionMatrix=B.multiply(B.create(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=B.multiply(B.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}(),U=n(4479),z=n.n(U),G=n(9974),j={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},V=function(){function e(){u()(this,e),y()(this,"container",void 0),y()(this,"controlCorners",void 0),y()(this,"controlContainer",void 0),y()(this,"scene",void 0),y()(this,"mapsService",void 0),y()(this,"controls",[]),y()(this,"unAddControls",[])}return c()(e,[{key:"init",value:function(e,t){this.container=e.container,this.scene=t,this.mapsService=t.mapService,this.initControlPos()}},{key:"addControl",value:function(e,t){t.mapService.map?(e.addTo(this.scene),this.controls.push(e)):this.unAddControls.push(e)}},{key:"getControlByName",value:function(e){return this.controls.find((function(t){return t.controlOption.name===e}))}},{key:"removeControl",value:function(e){var t=this.controls.indexOf(e);return t>-1&&this.controls.splice(t,1),e.remove(),this}},{key:"addControls",value:function(){var e=this;this.unAddControls.forEach((function(t){t.addTo(e.scene),e.controls.push(t)})),this.unAddControls=[]}},{key:"destroy",value:function(){var e,t=a()(this.controls);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(e){t.e(e)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var e=this.controlCorners={},t="l7-",n=this.controlContainer=_.SO.create("div",t+"control-container",this.container);Object.values(G.d).forEach((function(r){var i,o;!function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=r.map((function(e){return t+e})).join(" ");e[r.filter((function(e){return!["row","column"].includes(e)})).join("")]=_.SO.create("div",i,n)}((i=r,o=i.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),[].concat(z()(o),[j[i]])))})),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var e in this.controlCorners)this.controlCorners[e]&&_.SO.remove(this.controlCorners[e]);this.controlContainer&&_.SO.remove(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var e=this,t=window.MutationObserver;if(t)for(var n=function(){var n=i[r].match(/^(top|bottom)(left|right)$/);if(n){var o=D()(n,3),a=o[1],s=o[2],u=e.controlCorners["".concat(a).concat(s)];new t((function(e){var t=D()(e,1)[0].target;u&&(u.style[a]=t.clientHeight+"px")})).observe(e.controlCorners["".concat(s).concat(a)],{childList:!0,attributes:!0})}},r=0,i=Object.keys(this.controlCorners);r<i.length;r++)n()}}]),e}(),H=function(){function e(){u()(this,e),y()(this,"container",void 0),y()(this,"scene",void 0),y()(this,"mapsService",void 0),y()(this,"markers",[]),y()(this,"markerLayers",[]),y()(this,"unAddMarkers",[]),y()(this,"unAddMarkerLayers",[])}return c()(e,[{key:"addMarkerLayer",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(e),e.addTo(this.scene)):this.unAddMarkerLayers.push(e)}},{key:"removeMarkerLayer",value:function(e){e.destroy(),this.markerLayers.indexOf(e);var t=this.markerLayers.indexOf(e);t>-1&&this.markerLayers.splice(t,1)}},{key:"addMarker",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(e),e.addTo(this.scene)):this.unAddMarkers.push(e)}},{key:"addMarkers",value:function(){var e=this;this.unAddMarkers.forEach((function(t){t.addTo(e.scene),e.markers.push(t)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var e=this;this.unAddMarkerLayers.forEach((function(t){e.markerLayers.push(t),t.addTo(e.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(e){e.remove(),this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.mapService}},{key:"destroy",value:function(){this.markers.forEach((function(e){e.remove()})),this.markers=[],this.markerLayers.forEach((function(e){e.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(e){e.destroy()}}]),e}(),W=function(){function e(){u()(this,e),y()(this,"scene",void 0),y()(this,"mapsService",void 0),y()(this,"popups",[]),y()(this,"unAddPopups",[])}return c()(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(e){null!=e&&e.isOpen()&&e.remove();var t=this.popups.indexOf(e);t>-1&&this.popups.splice(t,1);var n=this.unAddPopups.indexOf(e);n>-1&&this.unAddPopups.splice(n,1)}},{key:"destroy",value:function(){this.popups.forEach((function(e){return e.remove()}))}},{key:"addPopup",value:function(e){var t=this;e&&e.getOptions().autoClose&&[].concat(z()(this.popups),z()(this.unAddPopups)).forEach((function(e){e.getOptions().autoClose&&t.removePopup(e)})),this.isMarkerReady?(e.addTo(this.scene),this.popups.push(e)):this.unAddPopups.push(e),e.on("close",(function(){t.removePopup(e)}))}},{key:"initPopup",value:function(){var e=this;this.unAddPopups.length&&this.unAddPopups.forEach((function(t){e.addPopup(t),e.unAddPopups=[]}))}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.mapService}}]),e}(),Z=n(7212),X={MapToken:"您正在使用 Demo 测试 Token, 生产环境务必自行注册 Token 确保服务稳定 高德地图申请地址 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox地图申请地址 https://docs.mapbox.com/help/glossary/access-token/",SDK:"请确认引入了mapbox-gl api且在L7之前引入"},Y=_.rU.merge,q={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},K={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:Z.lE.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Q=function(){function e(){u()(this,e),y()(this,"sceneConfigCache",{}),y()(this,"layerConfigCache",{}),y()(this,"layerAttributeConfigCache",{})}return c()(e,[{key:"getSceneConfig",value:function(e){return this.sceneConfigCache[e]}},{key:"getSceneWarninfo",value:function(e){return X[e]}},{key:"setSceneConfig",value:function(e,t){this.sceneConfigCache[e]=i()(i()({},q),t)}},{key:"getLayerConfig",value:function(e){return this.layerConfigCache[e]}},{key:"setLayerConfig",value:function(e,t,n){this.layerConfigCache[t]=i()({},Y({},this.sceneConfigCache[e],K,n))}},{key:"getAttributeConfig",value:function(e){return this.layerAttributeConfigCache[e]}},{key:"setAttributeConfig",value:function(e,t){this.layerAttributeConfigCache[e]=i()(i()({},this.layerAttributeConfigCache[e]),t)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}(),$=n(6749),J=Math.PI/180,ee=4003e4;function te(e){var t=e.latitude,n=void 0===t?0:t,r=e.zoom,i=void 0===r?0:r,o=e.scale,a=e.highPrecision,s=void 0!==a&&a,u=e.flipY,l=void 0!==u&&u,c={},h=512*(o=void 0!==o?o:Math.pow(2,i)),f=Math.cos(n*J),p=h/360,d=p/f,v=h/ee/f;if(c.pixelsPerMeter=[v,-v,v],c.metersPerPixel=[1/v,-1/v,1/v],c.pixelsPerDegree=[p,-d,v],c.degreesPerPixel=[1/p,-1/d,1/v],s){var m=J*Math.tan(n*J)/f,g=p*m/2,y=h/ee*m,_=y/d*v;c.pixelsPerDegree2=[0,-g,y],c.pixelsPerMeter2=[_,0,_],l&&(c.pixelsPerDegree2[1]=-c.pixelsPerDegree2[1],c.pixelsPerMeter2[1]=-c.pixelsPerMeter2[1])}return l&&(c.pixelsPerMeter[1]=-c.pixelsPerMeter[1],c.metersPerPixel[1]=-c.metersPerPixel[1],c.pixelsPerDegree[1]=-c.pixelsPerDegree[1],c.degreesPerPixel[1]=-c.degreesPerPixel[1]),c}var ne=n(7497),re=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ie=function(){function e(t){u()(this,e),y()(this,"needRefresh",!0),y()(this,"coordinateSystem",void 0),y()(this,"viewportCenter",void 0),y()(this,"viewportCenterProjection",void 0),y()(this,"pixelsPerDegree",void 0),y()(this,"pixelsPerDegree2",void 0),y()(this,"pixelsPerMeter",void 0),this.cameraService=t}return c()(e,[{key:"refresh",value:function(e){var t=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),r=e||this.cameraService.getCenter(),i=te({latitude:r[1],zoom:t}),o=i.pixelsPerMeter,a=i.pixelsPerDegree;this.viewportCenter=r,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===ne.l.LNGLAT||this.coordinateSystem===ne.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===ne.l.LNGLAT_OFFSET?this.calculateLnglatOffset(r,t):this.coordinateSystem===ne.l.P20_OFFSET&&this.calculateLnglatOffset(r,t,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(e){this.coordinateSystem=e}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(e,t,n,r){var i=te({latitude:e[1],zoom:t,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),l=this.cameraService.getProjectionMatrix(),c=B.multiply([],l,u),h=this.cameraService.projectFlat([Math.fround(e[0]),Math.fround(e[1])],Math.pow(2,t));this.viewportCenterProjection=$.fF([],[h[0],h[1],0,1],c),u=this.cameraService.getViewMatrixUncentered()||u,c=B.multiply([],l,u),c=B.multiply([],c,re),this.cameraService.setViewProjectionMatrix(c),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}]),e}(),oe=n(5570),ae=n.n(oe),se=function(e){d()(n,e);var t=m()(n);function n(){var e;u()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),y()(f()(e),"renderMap",new Map),y()(f()(e),"enable",!1),y()(f()(e),"renderEnable",!1),y()(f()(e),"cacheLogs",{}),e}return c()(n,[{key:"setEnable",value:function(e){this.enable=!!e}},{key:"log",value:function(e,t){var n=this;if(this.enable){var r=e.split("."),o=null;r.forEach((function(e,a){null!==o?(o[e]||(o[e]={}),a!==r.length-1&&(o=o[e])):(n.cacheLogs[e]||(n.cacheLogs[e]={}),a!==r.length-1&&(o=n.cacheLogs[e])),a===r.length-1&&(o[e]=i()(i()({time:Date.now()},o[e]),t))}))}}},{key:"getLog",value:function(e){var t=this;switch(ae()(e)){case"string":return this.cacheLogs[e];case"object":return e.map((function(e){return t.cacheLogs[e]})).filter((function(e){return void 0!==e}));case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(e){delete this.cacheLogs[e]}},{key:"generateRenderUid",value:function(){return this.renderEnable?(0,_.M8)():""}},{key:"renderDebug",value:function(e){this.renderEnable=e}},{key:"renderStart",value:function(e){if(this.renderEnable&&this.enable){var t=this.renderMap.get(e)||{};this.renderMap.set(e,i()(i()({},t),{},{renderUid:e,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(e){if(this.renderEnable&&this.enable){var t=this.renderMap.get(e);if(t){var n=t.renderStart,r=Date.now();this.emit("renderEnd",i()(i()({},t),{},{renderEnd:r,renderDuration:r-n})),this.renderMap.delete(e)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),n}(E.EventEmitter),ue=n(384),le=n.n(ue),ce=n(2477),he={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},fe=function(e){d()(n,e);var t=m()(n);function n(e){var r;return u()(this,n),r=t.call(this),y()(f()(r),"indragging",!1),y()(f()(r),"hammertime",void 0),y()(f()(r),"lastClickTime",0),y()(f()(r),"lastClickXY",[-1,-1]),y()(f()(r),"clickTimer",void 0),y()(f()(r),"$containter",void 0),y()(f()(r),"onDrag",(function(e){var t=r.interactionEvent(e);t.type=he[t.type],"dragging"===t.type?r.indragging=!0:r.indragging=!1,r.emit(ce.s.Drag,t)})),y()(f()(r),"onHammer",(function(e){e.srcEvent.stopPropagation();var t=r.interactionEvent(e);r.emit(ce.s.Hover,t)})),y()(f()(r),"onTouch",(function(e){var t=e.touches[0];r.onHover({clientX:t.clientX,clientY:t.clientY,type:"touchstart"})})),y()(f()(r),"onTouchEnd",(function(e){if(e.changedTouches.length>0){var t=e.changedTouches[0];r.onHover({clientX:t.clientX,clientY:t.clientY,type:"touchend"})}})),y()(f()(r),"onTouchMove",(function(e){var t=e.changedTouches[0];r.onHover({clientX:t.clientX,clientY:t.clientY,type:"touchmove"})})),y()(f()(r),"onHover",(function(e){var t=e.clientX,n=e.clientY,i=e.type,o=r.mapService.getMapContainer();if(o){var a=o.getBoundingClientRect(),s=a.top;t=t-a.left-o.clientLeft,n=n-s-o.clientTop}var u=r.mapService.containerToLngLat([t,n]);"click"!==i&&"touch"!==i?"click"!==i&&"dblclick"!==i&&r.emit(ce.s.Hover,{x:t,y:n,lngLat:u,type:i,target:e}):r.isDoubleTap(t,n,u)})),r.container=e,r}return c()(n,[{key:"mapService",get:function(){return this.container.mapService}},{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ce.s.Hover)}},{key:"triggerHover",value:function(e){var t=e.x,n=e.y;this.emit(ce.s.Hover,{x:t,y:n})}},{key:"triggerSelect",value:function(e){this.emit(ce.s.Select,{featureId:e})}},{key:"triggerActive",value:function(e){this.emit(ce.s.Active,{featureId:e})}},{key:"addEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();if(e){var t=new(le().Manager)(e);t.add(new(le().Tap)({event:"dblclick",taps:2})),t.add(new(le().Tap)({event:"click"})),t.add(new(le().Pan)({threshold:0,pointers:0})),t.add(new(le().Press)({})),t.on("dblclick click",this.onHammer),t.on("panstart panmove panend pancancel",this.onDrag),e.addEventListener("touchstart",this.onTouch),e.addEventListener("touchend",this.onTouchEnd),e.addEventListener("mousemove",this.onHover),e.addEventListener("touchmove",this.onTouchMove),e.addEventListener("mousedown",this.onHover,!0),e.addEventListener("mouseup",this.onHover),e.addEventListener("contextmenu",this.onHover),this.hammertime=t}}},{key:"removeEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();e&&(e.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),e.removeEventListener("touchstart",this.onTouch),e.removeEventListener("touchend",this.onTouchEnd),e.removeEventListener("mousedown",this.onHover),e.removeEventListener("mouseup",this.onHover),e.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(e){var t,n,r=e.type;"touch"===e.pointerType?(n=Math.floor(e.pointers[0].clientY),t=Math.floor(e.pointers[0].clientX)):(n=Math.floor(e.srcEvent.y),t=Math.floor(e.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;t-=o.left,n-=a}return{x:t,y:n,lngLat:this.mapService.containerToLngLat([t,n]),type:r,target:e.srcEvent}}},{key:"isDoubleTap",value:function(e,t,n){var r=this,i=(new Date).getTime(),o="click";i-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-e)<10&&Math.abs(this.lastClickXY[1]-t)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(ce.s.Hover,{x:e,y:t,lngLat:n,type:o})):(this.lastClickTime=i,this.lastClickXY=[e,t],this.clickTimer=setTimeout((function(){o="click",r.emit(ce.s.Hover,{x:e,y:t,lngLat:n,type:o})}),400))}}]),n}(S()),pe=0;function de(e){var t=e;if("string"==typeof e&&(t=document.getElementById(e)),t){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(pe++),n.classList.add("l7-scene"),t.appendChild(n),n}return null}var ve=n(1567),me=function(){function e(t){var n=this;u()(this,e),y()(this,"pickedColors",void 0),y()(this,"pickedTileLayers",[]),y()(this,"pickingFBO",void 0),y()(this,"width",0),y()(this,"height",0),y()(this,"alreadyInPicking",!1),y()(this,"pickBufferScale",1),y()(this,"pickFromPickingFBO",function(){var e=P()(L()().mark((function e(t,r){var o,a,s,u,l,c,h,f,p,d,v,m,g,y,b,x,E,S,A,T,C,w,R;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.x,a=r.y,s=r.lngLat,u=r.type,l=r.target,c=!1,h=n.rendererService,f=h.readPixelsAsync,p=h.getViewportSize,d=p(),v=d.width,m=d.height,g=t.getLayerConfig(),y=g.enableHighlight,b=g.enableSelect,x=o*_.SO.DPR,E=a*_.SO.DPR,!(x>v-1*_.SO.DPR||x<0||E>m-1*_.SO.DPR||E<0)){e.next=9;break}return e.abrupt("return",!1);case 9:return e.next=11,f({x:Math.floor(x/n.pickBufferScale),y:Math.floor((m-(a+1)*_.SO.DPR)/n.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:n.pickingFBO});case 11:return S=e.sent,n.pickedColors=S,0!==S[0]||0!==S[1]||0!==S[2]?(A=(0,_.W0)(S),T=t.layerPickService.getFeatureById(A),A!==t.getCurrentPickId()&&"mousemove"===u&&(u="mouseenter"),C={x:o,y:a,type:u,lngLat:s,featureId:A,feature:T,target:l},T&&(c=!0,t.setCurrentPickId(A),n.triggerHoverOnLayer(t,C))):(w={x:o,y:a,lngLat:s,type:null!==t.getCurrentPickId()&&"mousemove"===u?"mouseout":"un"+u,featureId:null,target:l,feature:null},n.triggerHoverOnLayer(t,i()(i()({},w),{},{type:"unpick"})),n.triggerHoverOnLayer(t,w),t.setCurrentPickId(null)),y&&t.layerPickService.highlightPickedFeature(S),b&&"click"===u&&(null==S?void 0:S.toString())!==[0,0,0,0].toString()&&(R=(0,_.W0)(S),null===t.getCurrentSelectedId()||R!==t.getCurrentSelectedId()?(t.layerPickService.selectFeature(S),t.setCurrentSelectedId(R)):(t.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))),e.abrupt("return",c);case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.container=t}var t,n,r,o;return c()(e,[{key:"mapService",get:function(){return this.container.mapService}},{key:"rendererService",get:function(){return this.container.rendererService}},{key:"configService",get:function(){return this.container.globalConfigService}},{key:"interactionService",get:function(){return this.container.interactionService}},{key:"layerService",get:function(){return this.container.layerService}},{key:"init",value:function(e){var t=this.rendererService,n=t.createTexture2D,r=t.createFramebuffer,i=(0,t.getViewportSize)(),o=i.width,a=i.height;this.pickBufferScale=this.configService.getSceneConfig(e).pickBufferScale||1;var s=n({width:o=Math.round(o/this.pickBufferScale),height:a=Math.round(a/this.pickBufferScale),usage:ve.v.RENDER_TARGET,label:"Picking Texture"});this.pickingFBO=r({color:s,depth:!0,width:o,height:a}),this.interactionService.on(ce.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(o=P()(L()().mark((function e(t,n,r){var i,o,a,s,u=this;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.rendererService,o=i.useFramebufferAsync,a=i.clear,this.resizePickingFBO(),t.hooks.beforePickingEncode.call(),e.next=5,o(this.pickingFBO,P()(L()().mark((function e(){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.renderModels({ispick:!0});case 2:case"end":return e.stop()}}),e)}))));case 5:return t.hooks.afterPickingEncode.call(),e.next=8,this.pickBox(t,n);case 8:s=e.sent,r(s);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"pickBox",value:(r=P()(L()().mark((function e(t,n){var r,o,a,s,u,l,c,h,f,p,d,v,m,g,y,b,x,E,S,A,T,C=this;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.map((function(e){var t=e<0?0:e;return Math.floor(t*_.SO.DPR/C.pickBufferScale)})),o=D()(r,4),a=o[0],s=o[1],u=o[2],l=o[3],c=this.rendererService,h=c.readPixelsAsync,f=c.getViewportSize,p=f(),d=p.width,v=p.height,!(a>(d-1)*_.SO.DPR/this.pickBufferScale||u<0||s>(v-1)*_.SO.DPR/this.pickBufferScale||l<0)){e.next=5;break}return e.abrupt("return",[]);case 5:return m=Math.min(d/this.pickBufferScale,u)-a,g=Math.min(v/this.pickBufferScale,l)-s,e.next=9,h({x:a,y:Math.floor(v/this.pickBufferScale-(l+1)),width:m,height:g,data:new Uint8Array(m*g*4),framebuffer:this.pickingFBO});case 9:for(y=e.sent,b=[],x={},E=0;E<y.length/4;E+=1)S=y.slice(4*E,4*E+4),-1===(A=(0,_.W0)(S))||x[A]||(T=t.layerPickService.getFeatureById(A),b.push(i()(i()({},T),{},{pickedFeatureIdx:A})),x[A]=!0);return e.abrupt("return",b);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"handleCursor",value:function(e,t){var n=e.getLayerConfig(),r=n.cursor,i=void 0===r?"":r;if(n.cursorEnabled){var o="GAODE2.x"===this.mapService.version?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),a=null==o?void 0:o.style.getPropertyValue("cursor");"unmousemove"===t&&""!==a?null==o||o.style.setProperty("cursor",""):"mousemove"===t&&(null==o||o.style.setProperty("cursor",i))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"pickingAllLayer",value:(n=P()(L()().mark((function e(t){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layerService.needPick(t.type)&&this.isPickingAllLayer()){e.next=2;break}return e.abrupt("return");case 2:return this.alreadyInPicking=!0,e.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"isPickingAllLayer",value:function(){return!this.alreadyInPicking&&(!this.layerService.alreadyInRendering&&(!this.interactionService.indragging&&!!this.layerService.getShaderPickStat()))}},{key:"resizePickingFBO",value:function(){var e=(0,this.rendererService.getViewportSize)(),t=e.width,n=e.height;this.width===t&&this.height===n||(this.pickingFBO.resize({width:Math.round(t/this.pickBufferScale),height:Math.round(n/this.pickBufferScale)}),this.width=t,this.height=n)}},{key:"pickingLayers",value:(t=P()(L()().mark((function e(t){var n,r,i,o,s,u,l,c=this;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.rendererService,r=n.clear,i=n.useFramebufferAsync,this.resizePickingFBO(),o=this.layerService.getRenderList(),s=a()(o.filter((function(e){return e.needPick(t.type)})).reverse()),e.prev=4,l=L()().mark((function e(){var n,o;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.value,e.next=3,i(c.pickingFBO,P()(L()().mark((function e(){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r({framebuffer:c.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),n.layerPickService.pickRender(t);case 2:case"end":return e.stop()}}),e)}))));case 3:return e.next=5,c.pickFromPickingFBO(n,t);case 5:if(o=e.sent,c.layerService.pickedLayerId=o?+n.id:-1,!o||n.getLayerConfig().enablePropagation){e.next=9;break}return e.abrupt("return",1);case 9:case"end":return e.stop()}}),e)})),s.s();case 7:if((u=s.n()).done){e.next=13;break}return e.delegateYield(l(),"t0",9);case 9:if(!e.t0){e.next=11;break}return e.abrupt("break",13);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(4),s.e(e.t1);case 18:return e.prev=18,s.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[4,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(e,t){(function(e){var t,n=!0;if((null==e||null===(t=e.target)||void 0===t?void 0:t.target)instanceof HTMLElement)for(var r,i=null==e||null===(r=e.target)||void 0===r?void 0:r.target;i;){var o,a=Array.from(i.classList);if(a.includes("l7-marker")||a.includes("l7-popup")){n=!1;break}i=null===(o=i)||void 0===o?void 0:o.parentElement}return n})(t)&&(this.handleCursor(e,t.type),e.emit(t.type,t))}}]),e}(),ge=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];u()(this,e),y()(this,"autoStart",void 0),y()(this,"startTime",0),y()(this,"oldTime",0),y()(this,"running",!1),y()(this,"elapsedTime",0),this.autoStart=t}return c()(e,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}(),ye=_.rU.throttle,_e=function(e){d()(h,e);var t,n,r,i,o,s,l=m()(h);function h(e){var t;return u()(this,h),t=l.call(this),y()(f()(t),"pickedLayerId",-1),y()(f()(t),"clock",new ge),y()(f()(t),"alreadyInRendering",!1),y()(f()(t),"layers",[]),y()(f()(t),"layerList",[]),y()(f()(t),"layerRenderID",void 0),y()(f()(t),"sceneInited",!1),y()(f()(t),"animateInstanceCount",0),y()(f()(t),"shaderPicking",!0),y()(f()(t),"enableRender",!0),y()(f()(t),"reRender",ye((function(){t.renderLayers()}),32)),y()(f()(t),"throttleRenderLayers",ye((function(){t.renderLayers()}),16)),t.container=e,t}return c()(h,[{key:"renderService",get:function(){return this.container.rendererService}},{key:"mapService",get:function(){return this.container.mapService}},{key:"debugService",get:function(){return this.container.debugService}},{key:"needPick",value:function(e){return this.updateLayerRenderList(),this.layerList.some((function(t){return t.needPick(e)}))}},{key:"add",value:function(e){var t=this;this.layers.push(e),this.sceneInited&&e.init().then((function(){t.renderLayers()}))}},{key:"addMask",value:function(e){var t=this;this.sceneInited&&e.init().then((function(){t.renderLayers()}))}},{key:"initLayers",value:(s=P()(L()().mark((function e(){var t=this;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var e=P()(L()().mark((function e(n){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.startInit){e.next=4;break}return e.next=3,n.init();case 3:t.updateLayerRenderList();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(e){return this.layers.find((function(t){return t.id===e}))}},{key:"getLayerByName",value:function(e){return this.layers.find((function(t){return t.name===e}))}},{key:"remove",value:(o=P()(L()().mark((function e(t,n){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n?n.layerChildren=n.layerChildren.filter((function(e){return e!==t})):this.layers=this.layers.filter((function(e){return e!==t})),t.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"removeAllLayers",value:(i=P()(L()().mark((function e(){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.destroy(),this.reRender();case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setEnableRender",value:function(e){this.enableRender=e}},{key:"renderLayers",value:(r=P()(L()().mark((function e(){var t,n,r,i,o,s,u,l;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alreadyInRendering&&this.enableRender){e.next=2;break}return e.abrupt("return");case 2:this.updateLayerRenderList(),t=this.debugService.generateRenderUid(),this.debugService.renderStart(t),this.alreadyInRendering=!0,this.clear(),n=a()(this.layerList);try{for(n.s();!(r=n.n()).done;)r.value.prerender()}catch(e){n.e(e)}finally{n.f()}this.renderService.beginFrame(),i=a()(this.layerList),e.prev=11,i.s();case 13:if((o=i.n()).done){e.next=25;break}if(s=o.value,u=s.getLayerConfig(),l=u.enableMask,s.masks.filter((function(e){return e.inited})).length>0&&l&&this.renderMask(s.masks),!s.getLayerConfig().enableMultiPassRenderer){e.next=22;break}return e.next=20,s.renderMultiPass();case 20:e.next=23;break;case 22:s.render();case 23:e.next=13;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(11),i.e(e.t0);case 30:return e.prev=30,i.f(),e.finish(30);case 33:this.renderService.endFrame(),this.debugService.renderEnd(t),this.alreadyInRendering=!1;case 36:case"end":return e.stop()}}),e,this,[[11,27,30,33]])}))),function(){return r.apply(this,arguments)})},{key:"renderMask",value:function(e){var t=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var n,r=e.length>1?Z.yn.MULTIPLE:Z.yn.SINGLE,i=a()(e);try{for(i.s();!(n=i.n()).done;){n.value.render({isStencil:!0,stencilType:r,stencilIndex:t++})}}catch(e){i.e(e)}finally{i.f()}}},{key:"beforeRenderData",value:(n=P()(L()().mark((function e(t){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.hooks.beforeRenderData.promise();case 2:e.sent&&this.renderLayers();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"renderTileLayerMask",value:function(e){var t=0,n=e.getLayerConfig().enableMask,r=void 0===n||n,i=e.tileMask?1:0,o=e.masks.filter((function(e){return e.inited})),s=(i+=r?o.length:1)>1?Z.yn.MULTIPLE:Z.yn.SINGLE;if((e.tileMask||o.length&&r)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),o.length&&r){var u,l=a()(o);try{for(l.s();!(u=l.n()).done;){u.value.render({isStencil:!0,stencilType:s,stencilIndex:t++})}}catch(e){l.e(e)}finally{l.f()}}e.tileMask&&e.tileMask.render({isStencil:!0,stencilType:s,stencilIndex:t++,stencilOperation:Z.lE.OR})}},{key:"renderTileLayer",value:(t=P()(L()().mark((function e(t){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.renderTileLayerMask(t),!t.getLayerConfig().enableMultiPassRenderer){e.next=6;break}return e.next=4,t.renderMultiPass();case 4:e.next=8;break;case 6:return e.next=8,t.render();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateLayerRenderList",value:function(){var e=this;this.layerList=[],this.layers.filter((function(e){return e.inited})).filter((function(e){return e.isVisible()})).sort((function(e,t){return e.zIndex-t.zIndex})).forEach((function(t){e.layerList.push(t)}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){e.destroy()})),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var e=(0,_.CI)(this.mapService.bgColor);this.renderService.clear({color:e,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),h}(E.EventEmitter),be=n(2760),xe=n.n(be),Ee=n(609),Se=_.rU.isNil,Ae=function(){function e(t){var n=this;u()(this,e),y()(this,"name",void 0),y()(this,"type",void 0),y()(this,"scale",void 0),y()(this,"descriptor",void 0),y()(this,"featureBufferLayout",[]),y()(this,"needRescale",!1),y()(this,"needRemapping",!1),y()(this,"needRegenerateVertices",!1),y()(this,"featureRange",{startIndex:0,endIndex:1/0}),y()(this,"vertexAttribute",void 0),y()(this,"defaultCallback",(function(e){var t;return 0===e.length?(null===(t=n.scale)||void 0===t?void 0:t.defaultValues)||[]:e.map((function(e,t){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[t].func)(e)}))})),this.setProps(t)}return c()(e,[{key:"setProps",value:function(e){Object.assign(this,e)}},{key:"mapping",value:function(e){var t;if(null!==(t=this.scale)&&void 0!==t&&t.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,z()(e));if(!Se(r))return[r]}return this.defaultCallback(e)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Te=["buffer","update","name"],Ce=["buffer","update","name"],we=y()(y()(y()({},Ee.gl.FLOAT,4),Ee.gl.UNSIGNED_BYTE,1),Ee.gl.UNSIGNED_SHORT,2),Re=function(){function e(t){u()(this,e),y()(this,"attributesAndIndices",void 0),y()(this,"attributes",[]),y()(this,"triangulation",void 0),y()(this,"featureLayout",{sizePerElement:0,elements:[]}),this.rendererService=t}return c()(e,[{key:"registerStyleAttribute",value:function(e){var t=this.getLayerStyleAttribute(e.name||"");return t?t.setProps(e):(t=new Ae(e),this.attributes.push(t)),t}},{key:"unRegisterStyleAttribute",value:function(e){var t=this.attributes.findIndex((function(t){return t.name===e}));t>-1&&this.attributes.splice(t,1)}},{key:"updateScaleAttribute",value:function(e){this.attributes.forEach((function(t){var n,r=t.name,i=null===(n=t.scale)||void 0===n?void 0:n.field;(e[r]||i&&e[i])&&(t.needRescale=!0,t.needRemapping=!0,t.needRegenerateVertices=!0)}))}},{key:"updateStyleAttribute",value:function(e,t,n){var r=this.getLayerStyleAttribute(e);r||(r=this.registerStyleAttribute(i()(i()({},t),{},{name:e})));var o=t.scale;o&&r&&(r.scale=o,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(e){return this.attributes.find((function(t){return t.name===e}))}},{key:"getLayerAttributeScale",value:function(e){var t,n=this.getLayerStyleAttribute(e),r=null==n||null===(t=n.scale)||void 0===t?void 0:t.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=this.attributes.find((function(t){return t.name===e}));if(o&&o.descriptor){var a=o.descriptor,s=a.update,u=a.buffer,l=a.size,c=void 0===l?0:l,h=we[u.type||Ee.gl.FLOAT];if(s){var f=this.featureLayout,p=f.elements,d=f.sizePerElement,v=p.slice(n,r);if(!v.length)return;var m=v[0].offset,g=m*c*h,y=v.map((function(e,n){for(var r=e.featureIdx,i=e.vertices,o=e.normals,a=i.length/d,u=[],l=0;l<a;l++){var c=o?o.slice(3*l,3*l+3):[];u.push.apply(u,z()(s(t[r],r,i.slice(l*d,l*d+d),n,c)))}return u})).flat();o.vertexAttribute.updateBuffer({data:y,offset:g}),null==i||i.emit("legend:".concat(e),i.getLegend(e))}}}},{key:"createAttributesAndIndices",value:function(e,t,n,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);var a=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),s=0,u=0,l=[],c=3;e.forEach((function(e,t){var r=o.triangulation(e,n),i=r.indices,h=r.vertices,f=r.normals,p=r.size,d=r.indexes,v=r.count;"number"==typeof v&&(u+=v),i.forEach((function(e){l.push(e+s)})),c=p;var m=h.length/p;o.featureLayout.sizePerElement=c,o.featureLayout.elements.push({featureIdx:t,vertices:h,normals:f,offset:s}),s+=m;for(var g=function(n){var r=(null==f?void 0:f.slice(3*n,3*n+3))||[],i=h.slice(n*p,n*p+p),o=0;d&&void 0!==d[n]&&(o=d[n]),a.forEach((function(a,s){var u;a&&a.update&&(u=a.buffer.data).push.apply(u,z()(a.update(e,t,i,n,r,o)))}))},y=0;y<m;y++)g(y)}));var h=this.rendererService,f=h.createAttribute,p=h.createBuffer,d=h.createElements,v={};a.forEach((function(e,t){if(e){var n=e.buffer,r=(e.update,e.name,xe()(e,Te)),a=f(i()({buffer:p(n)},r));v[e.name||""]=a,o.attributes[t].vertexAttribute=a}}));var m=d({data:l,type:Ee.gl.UNSIGNED_INT,count:l.length});return this.attributesAndIndices={attributes:v,elements:m,count:u},Object.values(this.attributes).filter((function(e){return e.scale})).forEach((function(e){var t=e.name;null==r||r.emit("legend:".concat(t),r.getLegend(t))})),this.attributesAndIndices}},{key:"createAttributes",value:function(e,t){var n=this;this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);var r=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),o=0,a=[],s=3;e.forEach((function(e,t){var i=n.triangulation(e),u=i.indices,l=i.vertices,c=i.normals,h=i.size,f=i.indexes;u.forEach((function(e){a.push(e+o)})),s=h;var p=l.length/h;n.featureLayout.sizePerElement=s,n.featureLayout.elements.push({featureIdx:t,vertices:l,normals:c,offset:o}),o+=p;for(var d=function(n){var i=(null==c?void 0:c.slice(3*n,3*n+3))||[],o=l.slice(n*h,n*h+h),a=0;f&&void 0!==f[n]&&(a=f[n]),r.forEach((function(r,s){var u;r&&r.update&&(u=r.buffer.data).push.apply(u,z()(r.update(e,t,o,n,i,a)))}))},v=0;v<p;v++)d(v)}));var u=this.rendererService,l=u.createAttribute,c=u.createBuffer,h={};return r.forEach((function(e,t){if(e){var r=e.buffer,o=(e.update,e.name,xe()(e,Ce)),a=l(i()({buffer:c(r)},o));h[e.name||""]=a,n.attributes[t].vertexAttribute=a}})),{attributes:h}}},{key:"clearAllAttributes",value:function(){var e;this.attributes.forEach((function(e){e.vertexAttribute&&e.vertexAttribute.destroy()})),null===(e=this.attributesAndIndices)||void 0===e||e.elements.destroy(),this.attributes=[]}}]),e}(),Me=n(7204),ke=n(1554),Le=n.n(ke),Oe=function(e){d()(i,e);var t,n,r=m()(i);function i(e){var t;return u()(this,i),t=r.call(this),y()(f()(t),"destroyed",!1),y()(f()(t),"loaded",!1),y()(f()(t),"id",void 0),y()(f()(t),"inited",!1),y()(f()(t),"rendering",!1),y()(f()(t),"$container",void 0),y()(f()(t),"canvas",void 0),y()(f()(t),"markerContainer",void 0),y()(f()(t),"resizeDetector",void 0),y()(f()(t),"hooks",void 0),y()(f()(t),"handleWindowResized",(function(){t.emit("resize"),t.$container&&(t.initContainer(),t.coordinateSystemService.needRefresh=!0,t.render())})),y()(f()(t),"handleMapCameraChanged",(function(e){t.cameraService.update(e),t.render()})),t.container=e,t.hooks={init:new Me.sX},t.id=e.id,t}return c()(i,[{key:"iconService",get:function(){return this.container.iconService}},{key:"fontService",get:function(){return this.container.fontService}},{key:"controlService",get:function(){return this.container.controlService}},{key:"configService",get:function(){return this.container.globalConfigService}},{key:"map",get:function(){return this.container.mapService}},{key:"coordinateSystemService",get:function(){return this.container.coordinateSystemService}},{key:"rendererService",get:function(){return this.container.rendererService}},{key:"layerService",get:function(){return this.container.layerService}},{key:"debugService",get:function(){return this.container.debugService}},{key:"cameraService",get:function(){return this.container.cameraService}},{key:"interactionService",get:function(){return this.container.interactionService}},{key:"pickingService",get:function(){return this.container.pickingService}},{key:"shaderModuleService",get:function(){return this.container.shaderModuleService}},{key:"markerService",get:function(){return this.container.markerService}},{key:"popupService",get:function(){return this.container.popupService}},{key:"init",value:function(e){var t=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return t.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",P()(L()().mark((function e(){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.debugService.log("map.mapInitStart",{type:t.map.version}),e.next=3,new Promise((function(e){t.map.onCameraChanged((function(n){t.cameraService.init(),t.cameraService.update(n),e()})),t.map.init()}));case 3:t.map.onCameraChanged(t.handleMapCameraChanged),t.map.addMarkerContainer(),t.markerService.addMarkers(),t.markerService.addMarkerLayers(),t.popupService.initPopup(),t.interactionService.init(),t.interactionService.on(ce.s.Drag,t.addSceneEvent.bind(t));case 10:case"end":return e.stop()}}),e)})))),this.hooks.init.tapPromise("initRenderer",P()(L()().mark((function n(){var r,i,o;return L()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=(null===(r=t.map)||void 0===r?void 0:r.getOverlayContainer())||void 0,t.$container=i||de(t.configService.getSceneConfig(t.id).id||""),!t.$container){n.next=14;break}return t.canvas=_.SO.create("canvas","",t.$container),t.setCanvas(),n.next=7,t.rendererService.init(t.canvas,t.configService.getSceneConfig(t.id),e.gl);case 7:t.registerContextLost(),t.initContainer(),t.resizeDetector=Le()({strategy:"scroll"}),t.resizeDetector.listenTo(t.$container,t.handleWindowResized),window.matchMedia&&(null===(o=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===o||o.addListener(t.handleWindowResized.bind("screen"))),n.next=15;break;case 14:console.error("容器 id 不存在");case 15:t.pickingService.init(t.id);case 16:case"end":return n.stop()}}),n)})))),this.render()}},{key:"registerContextLost",value:function(){var e=this,t=this.rendererService.getCanvas();t&&t.addEventListener("webglcontextlost",(function(){return e.emit("webglcontextlost")}))}},{key:"addLayer",value:function(e){this.layerService.sceneService=this,this.layerService.add(e)}},{key:"addMask",value:function(e){this.layerService.sceneService=this,this.layerService.addMask(e)}},{key:"render",value:(n=P()(L()().mark((function e(){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rendering&&!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(this.rendering=!0,this.inited){e.next=16;break}return e.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),e.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,e.next=20;break;case 16:return e.next=18,this.layerService.initLayers();case 18:return e.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"addFontFace",value:function(e,t){this.fontService.addFontFace(e,t)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:(t=P()(L()().mark((function e(t){var n,r,i;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null===(n=this.$container)||void 0===n?void 0:n.getElementsByTagName("canvas")[0],e.next=3,this.render();case 3:return i="jpg"===t?null==r?void 0:r.toDataURL("image/jpeg"):null==r?void 0:r.toDataURL("image/png"),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var e=this.$container.parentElement;null!==e&&(this.markerContainer=_.SO.create("div","l7-marker-container",e))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var e,t=this;this.inited?(this.resizeDetector.removeListener(this.$container,this.handleWindowResized),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout((function(){var e;null===(e=t.$container)||void 0===e||e.removeChild(t.canvas),t.canvas=null,t.rendererService.destroy()})),null===(e=this.$container)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.$container),this.emit("destroy")):this.destroyed=!0}},{key:"initContainer",value:function(){var e,t,n=_.SO.DPR,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o&&(o.width=r*n,o.height=i*n),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var e,t,n=_.SO.DPR,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o.width=r*n,o.height=i*n,o.style.width="100%",o.style.height="100%"}},{key:"addSceneEvent",value:function(e){this.emit(e.type,e)}}]),i}(E.EventEmitter),Pe=n(5594),Ie=_.rU.uniq,Ne="#define PI 3.14159265359",De="layout(std140) uniform PickingUniforms {\n  vec4 u_HighlightColor;\n  vec4 u_SelectColor;\n  vec3 u_PickingColor;\n  float u_PickingStage;\n  vec3 u_CurrentSelectedId;\n  float u_PickingThreshold;\n  float u_PickingBuffer;\n  float u_shaderPick;\n  float u_activeMix;\n};",Be='#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n#define EARTH_CIRCUMFERENCE 40.03e6\n\n#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0           // amap\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n\n#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0\n#pragma include "scene_uniforms"\n\n\n// web mercator coords -> world coords\nvec2 project_mercator(vec2 lnglat) {\n   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0\n    return lnglat;\n  }\n  float x = lnglat.x;\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\nfloat project_scale(float meters) {\n  return meters * u_PixelsPerMeter.z;\n}\n\n\n// offset coords -> world coords\nvec4 project_offset(vec4 offset) {\n  float dy = offset.y;\n  dy = clamp(dy, -1., 1.);\n  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\n  return vec4(offset.xyz * pixels_per_unit, offset.w);\n}\n\nvec3 project_normal(vec3 normal) {\n  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\n  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\n\nvec3 project_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // normals generated by the polygon tesselator are in lnglat offsets instead of meters\n    return normalize(vector * u_PixelsPerDegree);\n  }\n  return project_normal(vector);\n}\n// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01\n// reverse Y\nvec3 reverse_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\n    return vector * vec3(1.0, -1.0, 1.0);\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0\n    return vector;\n  }\n  return vector;\n}\n\nvec4 project_mvt_offset_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return project_offset(vec4(0.0, 0.0, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n  return position;\n}\n\nvec4 project_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    float X = position.x - u_ViewportCenter.x;\n    float Y = position.y - u_ViewportCenter.y;\n    return project_offset(vec4(X, Y, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return vec4(\n      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n \n\n  //    return vec4(\n  //     position.xy,\n  //     project_scale(position.z),\n  //     position.w);\n  // }\n  return position;\n\n  // TODO: 瓦片坐标系 & 常规世界坐标系\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\n  return offset * u_FocalDistance;\n}\n\n\n\nfloat project_pixel_allmap(float pixel) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    return pixel * pow(2.0, u_Zoom);\n  }\n  return pixel * u_FocalDistance ;\n}\n\n// 适配纹理贴图的等像素大小\nfloat project_pixel_texture(float pixel) {\n  // mapbox zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;\n  }\n\n  // amap2 zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n\n  // amap zoom > 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;\n  }\n\n  // amap zoom < 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * 2.0 *  u_FocalDistance;;\n}\n\n// 在不论什么底图下需要统一处理的时候使用\nfloat project_float_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // mapbox P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\n\n// Project meter into the unit of pixel which used in the camera world space\nfloat project_float_meter(float meter) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Since the zoom level uniform is updated by mapservice and it\'s alread been subtracted by 1\n    // Not sure if we are supposed to do that again\n   return meter;\n  } else  {\n    return project_float_pixel(meter);\n  }\n\n  // TODO: change the following code to make adaptations for amap\n  // return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;\n}\n\nfloat project_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\nvec2 project_pixel(vec2 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\nvec3 project_pixel(vec3 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    position.w *= u_PixelsPerMeter.z;\n  }\n\n  return viewProjectionMatrix * position + center;\n}\n\n// Projects from common space coordinates to clip space\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(\n    position,\n    u_ViewProjectionMatrix,\n    u_ViewportCenterProjection\n  );\n}\n\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\n  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n     pos.w = pos.w / u_PixelsPerMeter.z;\n  }\n  return pos;\n}\n\n\nbool isEqual( float a,  float b) {\n    return  a< b + 0.001 && a > b - 0.001;\n}\n\n// 支持 GaodeV2、Mapbox\nvec4 project_common_position_to_clipspace_v2(vec4 position) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    return u_Mvp * position;\n  } else {\n    return project_common_position_to_clipspace(position);\n  }\n}\n',Fe="layout(std140) uniform SceneUniforms {\n  mat4 u_ViewMatrix;\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewProjectionMatrix;\n  mat4 u_ModelMatrix;\n  vec4 u_ViewportCenterProjection;\n  vec3 u_PixelsPerDegree;\n  float u_Zoom;\n  vec3 u_PixelsPerDegree2;\n  float u_ZoomScale;\n  vec3 u_PixelsPerMeter;\n  float u_CoordinateSystem;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_ViewportCenter;\n  vec2 u_ViewportSize;\n  float u_FocalDistance;\n};\n\nlayout(std140) uniform LayerUniforms {\n  mat4 u_Mvp;\n  vec2 u_sceneCenterMercator;\n};\n",Ue=/precision\s+(high|low|medium)p\s+float/,ze="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n",Ge=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,je=/void\s+main\s*\([^)]*\)\s*\{\n?/,Ve=function(){function e(){u()(this,e),y()(this,"moduleCache",{}),y()(this,"rawContentCache",{})}return c()(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Ne,fs:Ne}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\n\nvec2 unpack_float(float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n",fs:""}),this.registerModule("scene_uniforms",{vs:Fe,fs:Fe}),this.registerModule("picking_uniforms",{vs:De,fs:De}),this.registerModule("projection",{vs:Be,fs:Be}),this.registerModule("project",{vs:"\n#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\n  float maxs=85.0511287798;\n  float lat=max(min(maxs,lnglat.y),-maxs);\n  float scale= 268435456.;\n  float d=PI/180.;\n  float x=lnglat.x*d;\n  float y=lat*d;\n  y=log(tan((PI/4.)+(y/2.)));\n\n  float a=.5/PI,\n  b=.5,\n  c=-.5/PI;\n  d=.5;\n  x=scale*(a*x+b);\n  y=scale*(c*y+d);\n  return vec2(x,y);\n}\n\nvec2 unProjectFlat(vec2 px){\n  float a=.5/PI;\n  float b=.5;\n  float c=-.5/PI;\n  float d=.5;\n  float scale = 268435456.;\n  float x=(px.x/scale-b)/a;\n  float y=(px.y/scale-d)/c;\n  y=(atan(pow(E,y))-(PI/4.))*2.;\n  d=PI/180.;\n  float lat=y/d;\n  float lng=x/d;\n  return vec2(lng,lat);\n}\n\nfloat pixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}\n\n// gaode2.0\nvec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标\n  float t = lnglat.x;\n  float e = lnglat.y;\n  float Sm = 180.0 / PI;\n  float Tm = 6378137.0;\n  float Rm = PI / 180.0;\n  float r = 85.0511287798;\n  e = max(min(r, e), -r);\n  t *= Rm;\n  e *= Rm;\n  e = log(tan(PI / 4.0 + e / 2.0));\n  return vec2(t * Tm, e * Tm);\n}\n\nvec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度\n  float Sm = 57.29577951308232; //180 / Math.PI\n  float Tm = 6378137.0;\n  float t = point.x;\n  float e = point.y;\n  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\n\n\nfloat customPixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}\n"}),this.registerModule("lighting",{vs:"// Blinn-Phong model\n// apply lighting in vertex shader instead of fragment shader\n// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\n\nstruct DirectionalLight {\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n};\n\nstruct SpotLight {\n  vec3 position;\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n  float constant;\n  float linear;\n  float quadratic;\n  float angle;\n  float blur;\n  float exponent;\n};\n\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\n\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\n  vec3 lightDir = normalize(light.direction);\n  // diffuse shading\n  float diff = max(dot(normal, lightDir), 0.0);\n  // Blinn-Phong specular shading\n  vec3 halfwayDir = normalize(lightDir + viewDir);\n  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\n\n  vec3 ambient = light.ambient * u_Ambient;\n  vec3 diffuse = light.diffuse * diff * u_Diffuse;\n  vec3 specular = light.specular * spec * u_Specular;\n\n  return ambient + diffuse + specular;\n}\n\n\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\n  vec3 weight = vec3(0.0);\n  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\n    if (i >= u_NumOfDirectionalLights) {\n      break;\n    }\n    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n  }\n  return weight;\n}\n",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n      // //cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(vec3(1, -10.5, 12));\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n      // //lambert\n    float lambert = dot(worldNormal, lightDir);\n        //specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n        //sum to light weight\n    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\n\n    return lightWeight;\n}\n",fs:""}),this.registerModule("picking",{vs:'layout(location = 3) in vec3 a_PickingColor;\nout vec4 v_PickingResult;\n\n#pragma include "picking_uniforms"\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\nbool isVertexPicked(vec3 vertexColor) {\n  return distance(vertexColor,u_PickingColor.rgb) < 0.01;\n}\n\n// 判断当前点是否已经被 select 选中\nbool isVertexSelected(vec3 vertexColor) {\n  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  if(u_shaderPick < 0.5) {\n    return;\n  }\n  // compares only in highlight stage\n\n  if(u_PickingStage == PICKING_HIGHLIGHT) {\n    if(isVertexPicked(pickingColor)) {\n       v_PickingResult = vec4(pickingColor.rgb * COLOR_SCALE,HIGHLIGHT);\n       return;\n    }\n    if(isVertexSelected(pickingColor)) {\n     v_PickingResult = vec4(u_CurrentSelectedId.rgb * COLOR_SCALE,SELECT);\n      return;\n    }\n\n  } else {\n      v_PickingResult= vec4(pickingColor.rgb * COLOR_SCALE,NORMAL);\n      return;\n  }\n\n  // // v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && (isVertexPicked(pickingColor) || isVertexPicked(u_CurrentSelectedId)));\n\n  // // Stores the picking color so that the fragment shader can render it during picking\n  // v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\n\nfloat setPickingOrder(float z) {\n   bool selected = bool(v_PickingResult.a);\n   return selected ? z + 1. : 0.;\n}\n',fs:'\nin vec4 v_PickingResult;\n\n#pragma include "picking_uniforms"\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color, float weight) {\n  float activeType = v_PickingResult.a;\n  if(activeType > 0.0) {\n    vec4 highLightColor =  activeType > 1.5 ? u_SelectColor : u_HighlightColor;\n    highLightColor = highLightColor * COLOR_SCALE;\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n  }\n  else {\n    return color;\n  }\n\n  \n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, 1.0));\n  }\n  \n}\n\nvec4 filterColorAlpha(vec4 color, float alpha) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, alpha));\n  }\n}\n\n'}),this.registerModule("rotation_2d",{vs:"vec2 rotate_matrix(vec2 v, float a) {\n    float b = a / 180.0 * 3.1415926535897932384626433832795;\n    float s = sin(b);\n    float c = cos(b);\n    mat2 m = mat2(c, s, -s, c);\n    return m * v;\n}",fs:""})}},{key:"registerModule",value:function(e,t){t.vs=t.vs.replace(/\r\n/g,"\n"),t.fs=t.fs.replace(/\r\n/g,"\n");var n=t.vs,r=t.fs,o=t.uniforms,a=t.inject,s=(0,Pe.y4)(n),u=s.content,l=s.uniforms,c=(0,Pe.y4)(r),h=c.content,f=c.uniforms;this.rawContentCache[e]={fs:h,inject:a,uniforms:i()(i()(i()({},l),f),o),vs:u}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(e){var t=this,n=this.rawContentCache[e].vs,r=this.rawContentCache[e].fs,o=this.rawContentCache[e].inject,a={};null!=o&&o["vs:#decl"]&&(n=(null==o?void 0:o["vs:#decl"])+n,a=(0,Pe.y4)(null==o?void 0:o["vs:#decl"]).uniforms),null!=o&&o["vs:#main-start"]&&(n=n.replace(je,(function(e){return e+(null==o?void 0:o["vs:#main-start"])}))),null!=o&&o["fs:#decl"]&&(r=(null==o?void 0:o["fs:#decl"])+r);var s=this.processModule(n,[],"vs"),u=s.content,l=s.includeList,c=this.processModule(r,[],"fs"),h=c.content,f=c.includeList,p="",d=Ie(l.concat(f).concat(e)).reduce((function(e,n){return i()(i()({},e),t.rawContentCache[n].uniforms)}),i()({},a));Ue.test(h)||(p+=ze),p+=h;var v="";return Ue.test(u)||(v+=ze),v+=u,this.moduleCache[e]={fs:p.trim(),uniforms:d,vs:v.trim()},this.moduleCache[e]}},{key:"processModule",value:function(e,t,n){var r=this;return{content:e.replace(Ge,(function(e,i){var o=i.split(" ")[0].replace(/"/g,"");if(t.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return t.push(o),r.processModule(a,t,n).content})),includeList:t}}},{key:"injectDefines",value:function(e){return Object.keys(e).reduce((function(t,n){return t+"#define ".concat(n.toUpperCase()," ").concat(e[n],";\n")}),"\n")}}]),e}(),He=n(746),We=n.n(He),Ze=n(378),Xe=n.n(Ze),Ye=n(4857),qe=function(){function e(){u()(this,e),y()(this,"shaderModuleService",void 0),y()(this,"rendererService",void 0),y()(this,"cameraService",void 0),y()(this,"mapService",void 0),y()(this,"interactionService",void 0),y()(this,"layerService",void 0),y()(this,"config",void 0)}return c()(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Ye.G.Normal}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().rendererService,this.cameraService=e.getContainer().cameraService,this.mapService=e.getContainer().mapService,this.interactionService=e.getContainer().interactionService,this.layerService=e.getContainer().layerService,this.shaderModuleService=e.getContainer().shaderModuleService}},{key:"render",value:function(e){}}]),e}(),Ke=function(e){d()(n,e);var t=m()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(e,t){We()(Xe()(n.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),n}(qe),Qe=function(){function e(t){u()(this,e),y()(this,"passes",[]),y()(this,"layer",void 0),y()(this,"renderFlag",void 0),y()(this,"width",0),y()(this,"height",0),this.postProcessor=t}var t;return c()(e,[{key:"setLayer",value:function(e){this.layer=e}},{key:"setRenderFlag",value:function(e){this.renderFlag=e}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(t=P()(L()().mark((function e(){var t,n,r;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a()(this.passes),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r.render(this.layer);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:return e.next=19,this.postProcessor.render(this.layer);case 19:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(){return t.apply(this,arguments)})},{key:"resize",value:function(e,t){this.width===e&&this.height===t||(this.postProcessor.resize(e,t),this.width=e,this.height=t)}},{key:"add",value:function(e,t){e.getType()===Ye.G.PostProcessing?this.postProcessor.add(e,this.layer,t):(e.init(this.layer,t),this.passes.push(e))}},{key:"insert",value:function(e,t,n){e.init(this.layer,t),this.passes.splice(n,0,e)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),$e=function(e){d()(n,e);var t=m()(n);function n(){var e;u()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),y()(f()(e),"pickingFBO",void 0),y()(f()(e),"layer",void 0),y()(f()(e),"width",0),y()(f()(e),"height",0),y()(f()(e),"alreadyInRendering",!1),y()(f()(e),"pickFromPickingFBO",(function(t){var n=t.x,r=t.y,o=t.lngLat,a=t.type;if(e.layer.isVisible()&&e.layer.needPick(a)){var s,u=e.rendererService,l=u.getViewportSize,c=u.readPixelsAsync,h=u.useFramebuffer,f=l(),p=f.width,d=f.height,v=e.layer.getLayerConfig(),m=v.enableHighlight,g=v.enableSelect,y=n*_.SO.DPR,b=r*_.SO.DPR;if(!(y>p||y<0||b>d||b<0))h(e.pickingFBO,P()(L()().mark((function t(){var u,l,h,f,p;return L()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c({x:Math.round(y),y:Math.round(d-(r+1)*_.SO.DPR),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO});case 2:0!==(s=t.sent)[0]||0!==s[1]||0!==s[2]?(l=(0,_.W0)(s),h=e.layer.getSource().getFeatureById(l),f={x:n,y:r,type:a,lngLat:o,featureId:l,feature:h},h&&(e.layer.setCurrentPickId(l),e.triggerHoverOnLayer(f))):(p={x:n,y:r,lngLat:o,type:null===e.layer.getCurrentPickId()?"un"+a:"mouseout",featureId:null,feature:null},e.triggerHoverOnLayer(i()(i()({},p),{},{type:"unpick"})),e.triggerHoverOnLayer(p),e.layer.setCurrentPickId(null)),m&&e.highlightPickedFeature(s),g&&"click"===a&&(null===(u=s)||void 0===u?void 0:u.toString())!==[0,0,0,0].toString()&&e.selectFeature(s);case 6:case"end":return t.stop()}}),t)}))))}})),e}return c()(n,[{key:"getType",value:function(){return Ye.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(e,t){We()(Xe()(n.prototype),"init",this).call(this,e,t),this.layer=e;var r=this.rendererService,i=r.createTexture2D,o=r.createFramebuffer,a=(0,r.getViewportSize)(),s=i({width:a.width,height:a.height,wrapS:Ee.gl.CLAMP_TO_EDGE,wrapT:Ee.gl.CLAMP_TO_EDGE,label:"Picking Texture"});this.pickingFBO=o({color:s}),this.interactionService.on(ce.s.Hover,this.pickFromPickingFBO),this.interactionService.on(ce.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ce.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(e){var t=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){o({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=t.layer.multiPassRenderer.getRenderFlag();t.layer.multiPassRenderer.setRenderFlag(!1),e.hooks.beforePickingEncode.call(),e.render(),e.hooks.afterPickingEncode.call(),t.layer.multiPassRenderer.setRenderFlag(n),t.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(e){this.layer.emit(e.type,e)}},{key:"highlightPickedFeature",value:function(e){var t=D()(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(e){var t=D()(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(e){var t=e.featureId,n=(0,_.Z6)(t);this.selectFeature(new Uint8Array(n))}},{key:"highlightFeatureHandle",value:function(e){var t=e.featureId,n=(0,_.Z6)(t);this.highlightPickedFeature(new Uint8Array(n))}}]),n}(qe),Je=function(){function e(t){u()(this,e),y()(this,"passes",[]),y()(this,"readFBO",void 0),y()(this,"writeFBO",void 0),this.rendererService=t,this.init()}var t,n;return c()(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var e=this.rendererService,t=e.getViewportSize,n=e.createTexture2D,r=t();return n({x:0,y:0,width:r.width,height:r.height,copy:!0})}},{key:"getReadFBOTex",value:function(){var e=this,t=this.rendererService.useFramebuffer;return new Promise((function(n){t(e.readFBO,P()(L()().mark((function t(){return L()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(e.getCurrentFBOTex());case 1:case"end":return t.stop()}}),t)}))))}))}},{key:"renderBloomPass",value:(n=P()(L()().mark((function e(t,n){var r,i;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getReadFBOTex();case 2:r=e.sent,i=0;case 4:if(!(i<4)){e.next=11;break}return e.next=7,n.render(t,r);case 7:this.swap(),i++,e.next=4;break;case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"render",value:(t=P()(L()().mark((function e(t){var n,r;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.passes.length)){e.next=15;break}if((r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),"bloom"!==r.getName()){e.next=9;break}return e.next=7,this.renderBloomPass(t,r);case 7:e.next=12;break;case 9:return e.next=11,r.render(t);case 11:n!==this.passes.length-1&&this.swap();case 12:n++,e.next=1;break;case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resize",value:function(e,t){this.readFBO.resize({width:e,height:t}),this.writeFBO.resize({width:e,height:t})}},{key:"add",value:function(e,t,n){e.init(t,n),this.passes.push(e)}},{key:"insert",value:function(e,t,n,r){e.init(n,r),this.passes.splice(t,0,e)}},{key:"getPostProcessingPassByName",value:function(e){return this.passes.find((function(t){return t.getName()===e}))}},{key:"init",value:function(){var e=this.rendererService,t=e.createFramebuffer,n=e.createTexture2D;this.readFBO=t({color:n({width:1,height:1,wrapS:Ee.gl.CLAMP_TO_EDGE,wrapT:Ee.gl.CLAMP_TO_EDGE})}),this.writeFBO=t({color:n({width:1,height:1,wrapS:Ee.gl.CLAMP_TO_EDGE,wrapT:Ee.gl.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].isEnabled())return!1;return!0}},{key:"swap",value:function(){var e=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=e}}]),e}(),et=function(e){d()(n,e);var t=m()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"getType",value:function(){return Ye.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(e,t){We()(Xe()(n.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(e){var t=this.rendererService,n=t.useFramebuffer,r=t.clear,i=e.multiPassRenderer.getPostProcessor().getReadFBO();n(i,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),e.multiPassRenderer.setRenderFlag(!1),e.models.forEach((function(t){t.draw({uniforms:e.layerModel.getUninforms()})})),e.multiPassRenderer.setRenderFlag(!0)}))}}]),n}(qe),tt="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}";function nt(e,t){for(var n=0,r=1/t,i=e;i>0;)n+=r*(i%t),i=Math.floor(i/t),r/=t;return n}var rt=1,it=function(e){d()(n,e);var t=m()(n);function n(e){var r;return u()(this,n),r=t.call(this),y()(f()(r),"haltonSequence",[]),y()(f()(r),"accumulatingId",0),y()(f()(r),"frame",0),y()(f()(r),"timer",void 0),y()(f()(r),"sampleRenderTarget",void 0),y()(f()(r),"prevRenderTarget",void 0),y()(f()(r),"outputRenderTarget",void 0),y()(f()(r),"copyRenderTarget",void 0),y()(f()(r),"blendModel",void 0),y()(f()(r),"outputModel",void 0),y()(f()(r),"copyModel",void 0),r.shaderModuleService=e,r}return c()(n,[{key:"getType",value:function(){return Ye.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(e,t){We()(Xe()(n.prototype),"init",this).call(this,e,t);var r=this.rendererService,i=r.createFramebuffer,o=r.createTexture2D;this.sampleRenderTarget=i({color:o({width:1,height:1,wrapS:Ee.gl.CLAMP_TO_EDGE,wrapT:Ee.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=i({color:o({width:1,height:1,wrapS:Ee.gl.CLAMP_TO_EDGE,wrapT:Ee.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=i({color:o({width:1,height:1,wrapS:Ee.gl.CLAMP_TO_EDGE,wrapT:Ee.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=i({color:o({width:1,height:1,wrapS:Ee.gl.CLAMP_TO_EDGE,wrapT:Ee.gl.CLAMP_TO_EDGE})});for(var a=0;a<30;a++)this.haltonSequence.push([nt(a,2),nt(a,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\n\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  vec4 texel1 = texture2D(u_Diffuse1, v_UV);\n  vec4 texel2 = texture2D(u_Diffuse2, v_UV);\n  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}\n"),this.outputModel=this.createTriangleModel("copy-pass",tt,{blend:{enable:!0,func:{srcRGB:Ee.gl.ONE,dstRGB:Ee.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:Ee.gl.ONE,dstAlpha:Ee.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:Ee.gl.FUNC_ADD,alpha:Ee.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",tt)}},{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var l=e.multiPassRenderer.getPostProcessor().getReadFBO();o(l,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l}),e.multiPassRenderer.setRenderFlag(!1),e.render(),e.multiPassRenderer.setRenderFlag(!0)}));var c=function n(r){t.accumulatingId&&r===t.accumulatingId&&(t.isFinished()||(t.doRender(e),window.requestAnimationFrame((function(){n(r)}))))};this.accumulatingId=rt++,this.timer=window.setTimeout((function(){c(t.accumulatingId)}),50)}},{key:"doRender",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height,l=e.getLayerConfig().jitterScale,c=void 0===l?1:l,h=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*h[0]-1)/s*c,(2*h[1]-1)/u*c),e.multiPassRenderer.setRenderFlag(!1),e.hooks.beforeRender.call(),o(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.sampleRenderTarget}),e.render()})),e.hooks.afterRender.call(),e.multiPassRenderer.setRenderFlag(!0);var f=e.getLayerConfig();o(this.outputRenderTarget,(function(){t.blendModel.draw({uniforms:{u_opacity:f.opacity||1,u_MixRatio:0===t.frame?1:.9,u_Diffuse1:t.sampleRenderTarget,u_Diffuse2:0===t.frame?e.multiPassRenderer.getPostProcessor().getReadFBO():t.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,(function(){t.outputModel.draw({uniforms:{u_Texture:t.outputRenderTarget}})})),o(e.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){t.copyModel.draw({uniforms:{u_Texture:t.copyRenderTarget}})})),e.multiPassRenderer.getPostProcessor().render(e));var p=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=p,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(e,t,n){this.shaderModuleService.registerModule(e,{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:t});var r=this.shaderModuleService.getModule(e),o=r.vs,a=r.fs,s=r.uniforms,u=this.rendererService,l=u.createAttribute,c=u.createBuffer;return(0,u.createModel)(i()({vs:o,fs:a,attributes:{a_Position:l({buffer:c({data:[-4,-4,4,-4,0,4],type:Ee.gl.FLOAT}),size:2})},uniforms:i()({},s),depth:{enable:!1},count:3},n))}}]),n}(qe),ot=n(8881),at=_.rU.isNil,st=function(e){d()(n,e);var t=m()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nfloat luminance(vec4 color) {\n  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\n\nvoid main() {\n  // vec4 baseColor = texture2D(u_Texture, v_UV);\n\n  float r = sqrt(u_radius);\n\n  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\n  // c1 *= luminance(c1);\n  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\n  // c2 *= luminance(c2);\n  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\n  // c3 *= luminance(c3);\n  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\n  // c4 *= luminance(c4);\n  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\n\n  // float lum = luminance(inbloomColor);\n  // inbloomColor.rgb *= lum;\n\n  if(u_BloomFinal > 0.0) {\n    vec4 baseColor = texture2D(u_Texture2, v_UV);\n    float baselum = luminance(baseColor);\n    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\n    if(baselum <= 0.2) {\n      gl_FragColor = inbloomColor * u_intensity;\n    }\n  } else {\n    gl_FragColor = inbloomColor;\n  }\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService.getViewportSize(),a=o.width,s=o.height;return{vs:t,fs:n,uniforms:i()(i()({},r),{},{u_ViewportSize:[a,s]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return at(e.bloomRadius)||(t.u_radius=e.bloomRadius),at(e.bloomIntensity)||(t.u_intensity=e.bloomIntensity),at(e.bloomBaseRadio)||(t.u_baseRadio=e.bloomBaseRadio),t}}]),n}(ot.Z),ut=_.rU.isNil,lt=function(e){d()(n,e);var t=m()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService.getViewportSize(),a=o.width,s=o.height;return{vs:t,fs:n,uniforms:i()(i()({},r),{},{u_ViewportSize:[a,s]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return ut(e.blurRadius)||(t.u_BlurDir=[e.blurRadius,0]),t}}]),n}(ot.Z),ct=_.rU.isNil,ht=function(e){d()(n,e);var t=m()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService.getViewportSize(),a=o.width,s=o.height;return{vs:t,fs:n,uniforms:i()(i()({},r),{},{u_ViewportSize:[a,s]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return ct(e.blurRadius)||(t.u_BlurDir=[0,e.blurRadius]),t}}]),n}(ot.Z),ft=function(e){d()(n,e);var t=m()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:'varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n\n#pragma include "common"\n\nfloat scale = PI / u_Size;\n\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\n  float s = sin(u_Angle), c = cos(u_Angle);\n  vec2 tex = texCoord * texSize - u_Center * texSize;\n  vec2 point = vec2(\n    c * tex.x - s * tex.y,\n    s * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  vec3 cmy = 1.0 - color.rgb;\n  float k = min(cmy.x, min(cmy.y, cmy.z));\n  cmy = (cmy - k) / (1.0 - k);\n  cmy = clamp(\n    cmy * 10.0 - 3.0 + vec3(\n      pattern(u_Angle + 0.26179, texSize, texCoord),\n      pattern(u_Angle + 1.30899, texSize, texCoord),\n      pattern(u_Angle, texSize, texCoord)\n    ),\n    0.0,\n    1.0\n  );\n  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\n  return vec4(1.0 - cmy - k, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var e=this.shaderModuleService.getModule("colorhalftone-pass"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService.getViewportSize(),a=o.width,s=o.height;return{vs:t,fs:n,uniforms:i()(i()({},r),{},{u_ViewportSize:[a,s]})}}}]),n}(ot.Z),pt=function(e){d()(n,e);var t=m()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}"}),this.shaderModuleService.getModule("copy-pass")}}]),n}(ot.Z),dt=function(e){d()(n,e);var t=m()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\n  tex.y /= 0.866025404;\n  tex.x -= tex.y * 0.5;\n  vec2 a;\n  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n    a = vec2(floor(tex.x), floor(tex.y));\n  }\n  else a = vec2(ceil(tex.x), ceil(tex.y));\n  vec2 b = vec2(ceil(tex.x), floor(tex.y));\n  vec2 c = vec2(floor(tex.x), ceil(tex.y));\n  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\n  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\n  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\n  float alen = length(TEX - A);\n  float blen = length(TEX - B);\n  float clen = length(TEX - C);\n  vec2 choice;\n  if (alen < blen) {\n    if (alen < clen) choice = a;\n    else choice = c;\n  } else {\n    if (blen < clen) choice = b;\n    else choice = c;\n  }\n  choice.x += choice.y * 0.5;\n  choice.y *= 0.866025404;\n  choice *= u_Scale / texSize;\n  return texture2D(texture, choice + u_Center);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("hexagonalpixelate-pass"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService.getViewportSize(),a=o.width,s=o.height;return{vs:t,fs:n,uniforms:i()(i()({},r),{},{u_ViewportSize:[a,s]})}}}]),n}(ot.Z),vt=function(e){d()(n,e);var t=m()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\n\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 dx = vec2(1.0 / texSize.x, 0.0);\n  vec2 dy = vec2(0.0, 1.0 / texSize.y);\n  vec4 color = texture2D(texture, texCoord);\n  float bigTotal = 0.0;\n  float smallTotal = 0.0;\n  vec3 bigAverage = vec3(0.0);\n  vec3 smallAverage = vec3(0.0);\n  for (float x = -2.0; x <= 2.0; x += 1.0) {\n    for (float y = -2.0; y <= 2.0; y += 1.0) {\n      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\n      bigAverage += sample;\n      bigTotal += 1.0;\n      if (abs(x) + abs(y) < 2.0) {\n        smallAverage += sample;\n        smallTotal += 1.0;\n      }\n    }\n  }\n  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\n  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\n  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("ink-pass"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService.getViewportSize(),a=o.width,s=o.height;return{vs:t,fs:n,uniforms:i()(i()({},r),{},{u_ViewportSize:[a,s]})}}}]),n}(ot.Z),mt=function(e){d()(n,e);var t=m()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\n\nfloat rand(vec2 co) {\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\n  float diff = (rand(texCoord) - 0.5) * u_Amount;\n  color.r += diff;\n  color.g += diff;\n  color.b += diff;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),n}(ot.Z),gt=function(e){d()(n,e);var t=m()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform float u_Amount : 0.5;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js\nvec4 sepia_filterColor(vec4 color) {\n  float r = color.r;\n  float g = color.g;\n  float b = color.b;\n  color.r =\n    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\n  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\n  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),n}(ot.Z),yt=new Q,_t=0;function bt(){var e=new Ve,t=new se,n=new F,r=new ie(n),i=new M,o=new I,a=new H,s=new W,u=new V,l={id:"".concat(_t++),globalConfigService:yt,shaderModuleService:e,debugService:t,cameraService:n,coordinateSystemService:r,fontService:i,iconService:o,markerService:a,popupService:s,controlService:u,customRenderService:{}},c=new _e(l);l.layerService=c;var h=new Oe(l);l.sceneService=h;var f=new fe(l);l.interactionService=f;var p=new me(l);l.pickingService=p;var d={clear:new Ke,pixelPicking:new $e,render:new et,taa:new it(e)};l.normalPassFactory=function(e){return d[e]};var v={copy:new pt,bloom:new st,blurH:new lt,blurV:new ht,noise:new mt,sepia:new gt,colorHalftone:new ft,hexagonalPixelate:new dt,ink:new vt};return l.postProcessingPass=v,l.postProcessingPassFactory=function(e){return v[e]},l}function xt(e){var t=i()({},e);return t.postProcessor=new Je(t.rendererService),t.multiPassRenderer=new Qe(t.postProcessor),t.styleAttributeService=new Re(t.rendererService),t}},8224:function(){},2942:function(){},2919:function(){},4970:function(e,t,n){"use strict";n.d(t,{l:function(){return r}});var r={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},9974:function(e,t,n){"use strict";n.d(t,{d:function(){return r}});var r=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({})},1315:function(){},9636:function(){},6178:function(){},7497:function(e,t,n){"use strict";n.d(t,{k:function(){return i},l:function(){return r}});var r=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),i={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},9376:function(e,t,n){"use strict";n.d(t,{O:function(){return r}});var r={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"}},2477:function(e,t,n){"use strict";n.d(t,{s:function(){return r}});var r=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({})},780:function(){},7212:function(e,t,n){"use strict";n.d(t,{KD:function(){return a},h0:function(){return r},lE:function(){return o},yn:function(){return i}});var r=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),i=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),o=function(e){return e.AND="and",e.OR="or",e}({}),a=function(e){return e.INIT="init",e.UPDATE="update",e}({})},5146:function(e,t,n){"use strict";n.d(t,{GC:function(){return o},ee:function(){return i},vY:function(){return r}});var r=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e.CUSTOM="threshold",e}({}),i=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),o=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({})},9253:function(e,t,n){"use strict";n.d(t,{I:function(){return r}});var r=["mapload","mapchange","mapAfterFrameChange"]},124:function(){},2549:function(){},7648:function(){},7856:function(){},9439:function(){},4857:function(e,t,n){"use strict";n.d(t,{G:function(){return r}});var r=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({})},8819:function(){},4518:function(){},1567:function(e,t,n){"use strict";n.d(t,{v:function(){return r}});var r=function(e){return e[e.SAMPLED=0]="SAMPLED",e[e.RENDER_TARGET=1]="RENDER_TARGET",e}({})},1780:function(){},609:function(e,t,n){"use strict";n.d(t,{gl:function(){return r}});var r=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({})},8881:function(e,t,n){"use strict";n.d(t,{Z:function(){return g}});var r=n(1448),i=n.n(r),o=n(4528),a=n.n(o),s=n(8798),u=n.n(s),l=n(9057),c=n.n(l),h=n(6490),f=n(4857),p=n(609),d=h.rU.camelCase,v=h.rU.isNil,m=h.rU.upperFirst,g=function(){function e(){a()(this,e),c()(this,"shaderModuleService",void 0),c()(this,"rendererService",void 0),c()(this,"config",void 0),c()(this,"quad","attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}"),c()(this,"enabled",!0),c()(this,"renderToScreen",!1),c()(this,"model",void 0),c()(this,"name",void 0),c()(this,"optionsToUpdate",{})}return u()(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}},{key:"getType",value:function(){return f.G.PostProcessing}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().rendererService,this.shaderModuleService=e.getContainer().shaderModuleService;var n=this.rendererService,r=n.createAttribute,o=n.createBuffer,a=n.createModel,s=this.setupShaders(),u=s.vs,l=s.fs,c=s.uniforms;this.model=a({vs:u,fs:l,attributes:{a_Position:r({buffer:o({data:[-4,-4,4,-4,0,4],type:p.gl.FLOAT}),size:2})},uniforms:i()(i()({u_Texture:null},c),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(e,t){var n=this,r=e.multiPassRenderer.getPostProcessor(),o=this.rendererService,a=o.useFramebuffer,s=o.getViewportSize,u=o.clear,l=s(),c=l.width,h=l.height;a(this.renderToScreen?null:r.getWriteFBO(),(function(){u({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var e=i()({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[c,h]},n.convertOptionsToUniforms(n.optionsToUpdate));t&&(e.u_BloomFinal=1,e.u_Texture2=t),n.model.draw({uniforms:e})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"setRenderToScreen",value:function(e){this.renderToScreen=e}},{key:"updateOptions",value:function(e){this.optionsToUpdate=i()(i()({},this.optionsToUpdate),e)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Object.keys(e).forEach((function(n){v(e[n])||(t["u_".concat(m(d(n)))]=e[n])})),t}}]),e}()},1624:function(e,t,n){"use strict";n.d(t,{P:function(){return r}});var r=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},8104:function(){},6386:function(e,t,n){"use strict";n.d(t,{n:function(){return r}});var r=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({})},5594:function(e,t,n){"use strict";function r(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16}return t}n.d(t,{Vb:function(){return s},y4:function(){return a}});var i=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function o(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};return{content:e=e.replace(i,(function(e,i,o){var a=o.split(":"),s=a[0].trim(),u="";switch(a.length>1&&(u=a[1].trim()),i){case"bool":u="true"===u;break;case"float":case"int":u=Number(u);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":u=u?u.replace("[","").replace("]","").split(",").reduce((function(e,t){return e.push(Number(t.trim())),e}),[]):new Array(r(i)).fill(0)}return n[s]=u,"".concat(t?"uniform ":"").concat(i," ").concat(s,";\n")})),uniforms:n}}function a(e){var t=o(e,!0),n=t.content,r=t.uniforms;return{content:n=n.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,(function(e,t,n){var i=o(n=n.trim().replace(/^.*$/gm,(function(e){return"uniform ".concat(e)}))),a=i.content,s=i.uniforms;return Object.assign(r,s),"".concat(t,"{\n").concat(a,"\n};")})),uniforms:r}}function s(e){var t={};return e.replace(i,(function(e,n,r){var i=r.trim();return t[i]?"":(t[i]=!0,"uniform ".concat(n," ").concat(i,";\n"))}))}},1951:function(e,t,n){"use strict";n.d(t,{wL:function(){return h}});var r=n(3100),i=n.n(r),o=n(6490),a=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function s(e){return a.indexOf(e)}var u=o.rU.clamp,l=131072;function c(e,t){return 256*(e=u(Math.floor(e),0,255))+(t=u(Math.floor(t),0,255))}function h(e){var t=e.color,n=e.radius,r=e.tileX,o=e.tileY,a=e.shape,u=e.opacity,h=e.stroke,f=e.strokeWidth,p=e.strokeOpacity,d=[],v=[],m=[],g=[c(t[0],t[1]),c(t[2],t[3])],y=[c(h[0],h[1]),c(h[2],h[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(e){var t=i()(e,2),c=t[0],h=t[1];d.push([].concat(g,[8388608*(c+1)+2097152*(h+1)+s(a)*l+n,524288*(r+512)+64*(o+512)])),v.push([].concat(y,[f,p])),m.push([u,0,0,0])})),{packedBuffer:d,packedBuffer2:v,packedBuffer3:m}}},8115:function(e,t,n){"use strict";n.d(t,{i:function(){return r}});var r='"2.21.3"'},3301:function(e,t,n){"use strict";n.d(t,{Z:function(){return ki}});var r=n(4479),i=n.n(r),o=n(2760),a=n.n(o),s=n(9558),u=n.n(s),l=n(6970),c=n.n(l),h=n(9989),f=n.n(h),p=n(1448),d=n.n(p),v=n(4528),m=n.n(v),g=n(8798),y=n.n(g),_=n(6626),b=n.n(_),x=n(7267),E=n.n(x),S=n(9913),A=n.n(S),T=n(9057),C=n.n(T),w=n(7204),R=n(3292),M=n(6490),k=n(2490),L=M.rU.cloneDeep,O=function(){function e(){m()(this,e),C()(this,"mapService",void 0),C()(this,"fontService",void 0)}return y()(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService,i=t.mapService,o=t.fontService;this.mapService=i,this.fontService=o,e.hooks.init.tapPromise("DataMappingPlugin",f()(u()().mark((function t(){return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.log(R.IDebugLog.MappingStart,R.ILayerStage.INIT),n.generateMaping(e,{styleAttributeService:r}),e.log(R.IDebugLog.MappingEnd,R.ILayerStage.INIT);case 3:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var t=f()(u()().mark((function t(i){var o;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return",i);case 2:return e.dataState.dataMappingNeedUpdate=!1,e.log(R.IDebugLog.MappingStart,R.ILayerStage.UPDATE),o=n.generateMaping(e,{styleAttributeService:r}),e.log(R.IDebugLog.MappingEnd,R.ILayerStage.UPDATE),t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("DataMappingPlugin",(function(){var t=e.getSource();if(!e.layerModelNeedUpdate&&t&&t.inited){var i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=t.data.dataArray;if(!Array.isArray(a)||0!==a.length){var s=i.filter((function(e){return e.needRemapping})),u=a;if(null!=o&&o.needRemapping&&null!=o&&o.scale&&(u=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),s.length){var l=n.mapping(e,s,u,e.getEncodedData());e.setEncodedData(l)}}}}))}},{key:"generateMaping",value:function(e,t){var n=this,r=t.styleAttributeService,i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=e.getSource().data.dataArray,s=a;null!=o&&o.scale&&(s=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),s=e.processData(s);var u=this.mapping(e,i,s,void 0);return e.setEncodedData(u),e.emit("dataUpdate",null),!0}},{key:"mapping",value:function(e,t,n,r){var i=this,o=t.filter((function(e){return void 0!==e.scale})).filter((function(e){return"filter"!==e.name})),a=n.map((function(e,t){var n=r?r[t]:{},a=d()({id:e._id,coordinates:e.coordinates},n);return o.forEach((function(t){var n=i.applyAttributeMapping(t,e);"color"!==t.name&&"stroke"!==t.name||(n=n.map((function(e){return(0,M.CI)(e)}))),a[t.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===t.name&&(a.shape=i.fontService.getIconFontKey(a[t.name]))})),a}));return t.forEach((function(e){e.needRemapping=!1})),this.adjustData2Amap2Coordinates(a,e),this.adjustData2SimpleCoordinates(a),a}},{key:"adjustData2Amap2Coordinates",value:function(e,t){var n=this;if(e.length>0&&"GAODE2.x"===this.mapService.version){var r=t.coordCenter||t.getSource().center;e.filter((function(e){return!e.originCoordinates})).map((function(e){e.version="GAODE2.x",e.originCoordinates=L(e.coordinates),e.coordinates=n.mapService.coordToAMap2RelativeCoordinates(e.coordinates,r)}))}}},{key:"adjustData2SimpleCoordinates",value:function(e){var t=this;e.length>0&&"SIMPLE"===this.mapService.version&&e.map((function(e){e.simpleCoordinate||(e.coordinates=t.unProjectCoordinates(e.coordinates),e.simpleCoordinate=!0)}))}},{key:"unProjectCoordinates",value:function(e){var t=this;if("number"==typeof e[0])return this.mapService.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),r}},{key:"applyAttributeMapping",value:function(e,t){var n;if(!e.scale)return[];var r=(null==e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(t.hasOwnProperty(o)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[o])})),e.mapping?e.mapping(i):[]}},{key:"getArrowPoints",value:function(e,t){var n=[t[0]-e[0],t[1]-e[1]],r=(0,M.Fv)(n);return[e[0]+1e-4*r[0],e[1]+1e-4*r[1]]}}]),e}(),P=n(8368),I=function(){function e(){m()(this,e),C()(this,"mapService",void 0)}return y()(e,[{key:"apply",value:function(e){var t=this;this.mapService=e.getContainer().mapService,e.hooks.init.tapPromise("DataSourcePlugin",f()(u()().mark((function n(){var r,i,o,a;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.log(R.IDebugLog.SourceInitStart,R.ILayerStage.INIT),(r=e.getSource())||(i=e.sourceOption||e.defaultSourceConfig,o=i.data,a=i.options,r=new P.default(o,a),e.setSource(r)),!r.inited){n.next=8;break}t.updateClusterData(e),e.log(R.IDebugLog.SourceInitEnd,R.ILayerStage.INIT),n.next=10;break;case 8:return n.next=10,new Promise((function(n){r.on("update",(function(r){"inited"===r.type&&(t.updateClusterData(e),e.log(R.IDebugLog.SourceInitEnd,R.ILayerStage.INIT)),n(null)}))}));case 10:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("DataSourcePlugin",f()(u()().mark((function n(){var r,i,o;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.updateClusterData(e),i=e.dataState.dataSourceNeedUpdate,e.dataState.dataSourceNeedUpdate=!1,o=r||i,n.abrupt("return",o);case 5:case"end":return n.stop()}}),n)}))))}},{key:"updateClusterData",value:function(e){if(e.isTileLayer||e.tileLayer||!e.getSource())return!1;var t=e.getSource(),n=t.cluster,r=t.clusterOptions.zoom,i=void 0===r?0:r,o=this.mapService.getZoom()-1,a=e.dataState.dataSourceNeedUpdate;return n&&a&&t.updateClusterData(Math.floor(o)),!!(n&&Math.abs(e.clusterZoom-o)>=1)&&(i!==Math.floor(o)&&t.updateClusterData(Math.floor(o)),e.clusterZoom=o,!0)}}]),e}();function N(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function D(e){var t;return 1===e.length&&(t=e,e=function(e,n){return N(t(e),n)}),{left:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)<0?r=o+1:i=o}return r},right:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)>0?i=o:r=o+1}return r}}}var B=D(N),F=B.right,U=(B.left,F);function z(e,t){var n,r,i,o=e.length,a=-1;if(null==t){for(;++a<o;)if(null!=(n=e[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=e[a])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++a<o;)if(null!=(n=t(e[a],a,e))&&n>=n)for(r=i=n;++a<o;)null!=(n=t(e[a],a,e))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}var G=Array.prototype,j=(G.slice,G.map,Math.sqrt(50)),V=Math.sqrt(10),H=Math.sqrt(2);function W(e,t,n){var r,i,o,a,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(a=Z(e,t,n))||!isFinite(a))return[];if(a>0)for(e=Math.ceil(e/a),t=Math.floor(t/a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(e+s)*a;else for(e=Math.floor(e*a),t=Math.ceil(t*a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(e-s)/a;return r&&o.reverse(),o}function Z(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=j?10:o>=V?5:o>=H?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=j?10:o>=V?5:o>=H?2:1)}function X(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=j?i*=10:o>=V?i*=5:o>=H&&(i*=2),t<e?-i:i}function Y(e){return null===e?NaN:+e}function q(e,t,n){if(null==n&&(n=Y),r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,o=Math.floor(i),a=+n(e[o],o,e);return a+(+n(e[o+1],o+1,e)-a)*(i-o)}}var K=n(3905);function Q(e,t,n,r,i){var o=e*e,a=o*e;return((1-3*e+3*o-a)*t+(4-6*o+3*a)*n+(1+3*e+3*o-3*a)*r+a*i)/6}function $(e){return function(){return e}}function J(e,t){return function(n){return e+n*t}}function ee(e){return 1==(e=+e)?te:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):$(isNaN(t)?n:t)}}function te(e,t){var n=t-e;return n?J(e,n):$(isNaN(e)?t:e)}var ne=function e(t){var n=ee(t);function r(e,t){var r=n((e=(0,K.B8)(e)).r,(t=(0,K.B8)(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),a=te(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);function re(e){return function(t){var n,r,i=t.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=(0,K.B8)(t[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=e(o),a=e(a),s=e(s),r.opacity=1,function(e){return r.r=o(e),r.g=a(e),r.b=s(e),r+""}}}var ie=re((function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],o=e[r+1],a=r>0?e[r-1]:2*i-o,s=r<t-1?e[r+2]:2*o-i;return Q((n-r/t)*t,a,i,o,s)}})),oe=(re((function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],o=e[r%t],a=e[(r+1)%t],s=e[(r+2)%t];return Q((n-r/t)*t,i,o,a,s)}})),"$");function ae(){}function se(e,t){var n=new ae;if(e instanceof ae)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var r,i=-1,o=e.length;if(null==t)for(;++i<o;)n.set(i,e[i]);else for(;++i<o;)n.set(t(r=e[i],i,e),r)}else if(e)for(var a in e)n.set(a,e[a]);return n}ae.prototype=se.prototype={constructor:ae,has:function(e){return oe+e in this},get:function(e){return this[oe+e]},set:function(e,t){return this[oe+e]=t,this},remove:function(e){var t=oe+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===oe&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===oe&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===oe&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===oe&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===oe&&++e;return e},empty:function(){for(var e in this)if(e[0]===oe)return!1;return!0},each:function(e){for(var t in this)t[0]===oe&&e(this[t],t.slice(1),this)}};var ue=se;function le(){}var ce=ue.prototype;function he(e,t){var n=new le;if(e instanceof le)e.each((function(e){n.add(e)}));else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}le.prototype=he.prototype={constructor:le,has:ce.has,add:function(e){return this[oe+(e+="")]=e,this},remove:ce.remove,clear:ce.clear,values:ce.keys,size:ce.size,empty:ce.empty,each:ce.each};var fe=Array.prototype,pe=fe.map,de=fe.slice;function ve(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function me(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e)}return this}var ge={name:"implicit"};function ye(){var e=ue(),t=[],n=[],r=ge;function i(i){var o=i+"",a=e.get(o);if(!a){if(r!==ge)return r;e.set(o,a=t.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=ue();for(var r,o,a=-1,s=n.length;++a<s;)e.has(o=(r=n[a])+"")||e.set(o,t.push(r));return i},i.range=function(e){return arguments.length?(n=de.call(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return ye(t,n).unknown(r)},ve.apply(i,arguments),i}var _e=n(5570),be=n.n(_e);function xe(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=Me(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<i;++n)a[n]=o[n](e);return a}}function Ee(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Se(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Ae(e,t){var n,r={},i={};for(n in null!==e&&"object"===be()(e)||(e={}),null!==t&&"object"===be()(t)||(t={}),t)n in e?r[n]=Me(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var Te=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ce=new RegExp(Te.source,"g");function we(e,t){var n,r,i,o=Te.lastIndex=Ce.lastIndex=0,a=-1,s=[],u=[];for(e+="",t+="";(n=Te.exec(e))&&(r=Ce.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:Se(n,r)})),o=Ce.lastIndex;return o<t.length&&(i=t.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function Re(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function Me(e,t){var n,r,i=be()(t);return null==t||"boolean"===i?$(t):("number"===i?Se:"string"===i?(n=(0,K.ZP)(t))?(t=n,ne):we:t instanceof K.ZP?ne:t instanceof Date?Ee:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?xe:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Ae:Se:Re))(e,t)}function ke(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Le(e){return+e}var Oe=[0,1];function Pe(e){return e}function Ie(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function Ne(e){var t,n=e[0],r=e[e.length-1];return n>r&&(t=n,n=r,r=t),function(e){return Math.max(n,Math.min(r,e))}}function De(e,t,n){var r=e[0],i=e[1],o=t[0],a=t[1];return i<r?(r=Ie(i,r),o=n(a,o)):(r=Ie(r,i),o=n(o,a)),function(e){return o(r(e))}}function Be(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)i[a]=Ie(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(t){var n=U(e,t,1,r)-1;return o[n](i[n](t))}}function Fe(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Ue(){var e,t,n,r,i,o,a=Oe,s=Oe,u=Me,l=Pe;function c(){return r=Math.min(a.length,s.length)>2?Be:De,i=o=null,h}function h(t){return isNaN(t=+t)?n:(i||(i=r(a.map(e),s,u)))(e(l(t)))}return h.invert=function(n){return l(t((o||(o=r(s,a.map(e),Se)))(n)))},h.domain=function(e){return arguments.length?(a=pe.call(e,Le),l===Pe||(l=Ne(a)),c()):a.slice()},h.range=function(e){return arguments.length?(s=de.call(e),c()):s.slice()},h.rangeRound=function(e){return s=de.call(e),u=ke,c()},h.clamp=function(e){return arguments.length?(l=e?Ne(a):Pe,h):l!==Pe},h.interpolate=function(e){return arguments.length?(u=e,c()):u},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,r){return e=n,t=r,c()}}function ze(e,t){return Ue()(e,t)}var Ge,je=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ve(e){if(!(t=je.exec(e)))throw new Error("invalid format: "+e);var t;return new He({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function He(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function We(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Ze(e){return(e=We(Math.abs(e)))?e[1]:NaN}function Xe(e,t){var n=We(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Ve.prototype=He.prototype,He.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Ye={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Xe(100*e,t)},r:Xe,s:function(e,t){var n=We(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(Ge=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+We(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function qe(e){return e}var Ke,Qe,$e,Je=Array.prototype.map,et=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function tt(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?qe:(t=Je.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],a=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[a=(a+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?qe:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Je.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"-":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=Ve(e)).fill,n=e.align,h=e.sign,f=e.symbol,p=e.zero,d=e.width,v=e.comma,m=e.precision,g=e.trim,y=e.type;"n"===y?(v=!0,y="g"):Ye[y]||(void 0===m&&(m=12),g=!0,y="g"),(p||"0"===t&&"="===n)&&(p=!0,t="0",n="=");var _="$"===f?i:"#"===f&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",b="$"===f?o:/[%p]/.test(y)?u:"",x=Ye[y],E=/[defgprs%]/.test(y);function S(e){var i,o,u,f=_,S=b;if("c"===y)S=x(e)+S,e="";else{var A=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:x(Math.abs(e),m),g&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),A&&0==+e&&"+"!==h&&(A=!1),f=(A?"("===h?h:l:"-"===h||"("===h?"":h)+f,S=("s"===y?et[8+Ge/3]:"")+S+(A&&"("===h?")":""),E)for(i=-1,o=e.length;++i<o;)if(48>(u=e.charCodeAt(i))||u>57){S=(46===u?a+e.slice(i+1):e.slice(i))+S,e=e.slice(0,i);break}}v&&!p&&(e=r(e,1/0));var T=f.length+e.length+S.length,C=T<d?new Array(d-T+1).join(t):"";switch(v&&p&&(e=r(C+e,C.length?d-S.length:1/0),C=""),n){case"<":e=f+e+S+C;break;case"=":e=f+C+e+S;break;case"^":e=C.slice(0,T=C.length>>1)+f+e+S+C.slice(T);break;default:e=C+f+e+S}return s(e)}return m=void 0===m?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),S.toString=function(){return e+""},S}return{format:h,formatPrefix:function(e,t){var n=h(((e=Ve(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(Ze(t)/3))),i=Math.pow(10,-r),o=et[8+r/3];return function(e){return n(i*e)+o}}}}function nt(e,t,n,r){var i,o=X(e,t,n);switch((r=Ve(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Ze(t)/3)))-Ze(Math.abs(e)))}(o,a))||(r.precision=i),$e(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Ze(t)-Ze(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-Ze(Math.abs(e)))}(o))||(r.precision=i-2*("%"===r.type))}return Qe(r)}function rt(e){var t=e.domain;return e.ticks=function(e){var n=t();return W(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return nt(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i=t(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),(r=Z(s,u,n))>0?r=Z(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=Z(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,t(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,t(i)),e},e}function it(e,t){var n,r=0,i=(e=e.slice()).length-1,o=e[r],a=e[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),e[r]=t.floor(o),e[i]=t.ceil(a),e}function ot(e){return Math.log(e)}function at(e){return Math.exp(e)}function st(e){return-Math.log(-e)}function ut(e){return-Math.exp(-e)}function lt(e){return isFinite(e)?+("1e"+e):e<0?0:e}function ct(e){return function(t){return-e(-t)}}function ht(e){var t,n,r=e(ot,at),i=r.domain,o=10;function a(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(o),n=function(e){return 10===e?lt:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(o),i()[0]<0?(t=ct(t),n=ct(n),e(st,ut)):e(ot,at),r}return r.base=function(e){return arguments.length?(o=+e,a()):o},r.domain=function(e){return arguments.length?(i(e),a()):i()},r.ticks=function(e){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(f=s,s=u,u=f);var l,c,h,f=t(s),p=t(u),d=null==e?10:+e,v=[];if(!(o%1)&&p-f<d){if(f=Math.round(f)-1,p=Math.round(p)+1,s>0){for(;f<p;++f)for(c=1,l=n(f);c<o;++c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else for(;f<p;++f)for(c=o-1,l=n(f);c>=1;--c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else v=W(f,p,Math.min(p-f,d)).map(n);return r?v.reverse():v},r.tickFormat=function(e,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=Qe(i)),e===1/0)return i;null==e&&(e=10);var a=Math.max(1,o*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*o<o-.5&&(r*=o),r<=a?i(e):""}},r.nice=function(){return i(it(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function ft(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function pt(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function dt(e){return e<0?-e*e:e*e}function vt(e){var t=e(Pe,Pe),n=1;function r(){return 1===n?e(Pe,Pe):.5===n?e(pt,dt):e(ft(n),ft(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},rt(t)}function mt(){var e=vt(Ue());return e.copy=function(){return Fe(e,mt()).exponent(e.exponent())},ve.apply(e,arguments),e}Ke=tt({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),Qe=Ke.format,$e=Ke.formatPrefix;var gt=new Date,yt=new Date;function _t(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),t(n,o),e(n)}while(a<n&&n<r);return s},i.filter=function(n){return _t((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return gt.setTime(+t),yt.setTime(+r),e(gt),e(yt),Math.floor(n(gt,yt))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var bt=_t((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));bt.every=function(e){return isFinite(e=Math.floor(e))&&e>0?_t((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var xt=bt,Et=(bt.range,_t((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),St=Et,At=(Et.range,1e3),Tt=6e4,Ct=36e5,wt=864e5,Rt=6048e5;function Mt(e){return _t((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Tt)/Rt}))}var kt=Mt(0),Lt=Mt(1),Ot=Mt(2),Pt=Mt(3),It=Mt(4),Nt=Mt(5),Dt=Mt(6),Bt=(kt.range,Lt.range,Ot.range,Pt.range,It.range,Nt.range,Dt.range,_t((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Tt)/wt}),(function(e){return e.getDate()-1}))),Ft=Bt,Ut=(Bt.range,_t((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*At-e.getMinutes()*Tt)}),(function(e,t){e.setTime(+e+t*Ct)}),(function(e,t){return(t-e)/Ct}),(function(e){return e.getHours()}))),zt=Ut,Gt=(Ut.range,_t((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*At)}),(function(e,t){e.setTime(+e+t*Tt)}),(function(e,t){return(t-e)/Tt}),(function(e){return e.getMinutes()}))),jt=Gt,Vt=(Gt.range,_t((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*At)}),(function(e,t){return(t-e)/At}),(function(e){return e.getUTCSeconds()}))),Ht=Vt,Wt=(Vt.range,_t((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e})));Wt.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?_t((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):Wt:null};var Zt=Wt;Wt.range;function Xt(e){return _t((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/Rt}))}var Yt=Xt(0),qt=Xt(1),Kt=Xt(2),Qt=Xt(3),$t=Xt(4),Jt=Xt(5),en=Xt(6),tn=(Yt.range,qt.range,Kt.range,Qt.range,$t.range,Jt.range,en.range,_t((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/wt}),(function(e){return e.getUTCDate()-1}))),nn=tn,rn=(tn.range,_t((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})));rn.every=function(e){return isFinite(e=Math.floor(e))&&e>0?_t((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var on=rn;rn.range;function an(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function sn(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function un(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var ln,cn,hn={"-":"",_:" ",0:"0"},fn=/^\s*\d+/,pn=/^%/,dn=/[\\^$*+?|[\]().{}]/g;function vn(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(t)+i:i)}function mn(e){return e.replace(dn,"\\$&")}function gn(e){return new RegExp("^(?:"+e.map(mn).join("|")+")","i")}function yn(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function _n(e,t,n){var r=fn.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function bn(e,t,n){var r=fn.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function xn(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function En(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function Sn(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function An(e,t,n){var r=fn.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function Tn(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Cn(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function wn(e,t,n){var r=fn.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function Rn(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Mn(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function kn(e,t,n){var r=fn.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function Ln(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function On(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function Pn(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function In(e,t,n){var r=fn.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Nn(e,t,n){var r=fn.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Dn(e,t,n){var r=pn.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Bn(e,t,n){var r=fn.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Fn(e,t,n){var r=fn.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function Un(e,t){return vn(e.getDate(),t,2)}function zn(e,t){return vn(e.getHours(),t,2)}function Gn(e,t){return vn(e.getHours()%12||12,t,2)}function jn(e,t){return vn(1+Ft.count(xt(e),e),t,3)}function Vn(e,t){return vn(e.getMilliseconds(),t,3)}function Hn(e,t){return Vn(e,t)+"000"}function Wn(e,t){return vn(e.getMonth()+1,t,2)}function Zn(e,t){return vn(e.getMinutes(),t,2)}function Xn(e,t){return vn(e.getSeconds(),t,2)}function Yn(e){var t=e.getDay();return 0===t?7:t}function qn(e,t){return vn(kt.count(xt(e)-1,e),t,2)}function Kn(e){var t=e.getDay();return t>=4||0===t?It(e):It.ceil(e)}function Qn(e,t){return e=Kn(e),vn(It.count(xt(e),e)+(4===xt(e).getDay()),t,2)}function $n(e){return e.getDay()}function Jn(e,t){return vn(Lt.count(xt(e)-1,e),t,2)}function er(e,t){return vn(e.getFullYear()%100,t,2)}function tr(e,t){return vn((e=Kn(e)).getFullYear()%100,t,2)}function nr(e,t){return vn(e.getFullYear()%1e4,t,4)}function rr(e,t){var n=e.getDay();return vn((e=n>=4||0===n?It(e):It.ceil(e)).getFullYear()%1e4,t,4)}function ir(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+vn(t/60|0,"0",2)+vn(t%60,"0",2)}function or(e,t){return vn(e.getUTCDate(),t,2)}function ar(e,t){return vn(e.getUTCHours(),t,2)}function sr(e,t){return vn(e.getUTCHours()%12||12,t,2)}function ur(e,t){return vn(1+nn.count(on(e),e),t,3)}function lr(e,t){return vn(e.getUTCMilliseconds(),t,3)}function cr(e,t){return lr(e,t)+"000"}function hr(e,t){return vn(e.getUTCMonth()+1,t,2)}function fr(e,t){return vn(e.getUTCMinutes(),t,2)}function pr(e,t){return vn(e.getUTCSeconds(),t,2)}function dr(e){var t=e.getUTCDay();return 0===t?7:t}function vr(e,t){return vn(Yt.count(on(e)-1,e),t,2)}function mr(e){var t=e.getUTCDay();return t>=4||0===t?$t(e):$t.ceil(e)}function gr(e,t){return e=mr(e),vn($t.count(on(e),e)+(4===on(e).getUTCDay()),t,2)}function yr(e){return e.getUTCDay()}function _r(e,t){return vn(qt.count(on(e)-1,e),t,2)}function br(e,t){return vn(e.getUTCFullYear()%100,t,2)}function xr(e,t){return vn((e=mr(e)).getUTCFullYear()%100,t,2)}function Er(e,t){return vn(e.getUTCFullYear()%1e4,t,4)}function Sr(e,t){var n=e.getUTCDay();return vn((e=n>=4||0===n?$t(e):$t.ceil(e)).getUTCFullYear()%1e4,t,4)}function Ar(){return"+0000"}function Tr(){return"%"}function Cr(e){return+e}function wr(e){return Math.floor(+e/1e3)}!function(e){ln=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,o=e.days,a=e.shortDays,s=e.months,u=e.shortMonths,l=gn(i),c=yn(i),h=gn(o),f=yn(o),p=gn(a),d=yn(a),v=gn(s),m=yn(s),g=gn(u),y=yn(u),_={a:function(e){return a[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:Un,e:Un,f:Hn,g:tr,G:rr,H:zn,I:Gn,j:jn,L:Vn,m:Wn,M:Zn,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:Cr,s:wr,S:Xn,u:Yn,U:qn,V:Qn,w:$n,W:Jn,x:null,X:null,y:er,Y:nr,Z:ir,"%":Tr},b={a:function(e){return a[e.getUTCDay()]},A:function(e){return o[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:or,e:or,f:cr,g:xr,G:Sr,H:ar,I:sr,j:ur,L:lr,m:hr,M:fr,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:Cr,s:wr,S:pr,u:dr,U:vr,V:gr,w:yr,W:_r,x:null,X:null,y:br,Y:Er,Z:Ar,"%":Tr},x={a:function(e,t,n){var r=p.exec(t.slice(n));return r?(e.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=f[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=g.exec(t.slice(n));return r?(e.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=m[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,n,r){return A(e,t,n,r)},d:Mn,e:Mn,f:Nn,g:Tn,G:An,H:Ln,I:Ln,j:kn,L:In,m:Rn,M:On,p:function(e,t,n){var r=l.exec(t.slice(n));return r?(e.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:wn,Q:Bn,s:Fn,S:Pn,u:bn,U:xn,V:En,w:_n,W:Sn,x:function(e,t,r){return A(e,n,t,r)},X:function(e,t,n){return A(e,r,t,n)},y:Tn,Y:An,Z:Cn,"%":Dn};function E(e,t){return function(n){var r,i,o,a=[],s=-1,u=0,l=e.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===e.charCodeAt(s)&&(a.push(e.slice(u,s)),null!=(i=hn[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(o=t[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(e.slice(u,s)),a.join("")}}function S(e,t){return function(n){var r,i,o=un(1900,void 0,1);if(A(o,e,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(t&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=sn(un(o.y,0,1))).getUTCDay(),r=i>4||0===i?qt.ceil(r):qt(r),r=nn.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=an(un(o.y,0,1))).getDay(),r=i>4||0===i?Lt.ceil(r):Lt(r),r=Ft.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?sn(un(o.y,0,1)).getUTCDay():an(un(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,sn(o)):an(o)}}function A(e,t,n,r){for(var i,o,a=0,s=t.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(a++))){if(i=t.charAt(a++),!(o=x[i in hn?t.charAt(a++):i])||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=E(n,_),_.X=E(r,_),_.c=E(t,_),b.x=E(n,b),b.X=E(r,b),b.c=E(t,b),{format:function(e){var t=E(e+="",_);return t.toString=function(){return e},t},parse:function(e){var t=S(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=E(e+="",b);return t.toString=function(){return e},t},utcParse:function(e){var t=S(e+="",!0);return t.toString=function(){return e},t}}}(e),cn=ln.format,ln.parse,ln.utcFormat,ln.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var Rr,Mr=1e3,kr=6e4,Lr=36e5,Or=864e5,Pr=2592e6,Ir=31536e6;function Nr(e){return new Date(e)}function Dr(e){return e instanceof Date?+e:+new Date(+e)}function Br(e,t,n,r,i,o,a,s,u){var l=ze(Pe,Pe),c=l.invert,h=l.domain,f=u(".%L"),p=u(":%S"),d=u("%I:%M"),v=u("%I %p"),m=u("%a %d"),g=u("%b %d"),y=u("%B"),_=u("%Y"),b=[[a,1,Mr],[a,5,5e3],[a,15,15e3],[a,30,3e4],[o,1,kr],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,Lr],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,Or],[r,2,1728e5],[n,1,6048e5],[t,1,Pr],[t,3,7776e6],[e,1,Ir]];function x(s){return(a(s)<s?f:o(s)<s?p:i(s)<s?d:r(s)<s?v:t(s)<s?n(s)<s?m:g:e(s)<s?y:_)(s)}function E(t,n,r,i){if(null==t&&(t=10),"number"==typeof t){var o=Math.abs(r-n)/t,a=D((function(e){return e[2]})).right(b,o);a===b.length?(i=X(n/Ir,r/Ir,t),t=e):a?(i=(a=b[o/b[a-1][2]<b[a][2]/o?a-1:a])[1],t=a[0]):(i=Math.max(X(n,r,t),1),t=s)}return null==i?t:t.every(i)}return l.invert=function(e){return new Date(c(e))},l.domain=function(e){return arguments.length?h(pe.call(e,Dr)):h().map(Nr)},l.ticks=function(e,t){var n,r=h(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=E(e,i,o,t))?n.range(i,o+1):[],a?n.reverse():n},l.tickFormat=function(e,t){return null==t?x:u(t)},l.nice=function(e,t){var n=h();return(e=E(e,n[0],n[n.length-1],t))?h(it(n,e)):l},l.copy=function(){return Fe(l,Br(e,t,n,r,i,o,a,s,u))},l}function Fr(){var e,t,n,r,i,o=0,a=1,s=Pe,u=!1;function l(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,u?Math.max(0,Math.min(1,t)):t))}return l.domain=function(i){return arguments.length?(e=r(o=+i[0]),t=r(a=+i[1]),n=e===t?0:1/(t-e),l):[o,a]},l.clamp=function(e){return arguments.length?(u=!!e,l):u},l.interpolator=function(e){return arguments.length?(s=e,l):s},l.unknown=function(e){return arguments.length?(i=e,l):i},function(i){return r=i,e=i(o),t=i(a),n=e===t?0:1/(t-e),l}}function Ur(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function zr(){var e,t,n,r,i,o,a,s=0,u=.5,l=1,c=Pe,h=!1;function f(e){return isNaN(e=+e)?a:(e=.5+((e=+o(e))-t)*(e<t?r:i),c(h?Math.max(0,Math.min(1,e)):e))}return f.domain=function(a){return arguments.length?(e=o(s=+a[0]),t=o(u=+a[1]),n=o(l=+a[2]),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),f):[s,u,l]},f.clamp=function(e){return arguments.length?(h=!!e,f):h},f.interpolator=function(e){return arguments.length?(c=e,f):c},f.unknown=function(e){return arguments.length?(a=e,f):a},function(a){return o=a,e=a(s),t=a(u),n=a(l),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),f}}var Gr=M.rU.isNil,jr=M.rU.isString,Vr=M.rU.uniq,Hr=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Wr=(Rr={},C()(C()(C()(C()(C()(C()(C()(C()(C()(C()(Rr,R.ScaleTypes.LINEAR,(function e(){var t=ze(Pe,Pe);return t.copy=function(){return Fe(t,e())},ve.apply(t,arguments),rt(t)})),R.ScaleTypes.POWER,mt),R.ScaleTypes.LOG,(function e(){var t=ht(Ue()).domain([1,10]);return t.copy=function(){return Fe(t,e()).base(t.base())},ve.apply(t,arguments),t})),R.ScaleTypes.IDENTITY,(function e(t){var n,r=[];function i(e){return null==e?n:e}return i.invert=i,i.domain=i.range=function(e){return e?(r=e,e):r},i.unknown=function(e){return e?(n=e,e):n},i.copy=function(){return e(t).unknown(n)},i})),R.ScaleTypes.SEQUENTIAL,(function e(){var t=rt(Fr()(Pe));return t.copy=function(){return Ur(t,e())},me.apply(t,arguments)})),R.ScaleTypes.TIME,(function(){return ve.apply(Br(xt,St,kt,Ft,zt,jt,Ht,Zt,cn).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),R.ScaleTypes.QUANTILE,(function e(){var t,n=[],r=[],i=[];function o(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=q(n,e/t);return a}function a(e){return isNaN(e=+e)?t:r[U(i,e)]}return a.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},a.domain=function(e){if(!arguments.length)return n.slice();n=[];for(var t,r=0,i=e.length;r<i;++r)null==(t=e[r])||isNaN(t=+t)||n.push(t);return n.sort(N),o()},a.range=function(e){return arguments.length?(r=de.call(e),o()):r.slice()},a.unknown=function(e){return arguments.length?(t=e,a):t},a.quantiles=function(){return i.slice()},a.copy=function(){return e().domain(n).range(r).unknown(t)},ve.apply(a,arguments)})),R.ScaleTypes.QUANTIZE,(function e(){var t,n=0,r=1,i=1,o=[.5],a=[0,1];function s(e){return e<=e?a[U(o,e,0,i)]:t}function u(){var e=-1;for(o=new Array(i);++e<i;)o[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?(n=+e[0],r=+e[1],u()):[n,r]},s.range=function(e){return arguments.length?(i=(a=de.call(e)).length-1,u()):a.slice()},s.invertExtent=function(e){var t=a.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,o[0]]:t>=i?[o[i-1],r]:[o[t-1],o[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return e().domain([n,r]).range(a).unknown(t)},ve.apply(rt(s),arguments)})),R.ScaleTypes.THRESHOLD,(function e(){var t,n=[.5],r=[0,1],i=1;function o(e){return e<=e?r[U(n,e,0,i)]:t}return o.domain=function(e){return arguments.length?(n=de.call(e),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(e){return arguments.length?(r=de.call(e),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},o.unknown=function(e){return arguments.length?(t=e,o):t},o.copy=function(){return e().domain(n).range(r).unknown(t)},ve.apply(o,arguments)})),R.ScaleTypes.CAT,ye),C()(Rr,R.ScaleTypes.DIVERGING,(function e(){var t=rt(zr()(Pe));return t.copy=function(){return Ur(t,e())},me.apply(t,arguments)}))),Zr=function(){function e(){m()(this,e),C()(this,"scaleOptions",{})}return y()(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("FeatureScalePlugin",f()(u()().mark((function t(){var i,o,a;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.log(R.IDebugLog.ScaleInitStart,R.ILayerStage.INIT),n.scaleOptions=e.getScaleOptions(),o=r.getLayerStyleAttributes(),a=null===(i=e.getSource())||void 0===i?void 0:i.data.dataArray,!Array.isArray(a)||0!==a.length){t.next=8;break}return t.abrupt("return");case 8:n.caculateScalesForAttributes(o||[],a);case 9:e.log(R.IDebugLog.ScaleInitEnd,R.ILayerStage.INIT);case 10:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var t=f()(u()().mark((function t(i){var o,a;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return",i);case 2:if(e.log(R.IDebugLog.ScaleInitStart,R.ILayerStage.UPDATE),n.scaleOptions=e.getScaleOptions(),o=r.getLayerStyleAttributes(),a=e.getSource().data.dataArray,!Array.isArray(a)||0!==a.length){t.next=8;break}return t.abrupt("return",!0);case 8:return n.caculateScalesForAttributes(o||[],a),e.log(R.IDebugLog.ScaleInitEnd,R.ILayerStage.UPDATE),e.layerModelNeedUpdate=!0,t.abrupt("return",!0);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!e.layerModelNeedUpdate){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes(),i=e.getSource().data.dataArray;if((!Array.isArray(i)||0!==i.length)&&t){var o=t.filter((function(e){return e.needRescale}));o.length&&n.caculateScalesForAttributes(o,i)}}}))}},{key:"isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},{key:"caculateScalesForAttributes",value:function(e,t){var n=this;e.forEach((function(e){if(e.scale){var r=e.scale,i=e.scale.field;r.names=n.parseFields(Gr(i)?[]:i);var o=[];r.names.forEach((function(r){var i;o.push(n.createScale(r,e.name,null===(i=e.scale)||void 0===i?void 0:i.values,t))})),o.some((function(e){return e.type===R.StyleScaleType.VARIABLE}))?(r.type=R.StyleScaleType.VARIABLE,o.forEach((function(e){var t,n;if(!r.callback&&"text"!==r.values)switch(null===(t=e.option)||void 0===t?void 0:t.type){case R.ScaleTypes.LOG:case R.ScaleTypes.LINEAR:case R.ScaleTypes.POWER:if(r.values&&r.values.length>2){var i=e.scale.ticks(r.values.length);e.scale.domain(i)}r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case R.ScaleTypes.QUANTILE:case R.ScaleTypes.QUANTIZE:case R.ScaleTypes.THRESHOLD:e.scale.range(r.values);break;case R.ScaleTypes.IDENTITY:break;case R.ScaleTypes.CAT:r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case R.ScaleTypes.DIVERGING:case R.ScaleTypes.SEQUENTIAL:e.scale.interpolator(ie(r.values))}"text"===r.values&&e.scale.range(null===(n=e.option)||void 0===n?void 0:n.domain)}))):(r.type=R.StyleScaleType.CONSTANT,r.defaultValues=o.map((function(e,t){return e.scale(r.names[t])}))),r.scalers=o.map((function(e){return{field:e.field,func:e.scale,option:e.option}})),e.needRescale=!1}}))}},{key:"parseFields",value:function(e){return Array.isArray(e)?e:jr(e)?e.split("*"):[e]}},{key:"createScale",value:function(e,t,n,r){var i,o,a=this.scaleOptions[t]&&(null===(i=this.scaleOptions[t])||void 0===i?void 0:i.field)===e?this.scaleOptions[t]:this.scaleOptions[e],s={field:e,scale:void 0,type:R.StyleScaleType.VARIABLE,option:a};if(!r||!r.length)return a&&a.type?s.scale=this.createDefaultScale(a):(s.scale=ye([e]),s.type=R.StyleScaleType.CONSTANT),s;var u=null===(o=r.find((function(t){return!Gr(t[e])})))||void 0===o?void 0:o[e];if(this.isNumber(e)||Gr(u)&&!a)s.scale=ye([e]),s.type=R.StyleScaleType.CONSTANT;else{var l=a&&a.type||this.getDefaultType(u);"text"===n&&(l=R.ScaleTypes.CAT),void 0===n&&(l=R.ScaleTypes.IDENTITY);var c=this.createScaleConfig(l,e,a,r);s.scale=this.createDefaultScale(c),s.option=c}return s}},{key:"getDefaultType",value:function(e){var t=R.ScaleTypes.LINEAR;return"string"==typeof e&&(t=Hr.test(e)?R.ScaleTypes.TIME:R.ScaleTypes.CAT),t}},{key:"createScaleConfig",value:function(e,t,n,r){var i={type:e},o=[];if(e===R.ScaleTypes.QUANTILE){var a=new Map;null==r||r.forEach((function(e){a.set(e._id,e[t])})),o=Array.from(a.values())}else o=(null==r?void 0:r.map((function(e){return e[t]})))||[];if(null!=n&&n.domain)i.domain=null==n?void 0:n.domain;else if(e===R.ScaleTypes.CAT||e===R.ScaleTypes.IDENTITY)i.domain=Vr(o);else if(e===R.ScaleTypes.QUANTILE)i.domain=o;else if(e===R.ScaleTypes.DIVERGING){var s=z(o),u=void 0!==(null==n?void 0:n.neutral)?null==n?void 0:n.neutral:(s[0]+s[1])/2;i.domain=[s[0],u,s[1]]}else i.domain=z(o);return d()(d()({},i),n)}},{key:"createDefaultScale",value:function(e){var t=e.type,n=e.domain,r=e.unknown,i=e.clamp,o=e.nice,a=Wr[t]();return n&&a.domain&&a.domain(n),r&&a.unknown(r),void 0!==i&&a.clamp&&a.clamp(i),void 0!==o&&a.nice&&a.nice(o),a}}]),e}(),Xr=function(){function e(){m()(this,e)}return y()(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){e.animateStatus&&e.models.forEach((function(t){t.addUniforms(d()({},e.layerModel.getAnimateUniforms()))}))}))}}]),e}(),Yr=function(){function e(){m()(this,e)}return y()(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerMaskPlugin",(function(){var t=e.getLayerConfig(),n=t.maskLayers,r=t.enableMask;!e.tileLayer&&n&&n.length>0&&e.updateLayerConfig({mask:r})}))}}]),e}(),qr=function(){function e(){m()(this,e)}var t,n,r;return y()(e,[{key:"build",value:(r=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.prepareBuildModel(),e.next=3,t.buildModels();case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"initLayerModel",value:(n=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"prepareLayerModel",value:(t=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"apply",value:function(e){var t=this;e.hooks.init.tapPromise("LayerModelPlugin",f()(u()().mark((function n(){return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.getSource().isTile){n.next=3;break}return e.prepareBuildModel(),n.abrupt("return");case 3:return e.log(R.IDebugLog.BuildModelStart,R.ILayerStage.INIT),n.next=6,t.initLayerModel(e);case 6:e.log(R.IDebugLog.BuildModelEnd,R.ILayerStage.INIT);case 7:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var n=f()(u()().mark((function n(r){return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r){n.next=2;break}return n.abrupt("return",!1);case 2:if(!e.getSource().isTile){n.next=4;break}return n.abrupt("return",!1);case 4:return e.log(R.IDebugLog.BuildModelStart,R.ILayerStage.UPDATE),n.next=7,t.prepareLayerModel(e);case 7:return e.log(R.IDebugLog.BuildModelEnd,R.ILayerStage.UPDATE),n.abrupt("return",!0);case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}}]),e}(),Kr=function(){function e(){m()(this,e)}return y()(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerStylePlugin",(function(){var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&e.fitBounds(r),e.styleNeedUpdate=!1}))}}]),e}(),Qr=["type"],$r={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Jr={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},ei={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},ti={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};var ni=function(){function e(){m()(this,e)}return y()(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LightingPlugin",(function(){e.getLayerConfig().enableLighting&&e.models.forEach((function(e){return e.addUniforms(d()({},(n={u_DirectionalLights:new Array(3).fill(d()({},ei)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(d()({},ti)),u_NumOfSpotLights:0},t&&t.length||(t=[Jr]),t.forEach((function(e){var t=e.type,r=void 0===t?"directional":t,i=a()(e,Qr),o=$r[r].lights,s=$r[r].num,u=n[s];n[o][u]=d()(d()({},n[o][u]),i),n[s]++})),n)));var t,n}))}))}}]),e}(),ri=n(3100),ii=n.n(ri);function oi(e){return e.map((function(e){return"string"==typeof e&&(e=[e,{}]),e}))}function ai(e,t,n,r){var i=e.multiPassRenderer;return e.getLayerConfig().enableTAA?i.add(r("taa")):i.add(r("render")),oi(t).forEach((function(e){var t=ii()(e,2),r=t[0],o=t[1];i.add(n(r),o)})),i.add(n("copy")),i}var si=function(){function e(){m()(this,e),C()(this,"enabled",void 0)}return y()(e,[{key:"apply",value:function(e,t){var n=this,r=t.rendererService,i=t.postProcessingPassFactory,o=t.normalPassFactory;e.hooks.init.tapPromise("MultiPassRendererPlugin",(function(){var t=e.getLayerConfig(),r=t.enableMultiPassRenderer,a=t.passes,s=void 0===a?[]:a;n.enabled=!!r&&!1!==e.getLayerConfig().enableMultiPassRenderer,n.enabled&&(e.multiPassRenderer=ai(e,s,i,o),e.multiPassRenderer.setRenderFlag(!0))})),e.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){if(n.enabled){var t=r.getViewportSize(),i=t.width,o=t.height;e.multiPassRenderer.resize(i,o)}}))}}]),e}(),ui=n(4889),li=M.rU.isNumber,ci=1,hi=2,fi=function(){function e(){m()(this,e),C()(this,"pickingUniformMap",void 0)}return y()(e,[{key:"pickOption2Array",value:function(){var e=[];return this.pickingUniformMap.forEach((function(t){li(t)?e.push(t):e.push.apply(e,i()(t))})),e}},{key:"updatePickOption",value:function(e,t){var n=this;Object.keys(e).forEach((function(t){n.pickingUniformMap.set(t,e[t])}));var r=t.getLayerConfig().pickingBuffer||0,i=Number(t.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",r),this.pickingUniformMap.set("u_shaderPick",i),t.getPickingUniformBuffer().subData({offset:0,data:this.pickOption2Array()})}},{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_activeMix",0]]),e.hooks.init.tapPromise("PixelPickingPlugin",(function(){var t=e.getLayerConfig().enablePicking;r.registerStyleAttribute({name:"pickingColor",type:R.AttributeType.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:ui.q.PICKING_COLOR,buffer:{data:[],type:R.gl.FLOAT},size:3,update:function(e){var n=e.id;return t?(0,M.Z6)(n):[0,0,0]}}})})),e.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){e.getLayerConfig().enablePicking&&e.isVisible()&&(n.updatePickOption({u_PickingStage:ci},e),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:ci})})))})),e.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){e.getLayerConfig().enablePicking&&e.isVisible()&&(n.updatePickOption({u_PickingStage:hi},e),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:hi})})))})),e.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(t){var r=e.getLayerConfig(),i=r.highlightColor,o=r.activeMix,a=void 0===o?0:o,s="string"==typeof i?(0,M.CI)(i):i||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:(0,M.W0)(new Uint8Array(t))});var u={u_PickingStage:hi,u_PickingColor:t,u_HighlightColor:s.map((function(e){return 255*e})),u_activeMix:a};n.updatePickOption(u,e),e.models.forEach((function(e){return e.addUniforms(u)}))})),e.hooks.beforeSelect.tap("PixelPickingPlugin",(function(t){var r=e.getLayerConfig(),i=r.selectColor,o=r.selectMix,a=void 0===o?0:o,s="string"==typeof i?(0,M.CI)(i):i||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:(0,M.W0)(new Uint8Array(t))});var u={u_PickingStage:hi,u_PickingColor:t,u_HighlightColor:s.map((function(e){return 255*e})),u_activeMix:a,u_CurrentSelectedId:t,u_SelectColor:s.map((function(e){return 255*e}))};n.updatePickOption(u,e),e.models.forEach((function(e){return e.addUniforms(u)}))}))}}]),e}(),pi=["mvt","geojsonvt","testTile"];var di=function(){function e(){m()(this,e)}return y()(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("RegisterStyleAttributePlugin",(function(){(function(e){var t=e.getSource();return pi.includes(t.parser.type)})(e)||n.registerBuiltinAttributes(r,e)}))}},{key:"registerBuiltinAttributes",value:function(e,t){"MaskLayer"!==t.type?(this.registerPositionAttribute(e),this.registerColorAttribute(e),this.registerVertexIdAttribute(e)):this.registerPositionAttribute(e)}},{key:"registerPositionAttribute",value:function(e){e.registerStyleAttribute({name:"position",type:R.AttributeType.Attribute,descriptor:{name:"a_Position",shaderLocation:ui.q.POSITION,buffer:{data:[],type:R.gl.FLOAT},size:3,update:function(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}})}},{key:"registerColorAttribute",value:function(e){e.registerStyleAttribute({name:"color",type:R.AttributeType.Attribute,descriptor:{name:"a_Color",shaderLocation:ui.q.COLOR,buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:4,update:function(e){var t=e.color;return t&&t.length?t:[1,1,1,1]}}})}},{key:"registerVertexIdAttribute",value:function(e){e.registerStyleAttribute({name:"vertexId",type:R.AttributeType.Attribute,descriptor:{name:"a_vertexId",shaderLocation:ui.q.VERTEX_ID,buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:1,update:function(e,t){return[t]}}})}}]),e}(),vi=function(){function e(){m()(this,e),C()(this,"cameraService",void 0),C()(this,"coordinateSystemService",void 0),C()(this,"rendererService",void 0),C()(this,"mapService",void 0),C()(this,"layerService",void 0)}return y()(e,[{key:"apply",value:function(e,t){var n=this,r=t.rendererService,o=t.mapService,a=t.layerService,s=t.coordinateSystemService,u=t.cameraService;this.rendererService=r,this.mapService=o,this.layerService=a,this.coordinateSystemService=s,this.cameraService=u;var l,c=this.mapService.version,h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[0,0];this.rendererService.uniformBuffers[0]||(l=this.rendererService.createBuffer({data:new Float32Array(92),isUBO:!0}),this.rendererService.uniformBuffers[0]=l),e.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){var t=e.getLayerConfig().tileOrigin;(n.coordinateSystemService.refresh(t),"GAODE2.x"===c)&&(n.setLayerCenter(e),h=n.mapService.map.customCoords.getMVPMatrix(),f=n.mapService.getCustomCoordCenter(),e.getLayerUniformBuffer().subData({offset:0,data:new Uint8Array(new Float32Array([].concat(i()(h),i()(f))).buffer)}));var r=n.rendererService.getViewportSize(),o=r.width,a=r.height,s=n.generateUBO(h,f,o,a),u=s.data,l=s.uniforms;n.layerService.alreadyInRendering&&n.rendererService.uniformBuffers[0]&&n.rendererService.uniformBuffers[0].subData({offset:0,data:u});"WebGL1"===n.rendererService.queryVerdorInfo()&&e.models.forEach((function(t){t.addUniforms(d()(d()({},l),{},{u_PickingBuffer:e.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(e.getShaderPickStat())}))}))}))}},{key:"setLayerCenter",value:function(e){void 0===e.coordCenter&&(e.coordCenter=e.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(e.coordCenter)}},{key:"generateUBO",value:function(e,t,n,r){var o,a=this.cameraService.getProjectionMatrix(),s=this.cameraService.getViewMatrix(),u=this.cameraService.getViewProjectionMatrix(),l=this.cameraService.getModelMatrix(),c=this.coordinateSystemService.getViewportCenterProjection(),h=this.coordinateSystemService.getPixelsPerDegree(),f=this.cameraService.getZoom(),p=this.coordinateSystemService.getPixelsPerDegree2(),d=this.cameraService.getZoomScale(),v=this.coordinateSystemService.getPixelsPerMeter(),m=this.coordinateSystemService.getCoordinateSystem(),g=this.cameraService.getCameraPosition(),y=window.devicePixelRatio,_=this.coordinateSystemService.getViewportCenter(),b=[n,r],x=this.cameraService.getFocalDistance();return{data:[].concat(i()(s),i()(a),i()(u),i()(l),i()(c),i()(h),[f],i()(p),[d],i()(v),[m],i()(g),[y],i()(_),b,[x,0,0,0]),uniforms:(o={},C()(C()(C()(C()(C()(C()(C()(C()(C()(C()(o,R.CameraUniform.ProjectionMatrix,a),R.CameraUniform.ViewMatrix,s),R.CameraUniform.ViewProjectionMatrix,u),R.CameraUniform.Zoom,f),R.CameraUniform.ZoomScale,d),R.CameraUniform.FocalDistance,x),R.CameraUniform.CameraPosition,g),R.CoordinateUniform.CoordinateSystem,m),R.CoordinateUniform.ViewportCenter,_),R.CoordinateUniform.ViewportCenterProjection,c),C()(C()(C()(C()(C()(C()(C()(C()(o,R.CoordinateUniform.PixelsPerDegree,h),R.CoordinateUniform.PixelsPerDegree2,p),R.CoordinateUniform.PixelsPerMeter,v),R.CoordinateUniform.Mvp,e),"u_sceneCenterMercator",t),"u_ViewportSize",b),"u_ModelMatrix",l),"u_DevicePixelRatio",y))}}}]),e}(),mi=function(){function e(){m()(this,e)}return y()(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("UpdateModelPlugin",(function(){e.layerModel&&e.layerModel.needUpdate().then((function(t){t&&e.renderLayers()}))})),e.hooks.afterRender.tap("UpdateModelPlugin",(function(){e.layerModelNeedUpdate=!1}))}}]),e}(),gi=function(){function e(){m()(this,e)}return y()(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(e,{styleAttributeService:r})})),e.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){e.layerModelNeedUpdate||e.inited&&n.updateStyleAttribute(e,{styleAttributeService:r})}))}},{key:"updateStyleAttribute",value:function(e,t){var n=t.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices)return e.layerModelNeedUpdate=!0,void r.forEach((function(e){return e.needRegenerateVertices=!1}));r.filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex,e),t.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(e,t){var n=t.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1}))}}]),e}();var yi=n(8685),_i=function(){function e(t){m()(this,e),C()(this,"layer",void 0),this.layer=t}var t;return y()(e,[{key:"pickRender",value:function(e){var t=this.layer.getContainer().layerService,n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(e);n.hooks.beforePickingEncode.call(),t.renderTileLayerMask(n),n.renderModels({ispick:!0}),n.hooks.afterPickingEncode.call()}},{key:"pick",value:(t=f()(u()().mark((function e(t,n){var r,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.layer.getContainer(),i=r.pickingService,"RasterLayer"!==t.type){e.next=4;break}return e.abrupt("return",this.pickRasterLayer(t,n));case 4:return this.pickRender(n),e.abrupt("return",i.pickFromPickingFBO(t,n));case 6:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"pickRasterLayer",value:function(e,t,n){var r=this.layer.getContainer(),i=r.pickingService,o=r.mapService,a=this.layer.getSource().extent,s=(0,M.if)(t.lngLat,a),u={x:t.x,y:t.y,type:t.type,lngLat:t.lngLat,target:t,rasterValue:null},l=n||e;if(s){var c=this.readRasterValue(e,a,o,t.x,t.y);return u.rasterValue=c,i.triggerHoverOnLayer(l,u),!0}return u.type="mousemove"===t.type?"mouseout":"un"+t.type,i.triggerHoverOnLayer(l,d()(d()({},u),{},{type:"unpick"})),i.triggerHoverOnLayer(l,u),!1}},{key:"readRasterValue",value:function(e,t,n,r,i){var o=e.getSource().data.dataArray[0],a=ii()(t,4),s=a[0],u=void 0===s?0:s,l=a[1],c=void 0===l?0:l,h=a[2],f=void 0===h?10:h,p=a[3],d=void 0===p?-10:p,v=n.lngLatToContainer([u,c]),m=n.lngLatToContainer([f,d]),g=m.x-v.x,y=v.y-m.y,_=[(r-v.x)/g,(i-m.y)/y],b=o.width||1,x=o.height||1,E=Math.floor(_[0]*b),S=Math.floor(_[1]*x),A=Math.max(0,S-1)*b+E;return o.data[A]}},{key:"selectFeature",value:function(e){var t=this.layer,n=ii()(e,3),r=n[0],i=n[1],o=n[2];t.hooks.beforeSelect.call([r,i,o])}},{key:"highlightPickedFeature",value:function(e){var t=ii()(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i])}},{key:"getFeatureById",value:function(e){return this.layer.getSource().getFeatureById(e)}}]),e}(),bi=function(){function e(t){m()(this,e),C()(this,"layer",void 0),C()(this,"rendererService",void 0),C()(this,"colorTexture",void 0),C()(this,"key",void 0),this.layer=t;var n=this.layer.getContainer();this.rendererService=n.rendererService}return y()(e,[{key:"getColorTexture",value:function(e,t){var n=this.getTextureKey(e,t);return this.key===n||(this.createColorTexture(e,t),this.key=n),this.colorTexture}},{key:"createColorTexture",value:function(e,t){var n=this.rendererService.createTexture2D,r=this.getColorRampBar(e,t),i=n({data:new Uint8Array(r.data),width:r.width,height:r.height,flipY:!1,unorm:!0});return this.colorTexture=i,i}},{key:"setColorTexture",value:function(e,t,n){this.key=this.getTextureKey(t,n),this.colorTexture=e}},{key:"destroy",value:function(){var e;null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"getColorRampBar",value:function(e,t){switch(e.type){case"cat":return(0,M.hj)(e);case"quantize":return(0,M.NJ)(e);case"custom":return(0,M.Oc)(e,t);case"linear":return(0,M.M4)(e,t);default:return(0,M.Cl)(e)}}},{key:"getTextureKey",value:function(e,t){var n;return"".concat(e.colors.join("_"),"_").concat(null==e||null===(n=e.positions)||void 0===n?void 0:n.join("_"),"_").concat(e.type,"_").concat(null==t?void 0:t.join("_"))}}]),e}(),xi=["passes"],Ei=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption","pickingEnabled"],Si=M.rU.isEqual,Ai=M.rU.isFunction,Ti=M.rU.isNumber,Ci=M.rU.isObject,wi=M.rU.isPlainObject,Ri=M.rU.isUndefined,Mi=0,ki=function(e){E()(v,e);var t,n,r,o,s,l,h,p=A()(v);function v(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m()(this,v),e=p.call(this),C()(b()(e),"id","".concat(Mi++)),C()(b()(e),"name","".concat(Mi)),C()(b()(e),"parent",void 0),C()(b()(e),"coordCenter",void 0),C()(b()(e),"type",void 0),C()(b()(e),"visible",!0),C()(b()(e),"zIndex",0),C()(b()(e),"minZoom",void 0),C()(b()(e),"maxZoom",void 0),C()(b()(e),"inited",!1),C()(b()(e),"layerModelNeedUpdate",!1),C()(b()(e),"pickedFeatureID",null),C()(b()(e),"selectedFeatureID",null),C()(b()(e),"styleNeedUpdate",!1),C()(b()(e),"rendering",void 0),C()(b()(e),"forceRender",!1),C()(b()(e),"clusterZoom",0),C()(b()(e),"layerType",void 0),C()(b()(e),"triangulation",void 0),C()(b()(e),"layerPickService",void 0),C()(b()(e),"textureService",void 0),C()(b()(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),C()(b()(e),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),C()(b()(e),"hooks",{init:new w.S$,afterInit:new w.oI,beforeRender:new w.oI,beforeRenderData:new w.bf,afterRender:new w.ni,beforePickingEncode:new w.ni,afterPickingEncode:new w.ni,beforeHighlight:new w.ni(["pickedColor"]),afterHighlight:new w.ni,beforeSelect:new w.ni(["pickedColor"]),afterSelect:new w.ni,beforeDestroy:new w.ni,afterDestroy:new w.ni}),C()(b()(e),"models",[]),C()(b()(e),"multiPassRenderer",void 0),C()(b()(e),"plugins",void 0),C()(b()(e),"startInit",!1),C()(b()(e),"sourceOption",void 0),C()(b()(e),"layerModel",void 0),C()(b()(e),"shapeOption",void 0),C()(b()(e),"tileLayer",void 0),C()(b()(e),"layerChildren",[]),C()(b()(e),"masks",[]),C()(b()(e),"configService",R.globalConfigService),C()(b()(e),"styleAttributeService",void 0),C()(b()(e),"layerSource",void 0),C()(b()(e),"postProcessingPassFactory",void 0),C()(b()(e),"animateOptions",{enable:!1}),C()(b()(e),"container",void 0),C()(b()(e),"encodedData",void 0),C()(b()(e),"currentPickId",null),C()(b()(e),"rawConfig",void 0),C()(b()(e),"needUpdateConfig",void 0),C()(b()(e),"encodeStyleAttribute",{}),C()(b()(e),"enableShaderEncodeStyles",[]),C()(b()(e),"enableDataEncodeStyles",[]),C()(b()(e),"pendingStyleAttributes",[]),C()(b()(e),"scaleOptions",{}),C()(b()(e),"animateStartTime",void 0),C()(b()(e),"animateStatus",!1),C()(b()(e),"isDestroyed",!1),C()(b()(e),"uniformBuffers",[]),C()(b()(e),"encodeDataLength",0),C()(b()(e),"sourceEvent",(function(){e.dataState.dataSourceNeedUpdate=!0;var t=e.getLayerConfig();t&&t.autoFit&&e.fitBounds(t.fitBoundsOptions),e.layerSource.getSourceCfg().autoRender&&setTimeout((function(){e.reRender()}),10)})),e.name=t.name||e.id,e.zIndex=t.zIndex||0,e.rawConfig=t,e.masks=t.maskLayers||[],e}return y()(v,[{key:"shaderModuleService",get:function(){return this.container.shaderModuleService}},{key:"cameraService",get:function(){return this.container.cameraService}},{key:"coordinateService",get:function(){return this.container.coordinateSystemService}},{key:"iconService",get:function(){return this.container.iconService}},{key:"fontService",get:function(){return this.container.fontService}},{key:"pickingService",get:function(){return this.container.pickingService}},{key:"rendererService",get:function(){return this.container.rendererService}},{key:"layerService",get:function(){return this.container.layerService}},{key:"debugService",get:function(){return this.container.debugService}},{key:"interactionService",get:function(){return this.container.interactionService}},{key:"mapService",get:function(){return this.container.mapService}},{key:"normalPassFactory",get:function(){return this.container.normalPassFactory}},{key:"addMask",value:function(e){this.masks.push(e),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}},{key:"removeMask",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1),this.updateLayerConfig({maskLayers:this.masks})}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(e){this.masks.push(e)}},{key:"removeMaskLayer",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1),e.destroy()}},{key:"getAttribute",value:function(e){return this.styleAttributeService.getLayerStyleAttribute(e)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(e){var t=this;if(Object.keys(e).map((function(n){n in t.rawConfig&&(t.rawConfig[n]=e[n])})),this.startInit){var n=this.container.id;this.configService.setLayerConfig(n,this.id,d()(d()(d()({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}else this.needUpdateConfig=d()(d()({},this.needUpdateConfig),e)}},{key:"setContainer",value:function(e){this.container=e}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(e){return this.plugins.push(e),this}},{key:"init",value:(h=f()(u()().mark((function e(){var t,n,r,i,o,a,s=this;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.container.id,this.startInit=!0,this.configService.setLayerConfig(t,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,n=this.getLayerConfig(),r=n.enableMultiPassRenderer,i=n.passes,r&&null!=i&&i.length&&i.length>0&&this.mapService.on("mapAfterFrameChange",(function(){s.renderLayers()})),this.postProcessingPassFactory=this.container.postProcessingPassFactory,this.styleAttributeService=this.container.styleAttributeService,r&&(this.multiPassRenderer=this.container.multiPassRenderer,this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach((function(e){var t=e.attributeName,n=e.attributeField,r=e.attributeValues,i=e.updateOptions;s.styleAttributeService.updateStyleAttribute(t,{scale:d()({field:n},s.splitValuesAndCallbackInAttribute(r,n?void 0:s.getLayerConfig()[t]))},i)})),this.pendingStyleAttributes=[],this.plugins=[new I,new di,new Zr,new O,new Kr,new Yr,new gi,new mi,new si,new vi,new Xr,new ni,new fi,new qr],o=c()(this.plugins);try{for(o.s();!(a=o.n()).done;)a.value.apply(this,this.container)}catch(e){o.e(e)}finally{o.f()}return this.layerPickService=new _i(this),this.textureService=new bi(this),this.log(R.IDebugLog.LayerInitStart),e.next=19,this.hooks.init.promise();case 19:this.log(R.IDebugLog.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 24:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"log",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"init";if(!this.tileLayer&&!this.isTileLayer){var r="".concat(this.id,".").concat(n,".").concat(e),i={id:this.id,type:this.type};null===(t=this.debugService)||void 0===t||t.log(r,i)}}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models.map((function(t){t.updateAttributesAndElements(e.attributes,e.elements)})):console.warn("data error")}},{key:"setLayerPickService",value:function(e){this.layerPickService=e}},{key:"prepareBuildModel",value:function(){0!==Object.keys(this.needUpdateConfig||{}).length&&this.updateLayerConfig({});var e=this.getLayerConfig().animateOption;null!=e&&e.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(e,t,n){return this.updateStyleAttribute("color",e,t,n),this}},{key:"texture",value:function(e,t,n){return this.updateStyleAttribute("texture",e,t,n),this}},{key:"rotate",value:function(e,t,n){return this.updateStyleAttribute("rotate",e,t,n),this}},{key:"size",value:function(e,t,n){return this.updateStyleAttribute("size",e,t,n),this}},{key:"filter",value:function(e,t,n){var r=this.updateStyleAttribute("filter",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"shape",value:function(e,t,n){this.shapeOption={field:e,values:t};var r=this.updateStyleAttribute("shape",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"label",value:function(e,t,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:e,attributeValues:t,updateOptions:n}),this}},{key:"animate",value:function(e){var t={};return Ci(e)?(t.enable=!0,t=d()(d()({},t),e)):t.enable=e,this.updateLayerConfig({animateOption:t}),this}},{key:"source",value:function(e,t){return"source"===(null==e?void 0:e.type)?(this.setSource(e),this):(this.sourceOption={data:e,options:t},this.clusterZoom=0,this)}},{key:"setData",value:function(e,t){var n=this;return this.inited?(this.dataUpdatelog(),this.layerSource.setData(e,t)):this.on("inited",(function(){n.dataUpdatelog(),n.layerSource.setData(e,t)})),this}},{key:"dataUpdatelog",value:function(){var e=this;this.log(R.IDebugLog.SourceInitStart,R.ILayerStage.UPDATE),this.layerSource.once("update",(function(){e.log(R.IDebugLog.SourceInitEnd,R.ILayerStage.UPDATE)}))}},{key:"style",value:function(e){var t=this,n=e.passes,r=a()(e,xi);n&&oi(n).forEach((function(e){var n=t.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(e[0]);n&&n.updateOptions(e[1])})),r.borderColor&&(r.stroke=r.borderColor),r.borderWidth&&(r.strokeWidth=r.borderWidth);var i=r;return Object.keys(r).forEach((function(e){var t=r[e];!Array.isArray(t)||2!==t.length||Ti(t[0])||Ti(t[1])||(i[e]={field:t[0],value:t[1]})})),this.encodeStyle(i),this.updateLayerConfig(i),this}},{key:"encodeStyle",value:function(e){var t=this;Object.keys(e).forEach((function(n){[].concat(i()(t.enableShaderEncodeStyles),i()(t.enableDataEncodeStyles)).includes(n)&&wi(e[n])&&(e[n].field||e[n].value)&&!Si(t.encodeStyleAttribute[n],e[n])?(t.encodeStyleAttribute[n]=e[n],t.updateStyleAttribute(n,e[n].field,e[n].value),t.inited&&(t.dataState.dataMappingNeedUpdate=!0)):t.encodeStyleAttribute[n]&&(delete t.encodeStyleAttribute[n],t.dataState.dataSourceNeedUpdate=!0)}))}},{key:"scale",value:function(e,t){var n=d()({},this.scaleOptions);if(Ci(e)?this.scaleOptions=d()(d()({},this.scaleOptions),e):this.scaleOptions[e]=t,this.styleAttributeService&&!Si(n,this.scaleOptions)){var r=Ci(e)?e:C()({},e,t);this.styleAttributeService.updateScaleAttribute(r)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"prerender",value:function(){}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender||this.renderModels(e),this)}},{key:"renderMultiPass",value:(l=f()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.encodeDataLength<=0)||this.forceRender){e.next=2;break}return e.abrupt("return");case 2:if(!this.multiPassRenderer||!this.multiPassRenderer.getRenderFlag()){e.next=7;break}return e.next=5,this.multiPassRenderer.render();case 5:e.next=8;break;case 7:this.multiPassRenderer,this.renderModels();case 8:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"active",value:function(e){var t={};return t.enableHighlight=!!Ci(e)||e,Ci(e)?(t.enableHighlight=!0,e.color&&(t.highlightColor=e.color),e.mix&&(t.activeMix=e.mix)):t.enableHighlight=!!e,this.updateLayerConfig(t),this}},{key:"setActive",value:function(e,t){var n=this;if(Ci(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:Ci(t)?t.color:this.getLayerConfig().highlightColor,activeMix:Ci(t)?t.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:Ci(t)?t.color:this.getLayerConfig().highlightColor,activeMix:Ci(t)?t.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call((0,M.Z6)(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(e){var t={};return t.enableSelect=!!Ci(e)||e,Ci(e)?(t.enableSelect=!0,e.color&&(t.selectColor=e.color),e.mix&&(t.selectMix=e.mix)):t.enableSelect=!!e,this.updateLayerConfig(t),this}},{key:"setSelect",value:function(e,t){var n=this;if(Ci(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:Ci(t)?t.color:this.getLayerConfig().selectColor,selectMix:Ci(t)?t.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:Ci(t)?t.color:this.getLayerConfig().selectColor,selectMix:Ci(t)?t.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call((0,M.Z6)(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(e){return this.updateLayerConfig({blend:e}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(e){return this.zIndex=e,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(e){this.currentPickId=e}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(e){this.selectedFeatureID=e}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var e=this.mapService.getZoom(),t=this.getLayerConfig(),n=t.visible,r=t.minZoom,i=void 0===r?-1/0:r,o=t.maxZoom;return!!n&&e>=i&&e<(void 0===o?1/0:o)}},{key:"setMultiPass",value:function(e,t){if(this.updateLayerConfig({enableMultiPassRenderer:e}),t&&this.updateLayerConfig({passes:t}),e){var n=this.getLayerConfig().passes,r=void 0===n?[]:n;this.multiPassRenderer=ai(this,r,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var i=this.rendererService.getViewportSize(),o=i.width,a=i.height;this.multiPassRenderer.resize(o,a)}return this}},{key:"setMinZoom",value:function(e){return this.updateLayerConfig({minZoom:e}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(e){return this.getLayerConfig()[e]}},{key:"setMaxZoom",value:function(e){return this.updateLayerConfig({maxZoom:e}),this}},{key:"setAutoFit",value:function(e){return this.updateLayerConfig({autoFit:e}),this}},{key:"fitBounds",value:function(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var t=this.getSource().extent;return t.some((function(e){return Math.abs(e)===1/0}))||this.mapService.fitBounds([[t[0],t[1]],[t[2],t[3]]],e),this}},{key:"destroy",value:function(){var e,t,n,r,i,o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.isDestroyed){null===(e=this.layerModel)||void 0===e||e.uniformBuffers.forEach((function(e){e.destroy()})),this.layerChildren.map((function(e){return e.destroy(!1)})),this.layerChildren=[];var a=this.getLayerConfig(),s=a.maskfence;s&&(this.masks.map((function(e){return e.destroy(!1)})),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),null===(t=this.multiPassRenderer)||void 0===t||t.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(n=this.layerModel)||void 0===n||n.clearModels(o),null===(r=this.tileLayer)||void 0===r||r.destroy(),this.models=[],null===(i=this.debugService)||void 0===i||i.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var e;this.models.forEach((function(e){return e.destroy()})),null===(e=this.layerModel)||void 0===e||e.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(e){return e.needRescale||e.needRemapping||e.needRegenerateVertices})).length}},{key:"setSource",value:function(e){var t=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=e,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var n=this.mapService.getZoom();this.layerSource.updateClusterData(n)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",(function(e){var n=e.type;if(void 0===t.coordCenter){var r,i=t.layerSource.center;t.coordCenter=i,null!==(r=t.mapService)&&void 0!==r&&r.setCoordCenter&&t.mapService.setCoordCenter(i)}if("update"===n){if(t.tileLayer)return void t.tileLayer.reload();t.sourceEvent()}}))}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(e){this.encodedData=e,this.encodeDataLength=e.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(e){return this.styleAttributeService.getLayerAttributeScale(e)}},{key:"getLegend",value:function(e){var t,n,r,i=this.styleAttributeService.getLayerStyleAttribute(e);return{type:null===(n=((null==i||null===(t=i.scale)||void 0===t?void 0:t.scalers)||[])[0])||void 0===n||null===(n=n.option)||void 0===n?void 0:n.type,field:null==i||null===(r=i.scale)||void 0===r?void 0:r.field,items:this.getLegendItems(e)}}},{key:"getLegendItems",value:function(e){var t=this.styleAttributeService.getLayerAttributeScale(e);return t?t.invertExtent?t.range().map((function(n){return C()({value:t.invertExtent(n)},e,n)})):t.ticks?t.ticks().map((function(n){return C()({value:n},e,t(n))})):null!=t&&t.domain?t.domain().filter((function(e){return!Ri(e)})).map((function(n){return C()({value:n},e,t(n))})):[]:[]}},{key:"pick",value:function(e){var t=e.x,n=e.y;this.interactionService.triggerHover({x:t,y:n})}},{key:"boxSelect",value:function(e,t){this.pickingService.boxPickLayer(this,e,t)}},{key:"buildLayerModel",value:(s=f()(u()().mark((function e(t){var n,r,o,s,l,c,h,f,p,v,m,g,y,_,b=this;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.moduleName,r=t.vertexShader,o=t.fragmentShader,s=t.inject,l=t.triangulation,c=t.styleOption,h=t.pickingEnabled,f=void 0===h||h,p=a()(t,Ei),this.shaderModuleService.registerModule(n,{vs:r,fs:o,inject:s}),v=this.shaderModuleService.getModule(n),m=v.vs,g=v.fs,y=v.uniforms,_=this.rendererService.createModel,e.abrupt("return",new Promise((function(e){var t=b.styleAttributeService.createAttributesAndIndices(b.encodedData,l,c,b),n=t.attributes,r=t.elements,o=t.count,a=[].concat(i()(b.layerModel.uniformBuffers),i()(b.rendererService.uniformBuffers),[b.getLayerUniformBuffer()]);f&&a.push(b.getPickingUniformBuffer());var s=d()({attributes:n,uniforms:y,fs:g,vs:m,elements:r,blend:yi.y[R.BlendType.normal],uniformBuffers:a,textures:b.layerModel.textures},p);o&&(s.count=o),e(_(s))})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"createAttributes",value:function(e){var t=e.triangulation;return this.styleAttributeService.createAttributes(this.encodedData,t).attributes}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(e){var t=this.getLayerConfig(),n=t.enableHighlight,r=void 0===n||n,i=t.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(e)||-1!==this.eventNames().indexOf("un"+e);return"click"!==e&&"dblclick"!==e||!o||(a=!0),"mousemove"!==e||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:(o=f()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})},{key:"rebuildModels",value:(r=f()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"renderMulPass",value:(n=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.render();case 2:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach((function(n){n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t),textures:e.layerModel.textures},(null==t?void 0:t.ispick)||!1)})),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(e,t,n,r){var i=this.configService.getAttributeConfig(this.id)||{};return!Si(i[e],{field:t,values:n})&&(-1!==["color","size","texture","rotate","filter","label","shape"].indexOf(e)&&this.configService.setAttributeConfig(this.id,C()({},e,{field:t,values:n})),this.startInit?this.styleAttributeService.updateStyleAttribute(e,{scale:d()({field:t},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[t]))},r):this.pendingStyleAttributes.push({attributeName:e,attributeField:t,attributeValues:n,updateOptions:r}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(e){console.warn("empty fn")}},{key:"processData",value:function(e){return e}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:(t=f()(u()().mark((function e(){var t,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.models.forEach((function(e){return e.destroy()})),this.models=[],this.uniformBuffers.forEach((function(e){e.destroy()})),this.uniformBuffers=[],t=this.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0}),this.uniformBuffers.push(t),n=this.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0}),this.uniformBuffers.push(n),e.next=10,this.layerModel.initModels();case 10:this.models=e.sent;case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getLayerUniformBuffer",value:function(){return this.uniformBuffers[0]}},{key:"getPickingUniformBuffer",value:function(){return this.uniformBuffers[1]}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(e){return{values:Ai(e)?void 0:e,callback:Ai(e)?e:void 0}}}]),v}(k.EventEmitter)},2606:function(e,t,n){"use strict";n.d(t,{Z:function(){return C}});var r=n(4479),i=n.n(r),o=n(9558),a=n.n(o),s=n(9989),u=n.n(s),l=n(1448),c=n.n(l),h=n(4528),f=n.n(h),p=n(8798),d=n.n(p),v=n(9057),m=n.n(v),g=n(3292),y=n(6490),_=n(8685);function b(e){return e.maskOperation===g.MaskOperation.OR?{enable:!0,mask:255,func:{cmp:g.gl.ALWAYS,ref:1,mask:255},opFront:{fail:g.gl.KEEP,zfail:g.gl.REPLACE,zpass:g.gl.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===g.StencilType.SINGLE||0===e.stencilIndex?g.gl.ALWAYS:g.gl.LESS,ref:e.stencilType===g.StencilType.SINGLE?1:0===e.stencilIndex?2:1,mask:255},opFront:{fail:g.gl.KEEP,zfail:g.gl.REPLACE,zpass:g.gl.REPLACE}}}var x=n(4889),E={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},S={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function A(e){return Math.max(4*Math.ceil(e/4),4)}var T={opacity:x.q.OPACITY,stroke:x.q.STROKE,offsets:x.q.OFFSETS,rotation:x.q.ROTATION,extrusionBase:x.q.EXTRUSION_BASE,thetaOffset:15},C=function(){function e(t){f()(this,e),m()(this,"triangulation",void 0),m()(this,"uniformBuffers",[]),m()(this,"textures",[]),m()(this,"createTexture2D",void 0),m()(this,"preStyleAttribute",{}),m()(this,"encodeStyleAttribute",{}),m()(this,"layer",void 0),m()(this,"dataTexture",void 0),m()(this,"DATA_TEXTURE_WIDTH",void 0),m()(this,"dataTextureTest",void 0),m()(this,"configService",void 0),m()(this,"shaderModuleService",void 0),m()(this,"rendererService",void 0),m()(this,"iconService",void 0),m()(this,"fontService",void 0),m()(this,"styleAttributeService",void 0),m()(this,"mapService",void 0),m()(this,"cameraService",void 0),m()(this,"layerService",void 0),m()(this,"pickingService",void 0),m()(this,"attributeUnifoms",void 0),m()(this,"commonUnifoms",void 0),this.layer=t,this.configService=t.getContainer().globalConfigService,this.rendererService=t.getContainer().rendererService,this.pickingService=t.getContainer().pickingService,this.shaderModuleService=t.getContainer().shaderModuleService,this.styleAttributeService=t.getContainer().styleAttributeService,this.mapService=t.getContainer().mapService,this.iconService=t.getContainer().iconService,this.fontService=t.getContainer().fontService,this.cameraService=t.getContainer().cameraService,this.layerService=t.getContainer().layerService,this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var n=this.rendererService.createTexture2D;this.createTexture2D=n}var t,n,r;return d()(e,[{key:"getBlend",value:function(){var e=this.layer.getLayerConfig().blend,t=void 0===e?"normal":e;return _.y[g.BlendType[t]]}},{key:"getStencil",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i,a=t.enableMask,s=t.maskOperation,u=void 0===s?g.MaskOperation.AND:s;return"MaskLayer"===this.layer.type?b({isStencil:!0,stencilType:g.StencilType.SINGLE}):e.isStencil?b(c()(c()({},e),{},{maskOperation:u})):function(e,t){return{enable:e,mask:255,func:{cmp:g.gl.EQUAL,ref:t?1:0,mask:1}}}(r||a&&0!==this.layer.masks.length||void 0!==this.layer.tileMask,o)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();var n=c()(c()({},t.uniformsOption),e.uniformsOption);return!this.rendererService.hasOwnProperty("device")&&this.textures&&1===this.textures.length&&(n.u_texture=this.textures[0]),n}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:(r=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"initModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"prerender",value:function(){}},{key:"render",value:function(e){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.duration||4,e.interval||.2,e.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var e=this.layer.encodeStyleAttribute,t="",n=[];this.layer.enableShaderEncodeStyles.forEach((function(r){e[r]?t+="#define USE_ATTRIBUTE_".concat(r.toUpperCase()," 0.0; \n\n"):n.push("  ".concat(S[r]," u_").concat(r,";"));var i=T[r];i||"THETA_OFFSET"!==r||(i=15),t+="\n          #ifdef USE_ATTRIBUTE_".concat(r.toUpperCase(),"\n          layout(location = ").concat(T[r],") in ").concat(S[r]," a_").concat(r.charAt(0).toUpperCase()+r.slice(1),";\n        #endif\n\n        ")}));var r=n.length?"\nlayout(std140) uniform AttributeUniforms {\n".concat(n.join("\n"),"\n};\n    "):"";t+=r;var i="";return this.layer.enableShaderEncodeStyles.forEach((function(e){i+="\n\n    #ifdef USE_ATTRIBUTE_".concat(e.toUpperCase(),"\n      ").concat(S[e]," ").concat(e,"  = a_").concat(e.charAt(0).toUpperCase()+e.slice(1),";\n    #else\n      ").concat(S[e]," ").concat(e," = u_").concat(e,";\n    #endif\n\n    ")})),{"vs:#decl":t,"fs:#decl":r,"vs:#main-start":i}}},{key:"getStyleAttribute",value:function(){var e=this,t={};return this.layer.enableShaderEncodeStyles.forEach((function(n){if(!e.layer.encodeStyleAttribute[n]){var r=e.layer.getLayerConfig()[n],i=void 0===r?E[n]:r;"stroke"===n&&(i=(0,y.CI)(i)),t["u_"+n]=i}})),t}},{key:"registerStyleAttribute",value:function(){var e=this;Object.keys(this.layer.encodeStyleAttribute).forEach((function(t){var n=(0,x.C)(t);n&&(e.styleAttributeService.registerStyleAttribute(n),n.descriptor&&(n.descriptor.shaderLocation=T[t]))}))}},{key:"updateEncodeAttribute",value:function(e,t){this.encodeStyleAttribute[e]=t}},{key:"initUniformsBuffer",value:function(){var e=this.getUniformsBufferInfo(this.getStyleAttribute()),t=this.getCommonUniformsInfo();0!==e.uniformsLength&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(A(e.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.attributeUnifoms)),0!==t.uniformsLength&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(A(t.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.commonUnifoms))}},{key:"getUniformsBufferInfo",value:function(e){var t=0,n=[];return Object.values(e).forEach((function(e){Array.isArray(e)?(n.push.apply(n,i()(e)),t+=e.length):"number"==typeof e?(n.push(e),t+=1):"boolean"==typeof e&&(n.push(Number(e)),t+=1)})),{uniformsOption:e,uniformsLength:t,uniformsArray:n}}},{key:"getCommonUniformsInfo",value:function(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}},{key:"updateStyleUnifoms",value:function(){var e,t,n=this.getUniformsBufferInfo(this.getStyleAttribute()).uniformsArray,r=this.getCommonUniformsInfo().uniformsArray;null===(e=this.attributeUnifoms)||void 0===e||e.subData({offset:0,data:new Uint8Array(new Float32Array(n).buffer)}),null===(t=this.commonUnifoms)||void 0===t||t.subData({offset:0,data:new Uint8Array(new Float32Array(r).buffer)})}}]),e}()},4889:function(e,t,n){"use strict";n.d(t,{C:function(){return o},q:function(){return i}});var r=n(3292),i=function(e){return e[e.POSITION=0]="POSITION",e[e.COLOR=1]="COLOR",e[e.VERTEX_ID=2]="VERTEX_ID",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.STROKE=4]="STROKE",e[e.OPACITY=5]="OPACITY",e[e.OFFSETS=6]="OFFSETS",e[e.ROTATION=7]="ROTATION",e[e.EXTRUSION_BASE=8]="EXTRUSION_BASE",e[e.SIZE=9]="SIZE",e[e.SHAPE=10]="SHAPE",e[e.EXTRUDE=11]="EXTRUDE",e[e.MAX=12]="MAX",e[e.NORMAL=13]="NORMAL",e[e.UV=14]="UV",e[e.LINEAR=15]="LINEAR",e}({});function o(e){switch(e){case"rotation":return{name:"Rotation",type:r.AttributeType.Attribute,descriptor:{name:"a_Rotation",shaderLocation:i.ROTATION,buffer:{usage:r.gl.DYNAMIC_DRAW,data:[],type:r.gl.FLOAT},size:1,update:function(e){var t=e.rotation,n=void 0===t?0:t;return Array.isArray(n)?[n[0]]:[n]}}};case"stroke":return{name:"stroke",type:r.AttributeType.Attribute,descriptor:{name:"a_Stroke",shaderLocation:i.STROKE,buffer:{usage:r.gl.DYNAMIC_DRAW,data:[],type:r.gl.FLOAT},size:4,update:function(e){var t=e.stroke;return void 0===t?[1,1,1,1]:t}}};case"opacity":return{name:"opacity",type:r.AttributeType.Attribute,descriptor:{name:"a_Opacity",shaderLocation:i.OPACITY,buffer:{usage:r.gl.STATIC_DRAW,data:[],type:r.gl.FLOAT},size:1,update:function(e){var t=e.opacity;return[void 0===t?1:t]}}};case"extrusionBase":return{name:"extrusionBase",type:r.AttributeType.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:i.EXTRUSION_BASE,buffer:{usage:r.gl.STATIC_DRAW,data:[],type:r.gl.FLOAT},size:1,update:function(e){var t=e.extrusionBase;return[void 0===t?0:t]}}};case"offsets":return{name:"offsets",type:r.AttributeType.Attribute,descriptor:{name:"a_Offsets",shaderLocation:i.OFFSETS,buffer:{usage:r.gl.STATIC_DRAW,data:[],type:r.gl.FLOAT},size:2,update:function(e){return e.offsets}}};case"thetaOffset":return{name:"thetaOffset",type:r.AttributeType.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:15,buffer:{usage:r.gl.STATIC_DRAW,data:[],type:r.gl.FLOAT},size:1,update:function(e){var t=e.thetaOffset;return[void 0===t?1:t]}}};default:return}}},5356:function(e,t,n){"use strict";n.d(t,{Fy:function(){return s},cA:function(){return i},qy:function(){return o},xg:function(){return a},zW:function(){return r}});var r=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),i=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),o=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),a=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),s=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({})},3365:function(e,t,n){"use strict";n.d(t,{SE:function(){return p},Xw:function(){return u}});var r=n(9057),i=n.n(r),o=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),a=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function s(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/e,r=[],i=0;i<e;i++)r.push(n*i+t*Math.PI/12);var o=r.map((function(e){return[Math.sin(e+Math.PI/4),Math.cos(e+Math.PI/4),0]}));return o}function u(){return s(30)}function l(){return s(4)}function c(){return s(3)}function h(){return s(6,1)}function f(){return s(5)}var p=i()(i()(i()(i()(i()(i()(i()(i()(i()(i()({},a.CIRCLE,u),a.HEXAGON,h),a.TRIANGLE,c),a.SQUARE,l),a.PENTAGON,f),o.CYLINDER,u),o.HEXAGONCOLUMN,h),o.TRIANGLECOLUMN,c),o.SQUARECOLUMN,l),o.PENTAGONCOLUMN,f)},6999:function(e,t,n){"use strict";n.d(t,{S:function(){return P},Rs:function(){return H},zO:function(){return X},$4:function(){return Z},sN:function(){return D},NM:function(){return I},oX:function(){return O},xH:function(){return N},Xz:function(){return V},iC:function(){return W},us:function(){return B},qZ:function(){return K},NW:function(){return q},Qr:function(){return z},T3:function(){return G}});var r=n(3100),i=n.n(r),o=n(4479),a=n.n(o),s=n(6490),u=n(4778),l=n.n(u),c=n(9119),h=n(4528),f=n.n(h),p=n(8798),d=n.n(p),v=n(9057),m=n.n(v),g=n(6568),y=g.Ue(),_=(g.Ue(),g.Ue()),b=g.Ue(),x=g.Ue();function E(e,t,n,r,i){g.IH(e,n,r),g.Fv(e,e),t=g.al(-e[1],e[0]);var o=g.al(-n[1],n[0]);return[i/g.AK(t,o),t]}function S(e,t){return g.t8(e,-t[1],t[0])}function A(e,t,n){return g.lu(e,t,n),g.Fv(e,e),e}function T(e,t){return e[0]===t[0]&&e[1]===t[1]}var C=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f()(this,e),m()(this,"complex",void 0),m()(this,"join",void 0),m()(this,"cap",void 0),m()(this,"miterLimit",void 0),m()(this,"thickness",void 0),m()(this,"normal",void 0),m()(this,"lastFlip",-1),m()(this,"miter",g.al(0,0)),m()(this,"started",!1),m()(this,"dash",!1),m()(this,"totalDistance",0),m()(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return d()(e,[{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.simpleSegment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var s,u,l,c=e[o-1];c.push(null!==(s=t[o-1][2])&&void 0!==s?s:0);var h=t[o-1],f=e[o];f.push(null!==(u=t[o][2])&&void 0!==u?u:0);var p=t[o],d=o<e.length-1?[].concat(a()(e[o+1]),[null!==(l=t[o+1][2])&&void 0!==l?l:0]):null,v=o<t.length-1?t[o+1]:null;i+=this.simpleSegment(n,i,c,f,d,h,p,v)}if(this.dash)for(var m=0;m<n.positions.length/6;m++)n.positions[6*m+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var s,u,l,c=e[o-1];c.push(null!==(s=t[o-1][2])&&void 0!==s?s:0);var h=t[o-1],f=e[o];f.push(null!==(u=t[o][2])&&void 0!==u?u:0);var p=t[o],d=o<e.length-1?[].concat(a()(e[o+1]),[null!==(l=t[o+1][2])&&void 0!==l?l:0]):null,v=o<t.length-1?t[o+1]:null;i+=this.segment_gaode2(n,i,c,f,d,h,p,v)}if(this.dash)for(var m=0;m<n.positions.length/6;m++)n.positions[6*m+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleSegment",value:function(e,t,n,r,o){var u=0,l=e.indices,c=e.positions,h=e.normals,f=(0,s.Z)([r[0],r[1]]),p=(0,s.Z)([n[0],n[1]]);A(_,f,p);var d=0;if(this.dash&&(d=this.lineSegmentDistance(f,p),this.totalDistance+=d),this.normal||(this.normal=g.Ue(),S(this.normal,_)),this.started||(this.started=!0,this.extrusions(c,h,n,this.normal,this.thickness,this.totalDistance-d)),l.push(t+0,t+1,t+2),o){var v=(0,s.Z)([o[0],o[1]]);T(f,v)&&g.IH(v,f,g.Fv(v,g.$X(v,f,p))),A(b,v,f);var m=E(x,g.Ue(),_,b,this.thickness),y=i()(m,2),C=y[0],w=y[1];g.AK(x,this.normal);this.extrusions(c,h,r,w,C,this.totalDistance),l.push.apply(l,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),-1,g.JG(this.normal,w),u+=2,this.lastFlip=-1}else S(this.normal,_),this.extrusions(c,h,r,this.normal,this.thickness,this.totalDistance),l.push.apply(l,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2;return u}},{key:"segment_gaode2",value:function(e,t,n,r,o,u,l,c){var h=0,f=e.indices,p=e.positions,d=e.normals,v="square"===this.cap,m="bevel"===this.join,C=(0,s.Z)([l[0],l[1]]),w=(0,s.Z)([u[0],u[1]]);A(_,r,n);var R=0;if(this.dash&&(R=this.lineSegmentDistance(C,w),this.totalDistance+=R),this.normal||(this.normal=g.Ue(),S(this.normal,_)),!this.started)if(this.started=!0,v){var M=g.Ue(),k=g.Ue();g.IH(M,this.normal,_),g.IH(k,this.normal,_),d.push(k[0],k[1],0),d.push(M[0],M[1],0),p.push(n[0],n[1],0|n[2],this.totalDistance-R,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),p.push(n[0],n[1],0|n[2],this.totalDistance-R,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,d,n,this.normal,this.thickness,this.totalDistance-R);if(f.push(t+0,t+1,t+2),o){T(r,o)&&g.IH(o,r,g.Fv(o,g.$X(o,r,n))),A(b,o,r);var L=E(x,g.Ue(),_,b,this.thickness),O=i()(L,2),P=O[0],I=O[1],N=g.AK(x,this.normal)<0?-1:1,D=m;if(!D&&"miter"===this.join)P>this.miterLimit&&(D=!0);D?(d.push(this.normal[0],this.normal[1],0),d.push(I[0],I[1],0),p.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*N,0|r[2]),this.complex.indexes.push(this.currentIndex),p.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*N,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,a()(this.lastFlip!==-N?[t,t+2,t+3]:[t+2,t+1,t+3])),f.push(t+2,t+3,t+4),S(y,b),g.JG(this.normal,y),d.push(this.normal[0],this.normal[1],0),p.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*N,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,h+=3):(this.extrusions(p,d,r,I,P,this.totalDistance),f.push.apply(f,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),N=-1,g.JG(this.normal,I),h+=2),this.lastFlip=N}else{if(S(this.normal,_),v){var B=g.Ue(),F=g.Ue();g.lu(F,_,this.normal),g.IH(B,_,this.normal),d.push(F[0],F[1],0),d.push(B[0],B[1],0),p.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),p.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,d,r,this.normal,this.thickness,this.totalDistance);f.push.apply(f,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),h+=2}return h}},{key:"segment",value:function(e,t,n,r,o){var u=0,l=e.indices,c=e.positions,h=e.normals,f="square"===this.cap,p="bevel"===this.join,d=(0,s.Z)([r[0],r[1]]),v=(0,s.Z)([n[0],n[1]]);A(_,d,v);var m=0;if(this.dash&&(m=this.lineSegmentDistance(d,v),this.totalDistance+=m),this.normal||(this.normal=g.Ue(),S(this.normal,_)),!this.started)if(this.started=!0,f){var C=g.Ue(),w=g.Ue();g.IH(C,this.normal,_),g.IH(w,this.normal,_),h.push(w[0],w[1],0),h.push(C[0],C[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-m,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],0|n[2],this.totalDistance-m,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,n,this.normal,this.thickness,this.totalDistance-m);if(l.push(t+0,t+1,t+2),o){var R=(0,s.Z)([o[0],o[1]]);T(d,R)&&g.IH(R,d,g.Fv(R,g.$X(R,d,v))),A(b,R,d);var M=E(x,g.Ue(),_,b,this.thickness),k=i()(M,2),L=k[0],O=k[1],P=g.AK(x,this.normal)<0?-1:1,I=p;if(!I&&"miter"===this.join)L>this.miterLimit&&(I=!0);I?(h.push(this.normal[0],this.normal[1],0),h.push(O[0],O[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*P,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*P,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l.push.apply(l,a()(this.lastFlip!==-P?[t,t+2,t+3]:[t+2,t+1,t+3])),l.push(t+2,t+3,t+4),S(y,b),g.JG(this.normal,y),h.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*P,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(c,h,r,O,L,this.totalDistance),l.push.apply(l,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),P=-1,g.JG(this.normal,O),u+=2),this.lastFlip=P}else{if(S(this.normal,_),f){var N=g.Ue(),D=g.Ue();g.lu(D,_,this.normal),g.IH(N,_,this.normal),h.push(D[0],D[1],0),h.push(N[0],N[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}(),w=n(1648);function R(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=l().flatten(e),s=o.vertices,u=o.dimensions,c=[],h=[],f=[],p=0;p<s.length/u;p++)c.push(s[p*u],s[p*u+1],1,-1,-1),f.push(0,0,1);var d=l()(o.vertices,o.holes,o.dimensions);h.push.apply(h,a()(d));for(var v=function(){var e=o.vertices.slice(m*u,(m+1)*u),n=o.vertices.slice((m+1)*u,(m+2)*u);0===n.length&&(n=o.vertices.slice(0,u));var r=c.length/5;c.push(e[0],e[1],1,0,0,n[0],n[1],1,.1,0,e[0],e[1],0,0,.8,n[0],n[1],0,.1,.8);var i=M([n[0],n[1],1],[e[0],e[1],0],[e[0],e[1],1],t);f.push.apply(f,a()(i).concat(a()(i),a()(i),a()(i))),h.push.apply(h,a()([1,2,0,3,2,1].map((function(e){return e+r}))))},m=0;m<i;m++)v();return{positions:c,index:h,normals:f}}function M(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=w.create(),o=w.create(),u=w.create();r&&(e=(0,s.vP)(e),t=(0,s.vP)(t),n=(0,s.vP)(n));var l=w.fromValues.apply(w,a()(e)),c=w.fromValues.apply(w,a()(t)),h=w.fromValues.apply(w,a()(n));w.sub(i,h,c),w.sub(o,l,c),w.cross(u,i,o);var f=w.create();return w.normalize(f,u),f}var k=n(3365),L={};function O(e){var t=(0,s.SI)(e.coordinates);return{vertices:[].concat(a()(t),a()(t),a()(t),a()(t)),indices:[0,1,2,2,3,0],size:t.length}}function P(e){var t=(0,s.SI)(e.coordinates),n=(0,c.rq)(t);return{vertices:[].concat(a()(n),a()(n),a()(n),a()(n)),indices:[0,1,2,2,3,0],size:n.length}}function I(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(L&&L[e])return L[e];var n=k.SE[e]?k.SE[e]():k.SE.cylinder(),r=R([n],t);return L[e]=r,r}(e.shape,!1);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function N(e){var t=(0,s.SI)(e.coordinates);return{vertices:a()(t),indices:[0],size:t.length}}function D(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new C({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.extrude_gaode2(u,l)}}else{var c=t;c[0]&&!Array.isArray(c[0][0])&&(c=[t]),c.forEach((function(e){i.extrude(e)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function B(e){var t=e.coordinates,n=e.originCoordinates,r=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var i=function(e,t){var n=e,r=t||e;Array.isArray(n)&&Array.isArray(n[0])&&Array.isArray(n[0][0])&&(n=t.flat(),r=t.flat());var i=0;if(n.length<2)return{results:n,totalDistance:0};var o=[],a=U(n[0],i);o.push(a);for(var u=1;u<n.length-1;u++){i+=F((0,s.Z)(r[u-1]),(0,s.Z)(r[u]));var l=U(n[u],i);o.push(l),o.push(l)}return i+=F((0,s.Z)(r[r.length-2]),(0,s.Z)(r[r.length-1])),o.push(U(n[n.length-1],i)),{results:o,totalDistance:i}}(t,n),o=i.results,a=i.totalDistance;return o.map((function(e){r.push(e[0],e[1],e[2],e[3],0,a)})),{vertices:r,indices:[],normals:[],size:6,count:o.length}}function F(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function U(e,t){return e.length<3&&e.push(0),void 0!==t&&e.push(t),e}function z(e){var t=e.coordinates,n=l().flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:l()(r,o,i),vertices:r,size:i}}function G(e){var t=e.coordinates,n=l().flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:l()(r,o,i),vertices:j(r),size:i+4}}function j(e){for(var t=[],n=(0,s.Rx)(e),r=n.center,i=n.radius,o=0;o<e.length;o+=2){var u=e[o],l=e[o+1];t.push.apply(t,[u,l,0].concat(a()(r),[i]))}return t}function V(e){var t=R(e.coordinates,!0);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function H(e){var t=function(e){var t=["cylinder","triangleColumn","hexagonColumn","squareColumn"],n=k.SE[e]?k.SE[e]():k.SE.circle(),r=-1===t.indexOf(e)?(i=[n],o=l().flatten(i),s=l()(o.vertices,o.holes,o.dimensions),{positions:o.vertices,index:s}):function(e){var t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,i=l().flatten(e),o=i.vertices,s=i.dimensions,u=[],c=[],h=0;h<o.length/s;h++)2===s?u.push(o[2*h],o[2*h+1],1):u.push(o[3*h],o[3*h+1],1);var f=l()(i.vertices,i.holes,i.dimensions);c.push.apply(c,a()(f));for(var p=function(){var e=i.vertices.slice(d*s,(d+1)*s),t=i.vertices.slice((d+1)*s,(d+2)*s);0===t.length&&(t=i.vertices.slice(0,s));var n=u.length/3;u.push(e[0],e[1],1,t[0],t[1],1,e[0],e[1],0,t[0],t[1],0),c.push.apply(c,a()([0,2,1,2,3,1].map((function(e){return e+n}))))},d=0;d<r;d++)p();return{positions:u,index:c}}([n]);var i,o,s;return r}(e.shape);return{vertices:t.positions,indices:t.index,size:3}}function W(e){var t=e.coordinates;return{vertices:[].concat(a()(t[0]),[0,0,0],a()(t[1]),[0,1,0],a()(t[2]),[0,1,1],a()(t[3]),[0,0,1]),indices:[0,1,2,0,2,3],size:5}}function Z(e,t){for(var n=t.segmentNumber,r=void 0===n?30:n,i=e.coordinates,o=[],s=[],u=function(e){o.push(e,1,e,i[0][0],i[0][1],i[1][0],i[1][1],e,-1,e,i[0][0],i[0][1],i[1][0],i[1][1]),e!==r-1&&s.push.apply(s,a()([0,1,2,1,3,2].map((function(t){return 2*e+t}))))},l=0;l<r;l++)u(l);return{vertices:o,indices:s,size:7}}function X(e){var t=e.coordinates;2===t.length&&t.push(0);var n=Y(-1,1),r=Y(1,1),i=Y(-1,-1),o=Y(1,-1);return{vertices:[].concat(a()(t),a()(n),a()(t),a()(i),a()(t),a()(o),a()(t),a()(r)),indices:[0,1,2,3,0,2],size:5}}function Y(e,t){return[(e+1)/2,(t+1)/2]}function q(){var e=(0,c.j7)(c.Y5,{segments:c.r1});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}function K(){var e=(0,c.j7)(c.Y5+c.XJ,{segments:c.r1});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}},9119:function(e,t,n){"use strict";n.d(t,{XJ:function(){return l},Y5:function(){return s},j7:function(){return f},r1:function(){return u},rq:function(){return h}});var r=n(4479),i=n.n(r),o=n(3311),a=n(1648),s=100,u=36,l=40;function c(e){return e/180*Math.acos(-1)}function h(e){var t=c(e[0])+Math.PI/2,n=c(e[1]),r=s+.4*Math.random(),i=r*Math.cos(n)*Math.cos(t);return[r*Math.cos(n)*Math.sin(t),r*Math.sin(n),i]}function f(e,t){var n=o.create(),r=o.create(),s=a.fromValues(0,1,0),u=a.fromValues(0,0,0);e=void 0!==e?e:1;for(var l=2+(void 0!==(t=t||{}).segments?t.segments:32),c=2*l,h=[],f=[],p=[],d=[],v=[],m=[],g=0;g<=l;g++){for(var y=g/l,_=y*Math.PI,b=0;b<=c;b++){var x=b/c,E=x*Math.PI*2;o.identity(r),o.rotateZ(r,r,-_),o.identity(n),o.rotateY(n,n,E),a.transformMat4(u,s,r),a.transformMat4(u,u,n),a.scale(u,u,-e),p.push(u.slice()),d.push.apply(d,i()(u.slice())),a.normalize(u,u),v.push.apply(v,i()(u.slice())),m.push([x,1-y]),d.push(x,1-y)}if(g>0)for(var S=p.length,A=S-2*(c+1);A+c+2<S;A++)h.push([A,A+1,A+c+1]),f.push(A,A+1,A+c+1),h.push([A+c+1,A+1,A+c+2]),f.push(A+c+1,A+1,A+c+2)}return{cells:h,positions:p,uvs:m,positionsArr:d,indicesArr:f,normalArr:v}}},7904:function(e,t,n){"use strict";n.d(t,{Z:function(){return w}});var r=n(9558),i=n.n(r),o=n(9989),a=n.n(o),s=n(4528),u=n.n(s),l=n(8798),c=n.n(l),h=n(6626),f=n.n(h),p=n(7267),d=n.n(p),v=n(9913),m=n.n(v),g=n(9057),y=n.n(g),_=n(3301),b=n(3292),x=n(6490),E=n(2606),S=n(4889),A=n(6999),T=function(e){d()(s,e);var t,n,r,o=m()(s);function s(){var e;u()(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),y()(f()(e),"texture",void 0),e}return c()(s,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.brightness,r=e.contrast,i=e.saturation,o=e.gamma,a={u_opacity:(0,x.LS)(t,1),u_brightness:(0,x.LS)(n,1),u_contrast:(0,x.LS)(r,1),u_saturation:(0,x.LS)(i,1),u_gamma:(0,x.LS)(o,1)};return this.textures=[this.texture],this.getUniformsBufferInfo(a)}},{key:"initModels",value:(r=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadTexture();case 2:return e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"loadTexture",value:(n=a()(i()().mark((function e(){var t,n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.rendererService.createTexture2D,this.texture=t({height:1,width:1}),n=this.layer.getSource(),e.next=5,n.data.images;case 5:r=e.sent,this.texture=t({data:r[0],width:r[0].width,height:r[0].height,mag:b.gl.LINEAR,min:b.gl.LINEAR});case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n    float u_opacity:1.0;\n    float u_brightness:1.0;\n    float u_contrast:1.0;\n    float u_saturation:1.0;\n    float u_gamma:1.0;\n};\n\nout vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n \n}\n',fragmentShader:"uniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n    float u_opacity:1.0;\n    float u_brightness:1.0;\n    float u_contrast:1.0;\n    float u_saturation:1.0;\n    float u_gamma:1.0;\n};\n\nin vec2 v_texCoord;\nout vec4 outputColor;\nvec3 setContrast(vec3 rgb, float contrast) {\n  vec3 color = mix(vec3(0.5), rgb, contrast);\n  color = clamp(color, 0.0, 1.0);\n  return color;\n}\nvec3 setSaturation(vec3 rgb, float adjustment) {\n  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);\n  vec3 intensity = vec3(dot(rgb, grayVector));\n  vec3 color = mix(intensity, rgb, adjustment);\n  color = clamp(color, 0.0, 1.0);\n  return color;\n}\nvoid main() {\n  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));\n  //brightness\n  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);\n  //contrast\n  color.rgb = setContrast(color.rgb, u_contrast);\n  // saturation\n  color.rgb = setSaturation(color.rgb, u_saturation);\n  // gamma\n  color.rgb = pow(color.rgb, vec3(u_gamma));\n  outputColor = color;\n  outputColor.a *= u_opacity;\n  if(outputColor.a < 0.01)\n    discard;\n}\n",triangulation:A.iC,primitive:b.gl.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:S.q.UV,buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),s}(E.Z),C={image:T},w=function(e){d()(r,e);var t,n=m()(r);function r(){var e;u()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),y()(f()(e),"type","ImageLayer"),e}return c()(r,[{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new C[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{image:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"image"}}]),r}(_.Z)},1903:function(e,t,n){"use strict";n.d(t,{zi:function(){return T.Z},gq:function(){return R.Z},mM:function(){return O},Fy:function(){return M.Fy},Rf:function(){return z},fJ:function(){return me},VR:function(){return Z},zP:function(){return te},Q8:function(){return ne.Z},Ie:function(){return re.Z},cA:function(){return M.cA},$1:function(){return ge.Z},ns:function(){return ie.Z},dW:function(){return oe.Z},YY:function(){return ae.Z},xg:function(){return M.xg},qy:function(){return M.qy},sh:function(){return ue},Im:function(){return se.Z},vo:function(){return ke},zW:function(){return M.zW}});var r=n(1448),i=n.n(r),o=n(9558),a=n.n(o),s=n(9989),u=n.n(s),l=n(4528),c=n.n(l),h=n(8798),f=n.n(h),p=n(6626),d=n.n(p),v=n(746),m=n.n(v),g=n(378),y=n.n(g),_=n(7267),b=n.n(_),x=n(9913),E=n.n(x),S=n(9057),A=n.n(S),T=n(3301),C=n(3100),w=n.n(C),R=n(2606),M=n(5356),k={canvas2d:"2d",webgl:"webgl",webgl2:"webgl2",webgpu:"webgpu"},L=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"canvas",null),A()(d()(e),"ctx",void 0),A()(d()(e),"ctxType",void 0),A()(d()(e),"viewportSize",void 0),A()(d()(e),"initCanvas",(function(){var t,n,r,i,o,a=e.layerConfig,s=a.zIndex,u=a.getContext,l=document.createElement("canvas"),c=e.layer.getModelType();e.canvas=l,l.classList.add("l7-canvas-layer"),l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.zIndex=String(s),e.resetCanvasSize();var h=null!==(t=null===(n=(r=e.mapService).getCanvasOverlays)||void 0===n?void 0:n.call(r))&&void 0!==t?t:null===(i=(o=e.mapService).getMapCanvasContainer)||void 0===i?void 0:i.call(o);null==h||h.appendChild(l),e.ctx=u?u(l):l.getContext(k[c]),e.ctx||console.error("Failed to get rendering context for canvas"),e.bindListeners()})),A()(d()(e),"resetViewportSize",(function(){var t=e.rendererService.getViewportSize(),n=t.width,r=t.height;e.viewportSize=[n,r]})),A()(d()(e),"resetCanvasSize",(function(){var t=e.canvas;if(t){e.resetViewportSize();var n=e.mapService.getSize(),r=w()(n,2),i=r[0],o=r[1],a=w()(e.viewportSize,2),s=a[0],u=a[1];t.width=s,t.height=u,t.style.width=i+"px",t.style.height=o+"px"}})),A()(d()(e),"renderCanvas",(function(){var t;e.canvas||e.initCanvas();var n=e.layerConfig,r=n.draw,i=n.drawingOnCanvas,o=w()(e.viewportSize,2),a=o[0],s=o[1],u=e.mapService.getBounds();null===(t=null!=r?r:i)||void 0===t||t({canvas:e.canvas,ctx:e.ctx,container:{width:a,height:s,bounds:u},size:[a,s],utils:{lngLatToContainer:e.lngLatToContainer},mapService:e.mapService})})),A()(d()(e),"removeCanvas",(function(){var t;e.canvas&&(null===(t=e.canvas.parentElement)||void 0===t||t.removeChild(e.canvas),e.canvas=null);e.unbindListeners()})),A()(d()(e),"onMapResize",(function(){requestAnimationFrame((function(){e.resetCanvasSize(),e.renderCanvas()}))})),A()(d()(e),"lngLatToContainer",(function(t){var n=e.mapService.lngLatToContainer(t),r=n.x,i=n.y;return{x:r*window.devicePixelRatio,y:i*window.devicePixelRatio}})),e}return f()(r,[{key:"layerConfig",get:function(){return this.layer.getLayerConfig()}},{key:"initModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.renderCanvas(),e.abrupt("return",[]);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"bindListeners",value:function(){this.mapService.on("resize",this.onMapResize);var e=this.layerConfig,t=e.trigger;e.update===M.Fy.ALWAYS||"change"===t?this.mapService.on("mapchange",this.renderCanvas):(this.mapService.on("zoomstart",this.removeCanvas),this.mapService.on("zoomend",this.renderCanvas),this.mapService.on("movestart",this.removeCanvas),this.mapService.on("moveend",this.renderCanvas))}},{key:"unbindListeners",value:function(){this.mapService.off("resize",this.onMapResize),this.mapService.off("mapchange",this.renderCanvas),this.mapService.off("zoomstart",this.removeCanvas),this.mapService.off("zoomend",this.renderCanvas),this.mapService.off("movestart",this.removeCanvas),this.mapService.off("moveend",this.renderCanvas)}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(R.Z),O=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","CanvasLayer"),e}return f()(r,[{key:"getDefaultConfig",value:function(){return{zIndex:3,contextType:"canvas2d",trigger:"change"}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layerModel=new L(this),e.next=3,this.initLayerModels();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelType",value:function(){return this.getLayerConfig().contextType||"canvas2d"}},{key:"draw",value:function(e){return this.updateLayerConfig({draw:e}),this.render(),this}},{key:"getLayerConfig",value:function(){var e=i()(i()({},this.getDefaultConfig()),m()(y()(r.prototype),"getLayerConfig",this).call(this));return e.zIndex<3&&(e.zIndex=3),e}},{key:"render",value:function(){var e;return null===(e=this.layerModel)||void 0===e||e.renderCanvas(),this}},{key:"getCanvas",value:function(){var e;return null===(e=this.layerModel)||void 0===e?void 0:e.canvas}},{key:"show",value:function(){var e=this.getCanvas();return e&&(e.style.display="unset"),this}},{key:"hide",value:function(){var e=this.getCanvas();return e&&(e.style.display="none"),this}},{key:"destroy",value:function(){this.layerModel.removeCanvas(),m()(y()(r.prototype),"destroy",this).call(this)}}]),r}(T.Z),P=n(4479),I=n.n(P),N=n(3292),D=n(6490),B=n(6999),F=n(4889),U=function(e){b()(i,e);var t,n,r=E()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),A()(d()(e),"cityCenter",void 0),A()(d()(e),"cityMinSize",void 0),e}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.baseColor,i=void 0===r?"rgb(16,16,16)":r,o=e.brightColor,a=void 0===o?"rgb(255,176,38)":o,s=e.windowColor,u=void 0===s?"rgb(30,60,89)":s,l=e.time,c=void 0===l?0:l,h=e.sweep,f=void 0===h?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:h,p={u_baseColor:(0,D.CI)(i),u_brightColor:(0,D.CI)(a),u_windowColor:(0,D.CI)(u),u_circleSweepColor:[].concat(I()((0,D.CI)(f.sweepColor).slice(0,3)),[1]),u_cityCenter:f.sweepCenter||this.cityCenter,u_circleSweep:f.enable?1:0,u_cityMinSize:this.cityMinSize*f.sweepRadius,u_circleSweepSpeed:f.sweepSpeed,u_opacity:n,u_near:0,u_far:1,u_time:this.layer.getLayerAnimateTime()||c};return this.getUniformsBufferInfo(p)}},{key:"calCityGeo",value:function(){var e=w()(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3];if("GAODE2.x"===this.mapService.version){this.cityCenter=this.mapService.lngLatToCoord([(r+t)/2,(i+n)/2]);var o=this.mapService.lngLatToCoord([r,i]),a=this.mapService.lngLatToCoord([t,n]);this.cityMinSize=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2))/4}else{var s=r-t,u=i-n;this.cityCenter=[(r+t)/2,(i+n)/2],this.cityMinSize=Math.sqrt(Math.pow(s,2)+Math.pow(u,2))/4}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.calCityGeo(),this.initUniformsBuffer(),this.startModelAnimate(),e.abrupt("return",this.buildModels());case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec2 a_Uv;\n\nout vec2 v_texCoord;\nout vec4 v_Color;\nout float v_worldDis;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_circleSweepColor;\n  vec2 u_cityCenter;\n  float u_circleSweep;\n  float u_cityMinSize;\n  float u_circleSweepSpeed;\n  float u_opacity: 1.0;\n  float u_near : 0;\n  float u_far : 1;\n  float u_time;\n};\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n   v_texCoord = a_Uv;\n\n  if(u_circleSweep > 0.0) {\n     vec2 lnglatscale = vec2(0.0);\n    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {\n      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);\n    }\n    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);\n  }\n \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nlayout(std140) uniform commonUniforms {\n  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_circleSweepColor;\n  vec2 u_cityCenter;\n  float u_circleSweep;\n  float u_cityMinSize;\n  float u_circleSweepSpeed;\n  float u_opacity: 1.0;\n  float u_near : 0;\n  float u_far : 1;\n  float u_time;\n};\nin vec4 v_Color;\nin vec2 v_texCoord;\nin float v_worldDis;\nout vec4 outputColor;\n\n#pragma include "picking"\n#pragma include "scene_uniforms"\n\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\n    float s = step(hot, n);\n    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\n\n    return mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\n\nfloat LinearizeDepth()\n{\n    float z = gl_FragCoord.z * 2.0 - 1.0;\n    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\n\nvec3 fog(vec3 color, vec3 fogColor, float depth){\n    float fogFactor=clamp(depth,0.0,1.0);\n    vec3 output_color=mix(fogColor,color,fogFactor);\n    return output_color;\n}\n\nfloat sdRect(vec2 p, vec2 sz) {\n  vec2 d = abs(p) - sz;\n  float outside = length(max(d, 0.));\n  float inside = min(max(d.x, d.y), 0.);\n  return outside + inside;\n}\n\nvoid main() {\n  outputColor = v_Color;\n  vec3 baseColor = u_baseColor.xyz;\n  vec3 brightColor = u_brightColor.xyz;\n  vec3 windowColor = u_windowColor.xyz;\n  float targetColId = 5.;\n  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\n  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\n  if(v_texCoord.x < 0.) { //顶部颜色\n       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\n       outputColor = vec4( foggedColor, v_Color.w);\n  }else { // 侧面颜色\n        vec2 st = v_texCoord;\n        vec2  UvScale = v_texCoord;\n        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\n        float tStart = 0.25 * tStep;\n        float tEnd = 0.75 * tStep;\n        float u = mod(UvScale.x, tStep);\n        float v = mod(UvScale.y, tStep);\n        float ux = floor(UvScale.x/tStep);\n        float uy = floor(UvScale.y/tStep);\n        float n = random(vec2(ux,uy));\n        float lightP = u_time;\n        float head = 1.0- step(0.005,st.y);\n        /*step3*/\n        // 将窗户颜色和墙面颜色区别开来\n        float sU = step(tStart, u) - step(tEnd, u);\n        float sV = step(tStart, v) - step(tEnd, v);\n        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\n        float dist = sdRect(vec2(u,v), windowSize);\n        float s = sU * sV;\n\n        float curColId = floor(UvScale.x / tStep);\n        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\n\n        float mLightP = mod(lightP, 2.);\n        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\n        if(ux == targetColId){\n            n =0.;\n        }\n        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );\n        float hot = smoothstep(1.0,0.0,timeP);\n        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\n        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);\n        float sFinal = s * sCol * sRow;\n        color += mix(baseColor, brightColor, sFinal*n);\n        if (st.y<0.01){\n        color = baseColor;\n         }\n        if(head ==1.0) { // 顶部亮线\n            color = brightColor;\n        }\n        color = color * v_Color.rgb;\n\n        vec3 foggedColor = fog(color,fogColor,depth);\n\n        outputColor = vec4(foggedColor,1.0);\n  }\n\n\n  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {\n    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);\n    outputColor.rgb += r * r * u_circleSweepColor.rgb;\n  }\n   \n  outputColor.a *= u_opacity;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:B.Xz,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:N.gl.BACK}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:N.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:F.q.NORMAL,buffer:{usage:N.gl.STATIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:N.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:F.q.SIZE,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:F.q.UV,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(R.Z),z=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","CityBuildingLayer"),e}return f()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layerModel=new U(this),e.next=3,this.initLayerModels();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setLight",value:function(e){this.updateLayerConfig({time:e})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(T.Z),G=function(e){b()(o,e);var t,n,r=E()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),A()(d()(e),"texture",void 0),A()(d()(e),"radian",0),A()(d()(e),"planeGeometryTriangulation",(function(){var t=e.layer.getLayerConfig().center,n=void 0===t?[120,30]:t;return{size:4,indices:[0,1,2,2,3,0],vertices:[].concat(I()(n),[1,1],I()(n),[0,1],I()(n),[0,0],I()(n),[1,0])}})),e}return f()(o,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),i()(i()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.width,r=void 0===n?1:n,i=e.height,o=void 0===i?1:i,a=e.raisingHeight,s=void 0===a?0:a,u=1;"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(u=-1),this.radian=u*Math.PI*(this.mapService.getRotation()%360)/180;var l={u_size:[r,o],u_raisingHeight:Number(s),u_rotation:this.radian,u_opacity:t||1,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(l)}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.drawCanvas,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),n&&this.updateTexture(n),this.initUniformsBuffer(),e.next=7,this.layer.buildLayerModel({moduleName:"geometryBillboard",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 11) in vec3 a_Extrude;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n vec2 u_size;\n float u_raisingHeight;\n float u_rotation;\n float u_opacity;\n};\n\nout vec2 v_uv;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\nvoid main() {\n   vec3 extrude = a_Extrude;\n   v_uv = a_Uv;\n   float raiseHeight = u_raisingHeight;\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raiseHeight = u_raisingHeight * mapboxZoomScale;\n   }\n\n   // 计算经纬度点位坐标\n   vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n   // 计算绕 z 轴旋转后的偏移\n   vec2 offsetXY = project_pixel(rotate_matrix(vec2(extrude.x * u_size.x, 0.0),u_rotation));\n   // 绕 z 轴旋转\n   float x = project_pos.x + offsetXY.x;\n   float y = project_pos.y + offsetXY.y;\n   // z 轴不参与旋转\n   float z = project_pixel(extrude.y * u_size.y + raiseHeight);\n\n   gl_Position = project_common_position_to_clipspace_v2(vec4(x , y, z , 1.0));\n\n   setPickingColor(a_PickingColor);\n}\n',fragmentShader:'layout(std140) uniform commonUniforms {\n vec2 u_size;\n float u_raisingHeight;\n float u_rotation;\n float u_opacity;\n};\n\nuniform sampler2D u_texture;\n\nin vec2 v_uv;\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  outputColor = texture(SAMPLER_2D(u_texture), vec2(v_uv.x, 1.0 - v_uv.y));\n  outputColor.a *= u_opacity;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:this.planeGeometryTriangulation,inject:this.getInject(),primitive:N.gl.TRIANGLES,depth:{enable:!0}});case 7:return i=e.sent,e.abrupt("return",[i]);case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateTexture",value:function(e){var t=this.rendererService.createTexture2D,n=this.layer.getLayerConfig(),r=n.canvasWidth,i=void 0===r?1:r,o=n.canvasHeight,a=void 0===o?1:o,s=document.createElement("canvas");s.width=i,s.height=a,s.getContext("2d")&&(e(s),this.texture=t({data:s,width:s.width,height:s.height,wrapS:N.gl.CLAMP_TO_EDGE,wrapT:N.gl.CLAMP_TO_EDGE}),this.layerService.reRender())}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:N.AttributeType.Attribute,descriptor:{name:"a_Extrude",shaderLocation:F.q.EXTRUDE,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:F.q.UV,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[2],n[3]]}}})}}]),o}(R.Z),j=function(e){b()(o,e);var t,n,r=E()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),A()(d()(e),"texture",void 0),A()(d()(e),"terrainImage",void 0),A()(d()(e),"terrainImageLoaded",!1),A()(d()(e),"mapTexture",void 0),A()(d()(e),"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.width,i=void 0===r?1:r,o=n.height,a=void 0===o?1:o,s=n.widthSegments,u=void 0===s?1:s,l=n.heightSegments,c=void 0===l?1:l,h=n.center,f=void 0===h?[120,30]:h,p=n.terrainTexture,d=(t=e).initPlane.apply(t,[i,a,u,c].concat(I()(f))),v=d.indices,m=d.positions;return p&&e.loadTerrainTexture(m,v),{vertices:m,indices:v,size:5}})),e}return f()(o,[{key:"initPlane",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=e/2,s=t/2,u=Math.floor(n),l=Math.floor(r),c=u+1,h=l+1,f=e/u,p=t/l,d=[],v=[],m=0;m<h;m++)for(var g=m*p-s,y=0;y<c;y++){var _=y*f-a;if("GAODE2.x"===this.mapService.version){var b=this.mapService.lngLatToCoord([_+i,-g+o]),x=w()(b,2),E=x[0],S=x[1];v.push(E,S,0)}else v.push(_+i,-g+o,0);v.push(y/u),v.push(1-m/l)}for(var A=0;A<l;A++)for(var T=0;T<u;T++){var C=T+c*A,R=T+c*(A+1),M=T+1+c*(A+1),k=T+1+c*A;d.push(C,R,k),d.push(R,M,k)}return{indices:d,positions:v}}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),i()(i()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.terrainClipHeight,o=void 0===i?0:i,a=t.terrainTexture;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.updateTexture(r));var s={u_opacity:n||1,u_mapFlag:r?1:0,u_terrainClipHeight:a?o:-1,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(s)}},{key:"clearModels",value:function(){var e;this.terrainImage=null,null===(e=this.texture)||void 0===e||e.destroy(),this.textures=[]}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.mapTexture,this.mapTexture=n,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),this.updateTexture(n),this.initUniformsBuffer(),e.next=8,this.layer.buildLayerModel({moduleName:"geometryPlane",vertexShader:'\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec3 a_Color;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_mapFlag;\n  float u_terrainClipHeight;\n};\n\nout vec3 v_Color;\nout vec2 v_uv;\nout float v_clip;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   v_Color = a_Color;\n   v_uv = a_Uv;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_clip = 1.0;\n   if(a_Position.z < u_terrainClipHeight) {\n      v_clip = 0.0;\n   }\n  \n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy, a_Position.z, 1.0));\n\n   setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_mapFlag;\n  float u_terrainClipHeight;\n};\n\nin vec3 v_Color;\nin vec2 v_uv;\nin float v_clip;\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  // gl_FragColor = vec4(v_Color, u_opacity);\n  if(u_mapFlag > 0.0) {\n    outputColor = texture(SAMPLER_2D(u_texture), vec2(v_uv.x, 1.0 - v_uv.y));\n    outputColor.a *= u_opacity;\n  } else {\n    // gl_FragColor = vec4(v_uv, 0.0, u_opacity);\n    outputColor = vec4(v_Color, u_opacity);\n  }\n  outputColor.a *= v_clip;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:this.planeGeometryTriangulation,inject:this.getInject(),primitive:N.gl.TRIANGLES,depth:{enable:!0},cull:{enable:!0,face:N.gl.BACK}});case 8:return i=e.sent,e.abrupt("return",[i]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"createModelData",value:function(e){if(e){var t=this.layer.getLayerConfig(),n=t.widthSegments,r=t.heightSegments,i=t.width,o=t.height,a=e,s=a.widthSegments,u=a.heightSegments,l=a.width,c=a.height;this.layer.style({widthSegments:void 0!==s?s:n,heightSegments:void 0!==u?u:r,width:void 0!==l?l:i,height:void 0!==c?c:o})}var h=this.layer.getEncodedData();return this.styleAttributeService.createAttributesAndIndices(h,this.planeGeometryTriangulation)}},{key:"updateTexture",value:function(e){var t=this,n=this.rendererService.createTexture2D;if(e){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:N.gl.CLAMP_TO_EDGE,wrapT:N.gl.CLAMP_TO_EDGE}),t.layerService.reRender()},r.src=e}else this.texture=n({width:0,height:0})}},{key:"getImageData",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=e.width,i=e.height;return t.width=r,t.height=i,n.drawImage(e,0,0,r,i),n.getImageData(0,0,r,i)}},{key:"translateVertex",value:function(e,t,n,r,i,o){for(var a=n.width,s=n.height,u=this.getImageData(n).data,l=Math.floor(r),c=Math.floor(i),h=l+1,f=c+1,p=a/l,d=s/c,v=0;v<f;v++)for(var m=Math.floor(v*d)*a,g=0;g<h;g++){var y=4*(m+Math.floor(g*p)),_=u[y],b=u[y+1],x=u[y+2];e[5*(v*h+g)+2]=o(_,b,x)}var E=this.layer.getEncodedData(),S=this.styleAttributeService.createAttributesAndIndices(E,(function(){return{vertices:e,indices:t,size:5}}));this.layer.updateModelData(S),this.layerService.throttleRenderLayers()}},{key:"loadTerrainTexture",value:function(e,t){var n=this,r=this.layer.getLayerConfig(),i=r.widthSegments,o=void 0===i?1:i,a=r.heightSegments,s=void 0===a?1:a,u=r.terrainTexture,l=r.rgb2height,c=void 0===l?function(e,t,n){return e+t+n}:l;if(this.terrainImage)this.terrainImageLoaded?this.translateVertex(e,t,this.terrainImage,o,s,c):this.terrainImage.onload=function(){n.translateVertex(e,t,n.terrainImage,o,s,c)};else{var h=new Image;this.terrainImage=h,h.crossOrigin="anonymous",h.onload=function(){n.terrainImageLoaded=!0,setTimeout((function(){return n.layer.emit("terrainImageLoaded",null)})),n.translateVertex(e,t,h,o,s,c)},h.src=u}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:F.q.UV,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),o}(R.Z),V=function(e){return e.UP="up",e.DOWN="down",e}(V||{}),H=function(e){b()(o,e);var t,n,r=E()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),A()(d()(e),"texture",void 0),A()(d()(e),"mapTexture",void 0),A()(d()(e),"positions",void 0),A()(d()(e),"indices",void 0),A()(d()(e),"timer",void 0),A()(d()(e),"spriteTop",void 0),A()(d()(e),"spriteUpdate",void 0),A()(d()(e),"spriteAnimate",void 0),A()(d()(e),"planeGeometryUpdateTriangulation",(function(){for(var t=e.layer.getLayerConfig().spriteBottom,n=void 0===t?-1e5:t,r=e.spriteUpdate,i=n,o=e.spriteTop,a=0;a<e.positions.length;a+=5)e.spriteAnimate===V.UP?(e.positions[a+2]+=r,e.positions[a+2]>o&&(e.positions[a+2]=i)):(e.positions[a+2]-=r,e.positions[a+2]<i&&(e.positions[a+2]=o));return{vertices:e.positions,indices:e.indices,size:5}})),A()(d()(e),"updatePosition",(function(){var t;e.planeGeometryUpdateTriangulation();var n=null===(t=e.styleAttributeService.getLayerStyleAttribute("position"))||void 0===t?void 0:t.vertexAttribute;if(n){for(var r=[],i=0;i<e.positions.length;i+=5)r.push(e.positions[i],e.positions[i+1],e.positions[i+2]);n.updateBuffer({data:r,offset:0})}e.layerService.throttleRenderLayers(),e.timer=requestAnimationFrame(e.updatePosition)})),A()(d()(e),"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.center,i=void 0===r?[120,30]:r,o=n.spriteCount,a=void 0===o?100:o,s=n.spriteRadius,u=void 0===s?10:s,l=(t=e).initSprite.apply(t,[u,a].concat(I()(i))),c=l.indices,h=l.positions;return e.positions=h,e.indices=c,{vertices:h,indices:c,size:5}})),e}return f()(o,[{key:"initSprite",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,i=[],o=[],a=this.mapService,s=this.spriteAnimate===V.UP?-this.spriteTop:this.spriteTop,u=0;u<t;u++){var l=Math.random()*s;o.push.apply(o,I()(h(l)))}for(var c=0;c<t;c++)i.push(c);function h(t){var i=e*Math.random(),o=e*Math.random(),s=-e/2+i,u=-e/2+o;if("GAODE2.x"===a.version){var l=a.lngLatToCoord([s+n,-u+r]),c=w()(l,2);return[c[0],c[1],t,0,0]}return[s+n,-u+r,t,0,0]}return{indices:i,positions:o}}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),i()(i()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.spriteScale,o=void 0===i?1:i;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.textures=[],this.updateTexture(r));var a={u_opacity:n||1,u_mapFlag:r?1:0,u_Scale:o,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(a)}},{key:"clearModels",value:function(){var e;cancelAnimationFrame(this.timer),null===(e=this.texture)||void 0===e||e.destroy(),this.textures=[]}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l,c,h,f=this;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.mapTexture,r=t.spriteTop,i=void 0===r?5e6:r,o=t.spriteUpdate,s=void 0===o?1e4:o,u=t.spriteAnimate,l=void 0===u?V.DOWN:u,this.initUniformsBuffer(),this.mapTexture=n,this.spriteTop=i,this.spriteUpdate=s,this.spriteAnimate="up"===l?V.UP:V.DOWN,c=this.rendererService.createTexture2D,this.texture=c({height:0,width:0}),this.updateTexture(n),setTimeout((function(){f.updatePosition()}),100),e.next=12,this.layer.buildLayerModel({moduleName:"geometrySprite",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec3 a_Color;\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_mapFlag;\n  float u_Scale;\n};\n\nout vec3 v_Color;\nout float v_d;\n\n#pragma include "projection"\nvoid main() {\n   v_Color = a_Color.xyz;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_d = a_Position.z;\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy, a_Position.z, 1.0));\ngl_PointSize = pow((u_Zoom - 1.0), 2.0) * u_Scale;\n}\n',fragmentShader:"\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_mapFlag;\n  float u_Scale;\n};\nuniform sampler2D u_texture;\n\nin vec3 v_Color;\nin float v_d;\nout vec4 outputColor;\n\nvoid main() {\n\n  if(v_d < 0.0) {\n    discard;\n  }\n\n  if(u_mapFlag > 0.0) {\n    outputColor = texture(SAMPLER_2D(u_texture), gl_PointCoord);\n    outputColor.a *= u_opacity;\n  } else {\n    outputColor = vec4(v_Color, u_opacity);\n  }\n}\n",triangulation:this.planeGeometryTriangulation,inject:this.getInject(),primitive:N.gl.POINTS,depth:{enable:!1},blend:this.getBlend()});case 12:return h=e.sent,e.abrupt("return",[h]);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateTexture",value:function(e){var t=this,n=this.rendererService.createTexture2D;if(e){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:N.gl.CLAMP_TO_EDGE,wrapT:N.gl.CLAMP_TO_EDGE}),t.layerService.reRender()},r.src=e}else this.texture=n({width:1,height:1})}},{key:"registerBuiltinAttributes",value:function(){return""}}]),o}(R.Z),W={plane:j,sprite:H,billboard:G},Z=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","GeometryLayer"),A()(d()(e),"defaultSourceConfig",{data:[{x:0,y:0}],options:{parser:{type:"json",x:"x",y:"y"}}}),e}return f()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new W[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{plane:{},sprite:{},billboard:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"plane"===n?"plane":"sprite"===n?"sprite":"billboard"===n?"billboard":"plane"}}]),r}(T.Z),X=function(e){b()(o,e);var t,n,r=E()(o);function o(){return c()(this,o),r.apply(this,arguments)}return f()(o,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),i()(i()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.coverage,r=e.angle,i={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:n||.9,u_angle:r||0};return this.getUniformsBufferInfo(i)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:'layout(location = 0) in vec3 a_Position;\r\nlayout(location = 1) in vec4 a_Color;\r\nlayout(location = 10) in vec3 a_Pos;\r\n\r\nlayout(std140) uniform commonUniforms {\r\n    vec2 u_radius;\r\n    float u_opacity;\r\n    float u_coverage;\r\n    float u_angle;\r\n};\r\n\r\n\r\nout vec4 v_color;\r\n\r\n\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\n\r\nvoid main() {\r\n  v_color = a_Color;\r\n  v_color.a *= u_opacity;\r\n\r\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\n  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n  // gl_Position = project_common_position_to_clipspace(project_pos);\r\n\r\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // 将经纬度转换为高德2.0需要的平面坐标\r\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\n    gl_Position = u_Mvp * (project_pos);\r\n  } else {\r\n     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n    gl_Position = project_common_position_to_clipspace(project_pos);\r\n  }\r\n\r\n  setPickingColor(a_PickingColor);\r\n}\r\n',fragmentShader:'in vec4 v_color;\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:B.Rs,primitive:N.gl.TRIANGLES,depth:{enable:!1}});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:N.AttributeType.Attribute,descriptor:{shaderLocation:10,name:"a_Pos",buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),o}(R.Z),Y=function(e){b()(o,e);var t,n,r=E()(o);function o(){return c()(this,o),r.apply(this,arguments)}return f()(o,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),i()(i()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.coverage,r=e.angle,i={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:n||.9,u_angle:r||0};return this.getUniformsBufferInfo(i)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 10) in vec3 a_Pos;\nlayout(location = 13) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_radius;\n  float u_opacity;\n  float u_coverage;\n  float u_angle;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n \n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 经纬度\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // 将经纬度转换为高德2.0需要的平面坐标\n    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\n\n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w * u_opacity);\n  \n    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n  } else {\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n    \n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n    \n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec4 v_color;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_radius;\n  float u_opacity;\n  float u_coverage;\n  float u_angle;\n};\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:B.NM,primitive:N.gl.TRIANGLES,depth:{enable:!0}});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:N.AttributeType.Attribute,descriptor:{shaderLocation:F.q.SIZE,name:"a_Size",buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:1,update:function(e){var t=e.size;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:N.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:F.q.NORMAL,buffer:{usage:N.gl.STATIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:N.AttributeType.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),o}(R.Z),q=n(3311);var K=D.rU.isEqual,Q=function(e){b()(s,e);var t,n,r,o=E()(s);function s(){var e;c()(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),A()(d()(e),"texture",void 0),A()(d()(e),"colorTexture",void 0),A()(d()(e),"heatmapFramerBuffer",void 0),A()(d()(e),"heatmapTexture",void 0),A()(d()(e),"intensityModel",void 0),A()(d()(e),"colorModel",void 0),A()(d()(e),"shapeType",void 0),A()(d()(e),"preRampColors",void 0),A()(d()(e),"colorModelUniformBuffer",[]),A()(d()(e),"heat3DModelUniformBuffer",[]),e}return f()(s,[{key:"prerender",value:function(){var e=this,t=this.rendererService,n=t.clear;(0,t.useFramebuffer)(this.heatmapFramerBuffer,(function(){n({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.heatmapFramerBuffer}),e.drawIntensityMode()}))}},{key:"render",value:function(e){var t=this.layer.getLayerConfig().rampColors;K(this.preRampColors,t)||this.updateColorTexture(),"heatmap"===this.shapeType?this.drawHeatMap(e):this.draw3DHeatMap(e)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(r=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l,c,h;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.rendererService,r=n.createFramebuffer,i=n.getViewportSize,o=n.createTexture2D,s=this.styleAttributeService.getLayerStyleAttribute("shape"),u=(null==s||null===(t=s.scale)||void 0===t?void 0:t.field)||"heatmap",this.shapeType=u,e.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=e.sent,this.colorModel="heatmap"===u?this.buildHeatmap():this.build3dHeatMap(),l=i(),c=l.width,h=l.height,this.heatmapTexture=o({width:Math.floor(c/4),height:Math.floor(h/4),wrapS:N.gl.CLAMP_TO_EDGE,wrapT:N.gl.CLAMP_TO_EDGE,min:N.gl.LINEAR,mag:N.gl.LINEAR,usage:N.TextureUsage.RENDER_TARGET}),this.heatmapFramerBuffer=r({color:this.heatmapTexture,depth:!0,width:Math.floor(c/4),height:Math.floor(h/4)}),this.updateColorTexture(),e.abrupt("return",[this.intensityModel,this.colorModel]);case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:N.AttributeType.Attribute,descriptor:{name:"a_Dir",shaderLocation:10,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:N.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:F.q.SIZE,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:1,update:function(e){var t=e.size;return[void 0===t?1:t]}}})}},{key:"buildHeatMapIntensity",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uniformBuffers=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],this.layer.triangulation=B.zO,e.next=4,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 9) in float a_Size;\nlayout(location = 10) in vec2 a_Dir;\n\n\nlayout(std140) uniform commonUniforms {\n  float u_radius;\n  float u_intensity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n};\n\nout vec2 v_extrude;\nout float v_weight;\n\n#define GAUSS_COEF  0.3989422804014327\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main(){\n    vec3 picking_color_placeholder = u_PickingColor;\n\n    v_weight = a_Size;\n    float ZERO = 1.0 / 255.0 / 16.0;\n    float extrude_x = a_Dir.x * 2.0 -1.0;\n    float extrude_y = a_Dir.y * 2.0 -1.0;\n    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\n    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\n    v_extrude = extrude_dir * S;\n\n    vec2 offset = project_pixel(v_extrude * u_radius);\n    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n    } else {\n        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n    }\n}\n',fragmentShader:"layout(std140) uniform commonUniforms {\n  float u_radius;\n  float u_intensity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n};\n\nin vec2 v_extrude;\nin float v_weight;\nout vec4 outputColor;\n#define GAUSS_COEF  0.3989422804014327\n\nvoid main(){\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);\n    outputColor = vec4(val, 1., 1., 1.);\n}\n",triangulation:B.zO,depth:{enable:!1},cull:{enable:!0,face:(0,D.fj)(this.mapService.version)}});case 4:return t=e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"buildHeatmap",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:'\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\n\n#pragma include "scene_uniforms"\n\nout vec2 v_texCoord;\nvoid main() {\n  v_texCoord = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_texCoord.y = 1.0 - v_texCoord.y;\n  #endif\n\n  gl_Position = vec4(a_Position.xy, 0, 1.);\n}\n',fs:'uniform sampler2D u_texture;        // 热力强度图\nuniform sampler2D u_colorTexture;   // 根据强度分布的色带\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\nin vec2 v_texCoord;\nout vec4 outputColor;\n\n#pragma include "scene_uniforms"\n\nfloat getBlurIndusty() {\n    float vW = 2.0/ u_ViewportSize.x;\n    float vH = 2.0/ u_ViewportSize.y;\n    vec2 vUv = v_texCoord;\n    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n\n    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\n    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;\n    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\n\n    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\n    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\n    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\n\n    return(\n        i11 + \n        i12 + \n        i13 + \n        i21 + \n        i21 + \n        i22 + \n        i23 + \n        i31 + \n        i32 + \n        i33\n        )/9.0;\n}\n\n\nvoid main(){\n    // float intensity = texture(u_texture, v_texCoord).r;\n    float intensity = getBlurIndusty();\n    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));\n    outputColor = color;\n    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n'}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];var e=this.shaderModuleService.getModule("heatmapColor"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService,a=o.createAttribute,s=o.createElements,u=o.createBuffer;return(0,o.createModel)({vs:t,fs:n,uniformBuffers:[].concat(I()(this.colorModelUniformBuffer),I()(this.rendererService.uniformBuffers)),attributes:{a_Position:a({shaderLocation:F.q.POSITION,buffer:u({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:N.gl.FLOAT}),size:3}),a_Uv:a({shaderLocation:F.q.UV,buffer:u({data:[0,1,1,1,0,0,1,0],type:N.gl.FLOAT}),size:2})},uniforms:i()({},r),depth:{enable:!1},elements:s({data:[0,2,1,2,3,1],type:N.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var e,t=this.layer.getLayerConfig(),n=t.intensity,r=void 0===n?10:n,i=t.radius,o=void 0===i?5:i,a={u_radius:o,u_intensity:r};this.uniformBuffers[0].subData({offset:0,data:[o,r]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),null===(e=this.intensityModel)||void 0===e||e.draw({uniforms:a,blend:{enable:!0,func:{srcRGB:N.gl.ONE,srcAlpha:1,dstRGB:N.gl.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawHeatMap",value:function(e){var t,n=this.layer.getLayerConfig().opacity,r=void 0===n?1:n,i={u_opacity:r,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},o=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[r]}),null===(t=this.colorModel)||void 0===t||t.draw({uniforms:i,textures:o,blend:this.getBlend(),stencil:this.getStencil(e)})}},{key:"draw3DHeatMap",value:function(e){var t,n=this.layer.getLayerConfig().opacity,r=void 0===n?1:n,i=q.create();q.invert(i,this.cameraService.getViewProjectionMatrixUncentered());var o={u_opacity:r,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:I()(i)};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[].concat(I()(o.u_ViewProjectionMatrixUncentered),I()(o.u_InverseViewProjectionMatrix),[r])});var a=[this.heatmapTexture,this.colorTexture];null===(t=this.colorModel)||void 0===t||t.draw({uniforms:o,textures:a,blend:{enable:!0,func:{srcRGB:N.gl.SRC_ALPHA,srcAlpha:1,dstRGB:N.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(e)})}},{key:"build3dHeatMap",value:function(){var e=(0,this.rendererService.getViewportSize)(),t=function(e,t){for(var n=[],r=[],i=[],o=e+1,a=t+1,s=e/2,u=t/2,l=0;l<a;l++)for(var c=l-u,h=0;h<o;h++){var f=h-s;r.push(f/s,-c/u,0),i.push(h/e),i.push(1-l/t)}for(var p=0;p<t;p++)for(var d=0;d<e;d++){var v=d+o*p,m=d+o*(p+1),g=d+1+o*(p+1),y=d+1+o*p;n.push(v,m,y),n.push(m,g,y)}return{vertices:r,indices:n,uvs:i}}(e.width/4,e.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'layout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  mat4 u_ViewProjectionMatrixUncentered;\n  mat4 u_InverseViewProjectionMatrix;\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nout vec2 v_texCoord;\nout float v_intensity;\n\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n    float t2 = t * t;\n    float one_minus_t = 1.0 - t;\n    float one_minus_t2 = one_minus_t * one_minus_t;\n    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\n    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_texCoord = a_Uv;\n\n  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）\n\n  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点\n\tvec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点\n\n\tvec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）\n\tvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\n\n  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）\n\tinverseP2 = inverseP2 / inverseP2.w;\n\n\tfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??\n\tvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\n\n  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\n  float fh;\n\n  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;\n  fh = toBezier(v_intensity, b).y;\n  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n \n}\n',fs:"layout(std140) uniform commonUniforms {\n  mat4 u_ViewProjectionMatrixUncentered;\n  mat4 u_InverseViewProjectionMatrix;\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nin vec2 v_texCoord;\nin float v_intensity;\nout vec4 outputColor;\n\nvoid main(){\n   \n    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;\n    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));\n    outputColor = color;\n    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;\n   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n"}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(36).fill(0),isUBO:!0})];var n=this.shaderModuleService.getModule("heatmap3dColor"),r=n.vs,o=n.fs,a=n.uniforms,s=this.rendererService,u=s.createAttribute,l=s.createElements,c=s.createBuffer;return(0,s.createModel)({vs:r,fs:o,attributes:{a_Position:u({shaderLocation:F.q.POSITION,buffer:c({data:t.vertices,type:N.gl.FLOAT}),size:3}),a_Uv:u({shaderLocation:F.q.UV,buffer:c({data:t.uvs,type:N.gl.FLOAT}),size:2})},primitive:N.gl.TRIANGLES,uniformBuffers:[].concat(I()(this.heat3DModelUniformBuffer),I()(this.rendererService.uniformBuffers)),uniforms:i()({},a),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:N.gl.SRC_ALPHA,srcAlpha:1,dstRGB:N.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:l({data:t.indices,type:N.gl.UNSIGNED_INT,count:t.indices.length})})}},{key:"updateColorTexture",value:function(){var e=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var t=this.layer.getLayerConfig().rampColors,n=(0,D.Cl)(t);this.colorTexture=e({data:n.data,usage:N.TextureUsage.SAMPLED,width:n.width,height:n.height,wrapS:N.gl.CLAMP_TO_EDGE,wrapT:N.gl.CLAMP_TO_EDGE,min:N.gl.NEAREST,mag:N.gl.NEAREST,flipY:!1,unorm:!0}),this.preRampColors=t}}]),s}(R.Z),$=function(e){b()(o,e);var t,n,r=E()(o);function o(){return c()(this,o),r.apply(this,arguments)}return f()(o,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),i()(i()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.coverage,r=e.angle,i={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:n||.9,u_angle:r||0};return this.getUniformsBufferInfo(i)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 10) in vec3 a_Pos;\n\nlayout(std140) uniform commonUniforms {\n    vec2 u_radius;\n    float u_opacity;\n    float u_coverage;\n    float u_angle;\n};\n\nout vec4 v_color;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n  v_color.a *= u_opacity;\n    \n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n \n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));\n    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\n    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec4 v_color;\n\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:B.Rs,depth:{enable:!1},primitive:N.gl.TRIANGLES});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:N.AttributeType.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),o}(R.Z),J={heatmap:Q,heatmap3d:Q,grid:X,grid3d:Y,hexagon:$},ee=n(1517),te=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","HeatMapLayer"),e}return f()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new J[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"prerender",value:function(){"heatmap"===this.getModelType()&&this.layerModel&&this.layerModel.prerender()}},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.getModelType();return"heatmap"===n?(this.layerModel&&this.layerModel.render(t),this):(this.encodeDataLength<=0&&!this.forceRender||(this.hooks.beforeRender.call(),this.models.forEach((function(n){return n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t)})})),this.hooks.afterRender.call()),this)}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models[0].updateAttributesAndElements(e.attributes,e.elements):console.warn("data error")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}},{key:"getLegend",value:function(e){if("heatmap"===this.getModelType()){if("color"!==e)return{type:void 0,field:void 0,items:[]};var t=this.getLayerConfig().rampColors;return(0,ee.I)(t,e)}return m()(y()(r.prototype),"getLegend",this).call(this,e)}}]),r}(T.Z),ne=n(7904),re=n(5122),ie=n(1452),oe=n(7702),ae=n(4767),se=n(8833),ue=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","TileDebugLayer"),A()(d()(e),"zIndex",1e4),A()(d()(e),"defaultSourceConfig",{data:[],options:{parser:{type:"testTile"}}}),e}return f()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),r}(T.Z),le=D.rU.isNumber,ce=function(e){b()(i,e);var t,n,r=E()(i);function i(){return c()(this,i),r.apply(this,arguments)}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e,n={u_opacity:le(t)?t:1};return this.getUniformsBufferInfo(n)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-997,e.next=3,this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) vec4 a_Color;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec2 a_Uv;\nlayout(std140) uniform commonUniforms {\n float u_opacity;\n};\n#pragma include "scene_uniforms"\nout vec3 vVertexNormal;\nout vec4 v_Color;\nout float v_offset;\n\nvoid main() {\n    float EARTH_RADIUS = 100.0;\n    \n    v_Color = a_Color;\n\n    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n',fragmentShader:'\nlayout(std140) uniform commonUniforms {\n float u_opacity;\n};\nin vec3 vVertexNormal;\nin float v_offset;\nin vec4 v_Color;\n\n#pragma include "scene_uniforms"\nout vec4 outputColor;\nvoid main() {\n    \n    \n    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    // 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    outputColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n',triangulation:B.NW,depth:{enable:!1},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:N.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:F.q.SIZE,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:N.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:F.q.NORMAL,buffer:{usage:N.gl.STATIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:F.q.UV,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(R.Z),he=function(e){b()(i,e);var t,n,r=E()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),A()(d()(e),"texture",void 0),A()(d()(e),"earthTime",3.4),A()(d()(e),"sunX",1e3),A()(d()(e),"sunY",1e3),A()(d()(e),"sunZ",1e3),A()(d()(e),"sunRadius",Math.sqrt(e.sunX*e.sunX+e.sunY*e.sunY+e.sunZ*e.sunZ)),e}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=e.globalOptions;null!=t&&t.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY));var r={u_sunLight:[this.sunX,this.sunY,this.sunZ,0],u_ambientRatio:(null==n?void 0:n.ambientRatio)||.6,u_diffuseRatio:(null==n?void 0:n.diffuseRatio)||.4,u_specularRatio:(null==n?void 0:n.specularRatio)||.1};return this.textures=[this.texture],this.getUniformsBufferInfo(r)}},{key:"setEarthTime",value:function(e){this.earthTime=e,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.throttleRenderLayers()}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,i,o=this;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),void 0!==(null==(n=t.globalOptions)?void 0:n.earthTime)&&this.setEarthTime(n.earthTime),r=this.layer.getSource(),i=this.rendererService.createTexture2D,this.texture=i({height:0,width:0}),r.data.images.then((function(e){o.texture=i({data:e[0],width:e[0].width,height:e[0].height}),o.textures=[o.texture],o.layerService.reRender()})),this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-998,e.next=3,this.layer.buildLayerModel({moduleName:"earthBase",vertexShader:'// attribute vec4 a_Color;\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec2 a_Uv;\n\n// attribute vec2 a_Extrude;\n// attribute float a_Size;\n// attribute float a_Shape;\n\nlayout(std140) uniform commonUniforms {\n\tvec4 u_sunLight: [1.0, -10.5, 12.0,0.0];\n\tfloat u_ambientRatio : 0.5;\n\tfloat u_diffuseRatio : 0.3;\n\tfloat u_specularRatio : 0.2;\n};\n\n#pragma include "scene_uniforms"\n\nout vec2 v_texCoord;\nout float v_lightWeight;\n\nfloat calc_lighting(vec4 pos) {\n\n\tvec3 worldPos = vec3(pos * u_ModelMatrix);\n\n\tvec3 worldNormal = a_Normal;\n\n\t// cal light weight\n\tvec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n\tvec3 lightDir = normalize(u_sunLight.xyz);\n\n\tvec3 halfDir = normalize(viewDir+lightDir);\n\t// lambert\n\tfloat lambert = dot(worldNormal, lightDir);\n\t// specular\n\tfloat specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n\t//sum to light weight\n\tfloat lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;\n\n\treturn lightWeight;\n}\n\nvoid main() {\n\n\tv_texCoord = a_Uv;\n\n\tfloat lightWeight = calc_lighting(vec4(a_Position, 1.0));\n\tv_lightWeight = lightWeight;\n\n\tgl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n',fragmentShader:"uniform sampler2D u_texture;\n\nin vec2 v_texCoord;\nin float v_lightWeight;\nout vec4 outputColor;\n\nvoid main() {\n    vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));\n    color.xyz = color.xyz * v_lightWeight;\n    outputColor = color;\n}\n",triangulation:B.NW,depth:{enable:!0},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:N.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:F.q.SIZE,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:N.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:F.q.NORMAL,buffer:{usage:N.gl.STATIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:F.q.UV,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(R.Z),fe=D.rU.isNumber,pe=function(e){b()(i,e);var t,n,r=E()(i);function i(){return c()(this,i),r.apply(this,arguments)}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e,n={u_opacity:fe(t)?t:1};return this.getUniformsBufferInfo(n)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-999,e.next=3,this.layer.buildLayerModel({moduleName:"earthBloom",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) vec4 a_Color;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec2 a_Uv;\nlayout(std140) uniform commonUniforms {\n float u_opacity;\n};\n#pragma include "scene_uniforms"\n\nout vec3 vVertexNormal;\nout vec4 v_Color;\n\nvoid main() {\n    v_Color = a_Color;\n\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n',fragmentShader:'\nin vec3 vVertexNormal;\nin vec4 v_Color;\n\nlayout(std140) uniform commonUniforms {\n float u_opacity;\n};\nout vec4 outputColor;\n#pragma include "scene_uniforms"\nvoid main() {\n    float intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));\n    // 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    outputColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n',triangulation:B.qZ,depth:{enable:!1},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:N.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:F.q.SIZE,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:N.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:F.q.NORMAL,buffer:{usage:N.gl.STATIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:F.q.UV,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(R.Z),de={base:he,atomSphere:ce,bloomSphere:pe},ve=["base","atomSphere","bloomSphere"],me=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","EarthLayer"),A()(d()(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),e}return f()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new de[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setEarthTime",value:function(e){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(e):console.warn("请在 scene loaded 之后执行该方法！")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"base";return ve.indexOf(n)<0&&(n="base"),n}}]),r}(T.Z),ge=n(240);function ye(e,t,n){var r=_e(e,e.VERTEX_SHADER,t),i=_e(e,e.FRAGMENT_SHADER,n);if(!r||!i)return null;var o=e.createProgram();if(!o)return null;if(e.attachShader(o,r),e.attachShader(o,i),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)){var a=e.getProgramInfoLog(o);return console.warn("Failed to link program: "+a),e.deleteProgram(o),e.deleteShader(i),e.deleteShader(r),null}for(var s=e.getProgramParameter(o,e.ACTIVE_ATTRIBUTES),u=0;u<s;u++){var l=e.getActiveAttrib(o,u);o[l.name]=e.getAttribLocation(o,l.name)}for(var c=e.getProgramParameter(o,e.ACTIVE_UNIFORMS),h=0;h<c;h++){var f=e.getActiveUniform(o,h);o[f.name]=e.getUniformLocation(o,f.name)}return o.vertexShader=r,o.fragmentShader=i,o}function _e(e,t,n){var r=e.createShader(t);if(null==r)return console.warn("unable to create shader"),null;if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(r);return console.warn("Failed to compile shader: "+i),e.deleteShader(r),null}return r}function be(e,t,n,r,i){var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),o}function xe(e,t,n){e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,t)}function Ee(e,t){var n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),n}function Se(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r=n.createLinearGradient(0,0,256,0),i=0,o=Object.keys(e);i<o.length;i++){var a=o[i];r.addColorStop(+a,e[+a])}return n.fillStyle=r,n.fillRect(0,0,256,1),t=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function Ae(e,t,n,r){e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,r,e.FLOAT,!1,0,0)}function Te(e,t,n){e.bindFramebuffer(e.FRAMEBUFFER,t),n&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}var Ce=function(){function e(t){c()(this,e),A()(this,"width",512),A()(this,"height",512),A()(this,"pixels",void 0),A()(this,"fadeOpacity",void 0),A()(this,"speedFactor",void 0),A()(this,"dropRate",void 0),A()(this,"dropRateBump",void 0),A()(this,"gl",void 0),A()(this,"drawProgram",void 0),A()(this,"fullScreenProgram",void 0),A()(this,"updateProgram",void 0),A()(this,"rampColors",void 0),A()(this,"numParticles",65536),A()(this,"numParticlesSize",void 0),A()(this,"particleStateResolution",void 0),A()(this,"quadBuffer",void 0),A()(this,"particleIndexBuffer",void 0),A()(this,"framebuffer",void 0),A()(this,"colorRampTexture",void 0),A()(this,"backgroundTexture",void 0),A()(this,"screenTexture",void 0),A()(this,"particleStateTexture0",void 0),A()(this,"particleStateTexture1",void 0),A()(this,"windTexture",void 0),A()(this,"windData",void 0),this.gl=t.glContext,this.width=t.imageWidth,this.height=t.imageHeight,this.fadeOpacity=t.fadeOpacity,this.speedFactor=t.speedFactor,this.dropRate=t.dropRate,this.dropRateBump=t.dropRateBump,this.rampColors=t.rampColors,this.init()}return f()(e,[{key:"init",value:function(){var e=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=ye(e,"\n precision mediump float;\n\n attribute float a_index;\n\n uniform sampler2D u_particles;\n uniform float u_particles_res;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec4 color = texture2D(u_particles, vec2(\n         fract(a_index / u_particles_res),\n         floor(a_index / u_particles_res) / u_particles_res)\n     );\n\n     // decode current particle position from the pixel's RGBA value\n     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n\n     gl_PointSize = 1.0;\n     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n }","\n precision mediump float;\n\n uniform sampler2D u_wind;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform sampler2D u_color_ramp;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // color ramp is encoded in a 16x16 texture\n     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);\n\n     gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n }"),this.fullScreenProgram=ye(e,"\n     precision mediump float;\n\n     attribute vec2 a_pos;\n\n     varying vec2 v_tex_pos;\n\n     void main() {\n         v_tex_pos = a_pos;\n         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);\n         gl_PointSize = 100.0;\n }","\n precision mediump float;\n\n uniform sampler2D u_screen;\n uniform float u_opacity;\n varying vec2 v_tex_pos;\n\n void main() {\n     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n\n     // a hack to guarantee opacity fade out even with a value close to 1.0\n     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n }"),this.updateProgram=ye(e,"\n precision mediump float;\n\n attribute vec2 a_pos;\n\n varying vec2 v_tex_pos;\n\n void main() {\n     v_tex_pos = a_pos;\n     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n     // framebuffer 始终用铺满屏幕的 texture\n }","\n precision highp float;\n\n uniform sampler2D u_particles;\n uniform sampler2D u_wind;\n uniform vec2 u_wind_res;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform float u_rand_seed;\n uniform float u_speed_factor;\n uniform float u_drop_rate;\n uniform float u_drop_rate_bump;\n\n varying vec2 v_tex_pos;\n\n // pseudo-random generator\n const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n float rand(const vec2 co) {\n float t = dot(rand_constants.xy, co);\n     return fract(sin(t) * (rand_constants.z + t));\n }\n\n // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n vec2 lookup_wind(const vec2 uv) {\n     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n     vec2 px = 1.0 / u_wind_res;\n     vec2 vc = (floor(uv * u_wind_res)) * px;\n     vec2 f = fract(uv * u_wind_res);\n     vec2 tl = texture2D(u_wind, vc).rg;\n     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n     vec2 br = texture2D(u_wind, vc + px).rg;\n     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n }\n\n void main() {\n     vec4 color = texture2D(u_particles, v_tex_pos);\n     vec2 pos = vec2(\n         color.r / 255.0 + color.b,\n         color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // take EPSG:4236 distortion into account for calculating where the particle moved\n     float distortion = cos(radians(pos.y * 180.0 - 90.0));\n     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n\n     // update particle position, wrapping around the date line\n     pos = fract(1.0 + pos + offset);\n\n     // a random seed to use for the particle drop\n     vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n\n     // drop rate is a chance a particle will restart at random position, to avoid degeneration\n     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n     float drop = step(1.0 - drop_rate, rand(seed));\n\n     vec2 random_pos = vec2(\n         rand(seed + 1.3),\n         rand(seed + 2.1));\n         pos = mix(pos, random_pos, drop);\n\n     // encode the new particle position back into RGBA\n     gl_FragColor = vec4(\n         fract(pos * 255.0),\n         floor(pos * 255.0) / 255.0);\n }"),this.quadBuffer=Ee(e,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=e.createFramebuffer(),this.colorRampTexture=be(this.gl,this.gl.LINEAR,Se(this.rampColors),16,16);var t=new Uint8Array(this.width*this.height*4);this.backgroundTexture=be(e,e.NEAREST,t,this.width,this.height),this.screenTexture=be(e,e.NEAREST,t,this.width,this.height);var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=be(e,e.NEAREST,r,n,n),this.particleStateTexture1=be(e,e.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=Ee(e,o)}},{key:"setWind",value:function(e){var t,n,r,i;this.windData=e,this.windTexture=(t=this.gl,n=this.gl.LINEAR,r=e.image,i=t.createTexture(),t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.bindTexture(t.TEXTURE_2D,null),i)}},{key:"updateParticelNum",value:function(e){var t=this.gl;if(e!==this.numParticles){this.numParticles=e;var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=be(t,t.NEAREST,r,n,n),this.particleStateTexture1=be(t,t.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=Ee(t,o)}}},{key:"updateWindDir",value:function(e,t,n,r){this.windData.uMin=e,this.windData.uMax=t,this.windData.vMin=n,this.windData.vMax=r}},{key:"updateColorRampTexture",value:function(e){if(this.isColorChanged(e)){this.rampColors=e;var t=this.gl;t.deleteTexture(this.colorRampTexture),this.colorRampTexture=be(t,t.LINEAR,Se(e),16,16)}}},{key:"isColorChanged",value:function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=Number(r);if(!this.rampColors[i])return!0;if(this.rampColors[i]&&this.rampColors[i]!==e[i])return!0}return!1}},{key:"reSize",value:function(e,t){if(e!==this.width||t!==this.height){var n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=e,this.height=t;var r=new Uint8Array(e*t*4);this.backgroundTexture=be(n,n.NEAREST,r,e,t),this.screenTexture=be(n,n.NEAREST,r,e,t)}}},{key:"draw",value:function(){var e;if(null!==(e=this.windData)&&void 0!==e&&e.image){var t=this.gl;return xe(t,this.windTexture,0),xe(t,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}},{key:"drawScreen",value:function(){var e=this.gl;Te(e,this.framebuffer,this.screenTexture),e.viewport(0,0,this.width,this.height),e.disable(e.BLEND),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),this.pixels=new Uint8Array(4*this.width*this.height),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.pixels),Te(e,null,null),e.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var t=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=t}},{key:"drawFullTexture",value:function(e,t){var n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),xe(n,e,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,t),n.drawArrays(n.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var e=this.gl,t=this.drawProgram;e.useProgram(t),Ae(e,this.particleIndexBuffer,t.a_index,1),xe(e,this.colorRampTexture,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1i(t.u_color_ramp,2),e.uniform1f(t.u_particles_res,this.particleStateResolution),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.drawArrays(e.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var e=this.gl;Te(e,this.framebuffer,this.particleStateTexture1),e.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var t=this.updateProgram;e.useProgram(t),Ae(e,this.quadBuffer,t.a_pos,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1f(t.u_rand_seed,Math.random()),e.uniform2f(t.u_wind_res,2*this.windData.image.width,2*this.windData.image.height),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.uniform1f(t.u_speed_factor,this.speedFactor),e.uniform1f(t.u_drop_rate,this.dropRate),e.uniform1f(t.u_drop_rate_bump,this.dropRateBump),e.drawArrays(e.TRIANGLES,0,6);var n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,Te(e,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}]),e}(),we={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"},Re=function(e){b()(i,e);var t,n,r=E()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),A()(d()(e),"texture",void 0),A()(d()(e),"colorModel",void 0),A()(d()(e),"wind",void 0),A()(d()(e),"imageCoords",void 0),A()(d()(e),"sizeScale",.5),A()(d()(e),"frequency",new D.iH(7.2)),A()(d()(e),"cacheZoom",void 0),e}return f()(i,[{key:"render",value:function(e){var t=this;this.drawColorMode(e),this.frequency.run((function(){t.drawWind()}))}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l,c,h,f,p,d,v,m,g,y,_,b,x,E,S,A,T,C,w,R,M=this;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.layer.getLayerConfig(),i=r.uMin,o=void 0===i?-21.32:i,s=r.uMax,u=void 0===s?26.8:s,l=r.vMin,c=void 0===l?-21.57:l,h=r.vMax,f=void 0===h?21.42:h,p=r.fadeOpacity,d=void 0===p?.996:p,v=r.speedFactor,m=void 0===v?.25:v,g=r.dropRate,y=void 0===g?.003:g,_=r.dropRateBump,b=void 0===_?.01:_,x=r.rampColors,E=void 0===x?we:x,S=r.sizeScale,A=void 0===S?.5:S,T=this.rendererService.createTexture2D,C=this.layer.getSource(),this.texture=T({height:0,width:0}),this.cacheZoom=Math.floor(this.mapService.getZoom()),w=this.rendererService.getGLContext(),this.imageCoords=null===(t=C.data)||void 0===t?void 0:t.dataArray[0].coordinates,null===(n=C.data)||void 0===n||null===(n=n.images)||void 0===n||n.then((function(e){var t;M.sizeScale=A*M.getZoomScale();var n=M.getWindSize(),r=n.imageWidth,i=n.imageHeight,a={glContext:w,imageWidth:r,imageHeight:i,fadeOpacity:d,speedFactor:m,dropRate:y,dropRateBump:b,rampColors:E};M.wind=new Ce(a),M.wind.setWind({uMin:o,uMax:u,vMin:c,vMax:f,image:e[0]}),null===(t=M.texture)||void 0===t||t.destroy(),M.texture=T({width:r,height:i}),M.layerService.reRender()})),e.next=10,this.layer.buildLayerModel({moduleName:"wind",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\n\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:B.iC,primitive:N.gl.TRIANGLES,depth:{enable:!1}});case 10:return R=e.sent,this.colorModel=R,e.abrupt("return",[R]);case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getWindSize",value:function(){var e=this.mapService.lngLatToPixel(this.imageCoords[0]),t=this.mapService.lngLatToPixel(this.imageCoords[1]);return{imageWidth:Math.min(Math.floor((t.x-e.x)*this.sizeScale),2048),imageHeight:Math.min(Math.floor((e.y-t.y)*this.sizeScale),2048)}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.wind)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"getZoomScale",value:function(){return Math.min((this.cacheZoom+4)/30*2,2)}},{key:"drawWind",value:function(){if(this.wind){var e=this.layer.getLayerConfig(),t=e.uMin,n=void 0===t?-21.32:t,r=e.uMax,i=void 0===r?26.8:r,o=e.vMin,a=void 0===o?-21.57:o,s=e.vMax,u=void 0===s?21.42:s,l=e.numParticles,c=void 0===l?65535:l,h=e.fadeOpacity,f=void 0===h?.996:h,p=e.speedFactor,d=void 0===p?.25:p,v=e.dropRate,m=void 0===v?.003:v,g=e.dropRateBump,y=void 0===g?.01:g,_=e.rampColors,b=void 0===_?we:_,x=e.sizeScale,E=void 0===x?.5:x,S=c,A=Math.floor(this.mapService.getZoom());if("number"==typeof E&&E!==this.sizeScale||A!==this.cacheZoom){var T=this.getZoomScale();this.sizeScale=E,S*=T;var C=this.getWindSize(),w=C.imageWidth,R=C.imageHeight;this.wind.reSize(w,R),this.cacheZoom=A}this.wind.updateWindDir(n,i,a,u),this.wind.updateParticelNum(S),this.wind.updateColorRampTexture(b),this.wind.fadeOpacity=f,this.wind.speedFactor=d,this.wind.dropRate=m,this.wind.dropRateBump=y;var M=this.wind.draw(),k=M.d,L=M.w,O=M.h;this.rendererService.setBaseState(),this.texture.update({data:k,width:L,height:O})}}},{key:"drawColorMode",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.layer.getLayerConfig(),r=n.opacity;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),this.layerService.renderMask(this.layer.masks),null===(e=this.colorModel)||void 0===e||e.draw({uniforms:{u_opacity:r||1,u_texture:this.texture},blend:this.getBlend(),stencil:this.getStencil(t)}),this.layer.hooks.afterRender.call()}}]),i}(R.Z),Me={wind:Re},ke=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","WindLayer"),e}return f()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new Me[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"renderModels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.layerModel&&this.layerModel.render(e),this}},{key:"getDefaultConfig",value:function(){return{wind:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"wind"}}]),r}(T.Z)},5122:function(e,t,n){"use strict";n.d(t,{Z:function(){return Q}});var r=n(1448),i=n.n(r),o=n(9558),a=n.n(o),s=n(9989),u=n.n(s),l=n(4528),c=n.n(l),h=n(8798),f=n.n(h),p=n(6626),d=n.n(p),v=n(7267),m=n.n(v),g=n(9913),y=n.n(g),_=n(9057),b=n.n(_),x=n(3301),E=n(3292),S=n(6490),A=n(2606),T=n(4889),C=n(6999),w={solid:0,dash:1},R=function(e){m()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"texture",void 0),b()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:E.gl.NEAREST,min:E.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128}),e.textures=[e.texture]})),e}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5]:s,l=e.forward,c=void 0===l||l,h=e.lineTexture,f=void 0!==h&&h,p=e.iconStep,d=void 0===p?100:p,v=e.segmentNumber,m=void 0===v?30:v,g=this.layer.getLayerConfig().animateOption,y=u;"dash"!==a&&(y=[0,0]),2===y.length&&y.push(0,0);var _,b=0,x=[0,0,0,0],E=[0,0,0,0];(t&&n&&(x=(0,S.CI)(t),E=(0,S.CI)(n),b=1),this.rendererService.getDirty())&&(null===(_=this.texture)||void 0===_||_.bind());var A={u_animate:this.animateOption2Array(g),u_dash_array:y,u_sourceColor:x,u_targetColor:E,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:m,u_lineDir:c?1:-1,u_icon_step:d,u_line_texture:f?1:0,u_textureBlend:"normal"===i?0:1,u_blur:.9,u_line_type:w[a||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:b};return this.getUniformsBufferInfo(A)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:'\n#define Animate 0.0\n#define LineTexture 1.0\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_lineDir: 1.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_blur : 0.9;\n  float u_line_type: 0.0;\n  float u_time;\n  float u_linearColor: 0.0;\n};\n\nin vec4 v_color;\nin vec2 v_iconMapUV;\nin vec4 v_lineData;\n//dash\nin vec4 v_dash_array;\nin float v_distance_ratio;\n\nout vec4 outputColor;\n#pragma include "picking"\n\nvoid main() {\n  if(u_dash_array!=vec4(0.0)){\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {\n      discard;\n    };\n  }\n  float animateSpeed = 0.0; // 运动速度\n  outputColor = v_color;\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      outputColor.a *= alpha;\n  }\n\n  // 当存在贴图时在底色上贴上贴图\n  if(u_line_texture == LineTexture) { // while load texture\n    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));\n    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);\n\n    float count = v_lineData.g; // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n    float v = v_lineData.a; // 横向 v\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = filterColor(pattern);\n    }\n    \n  } else {\n     outputColor = filterColor(outputColor);\n  }\n}',vert:'#define Animate 0.0\n#define LineTexture 1.0\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 12) in vec4 a_Instance;\nlayout(location = 14) in vec2 a_iconMapUV;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_lineDir: 1.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_blur : 0.9;\n  float u_line_type: 0.0;\n  float u_time;\n  float u_linearColor: 0.0;\n};\nout vec4 v_color;\nout vec2 v_iconMapUV;\nout vec4 v_lineData;\n//dash\nout vec4 v_dash_array;\nout float v_distance_ratio;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    // dash: index / (segmentNumber - 1.);\n    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    //  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  //vs中计算渐变色\n  if(u_linearColor==1.0){\n    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  }\n  else{\n    v_color = a_Color;\n  }\n  v_color.a = v_color.a * opacity;\n\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n\n\n\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  //计算dashArray和distanceRatio 输出到片元\n  vec2 s = source;\n  vec2 t = target;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    s = unProjCustomCoord(source);\n    t = unProjCustomCoord(target);\n  }\n  float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  v_distance_ratio = segmentIndex / segmentNumber;\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  \n  if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n      if(u_lineDir != 1.0) {\n        d_distance_ratio = 1.0 - d_distance_ratio;\n      }\n  }\n\n  v_lineData.b = d_distance_ratio;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));\n\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n  v_lineData.r = d_segmentIndex;\n\n  if(LineTexture == u_line_texture) { // 开启贴图模式\n\n    float arcDistrance = length(source - target); // 起始点和终点的距离\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      arcDistrance *= 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      // arcDistrance *= 8.0;\n      arcDistrance = project_pixel_allmap(arcDistrance);\n    }\n    v_iconMapUV = a_iconMapUV;\n\n    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变\n    float texCount = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n    v_lineData.g = texCount;\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size); // 定点位置偏移\n    v_lineData.a = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  }\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,s=i.vert,u=i.type,e.next=5,this.layer.buildLayerModel({moduleName:"lineArc2d"+u,vertexShader:s,fragmentShader:o,inject:this.getInject(),triangulation:C.$4,depth:{enable:!1},styleOption:{segmentNumber:r}});case 5:return l=e.sent,e.abrupt("return",[l]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:T.q.SIZE,buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:E.AttributeType.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(A.Z),M=n(9119),k={solid:0,dash:1},L=function(e){m()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"texture",void 0),b()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:E.gl.NEAREST,min:E.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128}),e.textures=[e.texture]})),e}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5]:s,l=e.lineTexture,c=void 0!==l&&l,h=e.iconStep,f=void 0===h?100:h,p=e.segmentNumber,d=void 0===p?30:p,v=e.globalArcHeight,m=void 0===v?10:v,g=this.layer.getLayerConfig().animateOption;2===u.length&&u.push(0,0);var y,_=0,b=[0,0,0,0],x=[0,0,0,0];(t&&n&&(b=(0,S.CI)(t),x=(0,S.CI)(n),_=1),this.rendererService.getDirty())&&(null===(y=this.texture)||void 0===y||y.bind());var E={u_animate:this.animateOption2Array(g),u_dash_array:u,u_sourceColor:b,u_targetColor:x,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:M.Y5,u_global_height:m,segmentNumber:d,u_line_type:k[a]||0,u_icon_step:f,u_line_texture:c?1:0,u_textureBlend:"normal"===i?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:_};return this.getUniformsBufferInfo(E)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform sampler2D u_texture;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_globel;\n  float u_globel_radius;\n  float u_global_height: 10;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0.0;\n};\n\n// varying vec2 v_normal;\nin vec4 v_dash_array;\nin vec4 v_color;\nin vec4 v_line_data;\nin float v_segmentIndex;\nin vec2 v_iconMapUV;\n\nout vec4 outputColor;\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例\n  outputColor = v_color;\n\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    outputColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      outputColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          outputColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 12) in vec4 a_Instance;\nlayout(location = 14) in vec2 a_iconMapUV;\n\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_globel;\n  float u_globel_radius;\n  float u_global_height: 10;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0.0;\n};\nout vec4 v_color;\nout vec4 v_dash_array;\nout float v_segmentIndex;\nout vec2 v_iconMapUV;\nout vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  //vs中计算渐变色\n  if(u_linearColor==1.0){\n    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  }\n  else{\n    v_color = a_Color;\n  }\n  v_color.a = v_color.a * opacity;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,s=i.vert,u=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+u,vertexShader:s,fragmentShader:o,inject:this.getInject(),triangulation:C.$4,styleOption:{segmentNumber:r}});case 4:return l=e.sent,e.abrupt("return",[l]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:T.q.SIZE,buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:E.AttributeType.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(A.Z),O=n(4479),P=n.n(O),I=n(5570),N=n.n(I),D=n(3365),B=n(4778),F=n.n(B),U={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},z=.5;function G(e,t){var n="object"===N()(e)?e.type:e,r="source"===t?1:-1,i="object"===N()(e)?e:{};switch(n){case"circle":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?2:i,a=(0,D.Xw)(),s=F().flatten([a]),u=F()(s.vertices,s.holes,s.dimensions),l=a.map((function(t){return[t[0]*r*e,t[1]*o]})).flat();return{vertices:[].concat(P()(l),P()(l)),dimensions:2,indices:u.map((function(e){return e+a.length})),outLineIndices:u,normals:[].concat(P()(a.map((function(t){return[t[1]*o,t[0]*r*e,1]})).flat()),P()(new Array(3*a.length).fill(0)))}}(r,i);case"triangle":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?3:i;return{vertices:[0,0,1*e*r,1*o,1*e*r,-1*o,0,0,1*e*r,1*o,1*e*r,-1*o],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}(r,i);case"diamond":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?3:i;return{vertices:[0,0,1*r*e,.5*o,2*r*e,0,1*r*e,-.5*o,0,0,1*r*e,.5*o,2*r*e,0,1*r*e,-.5*o],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}(r,i);case"rect":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?2:i;return{vertices:[0,o/2,e*r*1,o/2,e*r*1,-o/2,0,-o/2,0,o/2,e*r*1,o/2,e*r*1,-o/2,0,-o/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}(r,i);case"classic":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?3:i;return{vertices:[0,0,2*e*r,1*o,1.5*e*r,0,2*e*r,-1*o,0,0,2*e*r,1*o,1.5*e*r,0,2*e*r,-1*o],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}(r,i);case"halfTriangle":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?1:i;return{vertices:[0,z*e,1*e*r,-(o+z)*e,1*e*r,(o-z)*e,0,z*e,1*e*r,-(o+z)*e,1*e*r,(o-z)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}(r,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function j(e,t){return t?function(e,t){var n=e.coordinates.flat(),r=t,i=r.target,o=void 0===i?"classic":i,a=r.source,s=V(G(void 0===a?"circle":a,"source"),n,0,0),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r="object"===N()(n.source)?n.source.type:n.source,i="object"===N()(n.target)?n.target.type:n.target,o="object"===N()(n.source)?n.source:{},a=o.width,s=void 0===a?r?U[r]:0:a,u=("object"===N()(n.target)?n.target:{}).width,l=void 0===u?i?U[i]:0:u;return{vertices:[0,z,1*s].concat(P()(e),[1,z,-1*l],P()(e),[1,-z,-1*l],P()(e),[0,-z,1*s],P()(e),[0,z,1*s],P()(e),[1,z,-1*l],P()(e),[1,-z,-1*l],P()(e),[0,-z,1*s],P()(e)),outLineIndices:[0,1,2,0,2,3].map((function(e){return e+t})),indices:[4,5,6,4,6,7].map((function(e){return e+t})),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}(n,s.vertices.length/7,t),l=V(G(o,"target"),n,1,s.vertices.length/7+u.vertices.length/7);return{vertices:[].concat(P()(s.vertices),P()(u.vertices),P()(l.vertices)),indices:[].concat(P()(s.outLineIndices),P()(u.outLineIndices),P()(l.outLineIndices),P()(s.indices),P()(u.indices),P()(l.indices)),normals:[].concat(P()(s.normals),P()(u.normals),P()(l.normals)),size:7}}(e,t):function(e){var t=e.coordinates.flat();return{vertices:[1,0,0].concat(P()(t),[1,2,-3],P()(t),[1,1,-3],P()(t),[0,1,0],P()(t),[0,0,0],P()(t),[1,0,0],P()(t),[1,2,-3],P()(t),[1,1,-3],P()(t),[0,1,0],P()(t),[0,0,0],P()(t)),normals:[-1,2,1,2,-1,1,1,-1,1,1,-1,1,-1,-1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}(e)}function V(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=[],a=e.vertices,s=e.indices,u=e.dimensions,l=e.outLineIndices,c=0;c<a.length;c+=u)o.push.apply(o,[n,a[c+1],a[c]].concat(P()(t)));return i()(i()({},e),{},{vertices:o,indices:s.map((function(e){return e+r})),outLineIndices:l.map((function(e){return e+r}))})}var H=function(e){m()(i,e);var t,n,r=y()(i);function i(){return c()(this,i),r.apply(this,arguments)}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.gapWidth,n=void 0===t?2:t,r=e.strokeWidth,i=void 0===r?1:r,o=e.strokeOpacity,a={u_gap_width:n,u_stroke_width:i,u_stroke_opacity:void 0===o?1:o};return this.getUniformsBufferInfo(a)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in vec2 a_Size;\nlayout(location = 12) in vec4 a_Instance;\nlayout(location = 13) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniorm {\n  float u_gap_width: 1.0;\n  float u_stroke_width: 1.0;\n  float u_stroke_opacity: 1.0;\n};\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nout vec4 v_color;\n\nvec2 project_pixel_offset(vec2 offsets) {\n\n   vec2 data = project_pixel(offsets);\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return data;\n  }\n\n  return vec2(data.x, -data.y);;\n}\n\nvec2 line_dir(vec2 target, vec2 source) {\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n     return normalize(target - source);\n  }\n  return normalize(ProjectFlat(target) - ProjectFlat(source));\n}\n\nfloat flag_gap() {\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n     return 1.;\n  }\n  return -1.;\n\n}\n\n\nvoid main() {\n\n// 透明度计算\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  vec2 flowlineDir = line_dir(target,source);\n  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x); // mapbox || 高德\n   \n  vec2 position = mix(source, target, a_Position.x);\n  \n  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    \n  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || 高德\n  vec2 limitedOffsetDistances = clamp(   \n   offsetDistances,\n   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)\n  );\n\n\n  float startOffsetCommon = project_pixel(offsets[0]);\n  float endOffsetCommon = project_pixel(offsets[1]);\n  float endpointOffset = mix(\n    clamp(startOffsetCommon, 0.0, lengthCommon*.2),\n    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),\n    a_Position.x\n  );\n\n  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || 高德\n\n  float gapCommon = flag_gap() * project_pixel(u_gap_width);\n  vec3 offsetCommon = vec3(\n    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\n    perpendicularDir *  (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n    0.0\n  );\n\n  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));\n\n  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);\n  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'// #extension GL_OES_standard_derivatives : enable\n\nin vec4 v_color;\nout vec4 outputColor;\n\n\n// line texture\n\n#pragma include "picking"\n\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',inject:this.getInject(),triangulation:j,styleOption:this.layer.getLayerConfig().symbol,primitive:E.gl.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:T.q.SIZE,buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:E.AttributeType.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:E.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:T.q.NORMAL,buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}})}}]),i}(A.Z),W={solid:0,dash:1},Z=function(e){m()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"texture",void 0),b()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:E.gl.NEAREST,min:E.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128}),e.textures=[e.texture]})),e}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e,t=this.layer.getLayerConfig(),n=t.sourceColor,r=t.targetColor,i=t.textureBlend,o=void 0===i?"normal":i,a=t.lineType,s=void 0===a?"solid":a,u=t.dashArray,l=void 0===u?[10,5]:u,c=t.lineTexture,h=void 0!==c&&c,f=t.iconStep,p=void 0===f?100:f,d=t.segmentNumber,v=void 0===d?30:d,m=this.layer.getLayerConfig().animateOption;(2===l.length&&l.push(0,0),this.rendererService.getDirty())&&(null===(e=this.texture)||void 0===e||e.bind());var g=0,y=[0,0,0,0],_=[0,0,0,0];n&&r&&(y=(0,S.CI)(n),_=(0,S.CI)(r),g=1);var b=this.layer.getLayerAnimateTime();isNaN(b)&&(b=0);var x={u_animate:this.animateOption2Array(m),u_dash_array:l,u_sourceColor:y,u_targetColor:_,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:v,u_line_type:W[s]||0,u_icon_step:p,u_line_texture:h?1:0,u_textureBlend:"normal"===o?0:1,u_time:b,u_linearColor:g};return this.getUniformsBufferInfo(x)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,e.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 12) in vec4 a_Instance;\nlayout(location = 14) in vec2 a_iconMapUV;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0;\n};\n\nout vec4 v_dash_array;\nout vec4 v_color;\nout vec2 v_iconMapUV;\nout vec4 v_line_data;\nout float v_distance_ratio;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return index / (segmentNumber - 1.);\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n  mix(source, target, segmentRatio),\n  sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = 0.314;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  return mid;\n}\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    vec2 mid = midPoint(source, target);\n    vec3 x = vec3(source.x, mid.x, target.x);\n    vec3 y = vec3(source.y, mid.y, target.y);\n    return vec2(bezier3(x ,t), bezier3(y,t));\n  }\n  else {\n    if(abs(angularDist - PI) < 0.001) {\n      return (1.0 - t) * source + t * target;\n    }\n    float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n    float b = sin(t * angularDist) / sin(angularDist);\n    vec2 sin_source = sin(source);\n    vec2 cos_source = cos(source);\n    vec2 sin_target = sin(target);\n    vec2 cos_target = cos(target);\n    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n    float z = a * sin_source.y + b * sin_target.y;\n    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n  }\n}\n\nvoid main() {\n  v_color = a_Color;\n  v_color.a = v_color.a * opacity;\n  vec2 source = radians(a_Instance.rg);\n  vec2 target = radians(a_Instance.ba);\n  float angularDist = getAngularDist(source, target);\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  if(u_line_type == LineTypeDash) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    total_Distance = total_Distance*16.0; // total_Distance*16.0 调整默认的效果\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  }\n\n  if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  v_distance_ratio = segmentIndex / segmentNumber;\n  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\n  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n\n  v_line_data.g = a_Position.x; // 该顶点在弧线上的分段排序\n  if(LineTexture == u_line_texture) { // 开启贴图模式  \n    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;\n    float d_arcDistrance = length(source - target);\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      d_arcDistrance = d_arcDistrance * 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      d_arcDistrance = project_pixel_allmap(d_arcDistrance);\n    }\n    float d_pixelLen = project_pixel(u_icon_step)/8.0;\n    v_line_data.b = floor(d_arcDistrance/d_pixelLen); // 贴图在弧线上重复的数量\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));\n  setPickingColor(a_PickingColor);\n}\n\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0;\n};\n\nin vec4 v_line_data;\nin vec2 v_iconMapUV;\nin vec4 v_dash_array;\nin float v_distance_ratio;\nin vec4 v_color;\n\nout vec4 outputColor;\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\n\nvoid main() {\n\n  float animateSpeed = 0.0;\n  float d_segmentIndex = v_line_data.g;\n  \n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n    outputColor.a *= v_color.a;\n  } else { // 使用 color 方法传入的颜色\n    outputColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  if(u_line_type == LineTypeDash) {\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      // 实线部分\n    } else {\n      // 虚线部分\n      discard;\n    };\n  }\n\n  // 设置弧线的动画模式\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      outputColor.a *= alpha;\n  }\n\n  // 设置弧线的贴图\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\n    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // 贴图在弧线上重复的数量\n    float u = fract(arcRadio * count - animateSpeed * count);\n    // float u = fract(arcRadio * count - animateSpeed);\n    if(u_animate.x == Animate) {\n      u = outputColor.a/v_color.a;\n    }\n\n    float v = v_line_data.a; // 线图层贴图部分的 v 坐标值\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n    \n    // 设置贴图和底色的叠加模式\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = filterColor(pattern);\n    }\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n\n  // gl_FragColor = filterColor(gl_FragColor);\n}',triangulation:C.$4,styleOption:{segmentNumber:r},inject:this.getInject(),depth:{enable:!1}});case 3:return i=e.sent,e.abrupt("return",[i]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:T.q.SIZE,buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:E.AttributeType.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(A.Z),X=n(9262),Y=function(e){m()(i,e);var t,n,r=y()(i);function i(){return c()(this,i),r.apply(this,arguments)}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.lineType,i=void 0===r?"solid":r,o=e.dashArray,a=void 0===o?[10,5,0,0]:o,s=e.vertexHeightScale,u=void 0===s?20:s,l=a;"dash"!==i&&(l=[0,0,0,0]),2===l.length&&l.push(0,0);var c=0,h=[0,0,0,0],f=[0,0,0,0];t&&n&&(h=(0,S.CI)(t),f=(0,S.CI)(n),c=1);var p={u_sourceColor:h,u_targetColor:f,u_dash_array:l,u_vertexScale:u,u_linearColor:c};return this.getUniformsBufferInfo(p)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:"\nlayout(std140) uniform commonUniorm {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec4 u_dash_array;\n  float u_vertexScale: 1.0;\n  float u_linearColor: 0;\n};\nin float v_distanceScale;\nin vec4 v_color;\n//dash\nin vec4 v_dash_array;\n\nout vec4 outputColor;\nvoid main() {\n  if(u_dash_array!=vec4(0.0)){\n    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {\n      // 虚线部分\n      discard;\n    };\n  }\n  if(u_linearColor==1.0){\n    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);\n    outputColor.a *= v_color.a; // 全局透明度\n  }\n  else{\n    outputColor = v_color;\n  }\n}\n",vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in vec4 a_SizeDistanceAndTotalDistance;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec4 u_dash_array;\n  float u_vertexScale: 1.0;\n  float u_linearColor: 0;\n};\n\n#pragma include "projection"\n#pragma include "picking"\n\nout vec4 v_color;\nout float v_distanceScale;\nout vec4 v_dash_array;\n\nvoid main() {\n  //dash输出\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;\n\n  v_color = a_Color; \n  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;\n  v_color.a = v_color.a * opacity;\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_SizeDistanceAndTotalDistance.y) + h * 0.2, 1.0));\n  } else {\n    float lineHeight = a_SizeDistanceAndTotalDistance.y;\n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // 保持高度相对不变\n      h *= 2.0/pow(2.0, 20.0 - u_Zoom);\n    }\n\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // 保持高度相对不变\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\n    gl_PointSize = 10.0;\n  }\n}\n',type:"lineSimpleNormal"}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),t=this.getShaders(),n=t.frag,r=t.vert,i=t.type,e.next=4,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,triangulation:C.us,inject:this.getInject(),primitive:E.gl.LINES,depth:{enable:!1},pick:!1});case 4:return o=e.sent,e.abrupt("return",[o]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:E.AttributeType.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:T.q.SIZE,buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:4,update:function(e,t,n){var r=e.size,i=void 0===r?1:r,o=Array.isArray(i)?[i[0],i[1]]:[i,0];return[o[0],o[1],n[3],n[5]]}}})}}]),i}(A.Z),q=function(e){m()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"texture",void 0),b()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:E.gl.NEAREST,min:E.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128}),e.textures=[e.texture]})),e}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e,t=this.layer.getLayerConfig(),n=t.sourceColor,r=t.targetColor,i=t.textureBlend,o=void 0===i?"normal":i,a=t.heightfixed,s=void 0!==a&&a,u=t.lineTexture,l=void 0!==u&&u,c=t.iconStep,h=void 0===c?100:c,f=t.iconStepCount,p=void 0===f?1:f,d=this.layer.getLayerConfig().animateOption;this.rendererService.getDirty()&&(null===(e=this.texture)||void 0===e||e.bind());var v=0,m=[0,0,0,0],g=[0,0,0,0];n&&r&&(m=(0,S.CI)(n),g=(0,S.CI)(r),v=1);var y={u_animate:this.animateOption2Array(d),u_sourceColor:m,u_targetColor:g,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:h,u_heightfixed:Number(s),u_linearColor:v,u_line_texture:l?1:0,u_textureBlend:"normal"===o?0:1,u_iconStepCount:p,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(y)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:'#define Animate 0.0\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in vec2 a_Size;\nlayout(location = 10) in float a_Miter;\nlayout(location = 11) in float a_Total_Distance;\nlayout(location = 12) in vec4 a_Instance;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec2 a_iconMapUV;\nlayout(location = 15) in float a_Distance;\n\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed;\n  float u_linearColor: 0;\n  float u_line_texture;\n  float u_textureBlend;\n  float u_iconStepCount;\n  float u_time;\n};\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nout vec2 v_iconMapUV;\nout vec4 v_color;\nout float v_blur;\nout float v_radio;\nout vec4 v_dataset;\n\nvoid main() {\n\n\n  float d_distance_ratio; // 当前点位距离占线总长的比例\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    d_texPixelLen = project_pixel(u_icon_step);\n  } else {\n    d_texPixelLen = u_icon_step;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  if(u_animate.x == Animate || u_linearColor == 1.0) {\n      d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n\n  float miter = (a_Miter + 1.0)/2.0;\n  // 设置数据集的参数\n  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例\n  v_dataset[1] = a_Distance;       // 当前顶点的距离\n  v_dataset[2] = d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  v_dataset[3] = miter;          // 线图层贴图部分的 v 坐标值 0 - 1\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float originSize = a_Size.x;  // 固定高度\n  if(u_heightfixed < 1.0) {    \n     originSize = project_float_meter(a_Size.x); // 高度随 zoom 调整\n  }\n\n\n  float wallHeight = originSize * miter;\n  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\n\n  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n  } else {\n// 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n      if(u_heightfixed > 0.0) {\n        wallHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        wallHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define Animate 0.0\n#define LineTexture 1.0\n\n// line texture\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed;\n  float u_linearColor: 0;\n  float u_line_texture;\n  float u_textureBlend;\n  float u_iconStepCount;\n  float u_time;\n};\nin vec2 v_iconMapUV;\nin float v_blur;\nin float v_radio;\nin vec4 v_color;\nin vec4 v_dataset;\n\nout vec4 outputColor;\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例\n  float v = v_dataset.a;\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    outputColor = mix(u_sourceColor, u_targetColor, v);\n  } else { // 使用 color 方法传入的颜色\n     outputColor = v_color;\n  }\n\n  outputColor.a *= v_color.a; // 全局透明度\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      outputColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_dataset.g;      // 当前顶点的距离\n    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值\n\n    // 计算纹理间隔 start\n    float flag = 0.0;\n    if(u > 1.0/u_iconStepCount) {\n      flag = 1.0;\n    }\n    u = fract(u*u_iconStepCount);\n    // 计算纹理间隔 end\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    // Tip: 判断纹理间隔\n    if(flag > 0.0) {\n      pattern = vec4(0.0);\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = filterColor(pattern);\n    }\n  }\n  \n\n  // blur - AA\n  if(v < v_blur) {\n    outputColor.a = mix(0.0, outputColor.a, v/v_blur);\n  } else if(v > 1.0 - v_blur) {\n    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n  }\n\n  outputColor = filterColor(outputColor);\n}\n',triangulation:C.sN,inject:this.getInject(),depth:{enable:!1},blend:this.getBlend()});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:E.AttributeType.Attribute,descriptor:{name:"a_Distance",shaderLocation:15,buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(e,t,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:E.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",shaderLocation:11,buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:T.q.SIZE,buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:E.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:T.q.NORMAL,buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:E.AttributeType.Attribute,descriptor:{name:"a_Miter",shaderLocation:10,buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(A.Z),K={arc:R,arc3d:L,greatcircle:Z,wall:q,line:X.Z,simple:Y,flowline:H,earthArc3d:L},Q=function(e){m()(r,e);var t,n=y()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),b()(d()(e),"type","LineLayer"),b()(d()(e),"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),b()(d()(e),"arrowInsertCount",0),b()(d()(e),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),e}return f()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new K[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e;if(this.layerType)return this.layerType;var t=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"line"}},{key:"processData",value:function(e){if("simple"!==this.getModelType())return e;var t=[];return e.map((function(e){if(Array.isArray(e.coordinates)&&Array.isArray(e.coordinates[0])&&Array.isArray(e.coordinates[0][0])){var n=i()({},e);e.coordinates.map((function(e){t.push(i()(i()({},n),{},{coordinates:e}))}))}else t.push(e)})),t}}]),r}(x.Z)},9262:function(e,t,n){"use strict";n.d(t,{Z:function(){return w}});var r=n(4479),i=n.n(r),o=n(9558),a=n.n(o),s=n(9989),u=n.n(s),l=n(4528),c=n.n(l),h=n(8798),f=n.n(h),p=n(6626),d=n.n(p),v=n(7267),m=n.n(v),g=n(9913),y=n.n(g),_=n(9057),b=n.n(_),x=n(3292),E=n(6490),S=n(2606),A=n(5356),T=n(6999),C=n(4889),w=function(e){m()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"textureEventFlag",!1),b()(d()(e),"texture",e.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),b()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(0===e.textures.length&&(e.textures=[e.texture]),e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:x.gl.NEAREST,min:x.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return f()(o,[{key:"getCommonUniformsInfo",value:function(){var e,t=this.layer.getLayerConfig(),n=t.sourceColor,r=t.targetColor,i=t.textureBlend,o=void 0===i?"normal":i,a=t.lineType,s=void 0===a?"solid":a,u=t.dashArray,l=void 0===u?[10,5,0,0]:u,c=t.lineTexture,h=void 0!==c&&c,f=t.iconStep,p=void 0===f?100:f,d=t.vertexHeightScale,v=void 0===d?20:d,m=t.strokeWidth,g=void 0===m?0:m,y=t.raisingHeight,_=void 0===y?0:y,b=t.heightfixed,x=void 0!==b&&b,S=t.linearDir,T=void 0===S?A.cA.VERTICAL:S,C=t.blur,w=void 0===C?[1,1,1,0]:C,R=l;("dash"!==s&&(R=[0,0,0,0]),2===R.length&&R.push(0,0),this.rendererService.getDirty()&&this.texture)&&(null===(e=this.texture)||void 0===e||e.bind());var M=this.layer.getLayerConfig().animateOption,k=0,L=[0,0,0,0],O=[0,0,0,0];n&&r&&(L=(0,E.CI)(n),O=(0,E.CI)(r),k=1);var P={u_animate:this.animateOption2Array(M),u_dash_array:R,u_blur:w,u_sourceColor:L,u_targetColor:O,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:p,u_heightfixed:Number(x),u_vertexScale:v,u_raisingHeight:Number(_),u_strokeWidth:g,u_textureBlend:o===A.qy.NORMAL?0:1,u_line_texture:h?1:0,u_linearDir:T===A.cA.VERTICAL?1:0,u_linearColor:k,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(P)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0!==n&&n,i=this.getShaders(),o=i.frag,s=i.vert,u=i.type,this.layer.triangulation=T.sN,e.next=5,this.layer.buildLayerModel({moduleName:"line"+u,vertexShader:s,fragmentShader:o,triangulation:T.sN,inject:this.getInject(),depth:{enable:r}});case 5:return l=e.sent,e.abrupt("return",[l]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:'// #extension GL_OES_standard_derivatives : enable\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_blur;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed: 0.0;\n  float u_vertexScale: 1.0;\n  float u_raisingHeight: 0.0;\n  float u_strokeWidth: 0.0;\n  float u_textureBlend;\n  float u_line_texture;\n  float u_linearDir: 1.0;\n  float u_linearColor: 0;\n  float u_time;\n};\n\nin vec4 v_color;\nin vec4 v_stroke;\n// dash\nin vec4 v_dash_array;\nin float v_d_distance_ratio;\nin vec2 v_iconMapUV;\nin vec4 v_texture_data;\n\nout vec4 outputColor;\n#pragma include "picking"\n\n// [animate, duration, interval, trailLength],\nvoid main() {\n  if(u_dash_array!=vec4(0.0)){\n    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {\n      // 虚线部分\n      discard;\n    };\n  }\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_texture_data.r; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    d_distance_ratio = v_texture_data.a;\n  }\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);\n    outputColor.a *= v_color.a;\n  } else { // 使用 color 方法传入的颜色\n     outputColor = v_color;\n  }\n  // anti-alias\n  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      outputColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_texture_data.g;      // 当前顶点的距离\n    float d_texPixelLen = v_texture_data.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_texture_data.a;  // 线图层贴图部分的 v 坐标值\n\n    // v = max(smoothstep(0.95, 1.0, v), v);\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor += pattern;\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = pattern;\n    }\n  } \n\n  float v = v_texture_data.a;\n  float strokeWidth = min(0.5, u_strokeWidth);\n  // 绘制 border\n  if(strokeWidth > 0.01) {\n    float borderOuterWidth = strokeWidth / 2.0;\n\n\n    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {\n      if(v > strokeWidth) { // 外侧\n        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);\n        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);\n        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);\n      } else if(v <= strokeWidth) {\n        float linear = smoothstep(0.0, 1.0, v/strokeWidth);\n        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);\n      }\n    }\n\n    if(v < borderOuterWidth) {\n      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);\n    } else if(v > 1.0 - borderOuterWidth) {\n      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n    }\n  }\n\n  // blur\n  float blurV = v_texture_data.a;\n  if(blurV < 0.5) {\n    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);\n  } else {\n    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);\n  }\n  \n  outputColor = filterColor(outputColor);\n}\n',vert:'\n#define Animate 0.0\n\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in vec2 a_Size;\nlayout(location = 10) in vec3 a_DistanceAndIndexAndMiter;\nlayout(location = 13) in vec4 a_Normal_Total_Distance;\nlayout(location = 14) in vec2 a_iconMapUV;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_blur;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed: 0.0;\n  float u_vertexScale: 1.0;\n  float u_raisingHeight: 0.0;\n  float u_strokeWidth: 0.0;\n  float u_textureBlend;\n  float u_line_texture;\n  float u_linearDir: 1.0;\n  float u_linearColor: 0;\n  float u_time;\n};\n\n\nout vec4 v_color;\nout vec4 v_stroke;\n//dash\nout vec4 v_dash_array;\nout float v_d_distance_ratio;\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nout vec2 v_iconMapUV;\nout vec4 v_texture_data;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;\n  float a_Miter = a_DistanceAndIndexAndMiter.z;\n  vec3 a_Normal = a_Normal_Total_Distance.xyz;\n  float a_Total_Distance = a_Normal_Total_Distance.w;\n  //dash输出\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  v_iconMapUV = a_iconMapUV;\n  d_texPixelLen = project_float_pixel(u_icon_step);\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  v_color = a_Color;\n  v_color.a *= opacity;\n  v_stroke = stroke;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  \n  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);\n  // 设置数据集的参数\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:x.AttributeType.Attribute,descriptor:{name:"a_DistanceAndIndexAndMiter",shaderLocation:10,buffer:{usage:x.gl.STATIC_DRAW,data:[],type:x.gl.FLOAT},size:3,update:function(e,t,n,r,i,o){return void 0===o?[n[3],10,n[4]]:[n[3],o,n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:x.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:C.q.SIZE,buffer:{usage:x.gl.DYNAMIC_DRAW,data:[],type:x.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal_total_distance",type:x.AttributeType.Attribute,descriptor:{name:"a_Normal_Total_Distance",shaderLocation:C.q.NORMAL,buffer:{usage:x.gl.STATIC_DRAW,data:[],type:x.gl.FLOAT},size:4,update:function(e,t,n,r,o){return[].concat(i()(o),[n[5]])}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:x.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:C.q.UV,buffer:{usage:x.gl.DYNAMIC_DRAW,data:[],type:x.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),o}(S.Z)},240:function(e,t,n){"use strict";n.d(t,{Z:function(){return w}});var r=n(9558),i=n.n(r),o=n(9989),a=n.n(o),s=n(4528),u=n.n(s),l=n(8798),c=n.n(l),h=n(6626),f=n.n(h),p=n(7267),d=n.n(p),v=n(9913),m=n.n(v),g=n(9057),y=n.n(g),_=n(3301),b=n(1448),x=n.n(b),E=n(6490),S=n(2606),A=n(6999),T=function(e){d()(o,e);var t,n,r=m()(o);function o(){return u()(this,o),r.apply(this,arguments)}return c()(o,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),x()(x()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.color,i=void 0===r?"#000":r,o={u_color:(0,E.CI)(i),u_opacity:n||1};return this.getUniformsBufferInfo(o)}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"mask",vertexShader:'layout(location = 0) in vec3 a_Position;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_color;\n  float u_opacity;\n};\n\n#pragma include "projection"\n\nvoid main() {\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"layout(std140) uniform commonUniorm {\n  vec4 u_color;\n  float u_opacity;\n};\n\nout vec4 outputColor;\n\nvoid main() {\n  outputColor = u_color;\n  outputColor.a *= u_opacity;\n}\n",triangulation:A.Qr,depth:{enable:!1},pick:!1});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),o}(S.Z),C={fill:T},w=function(e){d()(r,e);var t,n=m()(r);function r(){var e;u()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),y()(f()(e),"type","MaskLayer"),e}return c()(r,[{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new C[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelType",value:function(){return"fill"}}]),r}(_.Z)},1452:function(e,t,n){"use strict";n.d(t,{Z:function(){return Y}});var r=n(6970),i=n.n(r),o=n(9558),a=n.n(o),s=n(9989),u=n.n(s),l=n(4528),c=n.n(l),h=n(8798),f=n.n(h),p=n(6626),d=n.n(p),v=n(7267),m=n.n(v),g=n(9913),y=n.n(g),_=n(9057),b=n.n(_),x=n(3301),E=n(4479),S=n.n(E),A=n(3292),T=n(2606),C=n(6490),w=n(4889);function R(e){var t=e.coordinates;return{vertices:S()(t),indices:[0],size:t.length}}var M=function(e){m()(i,e);var t,n,r=y()(i);function i(){return c()(this,i),r.apply(this,arguments)}return f()(i,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.blend,n=e.strokeOpacity,r=void 0===n?1:n,i=e.strokeWidth,o=void 0===i?0:i,a=e.stroke,s=void 0===a?"#fff":a,u={u_stroke_color:(0,C.CI)(s),u_additive:"additive"===t?1:0,u_stroke_opacity:r,u_stroke_width:o};return this.getUniformsBufferInfo(u)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=R,this.initUniformsBuffer(),e.next=4,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:'\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_stroke_color;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_stroke_width;\n};\n\nout vec4 v_color;\nout float v_blur;\nout float v_innerRadius;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_blur = 1.0 - max(2.0/a_Size, 0.05);\n  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\n  \n  vec2 offset = project_pixel(u_offsets);\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n  } else { // else\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n  }\n  \n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nlayout(std140) uniform commonUniorm {\n  vec4 u_stroke_color;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_stroke_width;\n};\n\nin vec4 v_color;\nin float v_blur;\nin float v_innerRadius;\n\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  vec2 center = vec2(0.5);\n\n  // Tip: 片元到中心点的距离 0 - 1\n  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\n  // Tip: 片元的剪切成圆形\n  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\n\n\n  if(v_innerRadius < 0.99) {\n    // 当存在 stroke 且 stroke > 0.01\n    float blurWidth = (1.0 - v_blur)/2.0;\n    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\n    if(fragmengTocenter > v_innerRadius + blurWidth) {\n      outputColor = stroke;\n    } else if(fragmengTocenter > v_innerRadius - blurWidth){\n      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\n      outputColor = mix(v_color, stroke, mixR);\n    } else {\n      outputColor = v_color;\n    }\n  } else {\n    // 当不存在 stroke 或 stroke <= 0.01\n    outputColor = v_color;\n  }\n\n  outputColor = filterColor(outputColor);\n  \n  if(u_additive > 0.0) {\n    outputColor *= circleClipOpacity;\n  } else {\n    outputColor.a *= circleClipOpacity;\n  }\n\n}\n',inject:this.getInject(),triangulation:R,depth:{enable:!1},primitive:A.gl.POINTS});case 4:return t=e.sent,e.abrupt("return",[t]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:w.q.SIZE,buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(T.Z),k=n(6999),L=n(9119),O=C.rU.isNumber,P=function(e){m()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"raiseCount",0),b()(d()(e),"raiseRepeat",0),e}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.opacity,i=void 0===r?1:r,o=e.sourceColor,a=e.targetColor,s=e.pickLight,u=void 0!==s&&s,l=e.heightfixed,c=void 0===l||l,h=e.opacityLinear,f=void 0===h?{enable:!1,dir:"up"}:h,p=e.lightEnable,d=void 0===p||p,v=0,m=[0,0,0,0],g=[0,0,0,0];if(o&&a&&(m=(0,C.CI)(o),g=(0,C.CI)(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var b={u_sourceColor:m,u_targetColor:g,u_linearColor:v,u_pickLight:Number(u),u_heightfixed:Number(c),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:O(i)?i:1,u_opacitylinear:Number(f.enable),u_opacitylinear_dir:"up"===f.dir?1:0,u_lightEnable:Number(d)};return this.getUniformsBufferInfo(b)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.animateOption.repeat,r=void 0===n?1:n,this.raiseRepeat=r,e.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in vec3 a_Size;\nlayout(location = 11) in vec3 a_Pos;\nlayout(location = 13) in vec3 a_Normal;\n\n\nlayout(std140) uniform commonUniform {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor: 0;\n  float u_heightfixed: 0.0; // 默认不固定\n  float u_globel;\n  float u_r;\n  float u_pickLight: 0.0;\n  float u_opacitylinear: 0.0;\n  float u_opacitylinear_dir: 1.0;\n  float u_lightEnable: 1.0;\n};\n\nout vec4 v_color;\nout float v_lightWeight;\nout float v_barLinearZ;\n// 用于将在顶点着色器中计算好的样式值传递给片元\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值\n  v_barLinearZ =  a_Position.z;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // 圆柱光照效果\n  float lightWeight = 1.0;\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n  v_lightWeight = lightWeight;\n  // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);\n    v_color.rgb *= lightWeight;\n  } else { // 使用 color 方法传入的颜色\n     v_color = a_Color;\n  }\n  v_color.a *= u_opacity;\n\n    \n  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度\n  //旋转矩阵mx，创建绕x轴旋转矩阵\n  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\n  float xRadian = getXRadian(a_Pos.y, r);\n  float xcos = cos(xRadian);//求解旋转角度余弦值\n  float xsin = sin(xRadian);//求解旋转角度正弦值\n  mat4 mx = mat4(\n    1,0,0,0,  \n    0,xcos,-xsin,0,  \n    0,xsin,xcos,0,  \n    0,0,0,1);\n\n  //旋转矩阵my，创建绕y轴旋转矩阵\n  float yRadian = getYRadian(a_Pos.x, a_Pos.z);\n  float ycos = cos(yRadian);//求解旋转角度余弦值\n  float ysin = sin(yRadian);//求解旋转角度正弦值\n  mat4 my = mat4(\n    ycos,0,-ysin,0,  \n    0,1,0,0,  \n    ysin,0,ycos,0,  \n    0,0,0,1);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n  \n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nin vec4 v_color;\n\n#pragma include "picking"\n\nlayout(std140) uniform commonUniform {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor: 0;\n  float u_heightfixed: 0.0; // 默认不固定\n  float u_globel;\n  float u_r;\n  float u_pickLight: 0.0;\n  float u_opacitylinear: 0.0;\n  float u_opacitylinear_dir: 1.0;\n  float u_lightEnable: 1.0;\n};\nin float v_lightWeight;\nin float v_barLinearZ;\nout vec4 outputColor;\nvoid main() {\n\n   outputColor = v_color;\n\n  // 开启透明度渐变\n  if(u_opacitylinear > 0.0) {\n    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;\n  }\n\n  // picking\n  if(u_pickLight > 0.0) {\n    outputColor = filterColorAlpha(outputColor, v_lightWeight);\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n}\n',triangulation:k.NM,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:(0,C.fj)(this.mapService.version)},blend:this.getBlend()});case 4:return i=e.sent,e.abrupt("return",[i]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:w.q.SIZE,buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:A.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:w.q.NORMAL,buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:A.AttributeType.Attribute,descriptor:{name:"a_Pos",shaderLocation:15,buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(e){var t=(0,C.SI)(e.coordinates);return(0,L.rq)([t[0],t[1]])}}})}}]),i}(T.Z),I=n(3100),N=n.n(I),D=n(1648),B=n(3311),F=function(e){m()(i,e);var t,n,r=y()(i);function i(){return c()(this,i),r.apply(this,arguments)}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.strokeOpacity,n=void 0===t?1:t,r=e.strokeWidth,i=void 0===r?0:r,o=e.blend,a=e.blur,s=void 0===a?0:a;this.layer.getLayerConfig();var u={u_additive:"additive"===o?1:0,u_stroke_opacity:n,u_stroke_width:i,u_blur:s};return this.getUniformsBufferInfo(u)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=k.S,e.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 10) in float a_Shape;\nlayout(location = 11) in vec3 a_Extrude;\n\nlayout(std140) uniform commonUniform {\n  float u_additive;\n  float u_stroke_opacity : 1;\n  float u_stroke_width : 2;\n  float u_blur : 0.0;\n};\nout vec4 v_data;\nout vec4 v_color;\nout float v_radius;\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);\n\n  setPickingColor(a_PickingColor);\n}',fragmentShader:"in vec4 v_data;\nin vec4 v_color;\nin float v_radius;\n\nlayout(std140) uniform commonUniform {\n  float u_additive;\n  float u_stroke_opacity : 1;\n  float u_stroke_width : 2;\n  float u_blur : 0.0;\n};\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nout vec4 outputColor;\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  if(outer_df > antialiasblur + 0.018) discard;\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(u_stroke_width < 0.01) {\n    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);\n  } else {\n    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    outputColor *= opacity_t;\n    outputColor = filterColorAlpha(outputColor, outputColor.a);\n  } else {\n    outputColor.a *= opacity_t;\n    outputColor = filterColor(outputColor);\n  }\n}\n",triangulation:k.S,inject:this.getInject(),depth:{enable:!0},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:A.AttributeType.Attribute,descriptor:{name:"a_Extrude",shaderLocation:w.q.EXTRUDE,buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(e,t,n,r){var i=N()(n,3),o=i[0],a=i[1],s=i[2],u=D.fromValues(0,0,1),l=D.fromValues(o,0,s),c=o>=0?D.angle(u,l):2*Math.PI-D.angle(u,l),h=2*Math.PI-Math.asin(a/100),f=B.create();B.rotateY(f,f,c),B.rotateX(f,f,h);var p=D.fromValues(1,1,0);D.transformMat4(p,p,f),D.normalize(p,p);var d=D.fromValues(-1,1,0);D.transformMat4(d,d,f),D.normalize(d,d);var v=D.fromValues(-1,-1,0);D.transformMat4(v,v,f),D.normalize(v,v);var m=D.fromValues(1,-1,0);D.transformMat4(m,m,f),D.normalize(m,m);var g=[].concat(S()(p),S()(d),S()(v),S()(m)),y=r%4*3;return[g[y],g[y+1],g[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:w.q.SIZE,buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:A.AttributeType.Attribute,descriptor:{name:"a_Shape",shaderLocation:w.q.SHAPE,buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n;return[e.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}]),i}(T.Z),U=n(230),z=n(3179),G=n(5356),j=function(e){m()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"meter2coord",1),b()(d()(e),"texture",void 0),b()(d()(e),"isMeter",!1),b()(d()(e),"radian",0),b()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void e.layerService.throttleRenderLayers();e.texture=t({data:e.iconService.getCanvas(),mag:A.gl.LINEAR,min:A.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0}),e.textures=[e.texture]})),e}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e,t=this.layer.getLayerConfig(),n=t.raisingHeight,r=void 0===n?0:n,i=t.heightfixed,o=void 0!==i&&i,a=t.unit,s=void 0===a?"pixel":a;this.rendererService.getDirty()&&(null===(e=this.texture)||void 0===e||e.bind());var u={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(o),u_raisingHeight:Number(r),u_size_unit:G.xg[s]};return this.getUniformsBufferInfo(u)}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),k.oX)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 11) in vec3 a_Extrude;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniform {\n  vec2 u_textSize;\n  float u_heightfixed: 0.0;\n  float u_raisingHeight: 0.0;\n  float u_size_unit;\n};\n\nout vec2 v_uv;\nout vec2 v_Iconuv;\nout float v_opacity;\n\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  v_uv = (a_Extrude.xy + 1.0)/2.0;\n  v_uv.y = 1.0 - v_uv.y;\n  v_Iconuv = a_Uv;\n  v_opacity = opacity;\n  float newSize = a_Size;\n  if(u_size_unit == 1.0) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n  \n  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec2 offset = (extrude.xy * (newSize) + offsets);\n\n  offset = rotate_matrix(offset,rotation);\n\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // height fixed\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec2 v_uv;// 本身的 uv 坐标\nin vec2 v_Iconuv;\nin float v_opacity;\nout vec4 outputColor;\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniform {\n  vec2 u_textSize;\n  float u_heightfixed: 0.0;\n  float u_raisingHeight: 0.0;\n  float u_size_unit;\n};\n\n#pragma include "scene_uniforms"\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nvoid main() {\n  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\n  outputColor = texture(SAMPLER_2D(u_texture), pos);\n  outputColor.a *= v_opacity;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:k.oX,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:(0,C.fj)(this.mapService.version)}});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;this.iconService.off("imageUpdate",this.updateTexture),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:w.q.UV,buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.shape]||{x:-64,y:-64};return[n.x,n.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:A.AttributeType.Attribute,descriptor:{name:"a_Extrude",shaderLocation:w.q.EXTRUDE,buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:w.q.SIZE,buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(T.Z),V=n(8837),H=n(6615),W=function(e){m()(i,e);var t,n,r=y()(i);function i(){return c()(this,i),r.apply(this,arguments)}return f()(i,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.blend,n=e.speed,r=void 0===n?1:n,i=e.unit,o=void 0===i?"pixel":i,a={u_additive:"additive"===t?1:0,u_size_unit:G.xg[o],u_speed:r,u_time:this.layer.getLayerAnimateTime()};return this.getUniformsBufferInfo(a)}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),k.oX)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 11) in vec3 a_Extrude;\n\nlayout(std140) uniform commonUniorm {\n  float u_additive;\n  float u_size_unit;\n  float u_speed: 1.0;\n  float u_time;\n};\n\nout vec4 v_data;\nout vec4 v_color;\nout float v_radius;\nout vec2 v_extrude;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  float newSize = setPickingSize(a_Size);\n\n  float time = u_time * u_speed;\n  mat2 rotateMatrix = mat2( \n    cos(time), sin(time), \n    -sin(time), cos(time)\n  );\n  v_extrude = rotateMatrix * a_Extrude.xy;\n\n  v_color = a_Color;\n  v_color.a *= opacity;\n\n  float blur = 0.0;\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\n\n  if(u_size_unit == 1.) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n  v_radius = newSize;\n\n  vec2 offset = (a_Extrude.xy * (newSize));\n  vec3 aPosition = a_Position;\n  \n  offset = project_pixel(offset);\n  \n  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nlayout(std140) uniform commonUniorm{\n  float u_additive;\n  float u_size_unit;\n  float u_speed: 1.0;\n  float u_time;\n};\nin vec4 v_data;\nin vec4 v_color;\nin float v_radius;\nin vec2 v_extrude;\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nout vec4 outputColor;\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df = sdCircle(v_data.xy, 1.0);\n  float inner_df = sdCircle(v_data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  outputColor = vec4(v_color.rgb, v_color.a);\n\n  if(u_additive > 0.0) {\n    outputColor *= opacity_t;\n  } else {\n    outputColor.a *= opacity_t;\n  }\n\n  if(outputColor.a > 0.0) {\n    outputColor = filterColor(outputColor);\n  }\n\n  vec2 extrude =  v_extrude;\n  vec2 dir = normalize(extrude);\n  vec2 baseDir = vec2(1.0, 0.0);\n  float pi = 3.14159265359;\n  float flag = sign(dir.y);\n  float rades = dot(dir, baseDir);\n  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\n  // simple AA\n  if(radar_v > 0.99) {\n    radar_v = 1.0 - (radar_v - 0.99)/0.01;\n  }\n\n  outputColor.a *= radar_v;\n}\n',triangulation:k.oX,inject:this.getInject(),depth:{enable:!1}});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:A.AttributeType.Attribute,descriptor:{name:"a_Extrude",shaderLocation:w.q.EXTRUDE,buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{shaderLocation:w.q.SIZE,name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(T.Z),Z=n(8951),X={fillImage:j,fill:z.Z,radar:W,image:V.Z,normal:H.Z,simplePoint:M,extrude:U.Z,text:Z.Z,earthFill:F,earthExtrude:P},Y=function(e){m()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"type","PointLayer"),b()(d()(e),"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),b()(d()(e),"enableDataEncodeStyles",["textOffset","textAnchor"]),b()(d()(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),e}return f()(o,[{key:"buildModels",value:(n=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new X[t](this),e.next=5,this.initLayerModels();case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"rebuildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var e=this.shapeOption,t=e.field,n=e.values,r=this.getLayerConfig().shape2d,o=this.iconService.getIconMap();if(t&&-1!==(null==r?void 0:r.indexOf(t)))return"fill";if("text"===n)return"text";if(n&&n instanceof Array){var a,s=i()(n);try{for(s.s();!(a=s.n()).done;){var u=a.value;if("string"==typeof u&&o.hasOwnProperty(u))return"image"}}catch(e){s.e(e)}finally{s.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=t.billboard,o=void 0===i||i,a=this.iconService.getIconMap(),s=e.find((function(e){return e.hasOwnProperty("shape")}));if(s){var u=s.shape;return"dot"===u?"normal":"simple"===u?"simplePoint":"radar"===u?"radar":"fillImage"===this.layerType||!1===o?"fillImage":-1!==(null==n?void 0:n.indexOf(u))?"GLOBEL"===this.mapService.version?"earthFill":"fill":-1!==(null==r?void 0:r.indexOf(u))?"GLOBEL"===this.mapService.version?"earthExtrude":"extrude":a.hasOwnProperty(u)?"image":"text"}return this.getModelTypeWillEmptyData()}}]),o}(x.Z)},230:function(e,t,n){"use strict";n.d(t,{Z:function(){return A}});var r=n(9558),i=n.n(r),o=n(9989),a=n.n(o),s=n(4528),u=n.n(s),l=n(8798),c=n.n(l),h=n(6626),f=n.n(h),p=n(7267),d=n.n(p),v=n(9913),m=n.n(v),g=n(9057),y=n.n(g),_=n(3292),b=n(6490),x=n(2606),E=n(4889),S=n(6999),A=function(e){d()(o,e);var t,n,r=m()(o);function o(){var e;u()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),y()(f()(e),"raiseCount",0),y()(f()(e),"raiseRepeat",0),e}return c()(o,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.sourceColor,i=e.targetColor,o=e.pickLight,a=void 0!==o&&o,s=e.heightfixed,u=void 0!==s&&s,l=e.opacityLinear,c=void 0===l?{enable:!1,dir:"up"}:l,h=e.lightEnable,f=void 0===h||h,p=0,d=[0,0,0,0],v=[0,0,0,0];if(r&&i&&(d=(0,b.CI)(r),v=(0,b.CI)(i),p=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var m=n.speed,g=void 0===m?.01:m;this.raiseCount+=g,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var y={u_pickLight:Number(a),u_heightfixed:Number(u),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:p,u_sourceColor:d,u_targetColor:v,u_opacitylinear:Number(c.enable),u_opacitylinear_dir:"up"===c.dir?1:0,u_lightEnable:Number(f)};return this.getUniformsBufferInfo(y)}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t,n,r,o,a,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0===n||n,o=t.animateOption.repeat,a=void 0===o?1:o,this.raiseRepeat=a,this.initUniformsBuffer(),e.next=5,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:'#define pi 3.1415926535\n\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in vec3 a_Size;\nlayout(location = 11) in vec3 a_Extrude;\nlayout(location = 13) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniforms {\n  float u_pickLight;\n  float u_heightfixed;\n  float u_r;\n  float u_linearColor;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_opacitylinear;\n  float u_opacitylinear_dir;\n  float u_lightEnable;\n};\nout vec4 v_color;\nout float v_lightWeight;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n\n  vec3 size = a_Size * a_Position;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Extrude.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // // 圆柱光照效果\n  float lightWeight = 1.0;\n\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n\n  v_lightWeight = lightWeight;\n\n  v_color = a_Color;\n\n    // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);\n    v_color.a =  v_color.a * opacity;\n  } else {\n    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);\n  }\n\n    if(u_opacitylinear > 0.0) {\n    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;\n  }\n\n\n  gl_Position = project_common_position_to_clipspace_v2(pos);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nin vec4 v_color;\nin float v_lightWeight;\nout vec4 outputColor;\n\nlayout(std140) uniform commonUniforms {\n  float u_pickLight;\n  float u_heightfixed;\n  float u_r;\n  float u_linearColor;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_opacitylinear;\n  float u_opacitylinear_dir;\n  float u_lightEnable;\n};\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nvoid main() {\n\n  outputColor = v_color;\n  // 开启透明度渐变\n  // picking\n  if(u_pickLight > 0.0) {\n    outputColor = filterColorAlpha(outputColor, v_lightWeight);\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n}\n',triangulation:S.NM,inject:this.getInject(),cull:{enable:!0,face:(0,b.fj)(this.mapService.version)},depth:{enable:r}});case 5:return s=e.sent,e.abrupt("return",[s]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:_.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:E.q.SIZE,buffer:{usage:_.gl.DYNAMIC_DRAW,data:[],type:_.gl.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:E.q.NORMAL,buffer:{usage:_.gl.STATIC_DRAW,data:[],type:_.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:_.AttributeType.Attribute,descriptor:{name:"a_Extrude",shaderLocation:E.q.EXTRUDE,buffer:{usage:_.gl.DYNAMIC_DRAW,data:[],type:_.gl.FLOAT},size:3,update:function(e){var t=(0,b.SI)(e.coordinates);return[t[0],t[1],0]}}})}}]),o}(x.Z)},3179:function(e,t,n){"use strict";n.d(t,{Z:function(){return b}});var r=n(9558),i=n.n(r),o=n(9989),a=n.n(o),s=n(4528),u=n.n(s),l=n(8798),c=n.n(l),h=n(7267),f=n.n(h),p=n(9913),d=n.n(p),v=n(3292),m=n(6999),g=n(2606),y=n(4889),_=n(5356),b=function(e){f()(o,e);var t,n,r=d()(o);function o(){return u()(this,o),r.apply(this,arguments)}return c()(o,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.strokeOpacity,n=void 0===t?1:t,r=e.strokeWidth,i=void 0===r?0:r,o=e.blend,a=e.blur,s=void 0===a?0:a,u=e.raisingHeight,l=void 0===u?0:u,c=e.heightfixed,h=void 0!==c&&c,f=e.unit,p=void 0===f?"pixel":f,d=this.getAnimateUniforms().u_time;isNaN(d)&&(d=-1);var v={u_blur_height_fixed:[s,Number(l),Number(h)],u_stroke_width:i,u_additive:"additive"===o?1:0,u_stroke_opacity:n,u_size_unit:_.xg[p],u_time:d,u_animate:this.getAnimateUniforms().u_animate};return this.getUniformsBufferInfo(v)}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),m.oX)}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t,n,r,o,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,o=t.type,this.layer.triangulation=m.oX,this.initUniformsBuffer(),e.next=5,this.layer.buildLayerModel({moduleName:o,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:m.oX,depth:{enable:!1}});case 5:return a=e.sent,e.abrupt("return",[a]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:"\nlayout(std140) uniform commonUniforms {\n  vec3 u_blur_height_fixed;\n  float u_stroke_width;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_size_unit;\n  float u_time;\n  vec4 u_animate;\n};\n\nin vec4 v_color;\nin vec4 v_stroke;\nin vec4 v_data;\nin float v_radius;\n\n#pragma include \"scene_uniforms\"\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nout vec4 outputColor;\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  float PI = 3.14159;\n  float N_RINGS = 3.0;\n  float FREQ = 1.0;\n\n  if(u_stroke_width < 0.01) {\n    outputColor = v_color;\n  } else {\n    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);\n  }\n  float intensity = 1.0;\n  if(u_time!=-1.0){\n    //wave相关逻辑\n    float d = length(v_data.xy);\n    if(d > 0.5) {\n      discard;\n    }\n    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);\n  }\n\n  if(u_additive > 0.0) {\n    outputColor *= opacity_t;\n    outputColor *= intensity;//wave\n    outputColor = filterColorAlpha(outputColor, outputColor.a);\n  } else {\n    outputColor.a *= opacity_t;\n    outputColor.a *= intensity;//wave \n    outputColor = filterColor(outputColor);\n  }\n   // 作为 mask 模板时需要丢弃透明的像素\n  if(outputColor.a < 0.01) {\n    discard;\n  } \n}\n",vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 10) in float a_Shape;\nlayout(location = 11) in vec3 a_Extrude;\n\nlayout(std140) uniform commonUniforms {\n  vec3 u_blur_height_fixed;\n  float u_stroke_width;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_size_unit;\n  float u_time;\n  vec4 u_animate;   \n};\n\nout vec4 v_color;\nout vec4 v_stroke;\nout vec4 v_data;\nout float v_radius;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  // 透明度计算\n   v_stroke = stroke;  \n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  *  u_meter2coord 在等面积大小的时候设置单位\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n\n\n  // unpack color(vec2)\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  if(u_size_unit == 1.0) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n   v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n  offset = rotate_matrix(offset,rotation);\n  \n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  float raisingHeight = u_blur_height_fixed.y;\n\n  if(u_blur_height_fixed.z < 1.0) { // false\n    raisingHeight = project_pixel(u_blur_height_fixed.y);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;\n    }\n  }\n  \n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:"pointFill"}}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:v.AttributeType.Attribute,descriptor:{name:"a_Extrude",shaderLocation:y.q.EXTRUDE,buffer:{usage:v.gl.DYNAMIC_DRAW,data:[],type:v.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:v.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:y.q.SIZE,buffer:{usage:v.gl.DYNAMIC_DRAW,data:[],type:v.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:v.AttributeType.Attribute,descriptor:{name:"a_Shape",shaderLocation:y.q.SHAPE,buffer:{usage:v.gl.DYNAMIC_DRAW,data:[],type:v.gl.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n;return[e.indexOf(r)]}}})}}]),o}(g.Z)},8837:function(e,t,n){"use strict";n.d(t,{Z:function(){return T}});var r=n(9558),i=n.n(r),o=n(9989),a=n.n(o),s=n(1448),u=n.n(s),l=n(4528),c=n.n(l),h=n(8798),f=n.n(h),p=n(6626),d=n.n(p),v=n(7267),m=n.n(v),g=n(9913),y=n.n(g),_=n(9057),b=n.n(_),x=n(3292),E=n(2606),S=n(4889),A=n(6999),T=function(e){m()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"texture",void 0),b()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void setTimeout((function(){e.layerService.throttleRenderLayers()}));e.texture=t({data:e.iconService.getCanvas(),mag:x.gl.LINEAR,min:x.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})})),e}return f()(o,[{key:"getUninforms",value:function(){var e;this.rendererService.getDirty()&&(null===(e=this.texture)||void 0===e||e.bind());var t=this.getCommonUniformsInfo(),n=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),u()(u()({},t.uniformsOption),n.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.raisingHeight,n=void 0===t?0:t,r=e.heightfixed,i=void 0!==r&&r,o={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(n),u_heightfixed:Number(i),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(o)}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_textSize;\n  float u_raisingHeight;\n  float u_heightfixed;\n};\n\nout vec4 v_color;\nout vec2 v_uv;\nout float v_opacity;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  v_color = a_Color;\n  v_opacity = opacity;\n  v_uv = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n  vec2 offset = project_pixel(offsets);\n\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // false\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'layout(std140) uniform commonUniforms {\n  vec2 u_textSize;\n  float u_raisingHeight;\n  float u_heightfixed;\n};\n\nuniform sampler2D u_texture;\n\nin vec4 v_color;\nin vec2 v_uv;\nin float v_opacity;\n\n#pragma include "picking"\n\nout vec4 outputColor;\n\nvoid main(){\n  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n  vec4 textureColor;\n\n  // Y = 0.299R + 0.587G + 0.114B // 亮度提取\n  \n  textureColor = texture(SAMPLER_2D(u_texture), pos);\n\n  // Tip: 去除边缘部分 mipmap 导致的混合变暗\n  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n  if(fragmengTocenter >= 0.5) {\n        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n        textureColor.a *= luma;\n  }\n  \n  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n        outputColor= textureColor;\n  }else {\n        outputColor= step(0.01, textureColor.z) * v_color;\n  }\n  outputColor.a *= v_opacity;\n  if (outputColor.a < 0.01) {\n      discard;\n  }\n  outputColor = filterColor(outputColor);\n}\n',triangulation:A.xH,inject:this.getInject(),depth:{enable:!1},primitive:x.gl.POINTS});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:x.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:S.q.SIZE,buffer:{usage:x.gl.DYNAMIC_DRAW,data:[],type:x.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:x.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:S.q.UV,buffer:{usage:x.gl.DYNAMIC_DRAW,data:[],type:x.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.shape]||{x:-64,y:-64};return[n.x,n.y]}}})}}]),o}(E.Z)},6615:function(e,t,n){"use strict";n.d(t,{Z:function(){return x}});var r=n(9558),i=n.n(r),o=n(9989),a=n.n(o),s=n(4528),u=n.n(s),l=n(8798),c=n.n(l),h=n(7267),f=n.n(h),p=n(9913),d=n.n(p),v=n(4479),m=n.n(v),g=n(3292),y=n(2606),_=n(4889);function b(e){var t=e.coordinates;return{vertices:m()(t),indices:[0],size:t.length}}var x=function(e){f()(o,e);var t,n,r=d()(o);function o(){return u()(this,o),r.apply(this,arguments)}return c()(o,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){return this.getUniformsBufferInfo({u_size_scale:.5})}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=b,this.initUniformsBuffer(),e.next=4,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\n\nlayout(std140) uniform u_Common {\n  float u_size_scale;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);\n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;\n}\n',fragmentShader:"in vec4 v_color;\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n}",triangulation:b,inject:this.getInject(),depth:{enable:!1},primitive:g.gl.POINTS,pick:!1});case 4:return t=e.sent,e.abrupt("return",[t]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:g.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:_.q.SIZE,buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),o}(y.Z)},8951:function(e,t,n){"use strict";n.d(t,{Z:function(){return j}});var r=n(6970),i=n.n(r),o=n(1448),a=n.n(o),s=n(9558),u=n.n(s),l=n(9989),c=n.n(l),h=n(4528),f=n.n(h),p=n(8798),d=n.n(p),v=n(6626),m=n.n(v),g=n(7267),y=n.n(g),_=n(9913),b=n.n(_),x=n(9057),E=n.n(x),S=n(4479),A=n.n(S),T=n(3292),C=n(6490),w=n(2606),R=n(6749),M=n(3311),k=function(){function e(t,n,r){f()(this,e),E()(this,"boxCells",[]),E()(this,"xCellCount",void 0),E()(this,"yCellCount",void 0),E()(this,"boxKeys",void 0),E()(this,"bboxes",void 0),E()(this,"width",void 0),E()(this,"height",void 0),E()(this,"xScale",void 0),E()(this,"yScale",void 0),E()(this,"boxUid",void 0);var i=this.boxCells;this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0}return d()(e,[{key:"insert",value:function(e,t,n,r,i){this.forEachCell(t,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!1,i)}},{key:"hitTest",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!0,i)}},{key:"insertBoxCell",value:function(e,t,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(e,t,n,r,i,o){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(e,t,n,r,this.queryCell,a,u,o),i?a.length>0:a}},{key:"queryCell",value:function(e,t,n,r,o,a,s,u){var l=s.seenUids,c=this.boxCells[o];if(null!==c){var h,f=this.bboxes,p=i()(c);try{for(p.s();!(h=p.n()).done;){var d=h.value;if(!l.box[d]){l.box[d]=!0;var v=4*d;if(e<=f[v+2]&&t<=f[v+3]&&n>=f[v+0]&&r>=f[v+1]&&(!u||u(this.boxKeys[d]))){if(s.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[d],x1:f[v],y1:f[v+1],x2:f[v+2],y2:f[v+3]})}}}}catch(e){p.e(e)}finally{p.f()}}return!1}},{key:"forEachCell",value:function(e,t,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(e),l=this.convertToYCellCoord(t),c=this.convertToXCellCoord(n),h=this.convertToYCellCoord(r),f=u;f<=c;f++)for(var p=l;p<=h;p++){var d=this.xCellCount*p+f;if(i.call(this,e,t,n,r,d,o,a,s))return}}},{key:"convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}}]),e}(),L=function(){function e(t,n){f()(this,e),E()(this,"width",void 0),E()(this,"height",void 0),E()(this,"grid",void 0),E()(this,"viewportPadding",100),E()(this,"screenRightBoundary",void 0),E()(this,"screenBottomBoundary",void 0),E()(this,"gridRightBoundary",void 0),E()(this,"gridBottomBoundary",void 0),this.width=t,this.height=n,this.viewportPadding=Math.max(t,n),this.grid=new k(t+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return d()(e,[{key:"placeCollisionBox",value:function(e){var t=e.x1+e.anchorPointX+this.viewportPadding,n=e.y1+e.anchorPointY+this.viewportPadding,r=e.x2+e.anchorPointX+this.viewportPadding,i=e.y2+e.anchorPointY+this.viewportPadding;return!this.isInsideGrid(t,n,r,i)||this.grid.hitTest(t,n,r,i)?{box:[]}:{box:[t,n,r,i]}}},{key:"insertCollisionBox",value:function(e,t){var n={featureIndex:t};this.grid.insert(n,e[0],e[1],e[2],e[3])}},{key:"project",value:function(e,t,n){var r=R.al(t,n,0,1),i=R.Ue(),o=M.fromValues.apply(M,A()(e));return R.fF(i,r,o),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}}]),e}();function O(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:t,verticalAlign:n}}function P(e,t,n,r,i){if(i){var o=e[r],a=o.glyph;if(a)for(var s=t[a].advance*o.scale,u=(e[r].x+s)*i,l=n;l<=r;l++)e[l].x-=u}}function I(e,t,n,r,o,a,s){var u,l=(t-n)*o,c=(-r*s+.5)*a,h=i()(e);try{for(h.s();!(u=h.n()).done;){var f=u.value;f.x+=l,f.y+=c}}catch(e){h.e(e)}finally{h.f()}}function N(e,t,n,r,i,o,a){var s=0,u=-8,l=0,c=e.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,f=c.length;n.forEach((function(e){if(e.split("").forEach((function(e){var n=t[e];n&&(c.push({glyph:e,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a)})),c.length!==f){var n=s-a;l=Math.max(n,l),P(c,t,f,c.length-1,h)}s=0,u-=r+5}));var p=O(i),d=p.horizontalAlign,v=p.verticalAlign;I(c,h,d,v,l,r,n.length);var m=u- -8;e.top+=-v*m,e.bottom=e.top-m,e.left+=-d*l,e.right=e.left+l}function D(e,t,n,r,i,o,a){var s=0,u=-8,l=0,c=e.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,f=c.length;n.forEach((function(e){var n=t[e];if(n&&(c.push({glyph:e,x:n.advance/2,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a),c.length!==f){var i=s-a;l=Math.max(i,l),P(c,t,f,c.length-1,h)}s=0,u-=r+5}));var p=O(i),d=p.horizontalAlign,v=p.verticalAlign;I(c,h,d,v,l,r,n.length);var m=u- -8;e.top+=-v*m,e.bottom=e.top-m,e.left+=-d*l,e.right=e.left+l}var B=n(4889),F='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\n\nuniform sampler2D u_sdf_map;\nlayout(std140) uniform commonUniforms {\n  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n  vec2 u_sdf_map_size;\n  float u_raisingHeight: 0.0;\n  float u_stroke_width : 2;\n  float u_gamma_scale : 0.5;\n  float u_halo_blur : 0.5;\n};\n\nin vec2 v_uv;\nin float v_gamma_scale;\nin vec4 v_color;\nin vec4 v_stroke_color;\nin float v_fontScale;\n\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  // get style data mapping\n\n  // get sdf from atlas\n  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;\n\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));\n\n  outputColor.a *= alpha;\n   // 作为 mask 模板时需要丢弃透明的像素\n  if (outputColor.a < 0.01) {\n    discard;\n  }\n  outputColor = filterColor(outputColor);\n}\n',U='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\n\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 10) in vec2 a_textOffsets;\nlayout(location = 14) in vec2 a_tex;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n  vec2 u_sdf_map_size;\n  float u_raisingHeight: 0.0;\n  float u_stroke_width : 2;\n  float u_gamma_scale : 0.5;\n  float u_halo_blur : 0.5;\n};\n\nout vec2 v_uv;\nout float v_gamma_scale;\nout vec4 v_color;\nout vec4 v_stroke_color;\nout float v_fontScale;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  \n  v_uv = a_tex / u_sdf_map_size;\n\n\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);\n\n  // 文本缩放比例\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  vec2 offset = rotate_matrix(a_textOffsets,rotation);\n  \n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n\n  float raiseHeight = u_raisingHeight;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n',z=C.rU.isEqual;function G(e){var t=this,n=e.id,r=[],i=[];if(!t.glyphInfoMap||!t.glyphInfoMap[n])return{vertices:[],indices:[],size:7};var o=t.glyphInfoMap[n].centroid,a=2===o.length?[o[0],o[1],0]:o;return t.glyphInfoMap[n].glyphQuads.forEach((function(e,t){r.push.apply(r,A()(a).concat([e.tex.x,e.tex.y+e.tex.height,e.tl.x,e.tl.y],A()(a),[e.tex.x+e.tex.width,e.tex.y+e.tex.height,e.tr.x,e.tr.y],A()(a),[e.tex.x+e.tex.width,e.tex.y,e.br.x,e.br.y],A()(a),[e.tex.x,e.tex.y,e.bl.x,e.bl.y])),i.push(0+4*t,1+4*t,2+4*t,2+4*t,3+4*t,0+4*t)})),{vertices:r,indices:i,size:7}}var j=function(e){y()(l,e);var t,n,r,o,s=b()(l);function l(){var e;f()(this,l);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=s.call.apply(s,[this].concat(n)),E()(m()(e),"glyphInfo",void 0),E()(m()(e),"glyphInfoMap",{}),E()(m()(e),"rawEncodeData",void 0),E()(m()(e),"texture",void 0),E()(m()(e),"currentZoom",-1),E()(m()(e),"extent",void 0),E()(m()(e),"textureHeight",0),E()(m()(e),"textCount",0),E()(m()(e),"preTextStyle",{}),E()(m()(e),"mapping",c()(u()().mark((function t(){return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.initGlyph(),e.updateTexture(),t.next=4,e.reBuildModel();case 4:case"end":return t.stop()}}),t)})))),e}return d()(l,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),a()(a()(a()({},e.uniformsOption),t.uniformsOption),{u_sdf_map:this.textures[0]})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.stroke,n=void 0===t?"#fff":t,r=e.strokeWidth,i=void 0===r?0:r,o=e.halo,a=void 0===o?.5:o,s=e.gamma,u=void 0===s?2:s,l=e.raisingHeight,c=void 0===l?0:l,h=this.getFontServiceMapping(),f=this.getFontServiceCanvas();h&&Object.keys(h).length!==this.textCount&&f&&(this.updateTexture(),this.textCount=Object.keys(h).length),this.preTextStyle=this.getTextStyle();var p={u_stroke_color:(0,C.CI)(n),u_sdf_map_size:[(null==f?void 0:f.width)||1,(null==f?void 0:f.height)||1],u_raisingHeight:Number(c),u_stroke_width:i,u_gamma_scale:u,u_halo_blur:a};return this.getUniformsBufferInfo(p)}},{key:"initModels",value:(o=c()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 6:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"buildModels",value:(r=c()(u()().mark((function e(){var t,n,r,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.textAllowOverlap,r=void 0!==n&&n,this.initGlyph(),this.updateTexture(),r||this.filterGlyphs(),e.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:U,fragmentShader:F,inject:this.getInject(),triangulation:G.bind(this),depth:{enable:!1}});case 6:return i=e.sent,e.abrupt("return",[i]);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"needUpdate",value:(n=c()(u()().mark((function e(){var t,n,r,i,o,a,s,l,c,h,f,p;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getTextStyle(),n=t.textAllowOverlap,r=void 0!==n&&n,i=t.textAnchor,o=void 0===i?"center":i,a=t.textOffset,s=t.padding,l=t.fontFamily,c=t.fontWeight,z(s,this.preTextStyle.padding)&&z(a,this.preTextStyle.textOffset)&&z(o,this.preTextStyle.textAnchor)&&z(l,this.preTextStyle.fontFamily)&&z(c,this.preTextStyle.fontWeight)){e.next=5;break}return e.next=4,this.mapping();case 4:case 13:return e.abrupt("return",!0);case 5:if(!r){e.next=7;break}return e.abrupt("return",!1);case 7:if(h=this.mapService.getZoom(),f=this.mapService.getBounds(),p=(0,C.oO)(this.extent,f),!(Math.abs(this.currentZoom-h)>.5)&&p&&r===this.preTextStyle.textAllowOverlap){e.next=14;break}return e.next=13,this.reBuildModel();case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:T.AttributeType.Attribute,descriptor:{shaderLocation:10,name:"a_textOffsets",buffer:{usage:T.gl.STATIC_DRAW,data:[],type:T.gl.FLOAT},size:2,update:function(e,t,n){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:T.AttributeType.Attribute,descriptor:{name:"a_tex",shaderLocation:B.q.UV,buffer:{usage:T.gl.DYNAMIC_DRAW,data:[],type:T.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:T.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:B.q.SIZE,buffer:{usage:T.gl.DYNAMIC_DRAW,data:[],type:T.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?12:t;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var e=this.mapService.getBounds();return(0,C.yA)(e,.5)}},{key:"initTextFont",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,o=[];r.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n=n.toString();var r,a=i()(n);try{for(a.s();!(r=a.n()).done;){var s=r.value;-1===o.indexOf(s)&&o.push(s)}}catch(e){a.e(e)}finally{a.f()}})),this.fontService.setFontOptions({characterSet:o,fontWeight:t,fontFamily:n,iconfont:!1})}},{key:"initIconFontTex",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n="".concat(n),-1===i.indexOf(n)&&i.push(n)})),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:n,iconfont:!0})}},{key:"getTextStyle",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,o=e.textAllowOverlap,a=void 0!==o&&o,s=e.padding,u=void 0===s?[0,0]:s,l=e.textAnchor,c=void 0===l?"center":l,h=e.textOffset,f=void 0===h?[0,0]:h,p=e.opacity,d=void 0===p?1:p,v=e.strokeOpacity,m=void 0===v?1:v,g=e.strokeWidth,y=void 0===g?0:g,_=e.stroke;return{fontWeight:n,fontFamily:i,textAllowOverlap:a,padding:u,textAnchor:c,textOffset:f,opacity:d,strokeOpacity:m,strokeWidth:y,stroke:void 0===_?"#000":_}}},{key:"generateGlyphLayout",value:function(e){var t=this,n=this.getFontServiceMapping(),r=this.layer.getLayerConfig(),o=r.spacing,a=void 0===o?2:o,s=r.textAnchor,u=void 0===s?"center":s,l=r.textOffset,c=this.rawEncodeData;this.glyphInfo=c.map((function(r){var o=r.shape,s=void 0===o?"":o,c=r.id,h=r.size,f=void 0===h?1:h,p=r.textOffset?r.textOffset:l||[0,0],d=r.textAnchor?r.textAnchor:u||"center",v=function(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=e.split("\n"),l=[],c={positionedGlyphs:l,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:e};return s?D(c,t,u,n,r,i,o):N(c,t,u,n,r,i,o),!!l.length&&c}(s.toString(),n,f,d,"left",a,p,e),m=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,o=e.positionedGlyphs,a=void 0===o?[]:o,s=[],u=i()(a);try{for(u.s();!(t=u.n()).done;){var l=t.value,c=l.metrics,h=4,f=c.advance*l.scale/2,p=r?[l.x+f,l.y]:[0,0],d=r?[0,0]:[l.x+f+n[0],l.y+n[1]],v=(0-h)*l.scale-f+d[0],m=(0-h)*l.scale+d[1],g=v+c.width*l.scale,y=m+c.height*l.scale,_={x:v,y:m},b={x:g,y:m},x={x:v,y:y},E={x:g,y:y};s.push({tl:_,tr:b,bl:x,br:E,tex:c,glyphOffset:p})}}catch(e){u.e(e)}finally{u.f()}return s}(v,p,!1);return r.shaping=v,r.glyphQuads=m,r.centroid=(0,C.SI)(r.coordinates),r.originCentroid="GAODE2.x"===r.version?(0,C.SI)(r.originCoordinates):r.originCentroid=r.centroid,t.glyphInfoMap[c]={shaping:v,glyphQuads:m,centroid:(0,C.SI)(r.coordinates)},r}))}},{key:"getFontServiceMapping",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getMappingByKey("".concat(i,"_").concat(n))}},{key:"getFontServiceCanvas",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getCanvasByKey("".concat(i,"_").concat(n))}},{key:"filterGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.padding,r=void 0===n?[0,0]:n,i=t.textAllowOverlap;if(!(void 0!==i&&i)){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new L(a,s);this.glyphInfo.filter((function(t){var n=t.shaping,i=t.id,o=void 0===i?0:i,a="GAODE2.x"===t.version?t.originCentroid:t.centroid,s=t.size/16,l=e.mapService.lngLatToContainer(a),c=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:l.x,anchorPointY:l.y}).box;return!(!c||!c.length)&&(u.insertCollisionBox(c,o),!0)})).forEach((function(t){e.glyphInfoMap[t.id]=t}))}}},{key:"initGlyph",value:function(){var e=this.layer.getLayerConfig().iconfont,t=void 0!==e&&e;t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}},{key:"updateTexture",value:function(){var e=this.rendererService.createTexture2D,t=this.getFontServiceCanvas();this.textureHeight=t.height,this.texture&&this.texture.destroy(),this.texture=e({data:t,mag:T.gl.LINEAR,min:T.gl.LINEAR,width:t.width,height:t.height}),this.textures=[this.texture]}},{key:"reBuildModel",value:(t=c()(u()().mark((function e(){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.filterGlyphs(),e.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:U,fragmentShader:F,triangulation:G.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:t=e.sent,this.layer.models=[t];case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),l}(w.Z)},7702:function(e,t,n){"use strict";n.d(t,{Z:function(){return V}});var r=n(9558),i=n.n(r),o=n(9989),a=n.n(o),s=n(4528),u=n.n(s),l=n(8798),c=n.n(l),h=n(6626),f=n.n(h),p=n(7267),d=n.n(p),v=n(9913),m=n.n(v),g=n(9057),y=n.n(g),_=n(3301),b=n(9262),x=n(230),E=n(3179),S=n(8837),A=n(6615),T=n(8951),C=n(3100),w=n.n(C),R=n(1448),M=n.n(R),k=n(3292),L=n(6490),O=n(2606),P=n(6999),I=n(4889);function N(e){return D.apply(this,arguments)}function D(){return(D=a()(i()().mark((function e(t){var n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.createImageBitmap){e.next=14;break}return e.next=3,fetch(t);case 3:return n=e.sent,e.t0=createImageBitmap,e.next=7,n.blob();case 7:return e.t1=e.sent,e.next=10,(0,e.t0)(e.t1);case 10:return r=e.sent,e.abrupt("return",r);case 14:return o=new window.Image,e.abrupt("return",new Promise((function(e){o.onload=function(){return e(o)},o.src=t,o.crossOrigin="Anonymous"})));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=function(e){d()(s,e);var t,n,r,o=m()(s);function s(){var e;u()(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),y()(f()(e),"texture",void 0),e}return c()(s,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),M()(M()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.mapTexture,n=e.heightfixed,r=void 0!==n&&n,i=e.raisingHeight,o=void 0===i?0:i,a=e.topsurface,s=void 0===a||a,u=e.sidesurface,l=void 0===u||u,c=e.sourceColor,h=e.targetColor,f=0,p=[1,1,1,1],d=[1,1,1,1];c&&h&&(p=(0,L.CI)(c),d=(0,L.CI)(h),f=1);var v={u_sourceColor:p,u_targetColor:d,u_linearColor:f,u_topsurface:Number(s),u_sidesurface:Number(l),u_heightfixed:Number(r),u_raisingHeight:Number(o)};return t&&this.texture&&(v.u_texture=this.texture,this.textures=[this.texture]),this.getUniformsBufferInfo(v)}},{key:"initModels",value:(r=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadTexture();case 2:return e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=a()(i()().mark((function e(){var t,n,r,o,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,o=t.type,this.initUniformsBuffer(),e.next=4,this.layer.buildLayerModel({moduleName:o,vertexShader:r,fragmentShader:n,depth:{enable:!0},inject:this.getInject(),triangulation:P.Xz});case 4:return a=e.sent,e.abrupt("return",[a]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.pickLight;return e.mapTexture?{frag:'uniform sampler2D u_texture;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nin vec4 v_Color;\nin vec3 v_uvs;\nin vec2 v_texture_data;\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nout vec4 outputColor;\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide = v_texture_data.x;\n  float lightWeight = v_texture_data.y;\n  float topU = v_uvs[0];\n  float topV = 1.0 - v_uvs[1];\n  float sidey = v_uvs[2];\n\n  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));\n  // Tip: 部分机型 GPU 计算精度兼容\n  if (isSide < 0.999) {// 是否是边缘\n    // side face\n    if (u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if (u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      outputColor = linearColor;\n    } else {\n      outputColor = v_Color;\n    }\n  } else {\n     // top face\n    if (u_topsurface < 1.0) {\n      discard;\n    }\n  }\n  \n  outputColor.a *= opacity;\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec3 a_uvs;\n\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nout vec4 v_Color;\nout vec3 v_uvs;\nout vec2 v_texture_data;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n  vec4 project_pos = project_position(pos);\n  v_uvs = a_uvs;\n  v_Color = a_Color;\n  v_Color.a *= opacity;\n   \n  v_texture_data = vec2(a_Position.z, lightWeight);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudeTexture"}:t?{frag:'\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nin vec4 v_Color;\nin vec3 v_uvs;\nin vec2 v_texture_data;\nout vec4 outputColor;\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nvoid main() {\n  float isSide =  v_texture_data.x;\n  float sidey = v_uvs[2];\n  float lightWeight = v_texture_data.y;\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n    \n    if( u_linearColor == 1.0) {\n      // side use linear\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      outputColor = linearColor;\n    } else {\n      // side notuse linear\n       outputColor = v_Color;\n    }\n  } else {\n    // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n    outputColor = v_Color;\n  }\n\n  outputColor = filterColorAlpha(outputColor, lightWeight);\n}\n',vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec3 a_uvs;\n\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nout vec4 v_Color;\nout vec3 v_uvs;\nout vec2 v_texture_data;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n\n\n  v_uvs = a_uvs;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n  float lightWeight = calc_lighting(pos);\n  v_texture_data = vec2(a_Position.z,lightWeight);\n\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudePickLight"}:{frag:'layout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nin vec4 v_Color;\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    outputColor = v_Color;\n  \n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 13) in vec3 a_Normal;\nlayout(location = 14) in vec3 a_uvs;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nout vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \nfloat isSide = a_Position.z;\n float topU = a_uvs[0];\n float topV = 1.0 - a_uvs[1];\n float sidey = a_uvs[2];\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    // if(u_sidesurface < 1.0) {\n    //   discard;\n    // }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      v_Color = linearColor;\n    } else {\n      v_Color = a_Color;\n    }\n\n  } else {\n    v_Color = a_Color;\n  }\n\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.textures=[]}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=e,n=this.layer.coordCenter||this.layer.getSource().center,r=t[2]-t[0],i=t[3]-t[1];if("GAODE2.x"===this.mapService.version){var o=this.mapService.coordToAMap2RelativeCoordinates([e[0],e[1]],n),a=w()(o,2),s=a[0],u=a[1],l=this.mapService.coordToAMap2RelativeCoordinates([e[2],e[3]],n),c=w()(l,2),h=c[0],f=c[1];r=h-s,i=f-u,t=[s,u,h,f]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:k.AttributeType.Attribute,descriptor:{name:"a_uvs",shaderLocation:I.q.UV,buffer:{usage:k.gl.STATIC_DRAW,data:[],type:k.gl.FLOAT},size:3,update:function(e,n,o){var a=o[0],s=o[1];return[(a-t[0])/r,(s-t[1])/i,o[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:k.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:I.q.NORMAL,buffer:{usage:k.gl.STATIC_DRAW,data:[],type:k.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:k.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:I.q.SIZE,buffer:{usage:k.gl.DYNAMIC_DRAW,data:[],type:k.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"loadTexture",value:(t=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer.getLayerConfig(),n=t.mapTexture,r=this.rendererService.createTexture2D,this.texture=r({height:1,width:1}),!n){e.next=8;break}return e.next=6,N(n);case 6:o=e.sent,this.texture=r({data:o,width:o.width,height:o.height,wrapS:k.gl.CLAMP_TO_EDGE,wrapT:k.gl.CLAMP_TO_EDGE,min:k.gl.LINEAR,mag:k.gl.LINEAR});case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),s}(O.Z),F=function(e){d()(o,e);var t,n,r=m()(o);function o(){var e;u()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),y()(f()(e),"texture",void 0),e}return c()(o,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),M()(M()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){return this.getUniformsBufferInfo({})}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t,n,r,o,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,o=t.type,this.initUniformsBuffer(),e.next=4,this.layer.buildLayerModel({moduleName:o,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:P.Xz,depth:{enable:!0}});case 4:return a=e.sent,e.abrupt("return",[a]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:'\nin vec4 v_Color;\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n\n  outputColor = v_Color;\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 13) in vec3 a_Normal;\n\nout vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);\n\n  vec4 project_pos = project_position(pos);\n   float lightWeight = calc_lighting(project_pos);\n  v_Color = a_Color;\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:k.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:I.q.NORMAL,buffer:{usage:k.gl.STATIC_DRAW,data:[],type:k.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:k.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:I.q.SIZE,buffer:{usage:k.gl.DYNAMIC_DRAW,data:[],type:k.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),o}(O.Z),U=function(e){d()(o,e);var t,n,r=m()(o);function o(){return u()(this,o),r.apply(this,arguments)}return c()(o,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),M()(M()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.raisingHeight,n=void 0===t?0:t,r=e.opacityLinear,i=void 0===r?{enable:!1,dir:"in"}:r,o={u_raisingHeight:Number(n),u_opacitylinear:Number(i.enable),u_dir:"in"===i.dir?1:0};return this.getUniformsBufferInfo(o)}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t,n,r,o,a,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelParams(),n=t.frag,r=t.vert,o=t.triangulation,a=t.type,this.initUniformsBuffer(),this.layer.triangulation=o,e.next=5,this.layer.buildLayerModel({moduleName:a,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:o,primitive:k.gl.TRIANGLES,depth:{enable:!1}});case 5:return s=e.sent,e.abrupt("return",[s]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().opacityLinear;(void 0===e?{enable:!1,dir:"in"}:e).enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:k.AttributeType.Attribute,descriptor:{name:"a_linear",shaderLocation:I.q.LINEAR,buffer:{usage:k.gl.STATIC_DRAW,data:[],type:k.gl.FLOAT},size:3,update:function(e,t,n){return[n[3],n[4],n[5]]}}})}},{key:"getModelParams",value:function(){var e=this.layer.getLayerConfig().opacityLinear;return(void 0===e?{enable:!1}:e).enable?{frag:'\nlayout(std140) uniform commonUniforms {\n  float u_raisingHeight;\n  float u_opacitylinear;\n  float u_dir;\n};\n\nin vec4 v_color;\nin vec3 v_linear;\nin vec2 v_pos;\nout vec4 outputColor;\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nvoid main() {\n  outputColor = v_color;\n  if (u_opacitylinear > 0.0) {\n    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n  }\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 15) in vec3 a_linear;\n\nlayout(std140) uniform commonUniforms {\n  float u_raisingHeight;\n  float u_opacitylinear;\n  float u_dir;\n};\n\nout vec4 v_color;\nout vec3 v_linear;\nout vec2 v_pos;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  if (u_opacitylinear > 0.0) {\n    v_linear = a_linear;\n    v_pos = a_Position.xy;\n  }\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  project_pos.z += u_raisingHeight;\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n  setPickingColor(a_PickingColor);\n}',type:"polygonLinear",triangulation:P.T3}:{frag:'in vec4 v_color;\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\n\nlayout(std140) uniform commonUniforms {\n  float u_raisingHeight;\n};\n\n\nout vec4 v_color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n \n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n\n',type:"polygonFill",triangulation:P.Qr}}}]),o}(O.Z),z=function(e){d()(o,e);var t,n,r=m()(o);function o(){var e;u()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),y()(f()(e),"texture1",void 0),y()(f()(e),"texture2",void 0),y()(f()(e),"texture3",void 0),e}return c()(o,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),M()(M()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.watercolor,n=void 0===t?"#6D99A8":t,r=e.watercolor2,i=void 0===r?"#0F121C":r,o={u_watercolor:(0,L.CI)(n),u_watercolor2:(0,L.CI)(i),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};return this.textures=[this.texture1,this.texture2,this.texture3],this.getUniformsBufferInfo(o)}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_uv;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_watercolor;\n  vec4 u_watercolor2;\n  float u_time;\n};\n\n\nout vec2 v_uv;\nout float v_opacity;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n  v_opacity = opacity;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n}\n\n',fragmentShader:"\nlayout(std140) uniform commonUniforms {\n  vec4 u_watercolor;\n  vec4 u_watercolor2;\n  float u_time;\n};\n\nin vec2 v_uv;\nin float v_opacity;\nout vec4 outputColor;\n\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750; // change to adjust the \"heavy\" waves\nfloat large_wavesize        = 3.4;  // factor to adjust the large wave size\nfloat small_waveheight      = 0.6;  // change to adjust the small random waves\nfloat small_wavesize        = 0.5;   // factor to ajust the small wave size\nfloat water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)\nfloat water_glossylight_fact= 120.; // range [1..200]\nfloat particle_amount       = 70.;\n\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\n  \n\nfloat hash( float n ) {\n    return fract(sin(n)*43758.5453123);\n}\n\n// 2d noise function\nfloat noise1( in vec2 x ) {\n  vec2 p  = floor(x);\n  vec2 f  = smoothstep(0.0, 1.0, fract(x));\n  float n = p.x + p.y*57.0;\n  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\n\nfloat noise(vec2 p) {\n    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;\n}\n\nvec4 highness(vec2 p) {\n    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));\n    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\n    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\n\nfloat height_map( vec2 p ) {\n    vec4 height=highness(p);\n    /*\n    height = -0.5+\n        0.5*smoothstep(-100.,0.,-height)+\n        2.75*smoothstep(0.,2.,height)+\n        1.75*smoothstep(2.,4.,height)+\n        2.75*smoothstep(4.,16.,height)+\n        1.5*smoothstep(16.,1000.,height);\n    */\n\n    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\n    //p = p*6.;\n    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;\n    f += 0.2500*noise( p ); p = m*p*1.32;\n    f += 0.1666*noise( p ); p = m*p*1.11;\n    f += 0.0834*noise( p ); p = m*p*1.12;\n    f += 0.0634*noise( p ); p = m*p*1.13;\n    f += 0.0444*noise( p ); p = m*p*1.14;\n    f += 0.0274*noise( p ); p = m*p*1.15;\n    f += 0.0134*noise( p ); p = m*p*1.16;\n    f += 0.0104*noise( p ); p = m*p*1.17;\n    f += 0.0084*noise( p );\n    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\n        const float FLAT_LEVEL = 0.92525;\n        //f = f*0.25+height*0.75;\n    if (f<FLAT_LEVEL)\n        f = f;\n    else\n        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase\n    return clamp(f, 0., 10.);\n}\n\nvec3 plasma_quintic( float x ) {\n    x = clamp( x, 0.0, 1.0);\n    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3\n    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7\n    return vec3(\n        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\n        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\n        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\n\nvec4 color(vec2 p){\n    vec4 c1 = vec4(1.7,1.6,.9,1);\n    vec4 c2 = vec4(.2,.94,.1,1);\n    vec4 c3 = vec4(.3,.2,.0,1);\n    vec4 c4 = vec4(.99,.99,1.6,1);\n    vec4 v = highness(p);\n    float los = smoothstep(0.1,1.1,v.b);\n    float his = smoothstep(3.5,6.5,v.b);\n    float ces = smoothstep(1.,5.,v.a);\n    vec4 lo = mix(c1,c2,los);\n    vec4 hi = mix(c3,c4,his);\n    vec4 ce = mix(lo,hi,ces);\n\n    return vec4(plasma_quintic(ces),1).ragb;\n}\n\nvec3 terrain_map( vec2 p )\n{\n  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'\n}\n\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\n\nfloat water_map( vec2 p, float height ) {\n    vec2 p2 = p*large_wavesize;\n    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\n    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\n\n    // coarse crossing 'ocean' waves...\n    float f = 0.6000*noise( p );\n    f += 0.2500*noise( p*m );\n    f += 0.1666*noise( p*m*m );\n    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\n\n    p *= small_wavesize;\n    f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<9; i++)\n    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\n    \n    return wave+f*small_waveheight;\n}\n\nfloat nautic(vec2 p) {\n    p *= 18.;\n    float f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\n    return pow(1.-f, 5.);\n}\n\nfloat particles(vec2 p) {\n    p *= 200.;\n    float f = 0.;\n    float amp = 1.0, s = 1.5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\n    return pow(f*.35, 7.)*particle_amount;\n}\n\nfloat test_shadow( vec2 xy, float height) {\n    vec3 r0 = vec3(xy, height);\n    vec3 rd = normalize( light - r0 );\n    \n    float hit = 1.0;\n    float t   = 0.001;\n    for (int j=1; j<25; j++)\n    {\n        vec3 p = r0 + t*rd;\n        float h = height_map( p.xy );\n        float height_diff = p.z - h;\n        if (height_diff<0.0)\n        {\n            return 0.0;\n        }\n        t += 0.01+height_diff*.02;\n        hit = min(hit, 2.*height_diff/t); // soft shaddow   \n    }\n    return hit;\n}\n\nvec3 CalcTerrain(vec2 uv, float height) {\n    vec3 col = terrain_map( uv );\n    vec2 iResolution = vec2(512.);\n    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\n    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\n    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\n    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\n    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\n    vec3 r0 = vec3(uv, height);\n    vec3 rd = normalize( light - r0 );\n    float grad = dot(norm, rd);\n    col *= grad+pow(grad, 8.);\n    float terrainshade = test_shadow( uv, height );\n    col = mix(col*.25, col, terrainshade);\n    return col;\n}\n\n\nvoid main() {\n  vec3 watercolor = u_watercolor.rgb;\n  vec3 watercolor2 = u_watercolor2.rgb;\n  vec2 uv = v_uv;\n  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)\n  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\n  float height = height_map( uv );\n  vec3 col;\n\n    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\n    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\n    if (height > level)\n    {\n        col = CalcTerrain(uv, height);\n    }\n    if (height <= level)\n    {\n        vec2 dif = vec2(.0, .01);\n        vec2 pos = uv*15. + vec2(u_time*.01);\n        float h1 = water_map(pos-dif,waveheight);\n        float h2 = water_map(pos+dif,waveheight);\n        float h3 = water_map(pos-dif.yx,waveheight);\n        float h4 = water_map(pos+dif.yx,waveheight);\n        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane\n        uv += normwater.xy*.002*(level-height);\n        \n        col = CalcTerrain(uv, height);\n\n        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\n        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\n        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;\n        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\n\n        vec3 r0 = vec3(uv, WATER_LEVEL);\n        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position\n        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction\n        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          \n        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights\n        float gradpos  = dot(vec3(0., 0., 1.), rd);\n        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          \n        float watershade  = test_shadow( uv, level );\n        watercolor *= 2.2+watershade;\n        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\n        watercolor /= (1.+specular1*1.25);\n        watercolor += watershade*specular2*water_specularcolor;\n        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\n        \n        col = mix(col, watercolor, coastfade);\n    }\n    \n  outputColor = vec4(col, v_opacity);  \n}\n",inject:this.getInject(),triangulation:P.Qr,primitive:k.gl.TRIANGLES,depth:{enable:!1}});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t,n;null===(e=this.texture1)||void 0===e||e.destroy(),null===(t=this.texture2)||void 0===t||t.destroy(),null===(n=this.texture3)||void 0===n||n.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=w()(e,4),n=t[0],r=t[1],i=t[2],o=t[3],a=i-n,s=o-r;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:k.AttributeType.Attribute,descriptor:{name:"a_uv",shaderLocation:I.q.UV,buffer:{usage:k.gl.STATIC_DRAW,data:[],type:k.gl.FLOAT},size:2,update:function(e,t,i,o){var u="GAODE2.x"===e.version?e.originCoordinates[0][o]:i,l=w()(u,2),c=l[0],h=l[1];return[(c-n)/a,(h-r)/s]}}})}},{key:"loadTexture",value:function(){var e,t,n,r=this,i=this.rendererService.createTexture2D,o={height:0,width:0};function a(e){return i({data:e,width:e.width,height:e.height,wrapS:k.gl.MIRRORED_REPEAT,wrapT:k.gl.MIRRORED_REPEAT,min:k.gl.LINEAR,mag:k.gl.LINEAR})}this.texture1=i(o),this.texture2=i(o),this.texture3=i(o),e=function(e){r.texture1=a(e[0]),r.texture2=a(e[1]),r.texture3=a(e[2]),r.layerService.reRender()},t=0,n=[],["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map((function(r){var i=new Image;i.crossOrigin="",i.src=r,n.push(i),i.onload=function(){3==++t&&e(n)}}))}}]),o}(O.Z),G=function(e){d()(o,e);var t,n,r=m()(o);function o(){var e;u()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),y()(f()(e),"texture",void 0),e}return c()(o,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),M()(M()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig().speed,t={u_speed:void 0===e?.5:e,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(t)}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 14) in vec2 a_uv;\nlayout(std140) uniform commonUniforms {\n  float u_speed;\n  float u_time;\n};\nout vec4 v_Color;\nout vec2 v_uv;\n\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n  v_Color = a_Color;\n  v_Color.a *= opacity;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n}\n\n',fragmentShader:"uniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n  float u_speed;\n  float u_time;\n};\n\nout vec4 outputColor;\n\n\nin vec4 v_Color;\nin vec2 v_uv;\n\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\n\nfloat water(vec3 p) {\n  float t = u_time * u_speed;\n  p.z += t * 2.; p.x += t * 2.;\n  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;\n  p.z += t * 3.; p.x += t * 0.52;\n  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;\n  p.z += t * 4.; p.x += t * 0.8;\n  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;\n  c1 += c2 - c3;\n  float z = (c1.x + c1.y + c1.z) / 3.;\n  return p.y + z / 4.;\n}\n\nfloat map(vec3 p) {\n  float d = 100.0;\n  d = water(p);\n  return d;\n}\n\nfloat intersect(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i <= 100; i++) {\n    float h = map(ro + rd * d);\n    if (h < 0.1) return  d;\n    d += h;\n  }\n  return 0.0;\n}\n\nvec3 norm(vec3 p) {\n  float eps = .1;\n  return normalize(vec3(\n    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\n    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\n    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n  ));\n} \n\nfloat calSpc() {\n  vec3 l1 = normalize(vec3(1, 1, 1));\n  vec3 ro = vec3(-3, 20, -8);\n  vec3 rc = vec3(0, 0, 0);\n  vec3 ww = normalize(rc - ro);\n  vec3 uu = normalize(cross(vec3(0,1,0), ww));\n  vec3 vv = normalize(cross(rc - ro, uu));\n  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\n  float d = intersect(ro, rd);\n  vec3 p = ro + rd * d;\n  vec3 n = norm(p);\n  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\n  return spc;\n}\n\nvoid main() {\n\n  outputColor = v_Color;\n  float spc = calSpc();\n  outputColor += spc * 0.4;\n}\n",triangulation:P.Qr,inject:this.getInject(),primitive:k.gl.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=w()(e,4),n=t[0],r=t[1],i=t[2],o=t[3],a=i-n,s=o-r;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:k.AttributeType.Attribute,descriptor:{name:"a_uv",shaderLocation:I.q.UV,buffer:{usage:k.gl.STATIC_DRAW,data:[],type:k.gl.FLOAT},size:2,update:function(e,t,i,o){var u="GAODE2.x"===e.version?e.originCoordinates[0][o]:i,l=w()(u,2),c=l[0],h=l[1];return[(c-n)/a,(h-r)/s]}}})}},{key:"loadTexture",value:function(){var e=this,t=this.layer.getLayerConfig().waterTexture,n=this.rendererService.createTexture2D;this.texture=n({height:1,width:1});var r=new Image;r.crossOrigin="",t?(console.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),r.src=t):r.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:k.gl.MIRRORED_REPEAT,wrapT:k.gl.MIRRORED_REPEAT,min:k.gl.LINEAR,mag:k.gl.LINEAR}),e.layerService.reRender()}}}]),o}(O.Z),j={fill:U,line:b.Z,extrude:B,text:T.Z,point_fill:E.Z,point_image:S.Z,point_normal:A.Z,point_extrude:x.Z,water:G,ocean:z,extrusion:F},V=function(e){d()(r,e);var t,n=m()(r);function r(){var e;u()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),y()(f()(e),"type","PolygonLayer"),y()(f()(e),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),e}return c()(r,[{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new j[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"fill"!==n&&n?"extrude"===n?"extrude":"extrusion"===n?"extrusion":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":this.getPointModelType():"fill"}},{key:"getPointModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null==n?void 0:n.indexOf(a))?"point_fill":-1!==(null==r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]),r}(_.Z)},4767:function(e,t,n){"use strict";n.d(t,{Z:function(){return D}});var r=n(9558),i=n.n(r),o=n(9989),a=n.n(o),s=n(4528),u=n.n(s),l=n(8798),c=n.n(l),h=n(6626),f=n.n(h),p=n(7267),d=n.n(p),v=n(9913),m=n.n(v),g=n(9057),y=n.n(g),_=n(3301),b=n(1448),x=n.n(b),E=n(3292),S=n(6490),A=n(2606),T=n(4889),C=n(6999),w=function(e){d()(s,e);var t,n,r,o=m()(s);function s(){var e;u()(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),y()(f()(e),"texture",void 0),y()(f()(e),"colorTexture",void 0),e}return c()(s,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),x()(x()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.clampLow,i=void 0===r||r,o=e.clampHigh,a=void 0===o||o,s=e.noDataValue,u=void 0===s?-9999999:s,l=e.domain,c=e.rampColors,h=l||(0,S.ZB)(c);this.colorTexture=this.layer.textureService.getColorTexture(c,h);var f={u_domain:h,u_opacity:n||1,u_noDataValue:u,u_clampLow:i?1:0,u_clampHigh:(void 0!==a?a:i)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};return this.textures=[this.texture,this.colorTexture],this.getUniformsBufferInfo(f)}},{key:"getRasterData",value:(r=a()(i()().mark((function e(t){var n,r,o,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return e.abrupt("return",{data:t.data,width:t.width,height:t.height});case 4:return e.next=6,t.data;case 6:return n=e.sent,r=n.rasterData,o=n.width,a=n.height,e.abrupt("return",{data:Array.from(r),width:o,height:a});case 11:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t,n,r,o,a,s,u,l,c,h;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),t=this.layer.getSource(),n=this.rendererService,r=n.createTexture2D,o=n.queryVerdorInfo,a=t.data.dataArray[0],e.next=6,this.getRasterData(a);case 6:return s=e.sent,u=s.data,l=s.width,c=s.height,this.texture=r({data:new Float32Array(u),width:l,height:c,format:"WebGL1"===o()?E.gl.LUMINANCE:E.gl.RED,type:E.gl.FLOAT,alignment:1}),e.next=13,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:'\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_domain;\n  float u_opacity;\n  float u_noDataValue;\n  float u_clampLow;\n  float u_clampHigh;\n};\n\nout vec2 v_texCoord;\n\n#pragma include "projection"\n\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n}\n',fragmentShader:"layout(std140) uniform commonUniforms {\n  vec2 u_domain;\n  float u_opacity;\n  float u_noDataValue;\n  float u_clampLow;\n  float u_clampHigh;\n};\n\nuniform sampler2D u_rasterTexture;\nuniform sampler2D u_colorTexture;\n\nin vec2 v_texCoord;\n\nbool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }\n\nout vec4 outputColor;\n\nvoid main() {\n  // Can use any component here since u_rasterTexture is under luminance format.\n  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;\n  if (value == u_noDataValue || isnan_emu(value)) {\n    discard;\n  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {\n    discard;\n  } else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));\n    \n    outputColor = color;\n    outputColor.a = outputColor.a * u_opacity ;\n    if (outputColor.a < 0.01)\n      discard;\n  }\n}\n",triangulation:C.iC,primitive:E.gl.TRIANGLES,depth:{enable:!1},pickingEnabled:!1});case 13:return h=e.sent,e.abrupt("return",[h]);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{shaderLocation:T.q.UV,name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),s}(A.Z),R=n(2760),M=n.n(R),k=["data"],L=["rasterData"],O=function(e){d()(s,e);var t,n,r,o=m()(s);function s(){var e;u()(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),y()(f()(e),"texture",void 0),y()(f()(e),"dataOption",{}),e}return c()(s,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),x()(x()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.noDataValue,i=void 0===r?0:r,o=this.dataOption,a=o.rMinMax,s=void 0===a?[0,255]:a,u=o.gMinMax,l=void 0===u?[0,255]:u,c=o.bMinMax,h={u_rminmax:s,u_gminmax:l,u_bminmax:void 0===c?[0,255]:c,u_opacity:n||1,u_noDataValue:i,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(h)}},{key:"getRasterData",value:(r=a()(i()().mark((function e(t){var n,r,o,a,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return n=t.data,r=M()(t,k),this.dataOption=r,e.abrupt("return",x()({data:n},r));case 4:return e.next=6,t.data;case 6:if(o=e.sent,a=o.rasterData,s=M()(o,L),this.dataOption=s,!Array.isArray(a)){e.next=14;break}return e.abrupt("return",x()({data:a},s));case 14:return e.abrupt("return",x()({data:Array.from(a)},s));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"initModels",value:(n=a()(i()().mark((function e(){var t,n,r,o,a,s,u,l;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0],e.next=6,this.getRasterData(r);case 6:return o=e.sent,a=o.data,s=o.width,u=o.height,this.texture=n({data:new Float32Array(a),width:s,height:u,format:E.gl.RGB,type:E.gl.FLOAT}),e.next=13,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:'\nlayout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n vec2 u_rminmax;\n vec2 u_gminmax;\n vec2 u_bminmax;\n float u_opacity;\n float u_noDataValue;\n};\n\nout vec2 v_texCoord;\n\n#pragma include "projection"\n\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n}\n',fragmentShader:"uniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n vec2 u_rminmax;\n vec2 u_gminmax;\n vec2 u_bminmax;\n float u_opacity;\n float u_noDataValue;\n};\n\nin vec2 v_texCoord;\n\nout vec4 outputColor;\n\nvoid main() {\n\n  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;\n\n  if(rgb == vec3(u_noDataValue)) {\n    outputColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);\n  }\n\n  if(outputColor.a < 0.01)\n    discard;\n \n}",triangulation:C.iC,primitive:E.gl.TRIANGLES,depth:{enable:!1},pickingEnabled:!1});case 13:return l=e.sent,e.abrupt("return",[l]);case 15:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:T.q.UV,buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),s}(A.Z),P=function(e){d()(o,e);var t,n,r=m()(o);function o(){var e;u()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),y()(f()(e),"texture",void 0),e}return c()(o,[{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.clampLow,r=void 0===n||n,i=e.clampHigh,o=void 0===i||i,a=e.noDataValue,s=void 0===a?-9999999:a,u=e.domain,l=e.rampColors,c=e.colorTexture,h=e.rScaler,f=void 0===h?6553.6:h,p=e.gScaler,d=void 0===p?25.6:p,v=e.bScaler,m=void 0===v?.1:v,g=e.offset,y=void 0===g?1e4:g,_=u||(0,S.ZB)(l),b=c;c?this.layer.textureService.setColorTexture(c,l,_):b=this.layer.textureService.getColorTexture(l,_);var x={u_unpack:[f,d,m,y],u_domain:_,u_opacity:t||1,u_noDataValue:s,u_clampLow:r,u_clampHigh:void 0!==o?o:r,u_texture:this.texture,u_colorTexture:b};return this.textures=[this.texture,b],this.getUniformsBufferInfo(x)}},{key:"initModels",value:(n=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),t=this.layer.getSource(),n=this.rendererService.createTexture2D,e.next=5,t.data.images;case 5:return r=e.sent,this.texture=n({data:r[0],width:r[0].width,height:r[0].height,min:E.gl.LINEAR,mag:E.gl.LINEAR}),e.next=9,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 14) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n   vec4 u_unpack;\n   vec2 u_domain;\n   float u_opacity;\n   float u_noDataValue;\n   float u_clampLow;\n   float u_clampHigh;\n};\nout vec2 v_texCoord;\n#pragma include "projection"\n\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n}\n',fragmentShader:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nlayout(std140) uniform commonUniforms {\n vec4 u_unpack;\n vec2 u_domain;\n float u_opacity;\n float u_noDataValue;\n float u_clampLow;\n float u_clampHigh;\n};\n\nin vec2 v_texCoord;\nout vec4 outputColor;\n\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data =  texture(SAMPLER_2D(u_texture), coord,bias) * 255.0;\n    data.a = -1.0;\n    return dot(data, u_unpack);\n}\n\nvec4 getColor(float value) {\n   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec2 coord = vec2(normalisedValue, 0);\n    return  texture(SAMPLER_2D(u_colorTexture), coord);\n}\n\nvoid main() {\n  float value = getElevation(v_texCoord,0.0);\n  if (value == u_noDataValue) {\n    outputColor = vec4(0.0, 0, 0, 0.0);\n  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {\n     outputColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n   \n    outputColor = getColor(value);\n    outputColor.a =  outputColor.a * u_opacity ;\n      if(outputColor.a < 0.01)\n      discard;\n  }\n}\n",triangulation:C.iC,primitive:E.gl.TRIANGLES,depth:{enable:!1}});case 9:return o=e.sent,e.abrupt("return",[o]);case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:(t=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:T.q.UV,buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),o}(A.Z),I={raster:w,rasterRgb:O,raster3d:w,rasterTerrainRgb:P},N=n(1517),D=function(e){d()(r,e);var t,n=m()(r);function r(){var e;u()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),y()(f()(e),"type","RasterLayer"),e}return c()(r,[{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new I[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[this.getModelType()]}},{key:"getModelType",value:function(){switch(this.layerSource.getParserType()){case"raster":default:return"raster";case"rasterRgb":case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb"}}},{key:"getLegend",value:function(e){if("color"!==e)return{type:void 0,field:void 0,items:[]};var t=this.getLayerConfig().rampColors;return(0,N.I)(t,e)}}]),r}(_.Z)},8833:function(e,t,n){"use strict";n.d(t,{Z:function(){return oe}});var r=n(9558),i=n.n(r),o=n(9989),a=n.n(o),s=n(4528),u=n.n(s),l=n(8798),c=n.n(l),h=n(9057),f=n.n(h),p=n(6490),d=n(4479),v=n.n(d),m=function(){function e(t){var n=t.rendererService,r=t.layerService,i=t.parent;u()(this,e),f()(this,"tileResource",new Map),f()(this,"rendererService",void 0),f()(this,"layerService",void 0),f()(this,"parent",void 0),f()(this,"layerTiles",[]),this.rendererService=n,this.layerService=r,this.parent=i}var t;return c()(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(e){return this.layerTiles.some((function(t){return t.key===e}))}},{key:"addTile",value:function(e){this.layerTiles.push(e)}},{key:"getTile",value:function(e){return this.layerTiles.find((function(t){return t.key===e}))}},{key:"getVisibleTileBylngLat",value:function(e){return this.layerTiles.find((function(t){return t.isLoaded&&t.visible&&t.lnglatInBounds(e)}))}},{key:"removeTile",value:function(e){var t=this.layerTiles.findIndex((function(t){return t.key===e})),n=this.layerTiles.splice(t,1);n[0]&&n[0].destroy()}},{key:"updateTileVisible",value:function(e){var t=this.getTile(e.key);if(e.isVisible)if(e.parent){var n=this.isChildrenLoaded(e.parent);null==t||t.updateVisible(n)}else null==t||t.updateVisible(!0);else if(e.parent){var r=this.isChildrenLoaded(e.parent);null==t||t.updateVisible(!r)}else null==t||t.updateVisible(!1)}},{key:"isParentLoaded",value:function(e){var t=e.parent;if(!t)return!0;var n=this.getTile(null==t?void 0:t.key);return!(null==n||!n.isLoaded)}},{key:"isChildrenLoaded",value:function(e){var t=this,n=null==e?void 0:e.children;return 0===n.length||n.every((function(e){var n=t.getTile(null==e?void 0:e.key);return!n||!0===(null==n?void 0:n.isLoaded)}))}},{key:"render",value:(t=a()(i()().mark((function e(){var t,n,r=this;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getRenderLayers(),n=t.map(function(){var e=a()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.layerService.renderTileLayer(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(n);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getRenderLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.visible&&e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,v()(e.getLayers()))})),t}},{key:"getLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,v()(e.getLayers()))})),t}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach((function(e){return e.destroy()})),this.tileResource.clear()}}]),e}(),g=n(3100),y=n.n(g),_=n(1448),b=n.n(_),x=n(2928),E=n(7473),S=n(1772);var A=function(e,t,n){void 0===n&&(n={});var r=(0,S.wA)(e),i=(0,S.wA)(t),o=E.union(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?(0,x.yu)(o[0],n.properties):(0,x.tw)(o,n.properties)},T=function(){function e(){u()(this,e)}return c()(e,[{key:"getCombineFeature",value:function(e){var t=null,n=e[0];return e.map((function(e){var n=x.yu(e.coordinates);t=null===t?n:A(t,n)})),n&&(t.properties=b()({},n)),t}}]),e}(),C="select",w="active",R=function(){function e(t){var n=t.layerService,r=t.tileLayerService,i=t.parent;u()(this,e),f()(this,"layerService",void 0),f()(this,"tileLayerService",void 0),f()(this,"tileSourceService",void 0),f()(this,"parent",void 0),f()(this,"tilePickID",new Map),this.layerService=n,this.tileLayerService=r,this.parent=i,this.tileSourceService=new T}var t;return c()(e,[{key:"pickRender",value:function(e){var t=this.tileLayerService.getVisibleTileBylngLat(e.lngLat);if(t){var n=t.getMainLayer();null==n||n.layerPickService.pickRender(e)}}},{key:"pick",value:(t=a()(i()().mark((function e(t,n){var r,o,a,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.parent.getContainer(),o=r.pickingService,"RasterLayer"!==t.type){e.next=8;break}if(!(a=this.tileLayerService.getVisibleTileBylngLat(n.lngLat))||void 0===a.getMainLayer()){e.next=7;break}return s=a.getMainLayer(),e.abrupt("return",s.layerPickService.pickRasterLayer(s,n,this.parent));case 7:return e.abrupt("return",!1);case 8:return this.pickRender(n),e.abrupt("return",o.pickFromPickingFBO(t,n));case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"selectFeature",value:function(e){var t=y()(e,3),n=t[0],r=t[1],i=t[2],o=this.color2PickId(n,r,i);this.tilePickID.set(C,o),this.updateHighLight(n,r,i,C)}},{key:"highlightPickedFeature",value:function(e){var t=y()(e,3),n=t[0],r=t[1],i=t[2],o=this.color2PickId(n,r,i);this.tilePickID.set(w,o),this.updateHighLight(n,r,i,w)}},{key:"updateHighLight",value:function(e,t,n,r){this.tileLayerService.tiles.map((function(i){var o=i.getMainLayer();switch(r){case C:null==o||o.hooks.beforeSelect.call([e,t,n]);break;case w:null==o||o.hooks.beforeHighlight.call([e,t,n])}}))}},{key:"setPickState",value:function(){var e=this.tilePickID.get(C),t=this.tilePickID.get(w);if(e){var n=this.pickId2Color(e),r=y()(n,3),i=r[0],o=r[1],a=r[2];this.updateHighLight(i,o,a,C)}else if(t){var s=this.pickId2Color(t),u=y()(s,3),l=u[0],c=u[1],h=u[2];this.updateHighLight(l,c,h,w)}else;}},{key:"color2PickId",value:function(e,t,n){return(0,p.W0)(new Uint8Array([e,t,n]))}},{key:"pickId2Color",value:function(e){return(0,p.Z6)(e)}},{key:"getFeatureById",value:function(e){var t=this.tileLayerService.getTiles().filter((function(e){return e.visible})),n=[];return t.forEach((function(t){n.push.apply(n,v()(t.getFeatureById(e)))})),n}},{key:"pickRasterLayer",value:function(){return!1}}]),e}(),M=n(3292),k=n(7267),L=n.n(k),O=n(9913),P=n.n(O),I=n(5122),N=n(1452),D=n(6626),B=n.n(D),F=n(2490),U=n(7702);var z=function(e){L()(s,e);var t,n,r,o=P()(s);function s(e,t){var n;return u()(this,s),n=o.call(this),f()(B()(n),"x",void 0),f()(B()(n),"y",void 0),f()(B()(n),"z",void 0),f()(B()(n),"key",void 0),f()(B()(n),"parent",void 0),f()(B()(n),"sourceTile",void 0),f()(B()(n),"visible",!0),f()(B()(n),"layers",[]),f()(B()(n),"isLoaded",!1),f()(B()(n),"tileMaskLayers",[]),f()(B()(n),"tileMask",void 0),n.parent=t,n.sourceTile=e,n.x=e.x,n.y=e.y,n.z=e.z,n.key="".concat(n.x,"_").concat(n.y,"_").concat(n.z),n}return c()(s,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(e){var t=y()(this.sourceTile.bounds,4),n=t[0],r=t[1],i=t[2],o=t[3],a=e.lng,s=e.lat;return a>=n&&a<=i&&s>=r&&s<=o}},{key:"getLayerOptions",value:function(){var e,t,n=this.parent.getLayerConfig();return b()(b()({},n),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:(t=this.parent.type,-1!==["PolygonLayer","LineLayer"].indexOf(t)),mask:n.mask||0!==(null===(e=n.maskLayers)||void 0===e?void 0:e.length)&&n.enableMask})}},{key:"getMaskLayer",value:function(){var e=this,t=this.parent.getLayerConfig().maskLayers,n=[];return null==t||t.forEach((function(t){if(!t.tileLayer)return n.push(t),t;var r=t.tileLayer.getTile(e.sourceTile.key),i=null==r?void 0:r.getLayers()[0];i&&n.push(i)})),n}},{key:"addTileMask",value:(r=a()(i()().mark((function e(){var t,n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new U.Z({name:"mask",visible:!0,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").color("#0f0").style({opacity:.5}),n=(0,M.createLayerContainer)(this.parent.container),t.setContainer(n),e.next=5,t.init();case 5:return this.tileMask=t,void 0!==(r=this.getMainLayer())&&(r.tileMask=t),e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"addMask",value:(n=a()(i()().mark((function e(t,n){var r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,M.createLayerContainer)(this.parent.container),n.setContainer(r),e.next=4,n.init();case 4:t.addMask(n),this.tileMaskLayers.push(n);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"addLayer",value:(t=a()(i()().mark((function e(t){var n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isTileLayer=!0,n=(0,M.createLayerContainer)(this.parent.container),t.setContainer(n),this.layers.push(t),e.next=6,t.init();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateVisible",value:function(e){this.visible=e,this.updateOptions("visible",e)}},{key:"updateOptions",value:function(e,t){this.layers.forEach((function(n){n.updateLayerConfig(f()({},e,t))}))}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(e){return[]}},{key:"getFeatureById",value:function(e){return[]}},{key:"destroy",value:function(){var e;null===(e=this.tileMask)||void 0===e||e.destroy(),this.layers.forEach((function(e){return e.destroy()}))}}]),s}(F.EventEmitter),G=function(e){L()(r,e);var t,n=P()(r);function r(){return u()(this,r),n.apply(this,arguments)}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSourceOption(),n=t.data.features[0].properties,r=(new I.Z).source(t.data,t.options).size(1).shape("line").color("red"),o=new N.Z({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([n],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),e.next=6,this.addLayer(r);case 6:return e.next=8,this.addLayer(o);case 8:this.isLoaded=!0;case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:e.transforms}}}}]),r}(z),j=n(7904),V=function(e){L()(r,e);var t,n=P()(r);function r(){return u()(this,r),n.apply(this,arguments)}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),o=new j.Z(b()({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;o[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(o);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),r}(z),H=n(240),W=function(e){L()(r,e);var t,n=P()(r);function r(){return u()(this,r),n.apply(this,arguments)}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),o=new H.Z(b()({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;o[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(o);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getFeatures",value:function(e){return e?this.sourceTile.data.getTileData(e):[]}},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=t.featureId;return{data:{type:"FeatureCollection",features:this.getFeatures(n)},options:{parser:{type:"geojson",featureId:r},transforms:e.transforms}}}}]),r}(z),Z=n(2760),X=n.n(Z),Y=n(4767),q=["rasterData"],K=function(e){L()(r,e);var t,n=P()(r);function r(){return u()(this,r),n.apply(this,arguments)}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),o=new Y.Z(b()({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;o[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(o);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=X()(t,q);return{data:n,options:{parser:b()({type:"rasterRgb",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}}]),r}(z),Q=function(e){L()(r,e);var t,n=P()(r);function r(){return u()(this,r),n.apply(this,arguments)}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),o=new Y.Z(b()({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;o[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(o);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),r}(z),$=["rasterData"],J={positions:[0,1],colors:["#000","#fff"]},ee=function(e){L()(r,e);var t,n=P()(r);function r(){var e;u()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),f()(B()(e),"colorTexture",void 0),e}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o,a,s,u;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),o=this.getLayerOptions(),a=o.rampColors,s=o.domain,this.colorTexture=this.parent.textureService.getColorTexture(a,s),u=new Y.Z(b()(b()({},n),{},{colorTexture:this.colorTexture})).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;u[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=9,this.addLayer(u);case 9:this.isLoaded=!0;case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=X()(t,$);return{data:n,options:{parser:b()({type:"raster",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}},{key:"styleUpdate",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n,o=i.rampColors,a=void 0===o?J:o,s=i.domain;this.colorTexture=this.parent.textureService.getColorTexture(a,s||(0,p.ZB)(a)),this.layers.forEach((function(t){return t.style({colorTexture:e.colorTexture})}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){return e.destroy()}))}}]),r}(z),te=function(e){L()(r,e);var t,n=P()(r);function r(){return u()(this,r),n.apply(this,arguments)}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),i=this.parent.type,r="PolygonLayer"===i?U.Z:"LineLayer"===i?I.Z:N.Z,o=this.getSourceOption()){e.next=8;break}return this.isLoaded=!0,this.emit("loaded"),e.abrupt("return");case 8:return a=new r(b()({},n)).source(o.data,o.options),Object.keys(t).forEach((function(e){var n,r,i=e;a[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=12,this.addLayer(a);case 12:if(!n.tileMask){e.next=15;break}return e.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(a),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return e.stop()}var i}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=void 0===n?"defaultLayer":n,i=t.featureId,o=void 0===i?"id":i;return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:o},transforms:e.transforms}}}},{key:"setLayerMinMaxZoom",value:function(e){"text"===e.getModelType()&&e.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(e){return this.sourceTile.data.getTileData(e)}},{key:"getFeatureById",value:function(e){var t=this.getMainLayer();return t?t.getSource().data.dataArray.filter((function(t){return t._id===e})):[]}}]),r}(z);function ne(e){switch(e.type){case"PolygonLayer":case"LineLayer":case"PointLayer":return te;case"TileDebugLayer":return G;case"MaskLayer":return W;case"RasterLayer":switch(e.getSource().parser.dataType){case M.RasterTileType.RGB:case M.RasterTileType.CUSTOMRGB:return K;case M.RasterTileType.ARRAYBUFFER:case M.RasterTileType.CUSTOMARRAYBUFFER:return ee;case M.RasterTileType.TERRAINRGB:case M.RasterTileType.CUSTOMTERRAINRGB:return Q;default:return V}default:return te}}var re=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],ie=p.rU.debounce,oe=function(){function e(t){var n=this;u()(this,e),f()(this,"parent",void 0),f()(this,"tileLayerService",void 0),f()(this,"mapService",void 0),f()(this,"layerService",void 0),f()(this,"rendererService",void 0),f()(this,"pickingService",void 0),f()(this,"tilePickService",void 0),f()(this,"tilesetManager",void 0),f()(this,"initedTileset",!1),f()(this,"lastViewStates",void 0),f()(this,"mapchange",(function(){var e;if(!1!==n.parent.isVisible()){var t=n.getCurrentView(),r=t.latLonBounds,i=t.zoom;if("GAODE1.x"===n.mapService.version){var o=n.parent.getLayerConfig().visible;i<2&&o?(n.parent.updateLayerConfig({visible:!1}),n.layerService.reRender()):i>=2&&!o&&(n.parent.updateLayerConfig({visible:!0}),n.layerService.reRender())}n.lastViewStates&&n.lastViewStates.zoom===i&&n.lastViewStates.latLonBounds.toString()===r.toString()||(n.lastViewStates={zoom:i,latLonBounds:r},null===(e=n.tilesetManager)||void 0===e||e.throttleUpdate(i,r))}})),f()(this,"viewchange",ie(this.mapchange,24)),this.parent=t;var r=this.parent.getContainer();this.rendererService=r.rendererService,this.layerService=r.layerService,this.mapService=r.mapService,this.pickingService=r.pickingService,this.tileLayerService=new m({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new R({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}var t;return c()(e,[{key:"initTileSetManager",value:function(){var e,t=this.parent.getSource();if(this.tilesetManager=t.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),!1!==this.parent.isVisible()){var n=this.getCurrentView(),r=n.latLonBounds,i=n.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(i,r)}}},{key:"getCurrentView",value:function(){var e=this.mapService.getBounds();return{latLonBounds:[e[0][0],e[0][1],e[1][0],e[1][1]],zoom:this.mapService.getZoom()}}},{key:"bindTilesetEvent",value:function(){var e=this;this.tilesetManager.on("tile-loaded",(function(e){})),this.tilesetManager.on("tile-unload",(function(t){e.tileUnLoad(t)})),this.tilesetManager.on("tile-error",(function(t,n){e.tileError(t)})),this.tilesetManager.on("tile-update",(function(){e.tileUpdate()})),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(e){return this.tileLayerService.getTile(e)}},{key:"tileLoaded",value:function(e){}},{key:"tileError",value:function(e){console.warn("error:",e)}},{key:"destroy",value:function(){var e;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),null===(e=this.tilesetManager)||void 0===e||e.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var e;this.tilesetManager.clear();var t=this.getCurrentView(),n=t.latLonBounds,r=t.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(r,n)}},{key:"tileUnLoad",value:function(e){this.tileLayerService.removeTile(e.key)}},{key:"tileUpdate",value:(t=a()(i()().mark((function e(){var t,n,r,o=this;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tilesetManager){e.next=2;break}return e.abrupt("return");case 2:return t=this.parent.getMinZoom(),n=this.parent.getMaxZoom(),r=this.tilesetManager.tiles.filter((function(e){return e.isLoaded})).filter((function(e){return e.isVisibleChange})).filter((function(e){return e.data})).filter((function(e){return e.z>=t&&e.z<n})),e.next=7,Promise.all(r.map(function(){var e=a()(i()().mark((function e(t){var n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.tileLayerService.hasTile(t.key)){e.next=9;break}return n=ne(o.parent),r=new n(t,o.parent),e.next=5,r.initTileLayer();case 5:o.tilePickService.setPickState(),0!==r.getLayers().length&&(o.tileLayerService.addTile(r),o.tileLayerService.updateTileVisible(t),o.layerService.reRender()),e.next=12;break;case 9:o.tileLayerService.updateTileVisible(t),o.tilePickService.setPickState(),o.layerService.reRender();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setPickState",value:function(e){}},{key:"pickRender",value:function(e){this.tilePickService.pickRender(e)}},{key:"selectFeature",value:function(e){this.tilePickService.selectFeature(e)}},{key:"highlightPickedFeature",value:function(e){this.tilePickService.highlightPickedFeature(e)}},{key:"proxy",value:function(e){var t=this;re.forEach((function(n){var r=e[n].bind(e);e[n]=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r.apply(void 0,o),t.getLayers().map((function(e){e[n].apply(e,o)})),"style"===n&&t.getTiles().forEach((function(e){return e.styleUpdate.apply(e,o)})),e}}))}}]),e}()},8685:function(e,t,n){"use strict";n.d(t,{y:function(){return a}});var r=n(9057),i=n.n(r),o=n(3292),a=i()(i()(i()(i()(i()(i()({},o.BlendType.additive,{enable:!0,func:{srcRGB:o.gl.ONE,dstRGB:o.gl.ONE,srcAlpha:1,dstAlpha:1}}),o.BlendType.none,{enable:!1}),o.BlendType.normal,{enable:!0,func:{srcRGB:o.gl.SRC_ALPHA,dstRGB:o.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),o.BlendType.subtractive,{enable:!0,func:{srcRGB:o.gl.ONE,dstRGB:o.gl.ONE,srcAlpha:o.gl.ZERO,dstAlpha:o.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:o.gl.FUNC_SUBTRACT,alpha:o.gl.FUNC_SUBTRACT}}),o.BlendType.max,{enable:!0,func:{srcRGB:o.gl.ONE,dstRGB:o.gl.ONE},equation:{rgb:o.gl.MAX_EXT}}),o.BlendType.min,{enable:!0,func:{srcRGB:o.gl.ONE,dstRGB:o.gl.ONE},equation:{rgb:o.gl.MIN_EXT}})},1517:function(e,t,n){"use strict";n.d(t,{I:function(){return o}});var r=n(9057),i=n.n(r);function o(e,t){return{type:e.type,field:"value",items:e.positions.map((function(n,r){return i()(i()({},t,r>=e.colors.length?null:e.colors[r]),"value",n)}))}}},8459:function(){},8088:function(e,t,n){"use strict";n.d(t,{Gp:function(){return ct},zr:function(){return $e},rh:function(){return v},IY:function(){return Er},lg:function(){return Xe},nb:function(){return Ge},DP:function(){return Xe},b6:function(){return ci},D5:function(){return Tr},H0:function(){return Ur},T:function(){return D.T},pc:function(){return Pr},Qs:function(){return ei},yh:function(){return qr},l_:function(){return me}});var r=n(4528),i=n.n(r),o=n(8798),a=n.n(o),s=n(7267),u=n.n(s),l=n(9913),c=n.n(l),h=n(1448),f=n.n(h),p=n(9057),d=n.n(p),v=function(){function e(t){i()(this,e),d()(this,"configService",void 0),d()(this,"config",void 0),this.config=t}return a()(e,[{key:"setContainer",value:function(e,t,n){this.configService=e.globalConfigService,e.mapConfig=f()(f()({},this.config),{},{id:t,canvas:n}),e.mapService=new(this.getServiceConstructor())(e)}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),m=n(3100),g=n.n(m),y=n(1088),_=n.n(y),b=n(4479),x=n.n(b),E=n(9558),S=n.n(E),A=n(2760),C=n.n(A),w=n(9989),R=n.n(w),M=n(6626),k=n.n(M),L=n(3292),O=n(3311),P=n(1648),I=n(7282),N=n.n(I),D=n(6490),B=n(2490);function F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function U(e){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}function z(e){var t=function(e,t){if("object"!=U(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=U(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==U(t)?t:t+""}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,z(r.key),r)}}function j(e,t,n){return t&&G(e.prototype,t),n&&G(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function V(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function H(e,t){if(t&&("object"===U(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return V(e)}function W(e){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},W(e)}function Z(e,t){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Z(e,t)}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var q=n(6749);function K(e,t){var n=q.fF([],t,e);return q.bA(n,n,1/n[3]),n}var Q=n(6568);function $(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var J=Math.PI,ee=J/4,te=J/180,ne=180/J,re=4003e4;function ie(e){return Math.pow(2,e)}function oe(e,t){var n=Y(e,2),r=n[0],i=n[1];$(Number.isFinite(r)&&Number.isFinite(t)),$(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*te;return[(t*=512)*(r*te+J)/(2*J),t*(J-Math.log(Math.tan(ee+.5*o)))/(2*J)]}function ae(e,t){var n=Y(e,2),r=n[0],i=n[1],o=r/(t*=512)*(2*J)-J,a=2*(Math.atan(Math.exp(J-i/t*(2*J)))-ee);return[o*ne,a*ne]}function se(e){var t=e.latitude,n=e.longitude,r=e.zoom,i=e.scale,o=e.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:ie(r),$(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=512*i,l=Math.cos(t*te),c=u/360,h=c/l,f=u/re/l;if(s.pixelsPerMeter=[f,-f,f],s.metersPerPixel=[1/f,-1/f,1/f],s.pixelsPerDegree=[c,-h,f],s.degreesPerPixel=[1/c,-1/h,1/f],a){var p=te*Math.tan(t*te)/l,d=c*p/2,v=u/re*p,m=v/h*f;s.pixelsPerDegree2=[0,-d,v],s.pixelsPerMeter2=[m,0,m]}return s}function ue(e){var t=e.height,n=e.pitch,r=e.bearing,i=e.altitude,o=e.center,a=void 0===o?null:o,s=e.flipY,u=void 0!==s&&s,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return O.translate(l,l,[0,0,-i]),O.scale(l,l,[1,1,1/t]),O.rotateX(l,l,-n*te),O.rotateZ(l,l,r*te),u&&O.scale(l,l,[1,-1,1]),a&&O.translate(l,l,P.negate([],a)),l}function le(e){var t=e.width,n=e.height,r=e.pitch,i=function(e){var t=e.width,n=e.height,r=e.altitude,i=void 0===r?1.5:r,o=e.pitch,a=void 0===o?0:o,s=e.nearZMultiplier,u=void 0===s?1:s,l=e.farZMultiplier,c=void 0===l?1:l,h=a*te,f=Math.atan(.5/i),p=Math.sin(f)*i/Math.sin(Math.PI/2-h-f),d=Math.cos(Math.PI/2-h)*p+i;return{fov:2*Math.atan(n/2/i),aspect:t/n,focalDistance:i,near:u,far:d*c}}({width:t,height:n,altitude:e.altitude,pitch:r,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),o=i.fov,a=i.aspect,s=i.near,u=i.far;return O.perspective([],o,a,s,u)}function ce(e,t){var n=Y(e,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return $(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),K(t,[r,i,a,1])}function he(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Y(e,3),i=r[0],o=r[1],a=r[2];if($(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=K(t,[i,o,a,1]);return s}var u=K(t,[i,o,0,1]),l=K(t,[i,o,1,1]),c=u[2],h=l[2],f=c===h?0:((n||0)-c)/(h-c);return Q.t7([],u,l,f)}var fe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],pe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width,r=t.height,i=t.viewMatrix,o=void 0===i?fe:i,a=t.projectionMatrix,s=void 0===a?fe:a;F(this,e),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=s;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];O.multiply(u,u,this.projectionMatrix),O.multiply(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];O.scale(l,l,[this.width/2,-this.height/2,1]),O.translate(l,l,[1,-1,0]),O.multiply(l,l,this.viewProjectionMatrix);var c=O.invert([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=c,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return j(e,[{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&O.equals(t.projectionMatrix,this.projectionMatrix)&&O.equals(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=this.projectPosition(e),o=ce(i,this.pixelProjectionMatrix),a=Y(o,2),s=a[0],u=a[1],l=r?u:this.height-u;return 2===e.length?[s,l]:[s,l,o[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=t.targetZ,o=Y(e,3),a=o[0],s=o[1],u=o[2],l=r?s:this.height-s,c=i&&i*this.pixelsPerMeter,h=he([a,l,u],this.pixelUnprojectionMatrix,c),f=this.unprojectPosition(h),p=Y(f,3),d=p[0],v=p[1],m=p[2];return Number.isFinite(u)?[d,v,m]:Number.isFinite(i)?[d,v,i]:[d,v]}},{key:"projectPosition",value:function(e){var t=Y(this.projectFlat(e),2);return[t[0],t[1],(e[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(e){var t=Y(this.unprojectFlat(e),2);return[t[0],t[1],(e[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}},{key:"unprojectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}}]),e}();function de(e){var t=e.width,n=e.height,r=e.bounds,i=e.minExtent,o=void 0===i?0:i,a=e.maxZoom,s=void 0===a?24:a,u=e.padding,l=void 0===u?0:u,c=e.offset,h=void 0===c?[0,0]:c,f=Y(r,2),p=Y(f[0],2),d=p[0],v=p[1],m=Y(f[1],2),g=m[0],y=m[1];if(Number.isFinite(l)){l={top:l,bottom:l,left:l,right:l}}else $(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var _=new ve({width:t,height:n,longitude:0,latitude:0,zoom:0}),b=_.project([d,y]),x=_.project([g,v]),E=[Math.max(Math.abs(x[0]-b[0]),o),Math.max(Math.abs(x[1]-b[1]),o)],S=[t-l.left-l.right-2*Math.abs(h[0]),n-l.top-l.bottom-2*Math.abs(h[1])];$(S[0]>0&&S[1]>0);var A=S[0]/E[0],T=S[1]/E[1],C=(l.right-l.left)/2/A,w=(l.bottom-l.top)/2/T,R=[(x[0]+b[0])/2+C,(x[1]+b[1])/2+w],M=_.unproject(R),k=_.zoom+Math.log2(Math.abs(Math.min(A,T)));return{longitude:M[0],latitude:M[1],zoom:Math.min(k,s)}}var ve=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,a=void 0===o?0:o,s=n.longitude,u=void 0===s?0:s,l=n.zoom,c=void 0===l?0:l,h=n.pitch,f=void 0===h?0:h,p=n.bearing,d=void 0===p?0:p,v=n.altitude,m=void 0===v?1.5:v,g=n.nearZMultiplier,y=n.farZMultiplier;F(this,t),r=r||1,i=i||1;var _=ie(c);m=Math.max(.75,m);var b=oe([u,a],_);b[2]=0;var x=le({width:r,height:i,pitch:f,bearing:d,altitude:m,nearZMultiplier:g||1/i,farZMultiplier:y||1.01}),E=ue({height:i,center:b,pitch:f,bearing:d,altitude:m,flipY:!0});return(e=H(this,W(t).call(this,{width:r,height:i,viewMatrix:E,projectionMatrix:x}))).latitude=a,e.longitude=u,e.zoom=c,e.pitch=f,e.bearing=d,e.altitude=m,e.scale=_,e.center=b,e.pixelsPerMeter=se(V(V(e))).pixelsPerMeter[2],Object.freeze(V(V(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z(e,t)}(t,e),j(t,[{key:"projectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return oe(e,t)}},{key:"unprojectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return ae(e,t)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t=e.lngLat,n=he(e.pos,this.pixelUnprojectionMatrix),r=oe(t,this.scale),i=Q.IH([],r,Q.tk([],n));return ae(Q.IH([],this.center,i),this.scale)}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=de(Object.assign({width:r,height:i,bounds:e},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new t({width:r,height:i,longitude:a,latitude:s,zoom:u})}}]),t}(pe),me=function(){function e(){i()(this,e),d()(this,"viewport",void 0)}return a()(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth,s=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new ve(f()(f()({},s),{},{width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),ge=function(){function e(t){i()(this,e),d()(this,"size",1e4),this.size=t||1e4}return a()(e,[{key:"setSize",value:function(e){this.size=e}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(e){return(180+e)/360*this.size}},{key:"mercatorYfromLat",value:function(e){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(e){return e/this.size*360-180}},{key:"latFromMercatorY",value:function(e){var t=180-360*(1-e/this.size);return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}},{key:"project",value:function(e){return[this.mercatorXfromLng(e[0]),this.mercatorYfromLat(e[1])]}},{key:"unproject",value:function(e){return[this.lngFromMercatorX(e[0]),this.latFromMercatorY(e[1])]}}]),e}();function ye(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={top:0,right:0,bottom:0,left:0};if("number"==typeof e)return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(4===e.length)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(2===e.length)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return f()(f()({},t),e)}var _e={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},be=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n.amap-copyright {\n  display: none !important;\n}\n");var xe={"GAODE1.x":{contextmenu:"rightclick"},"GAODE2.x":{contextmenu:"rightclick",camerachange:"viewchange"}},Ee=0;window.forceWebGL=!0;var Se="15cd8a57710d40c9b7c0e3cc120f1200",Ae=!1,Te=[],Ce=function(){function e(t){var n=this;i()(this,e),d()(this,"version",D.T["GAODE1.x"]),d()(this,"simpleMapCoord",new ge),d()(this,"map",void 0),d()(this,"bgColor","rgba(0, 0, 0, 0)"),d()(this,"configService",void 0),d()(this,"config",void 0),d()(this,"coordinateSystemService",void 0),d()(this,"eventEmitter",void 0),d()(this,"markerContainer",void 0),d()(this,"$mapContainer",void 0),d()(this,"cameraChangedCallback",void 0),d()(this,"handleCameraChanged",(function(e){var t=e.camera,r=t.fov,i=t.near,o=t.far,a=t.height,s=t.pitch,u=t.rotation,l=t.aspect,c=t.position,h=n.getCenter(),f=h.lng,p=h.lat;if(n.emit("mapchange"),n.cameraChangedCallback){n.viewport.syncWithMapCamera({aspect:l,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:n.map.getZoom()-1,center:[f,p],offsetOrigin:[c.x,c.y]});var d=n.config.offsetZoom,v=void 0===d?12:d;n.viewport.getZoom()>v?n.coordinateSystemService.setCoordinateSystem(L.CoordinateSystem.P20_OFFSET):n.coordinateSystemService.setCoordinateSystem(L.CoordinateSystem.P20),n.cameraChangedCallback(n.viewport)}})),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new B.EventEmitter}var t;return a()(e,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];this.markerContainer=D.SO.create("div","l7-marker-container",t)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==L.MapServiceEvent.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(xe[this.version][e]||e,t)}},{key:"off",value:function(e,t){-1!==L.MapServiceEvent.indexOf(e)?this.eventEmitter.off(e,t):this.map.off(xe[this.version][e]||e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-maps")[0]}},{key:"getCanvasOverlays",value:function(){var e;return null===(e=this.$mapContainer)||void 0===e?void 0:e.querySelector(".amap-overlays")}},{key:"getSize",value:function(){var e=this.map.getSize();return[e.getWidth(),e.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(e){return this.map.setZoom(e+1)}},{key:"getCenter",value:function(e){if(null!=e&&e.padding){var t=this.getCenter(),n=ye(e.padding),r=this.lngLatToPixel([t.lng,t.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}var o=this.map.getCenter();return{lng:o.getLng(),lat:o.getLat()}}},{key:"setCenter",value:function(e,t){if(null!=t&&t.padding){var n=ye(t.padding),r=this.lngLatToPixel(e),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var e=this.map.getBounds().toBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.get("zooms")[0]-1}},{key:"getMaxZoom",value:function(){return this.map.get("zooms")[1]-1}},{key:"setRotation",value:function(e){return this.map.setRotation(e)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(e,t)}},{key:"fitBounds",value:function(e){this.map.setBounds(new AMap.Bounds([e[0][0],e[0][1],e[1][0],e[1][1]]))}},{key:"setZoomAndCenter",value:function(e,t){this.map.setZoomAndCenter(e+1,t)}},{key:"setMapStyle",value:function(e){this.map.setMapStyle(this.getMapStyleValue(e))}},{key:"setMapStatus",value:function(e){this.map.setStatus(e)}},{key:"getMapStyleConfig",value:function(){return _e}},{key:"getMapStyleValue",value:function(e){return this.getMapStyleConfig()[e]||e}},{key:"getMapStyle",value:function(){return this.map.getMapStyle()}},{key:"pixelToLngLat",value:function(e){var t=this.map.pixelToLngLat(new AMap.Pixel(e[0],e[1]));return{lng:t.getLng(),lat:t.getLat()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lnglatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"containerToLngLat",value:function(e){var t=new AMap.Pixel(e[0],e[1]),n=this.map.containerToLngLat(t);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(e){var t=new AMap.LngLat(e[0],e[1]),n=this.map.lngLatToContainer(t);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToCoord",value:function(e){var t=this.map.lngLatToGeodeticCoord(e);return[t.x,-t.y]}},{key:"lngLatToMercator",value:function(e,t){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=O.create();return O.translate(o,o,P.fromValues(i[0],i[1],t)),O.scale(o,o,P.fromValues(r[0],r[1],r[2])),O.rotateX(o,o,n[0]),O.rotateY(o,o,n[1]),O.rotateZ(o,o,n[2]),o}},{key:"init",value:(t=R()(S()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p,d,v,m=this;return S()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,l=t.token,c=void 0===l?Se:l,h=t.mapInstance,p=t.plugin,d=void 0===p?[]:p,v=C()(t,be),e.next=3,new Promise((function(e){var t=function(){if(h)m.map=h,m.$mapContainer=m.map.getContainer(),setTimeout((function(){m.map.on("camerachange",m.handleCameraChanged),e()}),30);else{m.$mapContainer=m.creatMapContainer(n);var t=f()({mapStyle:m.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},v);t.zoom&&(t.zoom+=1);var r=new AMap.Map(m.$mapContainer,t);r.on("camerachange",m.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return m.handleAfterMapChange()}))})),m.map=r,setTimeout((function(){e()}),10)}};Ae||h?Ae&&window.AMap||h?t():Te.push(t):(c===Se&&console.warn("%c".concat(m.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),Ae=!0,d.push("Map3D"),N().load({key:c,version:"1.4.15",plugins:d}).then((function(){t(),Te.length&&(Te.forEach((function(e){return e()})),Te=[])})).catch((function(e){throw new Error(e)})))}));case 3:this.viewport=new me;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"meterToCoord",value:function(e,t){var n=AMap.GeometryUtil.distance(_()(AMap.LngLat,x()(e)),_()(AMap.LngLat,x()(t))),r=this.lngLatToCoord(e),i=g()(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(t),u=g()(s,2),l=u[0],c=u[1];return Math.sqrt(Math.pow(o-l,2)+Math.pow(a-c,2))/n}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"destroy",value:function(){var e;null===(e=this.$mapContainer)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.$mapContainer),delete window.initAMap;var t=document.getElementById("amap-script");t&&document.head.removeChild(t),this.map.destroy()}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n       position: absolute;\n       top: 0;\n       height: 100%;\n       width: 100%;\n     ",n.id="l7_amap_div"+Ee++,t.appendChild(n),n}}]),e}();if(!window)throw Error("AMap JSAPI can only be used in Browser.");var we=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(we||{}),Re={key:"",AMap:{version:"2.0",plugins:[]}},Me={AMap:we.notload},ke=[],Le=function(e){if("function"==typeof e){if(Me.AMap===we.loaded)return void e(window.AMap);ke.push(e)}},Oe=function(){var e=R()(S()().mark((function e(t){return S()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(Me.AMap===we.failed)n("");else if(Me.AMap===we.notload){var r=t.key,i=t.version,o=t.plugins;if(!r)return void n("请填写key");window.AMap&&"lbs.amap.com"!==location.host&&n("禁止多种API加载方式混用"),Re.key=r,Re.AMap.version=i||Re.AMap.version,Re.AMap.plugins=o||Re.AMap.plugins,Me.AMap=we.loading;var a=document.body||document.head;window._onAPILoaded=function(t){t?(Me.AMap=we.failed,n(t)):(Me.AMap=we.loaded,e(null))};var s=document.createElement("script");s.type="text/javascript",s.async=!1,s.src="https://webapi.amap.com/maps?callback=_onAPILoaded&v="+Re.AMap.version+"&key="+r+"&plugin="+Re.AMap.plugins.join(","),s.onerror=function(e){Me.AMap=we.failed,n(e)},a.appendChild(s)}else if(Me.AMap===we.loaded){if(t.key&&t.key!==Re.key)return void n("多个不一致的 key");if(t.version&&t.version!==Re.AMap.version)return void n("不允许多个版本 JSAPI 混用");var u=[];t.plugins&&t.plugins.forEach((function(e){-1===Re.AMap.plugins.indexOf(e)&&u.push(e)})),u.length&&window.AMap.plugin(u,(function(){e(window.AMap)}))}else{if(t.key&&t.key!==Re.key)return void n("多个不一致的 key");if(t.version&&t.version!==Re.AMap.version)return void n("不允许多个版本 JSAPI 混用");var l=[];t.plugins&&t.plugins.forEach((function(e){-1===Re.AMap.plugins.indexOf(e)&&l.push(e)})),Le((function(){l.length&&window.AMap.plugin(l,(function(){e(window.AMap)}))}))}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var Pe={load:Oe,reset:function(){delete window.AMap,Re={key:"",AMap:{version:"1.4.15",plugins:[]}},Me={AMap:we.notload}}},Ie=Math.PI/180,Ne=function(){function e(){i()(this,e),d()(this,"projectionMatrix",O.create()),d()(this,"viewMatrix",O.create()),d()(this,"viewProjectionMatrix",O.create()),d()(this,"ViewProjectionMatrixUncentered",O.create()),d()(this,"viewUncenteredMatrix",O.create()),d()(this,"zoom",void 0),d()(this,"center",void 0)}return a()(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.pitch,i=void 0===r?0:r,o=e.bearing,a=void 0===o?0:o,s=e.center,u=void 0===s?[0,0]:s,l=e.offsetOrigin,c=void 0===l?[0,0]:l,h=e.cameraHeight,f=void 0===h?1:h,p=e.aspect,d=void 0===p?1:p,v=e.near,m=void 0===v?.1:v,g=e.far,y=void 0===g?1e3:g,_=e.fov,b=void 0===_?0:_;this.zoom=n,this.center=u;var x=i*Ie,E=(360-a)*Ie;O.perspective(this.projectionMatrix,b,d,m,y);var S=P.fromValues(f*Math.sin(x)*Math.sin(E),-f*Math.sin(x)*Math.cos(E),f*Math.cos(x)),A=P.fromValues(-Math.cos(x)*Math.sin(E),Math.cos(x)*Math.cos(E),Math.sin(x));O.lookAt(this.viewMatrix,S,P.fromValues(0,0,0),A),this.viewUncenteredMatrix=O.clone(this.viewMatrix),O.translate(this.viewMatrix,this.viewMatrix,P.fromValues(-c[0],c[1],0)),O.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),O.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var e=g()(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e){var t=85.0511287798,n=Math.max(Math.min(t,e[1]),-t),r=256<<20,i=Math.PI/180,o=e[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));return[o=r*(.5/Math.PI*o+.5)-215440491,a=-(r*(-.5/Math.PI*a+(i=.5))-106744817)]}}]),e}(),De=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];window.forceWebGL=!0;var Be="15cd8a57710d40c9b7c0e3cc120f1200",Fe=!1,Ue=[],ze=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"version","GAODE1.x"),d()(k()(e),"viewport",void 0),d()(k()(e),"handleCameraChanged",(function(t){var n=t.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,l=n.aspect,c=n.position,h=e.getCenter(),f=h.lng,p=h.lat;if(e.emit("mapchange"),e.cameraChangedCallback){e.viewport.syncWithMapCamera({aspect:l,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:e.map.getZoom()-1,center:[f,p],offsetOrigin:[c.x,c.y]});var d=e.config.offsetZoom,v=void 0===d?12:d;e.viewport.getZoom()>v?e.coordinateSystemService.setCoordinateSystem(L.CoordinateSystem.P20_OFFSET):e.coordinateSystemService.setCoordinateSystem(L.CoordinateSystem.P20),e.cameraChangedCallback(e.viewport)}})),e}return a()(r,[{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=O.create();return O.translate(o,o,P.fromValues(i[0],i[1],t)),O.scale(o,o,P.fromValues(r[0],r[1],r[2])),O.rotateX(o,o,n[0]),O.rotateY(o,o,n[1]),O.rotateZ(o,o,n[2]),o}},{key:"init",value:(t=R()(S()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p,d,v,m=this;return S()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,l=t.token,c=void 0===l?Be:l,h=t.mapInstance,p=t.plugin,d=void 0===p?[]:p,v=C()(t,De),e.next=3,new Promise((function(e){var t=function(){if(h)m.map=h,m.$mapContainer=m.map.getContainer(),setTimeout((function(){m.map.on("camerachange",m.handleCameraChanged),e()}),30);else{m.$mapContainer=m.creatMapContainer(n);var t=f()({mapStyle:m.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},v);t.zoom&&(t.zoom+=1);var r=new AMap.Map(m.$mapContainer,t);r.on("camerachange",m.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return m.handleAfterMapChange()}))})),m.map=r,setTimeout((function(){e()}),10)}};Fe||h?Fe&&window.AMap||h?t():Ue.push(t):(c===Be&&console.warn(m.configService.getSceneWarninfo("MapToken")),Fe=!0,d.push("Map3D"),Pe.load({key:c,version:"1.4.15",plugins:d}).then((function(e){t(),Ue.length&&(Ue.forEach((function(e){return e()})),Ue=[])})).catch((function(e){throw new Error(e)})))}));case 3:this.viewport=new Ne;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"meterToCoord",value:function(e,t){var n=AMap.GeometryUtil.distance(_()(AMap.LngLat,x()(e)),_()(AMap.LngLat,x()(t))),r=this.lngLatToCoord(e),i=g()(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(t),u=g()(s,2),l=u[0],c=u[1];return Math.sqrt(Math.pow(o-l,2)+Math.pow(a-c,2))/n}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}}]),r}(Ce),Ge=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return ze}}]),n}(v),je=function(){function e(){i()(this,e),d()(this,"projectionMatrix",O.create()),d()(this,"viewMatrix",O.create()),d()(this,"viewProjectionMatrix",O.create()),d()(this,"ViewProjectionMatrixUncentered",O.create()),d()(this,"viewUncenteredMatrix",O.create()),d()(this,"zoom",void 0),d()(this,"center",void 0)}return a()(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.center,i=void 0===r?[0,0]:r,o=e.offsetOrigin,a=void 0===o?[0,0]:o,s=e.cameraPosition,u=void 0===s?[0,0,0]:s,l=e.up,c=void 0===l?[0,1,0]:l,h=e.lookAt,f=void 0===h?[0,0,0]:h,p=e.aspect,d=void 0===p?1:p,v=e.near,m=void 0===v?.1:v,g=e.far,y=void 0===g?1e3:g,_=e.fov,b=void 0===_?45:_;this.zoom=n,this.center=i,O.perspective(this.projectionMatrix,b/180*Math.PI,d,m,y);var E=P.fromValues.apply(P,x()(u)),S=P.fromValues.apply(P,x()(f)),A=P.fromValues.apply(P,x()(c));O.lookAt(this.viewMatrix,E,S,A),this.viewUncenteredMatrix=O.clone(this.viewMatrix),O.translate(this.viewMatrix,this.viewMatrix,P.fromValues(-a[0],a[1],0)),O.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),O.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var e=g()(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1.2}},{key:"projectFlat",value:function(e){var t=85.0511287798,n=Math.max(Math.min(t,e[1]),-t),r=256<<20,i=Math.PI/180,o=e[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));return[o=r*(.5/Math.PI*o+.5)-215440491,a=-(r*(-.5/Math.PI*a+(i=.5))-106744817)]}}]),e}(),Ve=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n.amap-copyright {\n  display: none !important;\n}\n.amap-overlays {\n  z-index: 3 !important;\n}\n");var He=[108.92361,34.54083];window.forceWebGL=!0;var We="f59bcf249433f8b05caaee19f349b3d7",Ze=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"version","GAODE2.x"),d()(k()(e),"sceneCenter",void 0),d()(k()(e),"sceneCenterMercator",void 0),d()(k()(e),"viewport",void 0),d()(k()(e),"handleViewChanged",(function(t){var n=e.map.customCoords.getCameraParams(),r=n.fov,i=n.near,o=n.far,a=n.aspect,s=n.position,u=n.lookAt,l=n.up;e.emit("mapchange");var c=e.map.customCoords.getCenter();e.cameraChangedCallback&&(e.viewport.syncWithMapCamera({aspect:a,far:o,fov:r,cameraPosition:s,lookAt:u,up:l,near:i,zoom:e.map.getZoom()-1,center:c,offsetOrigin:[s[0],s[1]]}),e.coordinateSystemService.setCoordinateSystem(L.CoordinateSystem.P20_2),e.cameraChangedCallback(e.viewport))})),e}return a()(r,[{key:"setCustomCoordCenter",value:function(e){this.sceneCenter=e,this.sceneCenterMercator=D.TG.apply(void 0,x()(e))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMercator}},{key:"lngLatToCoordByLayer",value:function(e,t){var n=t||this.sceneCenterMercator,r=this._sub((0,D.TG)(e[0],e[1]),n);return e[2]&&r.push(e[2]),r}},{key:"coordToAMap2RelativeCoordinates",value:function(e,t){var n=this,r=(0,D.TG)(t[0],t[1]);return"number"==typeof e[0]?this.lngLatToCoordByLayer(e,r):e.map((function(e){return Array.isArray(e)&&"number"==typeof e[0]?n.lngLatToCoordByLayer(e,r):e.map((function(e){return n.lngLatToCoordByLayer(e,r)}))}))}},{key:"setCoordCenter",value:function(e){this.map.customCoords.setCenter(e||He),this.setCustomCoordCenter(e||He)}},{key:"lngLatToCoord",value:function(e){return this.sceneCenter||(this.map.customCoords.setCenter(e),this.setCustomCoordCenter(e)),this._sub((0,D.TG)(e[0],e[1]),this.sceneCenterMercator)}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return"number"==typeof e[0]?t.lngLatToCoord(e):e.map((function(e){return t.lngLatToCoord(e)}))}))}},{key:"addMarkerContainer",value:function(){if(this.map){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];t.style.zIndex="auto",this.markerContainer=D.SO.create("div","l7-marker-container2",t)}}}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"getType",value:function(){return"amap2"}},{key:"getBounds",value:function(){var e=this.map.getBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.getZooms()[0]-1}},{key:"getMaxZoom",value:function(){return this.map.getZooms()[1]-1}},{key:"lngLatToContainer",value:function(e){var t=this.map.lngLatToContainer(e);return{x:t.getX(),y:t.getY()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lngLatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.map.customCoords.lngLatToCoord(e),o=O.create();return O.translate(o,o,P.fromValues(i[0],i[1],t)),O.scale(o,o,P.fromValues(r[0],r[1],r[2])),O.rotateX(o,o,n[0]),O.rotateY(o,o,n[1]),O.rotateZ(o,o,n[2]),o}},{key:"init",value:(t=R()(S()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p,d,v,m,g,y,_,b,x;return S()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?24:s,l=t.token,c=void 0===l?We:l,h=t.mapInstance,p=t.plugin,d=void 0===p?[]:p,t.version,v=C()(t,Ve),this.viewport=new je,window.AMap||h){e.next=6;break}return d.push("Map3D"),e.next=6,N().load({key:c,version:"2.0",plugins:d});case 6:h?(this.map=h,this.$mapContainer=this.map.getContainer(),g=this.map.getCenter(),null===(m=this.map.customCoords)||void 0===m||m.setCenter([g.lng,g.lat]),this.setCustomCoordCenter([g.lng,g.lat]),this.map.on("viewchange",this.handleViewChanged)):(this.$mapContainer=this.creatMapContainer(n),(_=f()({mapStyle:this.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},v)).zoom&&(_.zoom+=1),c===We&&(window._AMapSecurityConfig={securityJsCode:"2653011adeb04230b3a26cc9a780a800"},console.warn("%c".concat(this.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;")),b=new AMap.Map(this.$mapContainer,_),this.map=b,x=b.getCenter(),null===(y=this.map.customCoords)||void 0===y||y.setCenter([x.lng,x.lat]),this.setCustomCoordCenter([x.lng,x.lat]),b.on("viewchange",this.handleViewChanged)),this.initViewPort();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"initViewPort",value:function(){var e,t=(null===(e=this.map.customCoords)||void 0===e?void 0:e.getCameraParams())||{},n=t.fov,r=t.near,i=t.far,o=t.aspect,a=t.position,s=t.lookAt,u=t.up;this.emit("mapchange");var l=this.map.customCoords.getCenter(),c=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:o,far:i,fov:n,cameraPosition:a,lookAt:s,near:r,up:u,zoom:c-1,center:l,offsetOrigin:[a[0],a[1]]}),this.coordinateSystemService.setCoordinateSystem(L.CoordinateSystem.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(e,t){var n=[0,0];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}}]),r}(Ce),Xe=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return Ze}}]),n}(v),Ye=n(5570),qe=n.n(Ye),Ke={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Qe={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},$e=function(){function e(t){var n=this;i()(this,e),d()(this,"version","DEFAUlTMAP"),d()(this,"map",void 0),d()(this,"simpleMapCoord",new ge),d()(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),d()(this,"config",void 0),d()(this,"configService",void 0),d()(this,"coordinateSystemService",void 0),d()(this,"eventEmitter",void 0),d()(this,"markerContainer",void 0),d()(this,"cameraChangedCallback",void 0),d()(this,"$mapContainer",void 0),d()(this,"handleCameraChanged",(function(e){var t=n.map.getCenter(),r=t.lat,i=t.lng;n.emit("mapchange"),n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[i,r],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0}),n.updateCoordinateSystemService(),n.cameraChangedCallback(n.viewport)})),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new B.EventEmitter}return a()(e,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getCanvasContainer();this.markerContainer=D.SO.create("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"getCanvasOverlays",value:function(){}},{key:"on",value:function(e,t){-1!==L.MapServiceEvent.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(Qe[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(Qe[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if("SIMPLE"===this.version)return this.simpleMapCoord.getSize();var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy([e,t])}},{key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===e.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===e.dragEnable&&this.map.dragPan.disable(),!0===e.dragEnable&&this.map.dragPan.enable(),!1===e.rotateEnable&&this.map.dragRotate.disable(),!0===e.dragEnable&&this.map.dragRotate.enable(),!1===e.keyboardEnable&&this.map.keyboard.disable(),!0===e.keyboardEnable&&this.map.keyboard.enable(),!1===e.zoomEnable&&this.map.scrollZoom.disable(),!0===e.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(e,t){this.map.flyTo({zoom:e,center:t})}},{key:"setMapStyle",value:function(e){this.map.setStyle(this.getMapStyleValue(e))}},{key:"meterToCoord",value:function(e,t){return 1}},{key:"pixelToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToPixel",value:function(e){return this.map.project(e)}},{key:"containerToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToContainer",value:function(e){return this.map.project(e)}},{key:"getMapStyle",value:function(){try{var e,t=null!==(e=this.map.getStyle().sprite)&&void 0!==e?e:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(t)?null==t?void 0:t.replace(/\/\w+$/,"").replace(/sprites/,"styles"):t}catch(e){return""}}},{key:"getMapStyleConfig",value:function(){return Ke}},{key:"getMapStyleValue",value:function(e){var t;return null!==(t=this.getMapStyleConfig()[e])&&void 0!==t?t:e}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"creatMapContainer",value:function(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}},{key:"updateView",value:function(e){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:e.bearing,center:e.center,viewportHeight:e.viewportHeight,pitch:e.pitch,viewportWidth:e.viewportWidth,zoom:e.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var e=this.config.offsetCoordinate,t=void 0===e||e;this.viewport.getZoom()>12&&t?this.coordinateSystemService.setCoordinateSystem(L.CoordinateSystem.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(L.CoordinateSystem.LNGLAT)}}]),e}();if(!window)throw Error("BMapGL JSAPI can only be used in Browser.");var Je=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(Je||{}),et={key:"",BMapGL:{version:"1.0"}},tt={BMapGL:Je.notload},nt=[],rt=function(e){if("function"==typeof e){if(tt.BMapGL===Je.loaded)return void e(window.BMapGL);nt.push(e)}},it=function(e){return new Promise((function(t,n){if(tt.BMapGL===Je.failed)n("");else if(tt.BMapGL===Je.notload){var r=e.key,i=e.version;if(!r)return void n("请填写key");et.key=r,et.BMapGL.version=i||et.BMapGL.version,tt.BMapGL=Je.loading;var o=document.body||document.head;window.___onBMapGLAPILoaded=function(e){if(delete window.___onBMapGLAPILoaded,e)tt.BMapGL=Je.failed,n(e);else for(tt.BMapGL=Je.loaded;nt.length;)nt.splice(0,1)[0](window.BMapGL)};var a=document.createElement("script");a.type="text/javascript",a.src="https://api.map.baidu.com/api?type=webgl&v=".concat(et.BMapGL.version,"&ak=").concat(et.key,"&callback=___onBMapGLAPILoaded"),a.onerror=function(e){tt.BMapGL=Je.failed,n(e)},o.appendChild(a),rt(t)}else if(tt.BMapGL===Je.loaded){if(e.key&&e.key!==et.key)return void n("多个不一致的 key");if(e.version&&e.version!==et.BMapGL.version)return void n("不允许多个版本 JSAPI 混用");t(window.BMapGL)}else{if(e.key&&e.key!==et.key)return void n("多个不一致的 key");if(e.version&&e.version!==et.BMapGL.version)return void n("不允许多个版本 JSAPI 混用");rt(t)}}))},ot=["id","center","zoom","token","mapInstance","version","mapSize","minZoom","maxZoom"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".BMap_cpyCtrl .anchorBL {\n  display: none !important;\n}\n\n.anchorBL {\n  display: none !important;\n}\n");var at,st={mapmove:"moving",contextmenu:"rightclick",camerachange:"update",zoomchange:"zoomend"},ut="zLhopYPPERGtpGOgimcdKcCimGRyyIsh",lt=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"viewport",void 0),d()(k()(e),"styleConfig",{normal:[]}),d()(k()(e),"currentStyle","normal"),d()(k()(e),"evtCbProxyMap",new Map),d()(k()(e),"handleCameraChanged",(function(){e.emit("mapchange");var t=e.getMap(),n=t.getCenter(),r={center:[n.lng,n.lat],viewportHeight:t.getContainer().clientHeight,viewportWidth:t.getContainer().clientWidth,bearing:360-t.getHeading(),pitch:t.getTilt(),zoom:t.getZoom()-1.75};e.viewport.syncWithMapCamera(r),e.updateCoordinateSystemService(),e.cameraChangedCallback(e.viewport)})),e}return a()(r,[{key:"getMap",value:function(){return this.map}},{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"init",value:(t=R()(S()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p,d,v,m,g,y,_,b,E,A,T,w,R,M=this;return S()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.viewport=new me,t=this.config,n=t.id,r=t.center,i=void 0===r?[121.30654632240122,31.25744185633306]:r,o=t.zoom,a=void 0===o?12:o,s=t.token,u=void 0===s?ut:s,l=t.mapInstance,c=t.version,h=void 0===c?"1.0":c,p=t.mapSize,d=void 0===p?1e4:p,v=t.minZoom,m=void 0===v?0:v,g=t.maxZoom,y=void 0===g?21:g,_=C()(t,ot),this.viewport=new me,this.version=h,this.simpleMapCoord.setSize(d),window.BMapGL||l){e.next=8;break}return e.next=8,it({key:u,version:"1.0"});case 8:if(!l){e.next=17;break}this.map=l,this.$mapContainer=this.map.getContainer(),b=new BMapGL.Point(i[0],i[1]),this.map.isLoaded()||this.map.centerAndZoom(b,a),this.initMapByConfig(this.config),this.map.on("update",this.handleCameraChanged),e.next=32;break;case 17:if(E=f()({enableWheelZoom:!0,minZoom:m,maxZoom:y},_),u===ut&&console.warn("%c".concat(this.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),n){e.next=21;break}throw Error("No container id specified");case 21:A=D.SO.getContainer(n),T=x()(A.childNodes),w=new BMapGL.Map(A,E),this.$mapContainer=w.getContainer(),T.forEach((function(e){M.$mapContainer.appendChild(e)})),T=null,this.map=w,R=new BMapGL.Point(i[0],i[1]),this.map.centerAndZoom(R,a),this.initMapByConfig(this.config),w.on("update",this.handleCameraChanged);case 32:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.getMap().destroy()}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"addMarkerContainer",value:function(){}},{key:"getMarkerContainer",value:function(){return this.map.getPanes().markerPane}},{key:"getCanvasOverlays",value:function(){var e;return null===(e=this.getMap().getContainer().querySelector("#platform"))||void 0===e?void 0:e.lastChild}},{key:"on",value:function(e,t){if(-1===L.MapServiceEvent.indexOf(e)){var n=this.evtCbProxyMap.get(e);if(n||this.evtCbProxyMap.set(e,n=new Map),!n.get(t)){var r=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];!n[0]||"object"!==qe()(n[0])||n[0].lngLat||n[0].lnglat||(n[0].lngLat=n[0].latlng||n[0].latLng),t.apply(void 0,n)};n.set(t,r),this.map.on(st[e]||e,r)}}else this.eventEmitter.on(e,t)}},{key:"off",value:function(e,t){var n,r;if(-1===L.MapServiceEvent.indexOf(e)){var i=null===(n=this.evtCbProxyMap.get(e))||void 0===n?void 0:n.get(t);i&&(null===(r=this.evtCbProxyMap.get(e))||void 0===r||r.delete(t),this.map.off(st[e]||e,i))}else this.eventEmitter.off(e,t)}},{key:"once",value:function(e,t){this.eventEmitter.once(e,t)}},{key:"getContainer",value:function(){return this.getMap().getContainer()}},{key:"getSize",value:function(){var e=this.getMap().getSize();return[e.width,e.height]}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"getType",value:function(){return"bmap"}},{key:"getZoom",value:function(){return this.getMap().getZoom()}},{key:"getCenter",value:function(e){if(null!=e&&e.padding){var t=this.getCenter(),n=ye(e.padding),r=this.lngLatToPixel([t.lng,t.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}var o=this.map.getCenter();return{lng:o.lng,lat:o.lat}}},{key:"getPitch",value:function(){return this.getMap().getTilt()}},{key:"getRotation",value:function(){return 360-this.getMap().getHeading()}},{key:"getBounds",value:function(){var e=this.getMap().getBounds(),t=e.getNorthEast(),n=e.getSouthWest();return[[n.lng,n.lat],[t.lng,t.lat]]}},{key:"getMapContainer",value:function(){return this.getMap().getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.getMap().getContainer()}},{key:"getMapStyleConfig",value:function(){return this.styleConfig}},{key:"getMapStyleValue",value:function(e){return this.styleConfig[e]}},{key:"setMapStyle",value:function(e){if(this.currentStyle!==e){var t=Array.isArray(e)?e:this.styleConfig[e]||e;return Array.isArray(t)?(this.map.setMapStyleV2({styleJson:t}),void(this.currentStyle=e)):"string"==typeof t?(this.map.setMapStyleV2({styleId:t}),void(this.currentStyle=e)):void 0}}},{key:"setRotation",value:function(e){this.getMap().setHeading(e)}},{key:"zoomIn",value:function(){this.getMap().zoomIn()}},{key:"zoomOut",value:function(){this.getMap().zoomOut()}},{key:"panTo",value:function(e){this.getMap().panTo(new BMapGL.Point(e[0],e[1]))}},{key:"panBy",value:function(e,t){this.getMap().panBy(e,t)}},{key:"fitBounds",value:function(e,t){this.map.setViewport(e.map((function(e){return new BMapGL.Point(e[0],e[1])})),t)}},{key:"setZoomAndCenter",value:function(e,t){var n=g()(t,2),r=n[0],i=n[1];this.getMap().centerAndZoom(new BMapGL.Point(r,i),e+1.75)}},{key:"setCenter",value:function(e,t){var n=g()(e,2),r=n[0],i=n[1],o={lng:r,lat:i};if(null!=t&&t.padding){var a=ye(t.padding),s=this.lngLatToPixel([r,i]),u=[(a.right-a.left)/2,(a.bottom-a.top)/2];o=this.pixelToLngLat([s.x+u[0],s.y+u[1]])}this.getMap().setCenter(new BMapGL.Point(o.lng,o.lat))}},{key:"setPitch",value:function(e){this.getMap().setTilt(e)}},{key:"setZoom",value:function(e){this.getMap().setZoom(e)}},{key:"setMapStatus",value:function(e){var t=this,n=this.getMap();Object.keys(e).map((function(r){switch(r){case"doubleClickZoom":e.doubleClickZoom?n.enableDoubleClickZoom():n.disableDoubleClickZoom();break;case"dragEnable":e.dragEnable?n.enableDragging():n.disableDragging();break;case"keyboardEnable":e.keyboardEnable?n.enableKeyboard():n.disableKeyboard();break;case"resizeEnable":e.resizeEnable?n.enableAutoResize():n.disableAutoResize();break;case"rotateEnable":e.rotateEnable?(n.enableRotate(),n.enableRotateGestures()):(n.disableRotate(),n.disableRotateGestures());break;case"zoomEnable":e.zoomEnable?(t.map.enableDoubleClickZoom(),t.map.enableScrollWheelZoom(),t.map.enablePinchToZoom()):(t.map.disableDoubleClickZoom(),t.map.disableScrollWheelZoom(),t.map.disablePinchToZoom());break;case"showIndoorMap":n.setDisplayOptions({indoor:!!e.showIndoorMap})}}))}},{key:"meterToCoord",value:function(e,t){var n=this.getMap().getDistance(_()(BMapGL.Point,x()(e)),_()(BMapGL.Point,x()(t))),r=this.lngLatToCoord(e),i=g()(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(t),u=g()(s,2),l=u[0],c=u[1];return Math.sqrt(Math.pow(o-l,2)+Math.pow(a-c,2))/n}},{key:"pixelToLngLat",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.getMap().pixelToPoint(new BMapGL.Pixel(n,r));return{lng:i.lng,lat:i.lat}}},{key:"lngLatToPixel",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.getMap().pointToPixel(new BMapGL.Point(n,r));return{x:i.x,y:i.y}}},{key:"containerToLngLat",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.getMap().overlayPixelToPoint(new BMapGL.Pixel(n,r));return{lng:i.lng,lat:i.lat}}},{key:"lngLatToContainer",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.getMap().pointToOverlayPixel(new BMapGL.Point(n,r));return{x:i.x,y:i.y}}},{key:"lngLatToCoord",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.getMap().pointToPixel(new BMapGL.Point(n,r));return[i.x,-i.y]}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return Array.isArray(e[0])?t.lngLatToCoords(e):t.lngLatToCoord(e)}))}},{key:"lngLatToMercator",value:function(e,t){var n=g()(e,2),r=n[0],i=n[1],o=this.getMap().lnglatToMercator(r,i),a=g()(o,2);return{x:a[0],y:a[1],z:t}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=O.create();return O.translate(o,o,P.fromValues(i[0],i[1],t)),O.scale(o,o,P.fromValues(r[0],r[1],r[2])),O.rotateX(o,o,n[0]),O.rotateY(o,o,n[1]),O.rotateZ(o,o,n[2]),o}},{key:"getCustomCoordCenter",value:function(){throw new Error("Method not implemented.")}},{key:"exportMap",value:function(e){var t=this.getMap()._webglPainter._canvas;return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"hideLogo",value:function(){var e=this.map.getContainer();e&&D.SO.addClass(e,"bmap-contianer--hide-logo")}},{key:"initMapByConfig",value:function(e){var t=e.style,n=e.pitch,r=void 0===n?0:n,i=e.rotation,o=void 0===i?0:i,a=e.logoVisible,s=void 0===a||a;t&&this.setMapStyle(t),r&&this.setPitch(r),o&&this.setRotation(o),!1===s&&this.hideLogo()}}]),r}($e),ct=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return lt}}]),n}(v),ht=n(6970),ft=n.n(ht),pt=n(8421),dt=n.n(pt);function vt(e,t,n){var r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function mt(e,t,n){return Math.min(n,Math.max(t,e))}function gt(e,t,n){return e*(1-n)+t*n}function yt(e,t,n,r){var i=new(dt())(e,t,n,r);return function(e){return i.solve(e)}}var _t=yt(.25,.1,.25,1);function bt(){var e;return null==at&&"undefined"!=typeof window&&window.matchMedia&&(at=window.matchMedia("(prefers-reduced-motion: reduce)")),null===(e=at)||void 0===e?void 0:e.matches}function xt(e,t){var n,r={},i=ft()(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in e&&(r[o]=e[o])}}catch(e){i.e(e)}finally{i.f()}return r}var Et=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date),St=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,At=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;function Tt(e){var t=St(e);return{cancel:function(){return At(t)}}}var Ct=6371008.8,wt=function(){function e(t,n){if(i()(this,e),d()(this,"lng",void 0),d()(this,"lat",void 0),isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(n,")"));if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return a()(e,[{key:"wrap",value:function(){return new e(vt(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(e){var t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return Ct*Math.acos(Math.min(i,1))}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"===qe()(t)&&null!==t){var n="lng"in t?t.lng:t.lon;return new e(Number(n),Number(t.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),Rt=function(){function e(t,n){i()(this,e),d()(this,"ne",void 0),d()(this,"sw",void 0),t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}return a()(e,[{key:"setNorthEast",value:function(e){return this.ne=e instanceof wt?new wt(e.lng,e.lat):wt.convert(e),this}},{key:"setSouthWest",value:function(e){return this.sw=e instanceof wt?new wt(e.lng,e.lat):wt.convert(e),this}},{key:"extend",value:function(t){var n,r,i=this.sw,o=this.ne;if(t instanceof wt)n=t,r=t;else{if(!(t instanceof e)){if(Array.isArray(t)){if(4===t.length||t.every(Array.isArray)){var a=t;return this.extend(e.convert(a))}var s=t;return this.extend(wt.convert(s))}return this}if(n=t.sw,r=t.ne,!n||!r)return this}return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this.sw=new wt(n.lng,n.lat),this.ne=new wt(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new wt((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new wt(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new wt(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(e){var t=wt.convert(e),n=t.lng,r=t.lat,i=this.sw.lat<=r&&r<=this.ne.lat,o=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(o=this.sw.lng>=n&&n>=this.ne.lng),i&&o}}],[{key:"convert",value:function(t){return t instanceof e?t:new e(t)}}]),e}(),Mt=function(){function e(t,n){i()(this,e),d()(this,"x",void 0),d()(this,"y",void 0),this.x=t,this.y=n}return a()(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"_add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"add",value:function(e){return this.clone()._add(e)}},{key:"_sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"sub",value:function(e){return this.clone()._sub(e)}},{key:"_multByPoint",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multByPoint",value:function(e){return this.clone()._multByPoint(e)}},{key:"_divByPoint",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divByPoint",value:function(e){return this.clone()._divByPoint(e)}},{key:"_mult",value:function(e){return this.x*=e,this.y*=e,this}},{key:"mult",value:function(e){return this.clone()._mult(e)}},{key:"_div",value:function(e){return this.x/=e,this.y/=e,this}},{key:"div",value:function(e){return this.clone()._div(e)}},{key:"_rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(e){return this.clone()._rotate(e)}},{key:"_rotateAround",value:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=o,this}},{key:"roateAround",value:function(e,t){return this.clone()._rotateAround(e,t)}},{key:"_matMult",value:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this}},{key:"matMult",value:function(e){return this.clone()._matMult(e)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var e=this.y;return this.y=this.x,this.x=-e,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"dist",value:function(e){return Math.sqrt(this.distSqr(e))}},{key:"distSqr",value:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(e){return Math.atan2(this.y-e.y,this.x-e.x)}},{key:"angleWith",value:function(e){return this.angleWithSep(e.x,e.y)}},{key:"angleWithSep",value:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)}}],[{key:"convert",value:function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}}]),e}(),kt=n(7643);var Lt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(i()(this,e),d()(this,"top",void 0),d()(this,"bottom",void 0),d()(this,"left",void 0),d()(this,"right",void 0),isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(o)||o<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=r,this.right=o}return a()(e,[{key:"interpolate",value:function(e,t,n){return null!=t.top&&null!=e.top&&(this.top=gt(e.top,t.top,n)),null!=t.bottom&&null!=e.bottom&&(this.bottom=gt(e.bottom,t.bottom,n)),null!=t.left&&null!=e.left&&(this.left=gt(e.left,t.left,n)),null!=t.right&&null!=e.right&&(this.right=gt(e.right,t.right,n)),this}},{key:"getCenter",value:function(e,t){var n=mt((this.left+e-this.right)/2,0,e),r=mt((this.top+t-this.bottom)/2,0,t);return new Mt(n,r)}},{key:"equals",value:function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}},{key:"clone",value:function(){return new e(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),e}(),Ot=2*Math.PI*Ct;function Pt(e){return Ot*Math.cos(e*Math.PI/180)}function It(e){return(180+e)/360}function Nt(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Dt(e,t){return e/Pt(t)}function Bt(e){var t=180-360*e;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}var Ft=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i()(this,e),d()(this,"x",void 0),d()(this,"y",void 0),d()(this,"z",void 0),this.x=+t,this.y=+n,this.z=+r}return a()(e,[{key:"toLngLat",value:function(){return new wt(360*this.x-180,Bt(this.y))}},{key:"toAltitude",value:function(){return e=this.z,t=this.y,e*Pt(Bt(t));var e,t}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/Ot*(e=Bt(this.y),1/Math.cos(e*Math.PI/180));var e}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=wt.convert(t);return new e(It(r.lng),Nt(r.lat),Dt(n,r.lat))}}]),e}(),Ut=function(){function e(t,n,r,o,a){i()(this,e),d()(this,"tileSize",void 0),d()(this,"tileZoom",void 0),d()(this,"lngRange",void 0),d()(this,"latRange",void 0),d()(this,"maxValidLatitude",void 0),d()(this,"scale",void 0),d()(this,"width",void 0),d()(this,"height",void 0),d()(this,"angle",void 0),d()(this,"rotationMatrix",void 0),d()(this,"pixelsToGLUnits",void 0),d()(this,"cameraToCenterDistance",void 0),d()(this,"mercatorMatrix",void 0),d()(this,"projMatrix",void 0),d()(this,"invProjMatrix",void 0),d()(this,"alignedProjMatrix",void 0),d()(this,"pixelMatrix",void 0),d()(this,"pixelMatrixInverse",void 0),d()(this,"glCoordMatrix",void 0),d()(this,"labelPlaneMatrix",void 0),d()(this,"_fov",void 0),d()(this,"_pitch",void 0),d()(this,"_zoom",void 0),d()(this,"_renderWorldCopies",void 0),d()(this,"_minZoom",void 0),d()(this,"_maxZoom",void 0),d()(this,"_minPitch",void 0),d()(this,"_maxPitch",void 0),d()(this,"_center",void 0),d()(this,"zoomFraction",void 0),d()(this,"unmodified",void 0),d()(this,"edgeInsets",void 0),d()(this,"constraining",void 0),d()(this,"posMatrixCache",void 0),d()(this,"alignedPosMatrixCache",void 0),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===a||a,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==o?60:o,this.setMaxBounds(),this.width=0,this.height=0,this._center=new wt(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new Lt,this.posMatrixCache={},this.alignedPosMatrixCache={}}return a()(e,[{key:"minZoom",get:function(){return this._minZoom},set:function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}},{key:"minPitch",get:function(){return this._minPitch},set:function(e){this._minPitch!==e&&(this._minPitch=e,this._pitch=Math.max(this._pitch,e))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(e){this._maxPitch!==e&&(this._maxPitch=e,this._pitch=Math.min(this._pitch,e))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new Mt(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(e){var t,n=-vt(e,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=(t=new kt.WT(4),kt.WT!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t),function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);e[0]=r*u+o*s,e[1]=i*u+a*s,e[2]=r*-s+o*u,e[3]=i*-s+a*u}(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(e){var t=mt(e,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==t&&(this.unmodified=!1,this._pitch=t,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this.unmodified=!1,this._fov=e/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(e){var t=Math.min(Math.max(e,this._minZoom),this._maxZoom);this._zoom!==t&&(this.unmodified=!1,this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this.unmodified=!1,this._center=e,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(e){this.edgeInsets.equals(e)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,e,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var t=new e(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.center=this._center,t.zoom=this.zoom,t.angle=this.angle,t.fov=this._fov,t.pitch=this._pitch,t.unmodified=this.unmodified,t.edgeInsets=this.edgeInsets.clone(),t.calcMatrices(),t}},{key:"isPaddingEqual",value:function(e){return this.edgeInsets.equals(e)}},{key:"interpolatePadding",value:function(e,t,n){this.unmodified=!1,this.edgeInsets.interpolate(e,t,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(e){return Math.pow(2,e)}},{key:"scaleZoom",value:function(e){return Math.log(e)/Math.LN2}},{key:"project",value:function(e){var t=mt(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new Mt(It(e.lng)*this.worldSize,Nt(t)*this.worldSize)}},{key:"unproject",value:function(e){return new Ft(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(e,t){var n=this.pointCoordinate(t),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(e),o=new Ft(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(e){var t=new Float64Array([e.x,e.y,0,1]),n=new Float64Array([e.x,e.y,1,1]);q.fF(t,t,this.pixelMatrixInverse),q.fF(n,n,this.pixelMatrixInverse);var r=t[3],i=n[3],o=t[0]/r,a=n[0]/i,s=t[1]/r,u=n[1]/i,l=t[2]/r,c=n[2]/i,h=l===c?0:(0-l)/(c-l);return new Ft(gt(o,a,h)/this.worldSize,gt(s,u,h)/this.worldSize)}},{key:"getBounds",value:function(){return(new Rt).extend(this.pointLocation(new Mt(0,0))).extend(this.pointLocation(new Mt(this.width,0))).extend(this.pointLocation(new Mt(this.width,this.height))).extend(this.pointLocation(new Mt(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new Rt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new Mt(0,0)),t=new Float32Array([e.x*this.worldSize,e.y*this.worldSize,0,1]);return q.fF(t,t,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var e=this._pitch,t=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new Mt(0,t))}},{key:"getCameraQueryGeometry",value:function(e){var t=this.getCameraPoint();if(1===e.length)return[e[0],t];var n,r=t.x,i=t.y,o=t.x,a=t.y,s=ft()(e);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(e){s.e(e)}finally{s.f()}return[new Mt(r,i),new Mt(o,i),new Mt(o,a),new Mt(r,a),new Mt(r,i)]}},{key:"coordinatePoint",value:function(e){var t=q.al(e.x*this.worldSize,e.y*this.worldSize,0,1);return q.fF(t,t,this.pixelMatrix),new Mt(t[0]/t[3],t[1]/t[3])}},{key:"locationPoint",value:function(e){return this.coordinatePoint(this.locationCoordinate(e))}},{key:"pointLocation",value:function(e){return this.coordinateLocation(this.pointCoordinate(e))}},{key:"locationCoordinate",value:function(e){return Ft.fromLngLat(e)}},{key:"coordinateLocation",value:function(e){return e.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var e,t,n,r,i=-90,o=90,a=-180,s=180,u=this.size,l=this.unmodified;if(this.latRange){var c=this.latRange;i=Nt(c[1])*this.worldSize,e=(o=Nt(c[0])*this.worldSize)-i<u.y?u.y/(o-i):0}if(this.lngRange){var h=this.lngRange;a=It(h[0])*this.worldSize,t=(s=It(h[1])*this.worldSize)-a<u.x?u.x/(s-a):0}var f=this.point,p=Math.max(t||0,e||0);if(p)return this.center=this.unproject(new Mt(t?(s+a)/2:f.x,e?(o+i)/2:f.y)),this.zoom+=this.scaleZoom(p),this.unmodified=l,void(this.constraining=!1);if(this.latRange){var d=f.y,v=u.y/2;d-v<i&&(r=i+v),d+v>o&&(r=o-v)}if(this.lngRange){var m=f.x,g=u.x/2;m-g<a&&(n=a+g),m+g>s&&(n=s-g)}void 0===n&&void 0===r||(this.center=this.unproject(new Mt(void 0!==n?n:f.x,void 0!==r?r:f.y))),this.unmodified=l,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var e=this._fov/2,t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(e)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+t.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(mt(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);O.perspective(c,this._fov,this.width/this.height,l,u),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,O.scale(c,c,[1,-1,1]),O.translate(c,c,[0,0,-this.cameraToCenterDistance]),O.rotateX(c,c,this._pitch),O.rotateZ(c,c,this.angle),O.translate(c,c,[-a,-s,0]),this.mercatorMatrix=O.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),O.scale(c,c,[1,1,Dt(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=O.invert([],this.projMatrix);var h=this.width%2/2,f=this.height%2/2,p=Math.cos(this.angle),d=Math.sin(this.angle),v=a-Math.round(a)+p*h+d*f,m=s-Math.round(s)+p*f+d*h,g=new Float64Array(c);if(O.translate(g,g,[v>.5?v-1:v,m>.5?m-1:m,0]),this.alignedProjMatrix=g,c=O.create(),O.scale(c,c,[this.width/2,-this.height/2,1]),O.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=O.create(),O.scale(c,c,[1,-1,1]),O.translate(c,c,[-1,-1,0]),O.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=O.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=O.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),e}(),zt=D.rU.merge,Gt=a()((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i()(this,e),d()(this,"type",void 0),zt(this,n),this.type=t})),jt=D.rU.merge,Vt=function(e){u()(n,e);var t=c()(n);function n(e){var r;i()(this,n),r=t.call(this),d()(k()(r),"transform",void 0),d()(k()(r),"options",void 0),d()(k()(r),"moving",void 0),d()(k()(r),"zooming",void 0),d()(k()(r),"rotating",void 0),d()(k()(r),"pitching",void 0),d()(k()(r),"padding",void 0),d()(k()(r),"bearingSnap",void 0),d()(k()(r),"easeEndTimeoutID",void 0),d()(k()(r),"easeStart",void 0),d()(k()(r),"easeOptions",void 0),d()(k()(r),"easeId",void 0),d()(k()(r),"onEaseFrame",void 0),d()(k()(r),"onEaseEnd",void 0),d()(k()(r),"easeFrameId",void 0),d()(k()(r),"pitchEnabled",void 0),d()(k()(r),"rotateEnabled",void 0),d()(k()(r),"renderFrameCallback",(function(){var e=Math.min((Et()-r.easeStart)/r.easeOptions.duration,1);r.onEaseFrame(r.easeOptions.easing(e)),e<1?r.easeFrameId=r.requestRenderFrame(r.renderFrameCallback):r.stop()})),r.options=e;var o=e.minZoom,a=e.maxZoom,s=e.minPitch,u=e.maxPitch,l=e.renderWorldCopies;return r.moving=!1,r.zooming=!1,r.bearingSnap=e.bearingSnap,r.pitchEnabled=e.pitchEnabled,r.rotateEnabled=e.rotateEnabled,r.transform=new Ut(o,a,s,u,l),r}return a()(n,[{key:"requestRenderFrame",value:function(e){return 0}},{key:"cancelRenderFrame",value:function(e){}},{key:"getCenter",value:function(){var e=this.transform.center,t=e.lng,n=e.lat;return new wt(t,n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(e,t){return this.jumpTo({center:e},t)}},{key:"setPitch",value:function(e,t){return this.jumpTo({pitch:e},t),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(e,t,n){return this.easeTo(jt({center:e},t),n)}},{key:"panBy",value:function(e,t,n){return e=Mt.convert(e).mult(-1),this.panTo(this.transform.center,function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];for(var s in a)void 0!==a[s]&&(e[s]=a[s])}return e}({offset:e},t||{}),n)}},{key:"zoomOut",value:function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}},{key:"setBearing",value:function(e,t){return this.jumpTo({bearing:e},t),this}},{key:"setZoom",value:function(e,t){return this.jumpTo({zoom:e},t),this}},{key:"zoomIn",value:function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}},{key:"zoomTo",value:function(e,t,n){return this.easeTo(jt({zoom:e},t),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(e,t){return this.jumpTo({padding:e},t),this}},{key:"rotateTo",value:function(e,t,n){return this.easeTo(jt({bearing:e},t),n)}},{key:"resetNorth",value:function(e,t){return this.rotateTo(0,jt({duration:1e3},e),t),this}},{key:"resetNorthPitch",value:function(e,t){return this.easeTo(jt({bearing:0,pitch:0,duration:1e3},e),t),this}},{key:"fitBounds",value:function(e,t,n){return this.fitInternal(this.cameraForBounds(e,t),t,n)}},{key:"cameraForBounds",value:function(e,t){return e=Rt.convert(e),this.cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,t)}},{key:"snapToNorth",value:function(e,t){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(e,t):this}},{key:"jumpTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,o=!1;return void 0!==e.zoom&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=wt.convert(e.center)),void 0!==e.bearing&&n.bearing!==+e.bearing&&(i=!0,n.bearing=+e.bearing),void 0!==e.pitch&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),void 0===e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this.emit("movestart",new Gt("movestart",t)),this.emit("move",new Gt("move",t)),r&&(this.emit("zoomstart",new Gt("zoomstart",t)),this.emit("zoom",new Gt("zoom",t)),this.emit("zoomend",new Gt("zoomend",t))),i&&(this.emit("rotatestart",new Gt("rotatestart",t)),this.emit("rotate",new Gt("rotate",t)),this.emit("rotateend",new Gt("rotateend",t))),o&&(this.emit("pitchstart",new Gt("pitchstart",t)),this.emit("pitch",new Gt("pitch",t)),this.emit("pitchend",new Gt("pitchend",t))),this.emit("moveend",new Gt("moveend",t))}},{key:"easeTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;(!1===(t=jt({offset:[0,0],duration:500,easing:_t},t)).animate||!t.essential&&bt())&&(t.duration=0);var r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),u=t.zoom?+t.zoom:i,l=t.bearing?this.normalizeBearing(t.bearing,o):o,c=t.pitch?+t.pitch:a,h=t.padding?t.padding:r.padding,f=Mt.convert(t.offset),p=r.centerPoint.add(f),d=r.pointLocation(p),v=wt.convert(t.center||d);this.normalizeCenter(v);var m,g,y=r.project(d),_=r.project(v).sub(y),b=r.zoomScale(u-i);t.around&&(m=wt.convert(t.around),g=r.locationPoint(m));var x={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||u!==i,this.rotating=this.rotating||o!==l,this.pitching=this.pitching||c!==a,this.padding=!r.isPaddingEqual(h),this.easeId=t.easeId,this.prepareEase(n,t.noMoveStart,x),clearTimeout(this.easeEndTimeoutID),this.ease((function(t){if(e.zooming&&(r.zoom=gt(i,u,t)),e.rotating&&e.rotateEnabled&&(r.bearing=gt(o,l,t)),e.pitching&&e.pitchEnabled&&(r.pitch=gt(a,c,t)),e.padding&&(r.interpolatePadding(s,h,t),p=r.centerPoint.add(f)),m)r.setLocationAtPoint(m,g);else{var d=r.zoomScale(r.zoom-i),v=u>i?Math.min(2,b):Math.max(.5,b),x=Math.pow(v,1-t),E=r.unproject(y.add(_.mult(t*x)).mult(d));r.setLocationAtPoint(r.renderWorldCopies?E.wrap():E,p)}e.fireMoveEvents(n)}),(function(t){e.afterEase(n,t)}),t),this}},{key:"flyTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!t.essential&&bt()){var r=xt(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),t=jt({offset:[0,0],speed:1.2,curve:1.42,easing:_t},t);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l=t.zoom?mt(+t.zoom,i.minZoom,i.maxZoom):o,c=t.bearing?this.normalizeBearing(t.bearing,a):a,h=t.pitch?+t.pitch:s,f="padding"in t?t.padding:i.padding,p=i.zoomScale(l-o),d=Mt.convert(t.offset),v=i.centerPoint.add(d),m=i.pointLocation(v),g=wt.convert(t.center||m);this.normalizeCenter(g);var y=i.project(m),_=i.project(g).sub(y),b=t.curve,x=Math.max(i.width,i.height),E=x/p,S=_.mag();if("minZoom"in t){var A=mt(Math.min(t.minZoom,o,l),i.minZoom,i.maxZoom),T=x/i.zoomScale(A-o);b=Math.sqrt(T/S*2)}var C=b*b;function w(e){var t=(E*E-x*x+(e?-1:1)*C*C*S*S)/(2*(e?E:x)*C*S);return Math.log(Math.sqrt(t*t+1)-t)}function R(e){return(Math.exp(e)-Math.exp(-e))/2}function M(e){return(Math.exp(e)+Math.exp(-e))/2}function k(e){return R(e)/M(e)}var L=w(0),O=function(e){return M(L)/M(L+b*e)},P=function(e){return x*((M(L)*k(L+b*e)-R(L))/C)/S},I=(w(1)-L)/b;if(Math.abs(S)<1e-6||!isFinite(I)){if(Math.abs(x-E)<1e-6)return this.easeTo(t,n);var N=E<x?-1:1;I=Math.abs(Math.log(E/x))/b,P=function(){return 0},O=function(e){return Math.exp(N*b*e)}}if("duration"in t)t.duration=+t.duration;else{var D="screenSpeed"in t?+t.screenSpeed/b:+t.speed;t.duration=1e3*I/D}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this.zooming=!0,this.rotating=a!==c,this.pitching=h!==s,this.padding=!i.isPaddingEqual(f),this.prepareEase(n,!1),this.ease((function(t){var r=t*I,p=1/O(r);i.zoom=1===t?l:o+i.scaleZoom(p),e.rotating&&(i.bearing=gt(a,c,t)),e.pitching&&(i.pitch=gt(s,h,t)),e.padding&&(i.interpolatePadding(u,f,t),v=i.centerPoint.add(d));var m=1===t?g:i.unproject(y.add(_.mult(P(r))).mult(p));i.setLocationAtPoint(i.renderWorldCopies?m.wrap():m,v),e.fireMoveEvents(n)}),(function(){return e.afterEase(n)}),t),this}},{key:"fitScreenCoordinates",value:function(e,t,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(Mt.convert(e)),this.transform.pointLocation(Mt.convert(t)),n,r),r,i)}},{key:"stop",value:function(e,t){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,t)}return this}},{key:"normalizeBearing",value:function(e,t){e=vt(e,-180,180);var n=Math.abs(e-t);return Math.abs(e-360-t)<n&&(e-=360),Math.abs(e+360-t)<n&&(e+=360),e}},{key:"normalizeCenter",value:function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(e){this.emit("move",new Gt("move",e)),this.zooming&&this.emit("zoom",new Gt("zoom",e)),this.rotating&&this.emit("rotate",new Gt("rotate",e)),this.pitching&&this.emit("rotate",new Gt("pitch",e))}},{key:"prepareEase",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,t||n.moving||this.emit("movestart",new Gt("movestart",e)),this.zooming&&!n.zooming&&this.emit("zoomstart",new Gt("zoomstart",e)),this.rotating&&!n.rotating&&this.emit("rotatestart",new Gt("rotatestart",e)),this.pitching&&!n.pitching&&this.emit("pitchstart",new Gt("pitchstart",e))}},{key:"afterEase",value:function(e,t){if(!this.easeId||!t||this.easeId!==t){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new Gt("zoomend",e)),r&&this.emit("rotateend",new Gt("rotateend",e)),i&&this.emit("pitchend",new Gt("pitchend",e)),this.emit("moveend",new Gt("moveend",e))}}},{key:"ease",value:function(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this.easeStart=Et(),this.easeOptions=n,this.onEaseFrame=e,this.onEaseEnd=t,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(e,t,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=jt({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=jt(i,r.padding);var a=this.transform,s=a.padding,u=a.project(wt.convert(e)),l=a.project(wt.convert(t)),c=u.rotate(-n*Math.PI/180),h=l.rotate(-n*Math.PI/180),f=new Mt(Math.max(c.x,h.x),Math.max(c.y,h.y)),p=new Mt(Math.min(c.x,h.x),Math.min(c.y,h.y)),d=f.sub(p),v=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,m=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(m<0||v<0)){var g=Math.min(a.scaleZoom(a.scale*Math.min(v,m)),r.maxZoom),y=Mt.convert(r.offset),_=(r.padding.left-r.padding.right)/2,b=(r.padding.top-r.padding.bottom)/2,x=new Mt(y.x+_,y.y+b).mult(a.scale/a.zoomScale(g));return{center:a.unproject(u.add(l).div(2).sub(x)),zoom:g,bearing:n}}}},{key:"fitInternal",value:function(e,t,n){return e?(delete(t=jt(e,t)).padding,t.linear?this.easeTo(t,n):this.flyTo(t,n)):this}}]),n}(B.EventEmitter),Ht={},Wt=Ht;Ht.create=function(e,t,n){var r=window.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r},Ht.createNS=function(e,t){return window.document.createElementNS(e,t)};var Zt=window.document&&window.document.documentElement.style;function Xt(e){if(!Zt)return e[0];var t,n=ft()(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r in Zt)return r}}catch(e){n.e(e)}finally{n.f()}return e[0]}var Yt,qt=Xt(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Ht.disableDrag=function(){Zt&&qt&&(Yt=Zt[qt],Zt[qt]="none")},Ht.enableDrag=function(){Zt&&qt&&(Zt[qt]=Yt)};var Kt=Xt(["transform","WebkitTransform"]);Ht.setTransform=function(e,t){e.style[Kt]=t};var Qt=!1;try{var $t=Object.defineProperty({},"passive",{get:function(){Qt=!0}});window.addEventListener("test",$t,$t),window.removeEventListener("test",$t,$t)}catch(e){Qt=!1}Ht.addEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&Qt?e.addEventListener(t,n,r):e.addEventListener(t,n,r.capture)},Ht.removeEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&Qt?e.removeEventListener(t,n,r):e.removeEventListener(t,n,r.capture)};var Jt=function e(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",e,!0)};Ht.suppressClick=function(){window.addEventListener("click",Jt,!0),setTimeout((function(){window.removeEventListener("click",Jt,!0)}),0)},Ht.mousePos=function(e,t){var n=e.getBoundingClientRect();return new Mt(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)},Ht.touchPos=function(e,t){var n,r=e.getBoundingClientRect(),i=[],o=ft()(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;i.push(new Mt(a.clientX-r.left-e.clientLeft,a.clientY-r.top-e.clientTop))}}catch(e){o.e(e)}finally{o.f()}return i},Ht.mouseButton=function(e){return e.button},Ht.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};var en=D.rU.merge,tn=function(e){u()(n,e);var t=c()(n);function n(e,r,o){var a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};i()(this,n);var u=Wt.mousePos(r.getCanvasContainer(),o),l=r.unproject(u);return a=t.call(this,e,en({point:u,lngLat:l,originalEvent:o},s)),d()(k()(a),"target",void 0),d()(k()(a),"originalEvent",void 0),d()(k()(a),"point",void 0),d()(k()(a),"lngLat",void 0),d()(k()(a),"defaultPrevented",void 0),a.defaultPrevented=!1,a.target=r,a}return a()(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(Gt),nn=function(e){u()(n,e);var t=c()(n);function n(e,r,o){var a;i()(this,n);var s="touchend"===e?o.changedTouches:o.touches,u=Wt.touchPos(r.getCanvasContainer(),s),l=u.map((function(e){return r.unproject(e)})),c=u.reduce((function(e,t,n,r){return e.add(t.div(r.length))}),new Mt(0,0)),h=r.unproject(c);return a=t.call(this,e,{points:u,point:c,lngLats:l,lngLat:h,originalEvent:o}),d()(k()(a),"target",void 0),d()(k()(a),"originalEvent",void 0),d()(k()(a),"lngLat",void 0),d()(k()(a),"point",void 0),d()(k()(a),"points",void 0),d()(k()(a),"lngLats",void 0),d()(k()(a),"defaultPrevented",void 0),a.defaultPrevented=!1,a}return a()(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(Gt),rn=function(e){u()(n,e);var t=c()(n);function n(e,r,o){var a;return i()(this,n),a=t.call(this,e,{originalEvent:o}),d()(k()(a),"originalEvent",void 0),d()(k()(a),"defaultPrevented",void 0),d()(k()(a),"target",void 0),a.defaultPrevented=!1,a}return a()(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(Gt),on=function(){function e(t){i()(this,e),d()(this,"map",void 0),d()(this,"delayContextMenu",void 0),d()(this,"contextMenuEvent",void 0),this.map=t}return a()(e,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(e){this.map.emit(e.type,new tn(e.type,this.map,e))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new tn("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(e){this.delayContextMenu?this.contextMenuEvent=e:this.map.emit(e.type,new tn(e.type,this.map,e)),this.map.listeners("contextmenu")&&e.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),e}(),an=function(){function e(t,n){i()(this,e),d()(this,"map",void 0),d()(this,"el",void 0),d()(this,"container",void 0),d()(this,"enabled",void 0),d()(this,"active",void 0),d()(this,"startPos",void 0),d()(this,"lastPos",void 0),d()(this,"box",void 0),d()(this,"clickTolerance",void 0),this.map=t,this.el=t.getCanvasContainer(),this.container=t.getContainer(),this.clickTolerance=n.clickTolerance||1}return a()(e,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(Wt.disableDrag(),this.startPos=this.lastPos=t,this.active=!0)}},{key:"mousemoveWindow",value:function(e,t){if(this.active){var n=t;if(!(this.lastPos.equals(n)||!this.box&&n.dist(this.startPos)<this.clickTolerance)){var r=this.startPos;this.lastPos=n,this.box||(this.box=Wt.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",e));var i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);Wt.setTransform(this.box,"translate(".concat(i,"px,").concat(a,"px)")),this.box&&(this.box.style.width="".concat(o-i,"px"),this.box.style.height="".concat(s-a,"px"))}}}},{key:"mouseupWindow",value:function(e,t){var n=this;if(this.active&&0===e.button){var r=this.startPos,i=t;if(this.reset(),Wt.suppressClick(),r.x!==i.x||r.y!==i.y)return this.map.emit("boxzoomend",new Gt("boxzoomend",{originalEvent:e})),{cameraAnimation:function(e){return e.fitScreenCoordinates(r,i,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",e)}}},{key:"keydown",value:function(e){this.active&&27===e.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",e))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(Wt.remove(this.box),this.box=null),Wt.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(e,t){return this.map.emit(e,new Gt(e,{originalEvent:t}))}}]),e}(),sn=an,un=function(){function e(){i()(this,e),d()(this,"enabled",void 0),d()(this,"active",void 0),this.reset()}return a()(e,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(e,t){return e.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),ln=function(e){u()(n,e);var t=c()(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),d()(k()(e),"type","renderFrame"),d()(k()(e),"timeStamp",void 0),e}return a()(n)}(Gt),cn=D.rU.merge,hn={linearity:.3,easing:yt(0,0,.3,1)},fn=cn({deceleration:2500,maxSpeed:1400},hn),pn=cn({deceleration:20,maxSpeed:1400},hn),dn=cn({deceleration:1e3,maxSpeed:360},hn),vn=cn({deceleration:1e3,maxSpeed:90},hn),mn=function(){function e(t){i()(this,e),d()(this,"map",void 0),d()(this,"inertiaBuffer",void 0),this.map=t,this.clear()}return a()(e,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(e){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:Et(),settings:e})}},{key:"drainInertiaBuffer",value:function(){for(var e=this.inertiaBuffer,t=Et();e.length>0&&t-e[0].time>160;)e.shift()}},{key:"onMoveEnd",value:function(e){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var t,n={zoom:0,bearing:0,pitch:0,pan:new Mt(0,0),pinchAround:void 0,around:void 0},r=ft()(this.inertiaBuffer);try{for(r.s();!(t=r.n()).done;){var i=t.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(e){r.e(e)}finally{r.f()}var o=this.inertiaBuffer[this.inertiaBuffer.length-1].time-this.inertiaBuffer[0].time,a={};if(n.pan.mag()){var s=yn(n.pan.mag(),o,cn({},fn,e||{}));a.offset=n.pan.mult(s.amount/n.pan.mag()),a.center=this.map.transform.center,gn(a,s)}if(n.zoom){var u=yn(n.zoom,o,pn);a.zoom=this.map.transform.zoom+u.amount,gn(a,u)}if(n.bearing){var l=yn(n.bearing,o,dn);a.bearing=this.map.transform.bearing+mt(l.amount,-179,179),gn(a,l)}if(n.pitch){var c=yn(n.pitch,o,vn);a.pitch=this.map.transform.pitch+c.amount,gn(a,c)}if(a.zoom||a.bearing){var h=void 0===n.pinchAround?n.around:n.pinchAround;a.around=h?this.map.unproject(h):this.map.getCenter()}return this.clear(),cn(a,{noMoveStart:!0})}}}]),e}();function gn(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function yn(e,t,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=mt(e*i/(t/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:a*(s/2)}}var _n={panStep:100,bearingStep:15,pitchStep:10};function bn(e){return e*(2-e)}var xn=function(){function e(){i()(this,e),d()(this,"enabled",void 0),d()(this,"active",void 0),d()(this,"panStep",void 0),d()(this,"bearingStep",void 0),d()(this,"pitchStep",void 0);var t=_n;this.panStep=t.panStep,this.bearingStep=t.bearingStep,this.pitchStep=t.pitchStep}return a()(e,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),o=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),o=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:bn,zoom:n?Math.round(u)+n*(e.shiftKey?2:1):u,bearing:s.getBearing()+r*t.bearingStep,pitch:s.getPitch()+i*t.pitchStep,offset:[-o*t.panStep,-a*t.panStep],center:s.getCenter()},{originalEvent:e})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),En=function(){function e(t,n){i()(this,e),d()(this,"mousedownPos",void 0),d()(this,"clickTolerance",void 0),d()(this,"map",void 0),this.map=t,this.clickTolerance=n.clickTolerance}return a()(e,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(e){return this.firePreventable(new rn(e.type,this.map,e))}},{key:"mousedown",value:function(e,t){return this.mousedownPos=t,this.firePreventable(new tn(e.type,this.map,e))}},{key:"mouseup",value:function(e){this.map.emit(e.type,new tn(e.type,this.map,e))}},{key:"click",value:function(e,t){this.mousedownPos&&this.mousedownPos.dist(t)>=this.clickTolerance||this.map.emit(e.type,new tn(e.type,this.map,e))}},{key:"dblclick",value:function(e){return this.firePreventable(new tn(e.type,this.map,e))}},{key:"mouseover",value:function(e){this.map.emit(e.type,new tn(e.type,this.map,e))}},{key:"mouseout",value:function(e){this.map.emit(e.type,new tn(e.type,this.map,e))}},{key:"touchstart",value:function(e){return this.firePreventable(new nn(e.type,this.map,e))}},{key:"touchmove",value:function(e){this.map.emit(e.type,new nn(e.type,this.map,e))}},{key:"touchend",value:function(e){this.map.emit(e.type,new nn(e.type,this.map,e))}},{key:"touchcancel",value:function(e){this.map.emit(e.type,new nn(e.type,this.map,e))}},{key:"firePreventable",value:function(e){if(this.map.emit(e.type,e),e.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),e}(),Sn=n(746),An=n.n(Sn),Tn=n(378),Cn=n.n(Tn),wn=d()(d()({},0,1),2,2);var Rn=function(){function e(t){i()(this,e),d()(this,"enabled",void 0),d()(this,"active",void 0),d()(this,"lastPoint",void 0),d()(this,"eventButton",void 0),d()(this,"moved",void 0),d()(this,"clickTolerance",void 0),this.reset(),this.clickTolerance=t.clickTolerance||1}return a()(e,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(e,t){if(!this.lastPoint){var n=Wt.mouseButton(e);this.correctButton(e,n)&&(this.lastPoint=t,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(e,t){var n=this.lastPoint;if(n)if(e.preventDefault(),function(e,t){var n=wn[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this.eventButton))this.reset();else if(this.moved||!(t.dist(n)<this.clickTolerance))return this.moved=!0,this.lastPoint=t,this.move(n,t)}},{key:"mouseupWindow",value:function(e){this.lastPoint&&(Wt.mouseButton(e)===this.eventButton&&(this.moved&&Wt.suppressClick(),this.reset()))}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(e,t){return!1}},{key:"move",value:function(e,t){}}]),e}(),Mn=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"mousedown",value:function(e,t){An()(Cn()(n.prototype),"mousedown",this).call(this,e,t),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(e,t){return{around:t,panDelta:t.sub(e)}}},{key:"correctButton",value:function(e,t){return 0===t&&!e.ctrlKey}}]),n}(Rn),kn=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=-.5*(t.y-e.y);if(n)return this.active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(e){e.preventDefault()}}]),n}(Rn),Ln=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"contextmenu",value:function(e){e.preventDefault()}},{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=.8*(t.x-e.x);if(n)return this.active=!0,{bearingDelta:n}}}]),n}(Rn),On=4.000244140625,Pn=function(){function e(t,n){var r=this;i()(this,e),d()(this,"map",void 0),d()(this,"el",void 0),d()(this,"enabled",void 0),d()(this,"active",void 0),d()(this,"zooming",void 0),d()(this,"aroundCenter",void 0),d()(this,"around",void 0),d()(this,"aroundPoint",void 0),d()(this,"type",void 0),d()(this,"lastValue",void 0),d()(this,"timeout",void 0),d()(this,"finishTimeout",void 0),d()(this,"lastWheelEvent",void 0),d()(this,"lastWheelEventTime",void 0),d()(this,"startZoom",void 0),d()(this,"targetZoom",void 0),d()(this,"delta",void 0),d()(this,"easing",void 0),d()(this,"prevEase",void 0),d()(this,"frameId",void 0),d()(this,"handler",void 0),d()(this,"defaultZoomRate",void 0),d()(this,"wheelZoomRate",void 0),d()(this,"onScrollFrame",(function(){if(r.frameId&&(r.frameId=null,r.isActive())){var e=r.map.transform;if(0!==r.delta){var t="wheel"===r.type&&Math.abs(r.delta)>On?r.wheelZoomRate:r.defaultZoomRate,n=2/(1+Math.exp(-Math.abs(r.delta*t)));r.delta<0&&0!==n&&(n=1/n);var i="number"==typeof r.targetZoom?e.zoomScale(r.targetZoom):e.scale;r.targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(i*n))),"wheel"===r.type&&(r.startZoom=e.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var o,a="number"==typeof r.targetZoom?r.targetZoom:e.zoom,s=r.startZoom,u=r.easing,l=!1;if("wheel"===r.type&&s&&u){var c=Math.min((Et()-r.lastWheelEventTime)/200,1);o=gt(s,a,u(c)),c<1?r.frameId||(r.frameId=!0):l=!0}else o=a,l=!0;return r.active=!0,l&&(r.active=!1,r.finishTimeout=setTimeout((function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!l,zoomDelta:o-e.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}})),this.map=t,this.el=t.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=.01,this.wheelZoomRate=.0022222222222222222}return a()(e,[{key:"setZoomRate",value:function(e){this.defaultZoomRate=e}},{key:"setWheelZoomRate",value:function(e){this.wheelZoomRate=e}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(e){this.isEnabled()||(this.enabled=!0,this.aroundCenter=e&&"center"===e.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(e){if(this.isEnabled()){var t=e.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=Et(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==t&&t%On==0?this.type="wheel":0!==t&&Math.abs(t)<4?this.type="trackpad":r>400?(this.type=null,this.lastValue=t,this.timeout=setTimeout(this.onTimeout,40,e)):this.type||(this.type=Math.abs(r*t)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,t+=this.lastValue)),e.shiftKey&&t&&(t/=4),this.type&&(this.lastWheelEvent=e,this.delta-=t,this.active||this.start(e)),e.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(e){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(e)}},{key:"start",value:function(e){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var t=Wt.mousePos(this.el,e);this.around=wt.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(t)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(e){var t=_t;if(this.prevEase){var n=this.prevEase,r=(Et()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01;t=yt(o,Math.sqrt(.0729-o*o),.25,1)}return this.prevEase={start:Et(),duration:e,easing:t},t}}]),e}(),In=Pn,Nn=function(){function e(t,n){i()(this,e),d()(this,"clickZoom",void 0),d()(this,"tapZoom",void 0),this.clickZoom=t,this.tapZoom=n}return a()(e,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),e}(),Dn=function(){function e(t,n,r){i()(this,e),d()(this,"inertiaOptions",void 0),d()(this,"el",void 0),d()(this,"mousePan",void 0),d()(this,"touchPan",void 0),this.el=t,this.mousePan=n,this.touchPan=r}return a()(e,[{key:"enable",value:function(e){this.inertiaOptions=e||{},this.mousePan.enable(),this.touchPan.enable(),this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),e}(),Bn=function(){function e(t,n,r){i()(this,e),d()(this,"mouseRotate",void 0),d()(this,"mousePitch",void 0),d()(this,"pitchWithRotate",void 0),this.pitchWithRotate=t.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}return a()(e,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),e}(),Fn=function(){function e(t,n,r,o){i()(this,e),d()(this,"el",void 0),d()(this,"touchZoom",void 0),d()(this,"touchRotate",void 0),d()(this,"tapDragZoom",void 0),d()(this,"rotationDisabled",void 0),d()(this,"enabled",void 0),this.el=t,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=o,this.rotationDisabled=!1,this.enabled=!0}return a()(e,[{key:"enable",value:function(e){this.touchZoom.enable(e),this.rotationDisabled||this.touchRotate.enable(e),this.tapDragZoom.enable(),this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),e}();function Un(e,t){for(var n={},r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}var zn=function(){function e(t){i()(this,e),d()(this,"numTouches",void 0),d()(this,"centroid",void 0),d()(this,"startTime",void 0),d()(this,"aborted",void 0),d()(this,"touches",void 0),this.reset(),this.numTouches=t.numTouches}return a()(e,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(e,t,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){var t,n=new Mt(0,0),r=ft()(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n._add(i)}}catch(e){r.e(e)}finally{r.f()}return n.div(e.length)}(t),this.touches=Un(n,t)))}},{key:"touchmove",value:function(e,t,n){if(!this.aborted&&this.centroid){var r=Un(n,t);for(var i in this.touches)if(this.touches[i]){var o=this.touches[i],a=r[i];(!a||a.dist(o)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),e}(),Gn=function(){function e(t){i()(this,e),d()(this,"singleTap",void 0),d()(this,"numTaps",void 0),d()(this,"lastTime",void 0),d()(this,"lastTap",void 0),d()(this,"count",void 0),this.singleTap=new zn(t),this.numTaps=t.numTaps,this.reset()}return a()(e,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(e,t,n){this.singleTap.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.singleTap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this.singleTap.touchend(e,t,n);if(r){var i=e.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),e}(),jn=function(){function e(){i()(this,e),d()(this,"enabled",void 0),d()(this,"active",void 0),d()(this,"swipePoint",void 0),d()(this,"swipeTouch",void 0),d()(this,"tapTime",void 0),d()(this,"tap",void 0),this.tap=new Gn({numTouches:1,numTaps:1}),this.reset()}return a()(e,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(e,t,n){this.swipePoint||(this.tapTime&&e.timeStamp-this.tapTime>500&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=t[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(e,t,n))}},{key:"touchmove",value:function(e,t,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=t[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,e.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){this.tapTime?this.swipePoint&&0===n.length&&this.reset():this.tap.touchend(e,t,n)&&(this.tapTime=e.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),Vn=function(){function e(){i()(this,e),d()(this,"enabled",void 0),d()(this,"active",void 0),d()(this,"zoomIn",void 0),d()(this,"zoomOut",void 0),this.zoomIn=new Gn({numTouches:1,numTaps:2}),this.zoomOut=new Gn({numTouches:2,numTaps:1}),this.reset()}return a()(e,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(e,t,n){this.zoomIn.touchstart(e,t,n),this.zoomOut.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.zoomIn.touchmove(e,t,n),this.zoomOut.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this,i=this.zoomIn.touchend(e,t,n),o=this.zoomOut.touchend(e,t,n);return i?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}}):o?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(o)},{originalEvent:e})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),Hn=function(){function e(t){i()(this,e),d()(this,"enabled",void 0),d()(this,"active",void 0),d()(this,"touches",void 0),d()(this,"minTouches",void 0),d()(this,"clickTolerance",void 0),d()(this,"sum",void 0),this.minTouches=1,this.clickTolerance=t.clickTolerance||1,this.reset()}return a()(e,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new Mt(0,0)}},{key:"touchstart",value:function(e,t,n){return this.calculateTransform(e,t,n)}},{key:"touchmove",value:function(e,t,n){if(this.active)return e.preventDefault(),this.calculateTransform(e,t,n)}},{key:"touchend",value:function(e,t,n){this.calculateTransform(e,t,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(e,t,n){n.length>0&&(this.active=!0);var r=Un(n,t),i=new Mt(0,0),o=new Mt(0,0),a=0;for(var s in r)if(r[s]){var u=r[s],l=this.touches[s];l&&(i._add(u),o._add(u.sub(l)),a++,r[s]=u)}if(this.touches=r,!(a<this.minTouches)&&o.mag()){var c=o.div(a);if(this.sum._add(c),!(this.sum.mag()<this.clickTolerance))return{around:i.div(a),panDelta:c}}}}]),e}(),Wn=function(){function e(){i()(this,e),d()(this,"enabled",void 0),d()(this,"active",void 0),d()(this,"firstTwoTouches",void 0),d()(this,"vector",void 0),d()(this,"startVector",void 0),d()(this,"aroundCenter",void 0),this.reset()}return a()(e,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(e){}},{key:"move",value:function(e,t,n){}},{key:"touchstart",value:function(e,t,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([t[0],t[1]]))}},{key:"touchmove",value:function(e,t,n){if(this.firstTwoTouches){e.preventDefault();var r=g()(this.firstTwoTouches,2),i=r[0],o=r[1],a=Zn(n,t,i),s=Zn(n,t,o);if(a&&s){var u=this.aroundCenter?null:a.add(s).div(2);return this.move([a,s],u,e)}}}},{key:"touchend",value:function(e,t,n){if(this.firstTwoTouches){var r=g()(this.firstTwoTouches,2),i=r[0],o=r[1],a=Zn(n,t,i),s=Zn(n,t,o);a&&s||(this.active&&Wt.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(e){this.enabled=!0,this.aroundCenter=!!e&&"center"===e.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function Zn(e,t,n){for(var r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function Xn(e){return Math.abs(e.y)>Math.abs(e.x)}var Yn=function(e){u()(n,e);var t=c()(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),d()(k()(e),"valid",void 0),d()(k()(e),"firstMove",void 0),d()(k()(e),"lastPoints",void 0),e}return a()(n,[{key:"reset",value:function(){An()(Cn()(n.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(e){this.lastPoints=e,Xn(e[0].sub(e[1]))&&(this.valid=!1)}},{key:"move",value:function(e,t,n){var r=e[0].sub(this.lastPoints[0]),i=e[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid){this.lastPoints=e,this.active=!0;return{pitchDelta:-.5*((r.y+i.y)/2)}}}},{key:"gestureBeginsVertically",value:function(e,t,n){if(void 0!==this.valid)return this.valid;var r=e.mag()>=2,i=t.mag()>=2;if(r||i){if(!r||!i)return void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<100&&void 0;var o=e.y>0==t.y>0;return Xn(e)&&Xn(t)&&o}}}]),n}(Wn);function qn(e,t){return 180*e.angleWith(t)/Math.PI}var Kn=function(e){u()(n,e);var t=c()(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),d()(k()(e),"minDiameter",void 0),e}return a()(n,[{key:"reset",value:function(){An()(Cn()(n.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(e){this.startVector=this.vector=e[0].sub(e[1]),this.minDiameter=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.vector;if(this.vector=e[0].sub(e[1]),this.active||!this.isBelowThreshold(this.vector))return this.active=!0,{bearingDelta:qn(this.vector,n),pinchAround:t}}},{key:"isBelowThreshold",value:function(e){this.minDiameter=Math.min(this.minDiameter,e.mag());var t=25/(Math.PI*this.minDiameter)*360,n=qn(e,this.startVector);return Math.abs(n)<t}}]),n}(Wn);function Qn(e,t){return Math.log(e/t)/Math.LN2}var $n=function(e){u()(n,e);var t=c()(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),d()(k()(e),"distance",void 0),d()(k()(e),"startDistance",void 0),e}return a()(n,[{key:"reset",value:function(){An()(Cn()(n.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(e){this.startDistance=this.distance=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.distance;if(this.distance=e[0].dist(e[1]),this.active||!(Math.abs(Qn(this.distance,this.startDistance))<.1))return this.active=!0,{zoomDelta:Qn(this.distance,n),pinchAround:t}}}]),n}(Wn),Jn=D.rU.merge,er=function(e){return e.zoom||e.drag||e.pitch||e.rotate};function tr(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var nr=function(){function e(t,n){var r=this;i()(this,e),d()(this,"map",void 0),d()(this,"el",void 0),d()(this,"handlers",void 0),d()(this,"eventsInProgress",void 0),d()(this,"frameId",void 0),d()(this,"inertia",void 0),d()(this,"bearingSnap",void 0),d()(this,"handlersById",void 0),d()(this,"updatingCamera",void 0),d()(this,"changes",void 0),d()(this,"previousActiveHandlers",void 0),d()(this,"bearingChanged",void 0),d()(this,"rotateEnabled",void 0),d()(this,"pitchEnabled",void 0),d()(this,"listeners",void 0),d()(this,"handleWindowEvent",(function(e){r.handleEvent(e,"".concat(e.type,"Window"))})),d()(this,"handleEvent",(function(e,t){if("blur"!==e.type){r.updatingCamera=!0;var n,i="renderFrame"===e.type?void 0:e,o={needsRenderFrame:!1},a={},s={},u=e.touches?r.getMapTouches(e.touches):void 0,l=u?Wt.touchPos(r.el,u):Wt.mousePos(r.el,e),c=ft()(r.handlers);try{for(c.s();!(n=c.n()).done;){var h=n.value,f=h.handlerName,p=h.handler,d=h.allowed;if(p.isEnabled()){var v=void 0;if(r.blockedByActive(s,d,f))p.reset();else{var m=t||e.type;p&&p[m]&&(v=p[m](e,l,u),r.mergeIHandlerResult(o,a,v,f,i),v&&v.needsRenderFrame&&r.triggerRenderFrame())}(v||p.isActive())&&(s[f]=p)}}}catch(e){c.e(e)}finally{c.f()}var g={};for(var y in r.previousActiveHandlers)s[y]||(g[y]=i);r.previousActiveHandlers=s,(Object.keys(g).length||tr(o))&&(r.changes.push([o,a,g]),r.triggerRenderFrame()),(Object.keys(s).length||tr(o))&&r.map.stop(!0),r.updatingCamera=!1;var _=o.cameraAnimation;_&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],_(r.map))}else r.stop()})),this.map=t,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new mn(t),this.bearingSnap=n.bearingSnap,this.rotateEnabled=n.rotateEnabled,this.pitchEnabled=n.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var o=this.el;this.listeners=[],this.listeners=[[o,"touchstart",{passive:!1}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];var a,s=ft()(this.listeners);try{for(s.s();!(a=s.n()).done;){var u=g()(a.value,3),l=u[0],c=u[1],h=u[2];Wt.addEventListener(l,c,l===window.document?this.handleWindowEvent:this.handleEvent,h)}}catch(e){s.e(e)}finally{s.f()}}return a()(e,[{key:"destroy",value:function(){var e,t=ft()(this.listeners);try{for(t.s();!(e=t.n()).done;){var n=g()(e.value,3),r=n[0],i=n[1],o=n[2];Wt.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(e){t.e(e)}finally{t.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var e,t=ft()(this.handlers);try{for(t.s();!(e=t.n()).done;){e.value.handler.reset()}}catch(e){t.e(e)}finally{t.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var e,t=ft()(this.handlers);try{for(t.s();!(e=t.n()).done;){if(e.value.handler.isActive())return!0}}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(er(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(e,t,n,r,i){if(n){Jn(e,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(t.zoom=o),void 0!==n.panDelta&&(t.drag=o),void 0!==n.pitchDelta&&(t.pitch=o),void 0!==n.bearingDelta&&(t.rotate=o)}}},{key:"triggerRenderFrame",value:function(){var e=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame((function(t){delete e.frameId,e.handleEvent(new ln("renderFrame",{timeStamp:t})),e.applyChanges()})))}},{key:"addDefaultHandlers",value:function(e){var t=this.map,n=t.getCanvasContainer();this.add("mapEvent",new En(t,e));var r=t.boxZoom=new sn(t,e);this.add("boxZoom",r);var i=new Vn,o=new un;t.doubleClickZoom=new Nn(o,i),this.add("tapZoom",i),this.add("clickZoom",o);var a=new jn;this.add("tapDragZoom",a);var s=t.touchPitch=new Yn;this.add("touchPitch",s);var u=new kn(e),l=new Ln(e);t.dragRotate=new Bn(e,u,l),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",l,["mouseRotate"]);var c=new Mn(e),h=new Hn(e);t.dragPan=new Dn(n,c,h),this.add("mousePan",c),this.add("touchPan",h,["touchZoom","touchRotate"]);var f=new Kn,p=new $n;t.touchZoomRotate=new Fn(n,p,f,a),this.add("touchRotate",f,["touchPan","touchZoom"]),this.add("touchZoom",p,["touchPan","touchRotate"]);var d=t.scrollZoom=new In(t,this);this.add("scrollZoom",d,["mousePan"]);var v=t.keyboard=new xn;this.add("keyboard",v),this.add("blockableMapEvent",new on(t));for(var m=0,g=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];m<g.length;m++){var y=g[m];e.interactive&&e[y]&&t[y].enable(e[y])}}},{key:"add",value:function(e,t,n){this.handlers.push({handlerName:e,handler:t,allowed:n}),this.handlersById[e]=t}},{key:"blockedByActive",value:function(e,t,n){for(var r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}},{key:"getMapTouches",value:function(e){var t,n=[],r=ft()(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,o=i.target;this.el.contains(o)&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var e,t={},n={},r={},i=ft()(this.changes);try{for(i.s();!(e=i.n()).done;){var o=g()(e.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(t.panDelta=(t.panDelta||new Mt(0,0))._add(a.panDelta)),a.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(t.around=a.around),void 0!==a.pinchAround&&(t.pinchAround=a.pinchAround),a.noInertia&&(t.noInertia=a.noInertia),Jn(n,s),Jn(r,u)}}catch(e){i.e(e)}finally{i.f()}this.updateMapTransform(t,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(e,t,n){var r=this.map,i=r.transform;if(!tr(e))return this.fireEvents(t,n);var o=e.panDelta,a=e.zoomDelta,s=e.bearingDelta,u=e.pitchDelta,l=e.pinchAround,c=e.around;void 0!==l&&(c=l),r.stop(!0),c=c||r.transform.centerPoint;var h=i.pointLocation(o?c.sub(o):c);s&&this.rotateEnabled&&(i.bearing+=s),u&&this.pitchEnabled&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,c),this.map.update(),e.noInertia||this.inertia.record(e),this.fireEvents(t,n)}},{key:"fireEvents",value:function(e,t){var n=this,r=er(this.eventsInProgress),i=er(e),o={};for(var a in e)if(e[a]){var s=e[a].originalEvent;this.eventsInProgress[a]||(o["".concat(a,"start")]=s),this.eventsInProgress[a]=e[a]}for(var u in!r&&i&&this.fireEvent("movestart",i.originalEvent),o)o[u]&&this.fireEvent(u,o[u]);for(var l in e.rotate&&(this.bearingChanged=!0),i&&this.fireEvent("move",i.originalEvent),e)if(e[l]){var c=e[l].originalEvent;this.fireEvent(l,c)}var h,f={};for(var p in this.eventsInProgress)if(this.eventsInProgress[p]){var d=this.eventsInProgress[p],v=d.handlerName,m=d.originalEvent;this.handlersById[v].isActive()||(delete this.eventsInProgress[p],h=t[v]||m,f["".concat(p,"end")]=h)}for(var g in f)f[g]&&this.fireEvent(g,f[g]);var y=er(this.eventsInProgress);if((r||i)&&!y){this.updatingCamera=!0;var _=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),b=function(e){return 0!==e&&-n.bearingSnap<e&&e<n.bearingSnap};_?(b(_.bearing||this.map.getBearing())&&(_.bearing=0),this.map.easeTo(_,{originalEvent:h})):(this.map.emit("moveend",new Gt("moveend",{originalEvent:h})),b(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(e,t){this.map.emit(e,new Gt(e,t?{originalEvent:t}:{}))}}]),e}(),rr=nr,ir=null,or=[],ar=(window.performance,function(e){var t=e;if(null!=ir){var n=t-ir;or.push(n)}ir=t}),sr=function(){function e(){i()(this,e),d()(this,"queue",void 0),d()(this,"id",void 0),d()(this,"cleared",void 0),d()(this,"currentlyRunning",void 0),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return a()(e,[{key:"add",value:function(e){var t=++this.id;return this.queue.push({callback:e,id:t,cancelled:!1}),t}},{key:"remove",value:function(e){var t,n=this.currentlyRunning,r=n?this.queue.concat(n):this.queue,i=ft()(r);try{for(i.s();!(t=i.n()).done;){var o=t.value;if(o.id===e)return void(o.cancelled=!0)}}catch(e){i.e(e)}finally{i.f()}}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.currentlyRunning=this.queue;this.queue=[];var n,r=ft()(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(e),this.cleared))break}}catch(e){r.e(e)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),e}(),ur=sr;!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var lr=D.rU.merge,cr={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},hr=function(e){u()(n,e);var t=c()(n);function n(e){var r;return i()(this,n),r=t.call(this,lr({},cr,e)),d()(k()(r),"doubleClickZoom",void 0),d()(k()(r),"dragRotate",void 0),d()(k()(r),"dragPan",void 0),d()(k()(r),"touchZoomRotate",void 0),d()(k()(r),"scrollZoom",void 0),d()(k()(r),"keyboard",void 0),d()(k()(r),"touchPitch",void 0),d()(k()(r),"boxZoom",void 0),d()(k()(r),"handlers",void 0),d()(k()(r),"container",void 0),d()(k()(r),"canvas",void 0),d()(k()(r),"canvasContainer",void 0),d()(k()(r),"renderTaskQueue",new ur),d()(k()(r),"frame",void 0),d()(k()(r),"trackResize",!0),d()(k()(r),"onWindowOnline",(function(){r.update()})),d()(k()(r),"onWindowResize",(function(e){r.trackResize&&r.resize({originalEvent:e}).update()})),r.initContainer(),r.resize(),r.handlers=new rr(k()(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1)),r}return a()(n,[{key:"resize",value:function(e){var t=this.containerDimensions(),n=t[0],r=t[1];this.transform.resize(n,r);var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Event("movestart",e)),this.emit("move",new Event("move",e))),this.emit("resize",new Event("resize",e)),i&&this.emit("moveend",new Event("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(e){return this.transform.locationPoint(wt.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation(Mt.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds(Rt.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear(),this.handlers.destroy(),"undefined"!=typeof window&&(window.removeEventListener("online",this.onWindowOnline,!1),window.removeEventListener("resize",this.onWindowResize,!1),window.removeEventListener("orientationchange",this.onWindowResize,!1))}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=Tt((function(t){ar(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=Tt((function(n){ar(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=D.SO.create("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(e=this.container.clientWidth||400,t=this.container.clientHeight||300),[e,t]}},{key:"resizeCanvas",value:function(e,t){var n=D.SO.DPR||1;this.canvas.width=n*e,this.canvas.height=n*t,this.canvas.style.width="".concat(e,"px"),this.canvas.style.height="".concat(t,"px")}}]),n}(Vt),fr=(n(8459),D.rU.throttle),pr=function(){function e(t){var n=this;i()(this,e),d()(this,"map",void 0),d()(this,"updateHash",void 0),d()(this,"hashName",void 0),d()(this,"onHashChange",(function(){var e=n.getCurrentHash();if(e.length>=3&&!e.some((function(e){return isNaN(+e)}))){var t=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(e[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1})),d()(this,"getCurrentHash",(function(){var e,t=window.location.hash.replace("#","");return n.hashName?(t.split("&").map((function(e){return e.split("=")})).forEach((function(t){t[0]===n.hashName&&(e=t)})),(e&&e[1]||"").split("/")):t.split("/")})),d()(this,"updateHashUnthrottled",(function(){var e=n.getHashString();try{window.history.replaceState(window.history.state,"",e)}catch(e){}})),this.hashName=t&&encodeURIComponent(t),this.updateHash=fr(this.updateHashUnthrottled,300)}return a()(e,[{key:"addTo",value:function(e){return this.map=e,window.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return window.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(e){var t=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(t.lng*i)/i,a=Math.round(t.lat*i)/i,s=this.map.getBearing(),u=this.map.getPitch(),l="";if(l+=e?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o),(s||u)&&(l+="/".concat(Math.round(10*s)/10)),u&&(l+="/".concat(Math.round(u))),this.hashName){var c=this.hashName,h=!1,f=window.location.hash.slice(1).split("&").map((function(e){var t=e.split("=")[0];return t===c?(h=!0,"".concat(t,"=").concat(l)):e})).filter((function(e){return e}));return h||f.push("".concat(c,"=").concat(l)),"#".concat(f.join("&"))}return"#".concat(l)}}]),e}(),dr=pr;!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n"),function(){if("function"==typeof window.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}();var vr=D.rU.merge,mr={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},gr=function(e){u()(n,e);var t=c()(n);function n(e){var r;i()(this,n),r=t.call(this,vr({},mr,e)),d()(k()(r),"doubleClickZoom",void 0),d()(k()(r),"dragRotate",void 0),d()(k()(r),"dragPan",void 0),d()(k()(r),"touchZoomRotate",void 0),d()(k()(r),"scrollZoom",void 0),d()(k()(r),"keyboard",void 0),d()(k()(r),"touchPitch",void 0),d()(k()(r),"boxZoom",void 0),d()(k()(r),"handlers",void 0),d()(k()(r),"container",void 0),d()(k()(r),"canvas",void 0),d()(k()(r),"canvasContainer",void 0),d()(k()(r),"renderTaskQueue",new ur),d()(k()(r),"frame",void 0),d()(k()(r),"trackResize",!0),d()(k()(r),"hash",void 0),d()(k()(r),"onWindowOnline",(function(){r.update()})),d()(k()(r),"onWindowResize",(function(e){r.trackResize&&r.resize({originalEvent:e}).update()})),r.initContainer(),r.resize(),r.handlers=new rr(k()(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1));var o="string"==typeof e.hash&&e.hash||void 0;return e.hash&&(r.hash=new dr(o).addTo(k()(r))),r.hash&&r.hash.onHashChange()||(r.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(r.resize(),r.fitBounds(e.bounds,vr({},e.fitBoundsOptions,{duration:0})))),r}return a()(n,[{key:"resize",value:function(e){var t=this.containerDimensions(),n=g()(t,2),r=n[0],i=n[1];this.transform.resize(r,i);var o=!this.moving;return o&&(this.stop(),this.emit("movestart",new window.CustomEvent("movestart",e)),this.emit("move",new window.CustomEvent("move",e))),this.emit("resize",new window.CustomEvent("resize",e)),o&&this.emit("moveend",new window.CustomEvent("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"getCanvasOverlays",value:function(){return this.getCanvasContainer()}},{key:"project",value:function(e){return this.transform.locationPoint(wt.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation(Mt.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds(Rt.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear(),this.handlers.destroy(),"undefined"!=typeof window&&(window.removeEventListener("online",this.onWindowOnline,!1),window.removeEventListener("resize",this.onWindowResize,!1),window.removeEventListener("orientationchange",this.onWindowResize,!1))}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=Tt((function(t){ar(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=Tt((function(n){ar(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=D.SO.create("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(e=0===(e=this.container.clientWidth)?400:e,t=0===(t=this.container.clientHeight)?300:t),[e,t]}}]),n}(Vt),yr=function(){function e(){i()(this,e),d()(this,"xzReg",.6*-Math.PI),d()(this,"yReg",.2*Math.PI),d()(this,"earthCameraRadius",200),d()(this,"earthCameraZoom",1),d()(this,"cameraPosition",P.create()),d()(this,"viewport",void 0),d()(this,"projectionMatrix",O.create()),d()(this,"modelMatrix",O.create()),d()(this,"viewMatrix",O.create()),d()(this,"viewProjectionMatrix",O.create()),d()(this,"ViewProjectionMatrixUncentered",O.create()),d()(this,"viewUncenteredMatrix",O.create())}return a()(e,[{key:"syncWithMapCamera",value:function(e){var t=e.viewportHeight,n=void 0===t?1:t,r=e.viewportWidth,i=(void 0===r?1:r)/n;O.perspective(this.projectionMatrix,20,i,.1,1e4);var o=this.earthCameraRadius*Math.cos(this.xzReg),a=this.earthCameraRadius*Math.sin(this.xzReg),s=this.earthCameraRadius*Math.sin(this.yReg);this.cameraPosition=P.fromValues(o,s,a),P.normalize(this.cameraPosition,this.cameraPosition),P.multiply(this.cameraPosition,this.cameraPosition,P.fromValues(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),P.scale(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);var u=P.create();P.cross(u,this.cameraPosition,P.fromValues(0,1,0));var l=P.fromValues(0,1,0);P.cross(l,u,this.cameraPosition);var c=P.fromValues(0,0,0);O.lookAt(this.viewMatrix,this.cameraPosition,c,l),this.viewUncenteredMatrix=O.clone(this.viewMatrix),O.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),O.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"rotateY",value:function(e){this.xzReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"rotateX",value:function(e){this.yReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"scaleZoom",value:function(e){this.earthCameraZoom+=e,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}},{key:"getZoom",value:function(){return 4}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[0,0]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return this.modelMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),_r=["id","style","rotation"],br={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},xr=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"version","GLOBEL"),d()(k()(e),"dragging",!1),d()(k()(e),"viewport",void 0),d()(k()(e),"handleCameraChanging",void 0),d()(k()(e),"handleCameraTimer",void 0),d()(k()(e),"handleCameraChanged",(function(t){e.emit("mapchange");e.handleCameraChanging=!0,e.handleCameraTimer&&clearTimeout(e.handleCameraTimer),e.handleCameraTimer=setTimeout((function(){e.handleCameraChanging=!1}),2e3);var n=.02;t.type&&t.originalEvent&&("wheel"===t.originalEvent.type&&e.viewport.scaleZoom(.01*Math.sign(t.originalEvent.wheelDelta)*-1),Math.abs(t.originalEvent.movementX)>Math.abs(t.originalEvent.movementY)?t.originalEvent.movementX>0?e.viewport.rotateY(n):t.originalEvent.movementX<0&&e.viewport.rotateY(-.02):t.originalEvent.movementY>0?e.viewport.rotateX(n):t.originalEvent.movementY<0&&e.viewport.rotateX(-.02));var r=e.config.offsetCoordinate,i=void 0===r||r;e.viewport.syncWithMapCamera({viewportHeight:e.map.transform.height,viewportWidth:e.map.transform.width}),e.viewport.getZoom()>12&&i?e.coordinateSystemService.setCoordinateSystem(L.CoordinateSystem.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(L.CoordinateSystem.LNGLAT),e.cameraChangedCallback(e.viewport)})),e}return a()(r,[{key:"lngLatToMercator",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getModelMatrix",value:function(e,t,n,r,i){throw new Error("Method not implemented.")}},{key:"on",value:function(e,t){-1!==L.MapServiceEvent.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(br[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(br[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"earth"}},{key:"init",value:(t=R()(S()().mark((function e(){var t,n,r,i,o,a,s,u;return S()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.style,o=void 0===i?"light":i,a=t.rotation,s=void 0===a?0:a,u=C()(t,_r),this.viewport=new yr,this.$mapContainer=this.creatMapContainer(r),this.map=new hr(f()({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},u)),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged({});case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e;null===(e=this.$mapContainer)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"getCanvasOverlays",value:function(){}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"rotateY",value:function(e){var t=e||{},n=t.force,r=void 0!==n&&n,i=t.reg,o=void 0===i?.01:i;this.handleCameraChanging&&!r||this.viewport&&(this.viewport.rotateY(o),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}}]),r}($e),Er=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return xr}}]),n}(v),Sr=["id","style","rotation","mapInstance","version","mapSize","interactive"],Ar=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"version",D.T.DEFAULT),d()(k()(e),"viewport",void 0),e}return a()(r,[{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=Ft.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=Ft.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=O.create();return O.translate(s,s,P.fromValues(o.x-i.x,o.y-i.y,o.z||0-i.z)),O.scale(s,s,P.fromValues(a*r[0],-a*r[1],a*r[2])),O.rotateX(s,s,n[0]),O.rotateY(s,s,n[1]),O.rotateZ(s,s,n[2]),s}},{key:"init",value:(t=R()(S()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p,d,v,m,g=this;return S()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.style,o=void 0===i?"light":i,a=t.rotation,s=void 0===a?0:a,u=t.mapInstance,l=t.version,c=void 0===l?"DEFAULTMAP":l,h=t.mapSize,p=void 0===h?1e4:h,d=t.interactive,v=void 0===d||d,m=C()(t,Sr),this.viewport=new me,this.version=c,this.simpleMapCoord.setSize(p),"SIMPLE"===c&&m.center&&(m.center=this.simpleMapCoord.unproject(m.center)),u?(this.map=u,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new gr(f()({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},m))),this.map.on("load",(function(){g.handleCameraChanged()})),v&&this.map.on("move",this.handleCameraChanged),setTimeout((function(){g.handleCameraChanged()}),100),this.handleCameraChanged();case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"getCanvasOverlays",value:function(){return this.getContainer()}}]),r}($e),Tr=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return Ar}}]),n}(v),Cr=n(5012),wr=n.n(Cr),Rr=function(){function e(){i()(this,e),d()(this,"viewport",void 0)}return a()(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth;this.viewport=new ve({width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),Mr=["id","attributionControl","style","token","rotation","mapInstance"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}"),window.mapboxgl=wr();var kr=0,Lr="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",Or=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"version","MAPBOX"),d()(k()(e),"viewport",void 0),e}return a()(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=O.create();return O.translate(s,s,P.fromValues(o.x-i.x,o.y-i.y,o.z||0-i.z)),O.scale(s,s,P.fromValues(a*r[0],-a*r[1],a*r[2])),O.rotateX(s,s,n[0]),O.rotateY(s,s,n[1]),O.rotateZ(s,s,n[2]),s}},{key:"init",value:(t=R()(S()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p,d,v=this;return S()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.attributionControl,o=void 0!==i&&i,a=t.style,s=void 0===a?"light":a,u=t.token,l=void 0===u?Lr:u,c=t.rotation,h=void 0===c?0:c,p=t.mapInstance,d=C()(t,Mr),this.viewport=new Rr,p||window.mapboxgl||console.error(this.configService.getSceneWarninfo("SDK")),l!==Lr||"blank"===s||window.mapboxgl.accessToken||p||console.warn(this.configService.getSceneWarninfo("MapToken")),p||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=l),p?(this.map=p,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.mapboxgl.Map(f()({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:h},d))),this.map.on("load",(function(){v.handleCameraChanged()})),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e;null===(e=this.$mapContainer)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"getCanvasOverlays",value:function(){var e;return null===(e=this.getMapContainer())||void 0===e?void 0:e.querySelector(".mapboxgl-canvas-container")}},{key:"meterToCoord",value:function(e,t){var n=new(wr().LngLat)(e[0],e[1]),r=new(wr().LngLat)(t[0],t[1]),i=n.distanceTo(r),o=wr().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),a=wr().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),s=o.x,u=o.y,l=a.x,c=a.y;return 4194304*Math.sqrt(Math.pow(s-l,2)+Math.pow(u-c,2))*2/i}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+kr++,t.appendChild(n),n}}]),r}($e);!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".mapboxgl-ctrl-logo {\n display: none !important;\n}\n");var Pr=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return Or}}]),n}(v),Ir=n(9427),Nr=n.n(Ir),Dr=["id","attributionControl","style","rotation","mapInstance"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".maplibregl-map{-webkit-tap-highlight-color:rgb(0 0 0/0);font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:-moz-full-screen{height:100%;width:100%}.maplibregl-map:-ms-fullscreen{height:100%;width:100%}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (-ms-high-contrast:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}.maplibregl-ctrl button:not(:disabled):hover{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23999' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E\")}}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{-webkit-animation:maplibregl-spin 2s linear infinite;animation:maplibregl-spin 2s linear infinite}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E\")}}@-webkit-keyframes maplibregl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes maplibregl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E\");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (-ms-high-contrast:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.maplibregl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E\")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:hsla(0,0%,100%,.5);margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:hsla(0,0%,100%,.5);background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\")}}.maplibregl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:hsla(0,0%,100%,.75);border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:rgb(0 0 0/5%)}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{-webkit-animation:maplibregl-user-location-dot-pulse 2s infinite;animation:maplibregl-user-location-dot-pulse 2s infinite;content:\"\";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px rgba(0,0,0,.35);box-sizing:border-box;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@-webkit-keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}70%{opacity:0;-webkit-transform:scale(3);transform:scale(3)}to{opacity:0;-webkit-transform:scale(1);transform:scale(1)}}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}70%{opacity:0;-webkit-transform:scale(3);transform:scale(3)}to{opacity:0;-webkit-transform:scale(1);transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:rgba(0,0,0,.4);color:#fff;display:flex;font-size:1.4em;inset:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none),(width <= 480px){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}"),window.maplibregl=Nr();var Br=0,Fr=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"version",D.T.MAPBOX),d()(k()(e),"viewport",void 0),e}return a()(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=window.maplibregl.MercatorCoordinate.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.maplibregl.MercatorCoordinate.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=O.create();return O.translate(s,s,P.fromValues(o.x-i.x,o.y-i.y,o.z||0-i.z)),O.scale(s,s,P.fromValues(a*r[0],-a*r[1],a*r[2])),O.rotateX(s,s,n[0]),O.rotateY(s,s,n[1]),O.rotateZ(s,s,n[2]),s}},{key:"init",value:(t=R()(S()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p=this;return S()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.attributionControl,o=void 0!==i&&i,a=t.style,s=void 0===a?"light":a,u=t.rotation,l=void 0===u?0:u,c=t.mapInstance,h=C()(t,Dr),this.viewport=new Rr,c||window.maplibregl||console.error(this.configService.getSceneWarninfo("SDK")),c?(this.map=c,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.maplibregl.Map(f()({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:l},h))),this.map.on("load",(function(){p.handleCameraChanged()})),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e;null===(e=this.$mapContainer)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"getCanvasOverlays",value:function(){return this.getMapContainer()}},{key:"meterToCoord",value:function(e,t){var n=new(Nr().LngLat)(e[0],e[1]),r=new(Nr().LngLat)(t[0],t[1]),i=n.distanceTo(r),o=Nr().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),a=Nr().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),s=o.x,u=o.y,l=a.x,c=a.y;return 4194304*Math.sqrt(Math.pow(s-l,2)+Math.pow(u-c,2))*2/i}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+Br++,t.appendChild(n),n}}]),r}($e),Ur=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return Fr}}]),n}(v);if(!window)throw Error("TMap JSAPI can only be used in Browser.");var zr=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(zr||{}),Gr={key:"",version:"1.exp",libraries:[]},jr={TMap:zr.notload},Vr=[],Hr=function(e){if("function"==typeof e){if(jr.TMap===zr.loaded)return void e(window.TMap);Vr.push(e)}},Wr=function(e){return new Promise((function(t,n){if(jr.TMap===zr.failed)n("");else if(jr.TMap===zr.notload){var r=e.key,i=e.version,o=e.libraries;if(!r)return void n("请填写key");Gr.key=r,Gr.version=i||Gr.version,Gr.libraries=o||Gr.libraries,jr.TMap=zr.loading,window._onTMapAPILoaded=function(e){if(delete window._onTMapAPILoaded,e)jr.TMap=zr.failed,n(e);else for(jr.TMap=zr.loaded;Vr.length;)Vr.splice(0,1)[0](window.TMap)};var a=document.createElement("script");a.type="text/javascript",a.async=!1,a.src="https://map.qq.com/api/gljs?callback=_onTMapAPILoaded&v="+Gr.version+"&key="+r+"&plugin="+Gr.libraries.join(","),a.onerror=function(e){jr.TMap=zr.failed,n(e)},(document.body||document.head).appendChild(a),Hr(t)}else if(jr.TMap===zr.loaded){if(e.key&&e.key!==Gr.key)return void n("多个不一致的 key");if(e.version&&e.version!==Gr.version)return void n("不允许多个版本 JSAPI 混用");Hr(t)}}))},Zr=["id","mapInstance","center","token","version","libraries","minZoom","maxZoom","rotation","pitch","mapSize","logoVisible"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}("img[src*='//mapapi.qq.com/web/jsapi/logo/logo_def.png'],.logo-text {\n  display: none !important;\n}\n\n.tencent-map > canvas + div{\n  z-index: 3 !important;\n}");var Xr={mapmove:"center_changed",camerachange:["drag","pan","rotate","pitch","zoom"],zoomchange:"zoom",dragging:"drag"},Yr=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"viewport",null),d()(k()(e),"evtCbProxyMap",new Map),d()(k()(e),"handleCameraChanged",(function(){e.emit("mapchange");var t=e.map,n=t.getCenter(),r={center:[n.lng,n.lat],viewportHeight:t.getContainer().clientHeight,viewportWidth:t.getContainer().clientWidth,bearing:t.getHeading(),pitch:t.getPitch(),zoom:t.getZoom()-1};e.viewport.syncWithMapCamera(r),e.updateCoordinateSystemService(),e.cameraChangedCallback(e.viewport)})),e}return a()(r,[{key:"init",value:(t=R()(S()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p,d,v,m,g,y,_,b,x,E,A,T,w,R,M,k,L;return S()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.viewport=new me,n=this.config,r=n.id,i=n.mapInstance,o=n.center,a=void 0===o?[121.30654632240122,31.25744185633306]:o,s=n.token,u=void 0===s?"OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77":s,l=n.version,c=void 0===l?"1.exp":l,h=n.libraries,p=void 0===h?[]:h,d=n.minZoom,v=void 0===d?3:d,m=n.maxZoom,g=void 0===m?18:m,y=n.rotation,_=void 0===y?0:y,b=n.pitch,x=void 0===b?0:b,E=n.mapSize,A=void 0===E?1e4:E,T=n.logoVisible,w=void 0===T||T,R=C()(n,Zr),window.TMap||i){e.next=5;break}return e.next=5,Wr({key:u,version:c,libraries:p});case 5:if(!i){e.next=11;break}this.map=i,this.$mapContainer=this.map.getContainer(),!1===w&&this.hideLogo(),e.next=18;break;case 11:if(r){e.next=13;break}throw Error("No container id specified");case 13:M=D.SO.getContainer(r),k=new TMap.Map(M,f()({maxZoom:g,minZoom:v,rotation:_,pitch:x,showControl:!1,center:new TMap.LatLng(a[1],a[0])},R)),this.map=k,this.$mapContainer=k.getContainer(),!1===w&&this.hideLogo();case 18:this.map.canvasContainer.style.position="absolute",this.map.drawContainer.classList.add("tencent-map"),(L=null===(t=this.map.controlManager.controlContainer)||void 0===t?void 0:t.parentNode)&&(L.style.zIndex=2),this.simpleMapCoord.setSize(A),this.map.on("drag",this.handleCameraChanged),this.map.on("pan",this.handleCameraChanged),this.map.on("rotate",this.handleCameraChanged),this.map.on("pitch",this.handleCameraChanged),this.map.on("zoom",this.handleCameraChanged),this.handleCameraChanged();case 29:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.map.destroy()}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getContainer();this.markerContainer=D.SO.create("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1"),this.markerContainer.style.zIndex="2"}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){var n=this;if(-1!==L.MapServiceEvent.indexOf(e))this.eventEmitter.on(e,t);else{var r=function(e){var r=n.evtCbProxyMap.get(e);if(r||n.evtCbProxyMap.set(e,r=new Map),!r.get(t)){var i=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];!n[0]||"object"!==qe()(n[0])||n[0].lngLat||n[0].lnglat||(n[0].lngLat=n[0].latlng||n[0].latLng),t.apply(void 0,n)};r.set(t,i),n.map.on(e,i)}};Array.isArray(Xr[e])?Xr[e].forEach((function(t){r(t||e)})):r(Xr[e]||e)}}},{key:"off",value:function(e,t){var n=this;if(-1===L.MapServiceEvent.indexOf(e)){var r=function(r){var i,o,a=null===(i=n.evtCbProxyMap.get(e))||void 0===i?void 0:i.get(t);a&&(null===(o=n.evtCbProxyMap.get(r))||void 0===o||o.delete(t),n.map.off(r,a))};Array.isArray(Xr[e])?Xr[e].forEach((function(t){r(t||e)})):r(Xr[e]||e)}else this.eventEmitter.off(e,t)}},{key:"once",value:function(){throw new Error("Method not implemented.")}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getSize",value:function(){return[this.map.width,this.map.height]}},{key:"getMinZoom",value:function(){return this.map.transform._minZoom}},{key:"getMaxZoom",value:function(){return this.map.transform._maxZoom}},{key:"getType",value:function(){return"tmap"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var e=this.map.getCenter();return{lng:e.lng,lat:e.lat}}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getRotation()}},{key:"getBounds",value:function(){var e=this.map.getBounds().getNorthEast(),t=this.map.getBounds().getSouthWest();return[[t.lng,t.lat],[e.lng,e.lat]]}},{key:"getMapContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByTagName("canvas")[0]}},{key:"getCanvasOverlays",value:function(){var e;return null===(e=this.getMapCanvasContainer())||void 0===e||null===(e=e.nextSibling)||void 0===e?void 0:e.firstChild}},{key:"getMapStyleConfig",value:function(){throw new Error("Method not implemented.")}},{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"setMapStyle",value:function(e){this.map.setMapStyleId(e)}},{key:"setRotation",value:function(e){this.map.setRotation(e)}},{key:"zoomIn",value:function(){this.map.setZoom(this.getZoom()+1)}},{key:"zoomOut",value:function(){this.map.setZoom(this.getZoom()-1)}},{key:"panTo",value:function(e){var t=g()(e,2),n=t[0],r=t[1];this.map.panTo(new TMap.LatLng(r,n))}},{key:"panBy",value:function(e,t){this.map.panBy([e,t])}},{key:"fitBounds",value:function(e,t){var n=g()(e,2),r=n[0],i=n[1],o=new TMap.LatLng(r[1],r[0]),a=new TMap.LatLng(i[1],i[0]),s=new TMap.LatLngBounds(o,a);this.map.fitBounds(s,t)}},{key:"setZoomAndCenter",value:function(e,t){var n=g()(t,2),r=n[0],i=n[1];this.map.setCenter(new TMap.LatLng(i,r)),this.map.setZoom(e)}},{key:"setCenter",value:function(e){var t=g()(e,2),n=t[0],r=t[1];this.map.setCenter(new TMap.LatLng(r,n))}},{key:"setPitch",value:function(e){this.map.setPitch(e)}},{key:"setZoom",value:function(e){this.map.setZoom(e)}},{key:"setMapStatus",value:function(e){var t=this;Object.keys(e).map((function(n){switch(n){case"doubleClickZoom":t.map.setDoubleClickZoom(!!e.doubleClickZoom);break;case"dragEnable":t.map.setDraggable(!!e.dragEnable);break;case"rotateEnable":t.map.setRotatable(!!e.rotateEnable);break;case"zoomEnable":t.map.setDoubleClickZoom(!!e.zoomEnable),t.map.setScrollable(!!e.zoomEnable);break;case"keyboardEnable":case"resizeEnable":case"showIndoorMap":throw Error("Options may bot be supported")}}))}},{key:"meterToCoord",value:function(e,t){var n=g()(e,2),r=n[0],i=n[1],o=g()(t,2),a=o[0],s=o[1],u=TMap.geometry.computeDistance([new TMap.LatLng(i,r),new TMap.LatLng(s,a)]),l=this.lngLatToCoord([r,i]),c=g()(l,2),h=c[0],f=c[1],p=this.lngLatToCoord([a,s]),d=g()(p,2),v=d[0],m=d[1];return Math.sqrt(Math.pow(h-v,2)+Math.pow(f-m,2))/u}},{key:"pixelToLngLat",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.map.getCenter(),o=i.lng,a=i.lat,s=this.lngLatToPixel([o,a]),u=s.x,l=s.y,c=this.lngLatToContainer([o,a]),h=c.x,f=c.y,p=this.map.unprojectFromContainer(new TMap.Point(h+(n-u),f+(r-l))),d=p.lng,v=p.lat;return this.containerToLngLat([d,v])}},{key:"lngLatToPixel",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.map.projectToWorldPlane(new TMap.LatLng(r,n));return{x:i.x,y:i.y}}},{key:"containerToLngLat",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.map.unprojectFromContainer(new TMap.Point(n,r));return{lng:i.lng,lat:i.lat}}},{key:"lngLatToContainer",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.map.projectToContainer(new TMap.LatLng(r,n));return{x:i.x,y:i.y}}},{key:"lngLatToCoord",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.lngLatToPixel([n,r]);return[i.x,-i.y]}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return Array.isArray(e[0])?t.lngLatToCoords(e):t.lngLatToCoord(e)}))}},{key:"lngLatToMercator",value:function(e,t){var n=Ft.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=O.create();return O.translate(o,o,P.fromValues(i[0],i[1],t)),O.scale(o,o,P.fromValues(r[0],r[1],r[2])),O.rotateX(o,o,n[0]),O.rotateY(o,o,n[1]),O.rotateZ(o,o,n[2]),o}},{key:"getCustomCoordCenter",value:function(){throw new Error("Method not implemented.")}},{key:"exportMap",value:function(e){var t=this.getMapCanvasContainer();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"rotateY",value:function(){throw new Error("Method not implemented.")}},{key:"hideLogo",value:function(){var e=this.map.getContainer();e&&D.SO.addClass(e,"tmap-contianer--hide-logo")}}]),r}($e),qr=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return Yr}}]),n}(v),Kr=function(e){var t=e.tk;return new Promise((function(e){var n=document.createElement("script");n.type="text/javascript",n.src="https://api.tianditu.gov.cn/api?v=4.0&tk=".concat(t),n.onload=function(){console.log("TianDiTu API script loaded."),e(!0)},n.onerror=function(){console.error("Failed to load TianDiTu API script."),e(!1)},document.head.appendChild(n)}))},Qr=0,$r={zoomchange:["Ge"]},Jr=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"viewport",null),d()(k()(e),"evtCbProxyMap",new Map),d()(k()(e),"sceneContainer",void 0),d()(k()(e),"handleCameraChanged",(function(){e.emit("mapchange");var t=e.map,n=e.map.getCenter(),r={center:[n.lng,n.lat],viewportHeight:t.getContainer().clientHeight,viewportWidth:t.getContainer().clientWidth,bearing:360,pitch:0,zoom:t.getZoom()-1};e.viewport&&(e.viewport.syncWithMapCamera(r),e.updateCoordinateSystemService(),e.cameraChangedCallback(e.viewport))})),e}return a()(r,[{key:"addMarkerContainer",value:function(){var e=this.map.getContainer(),t=this.markerContainer=document.createElement("div");e.appendChild(t),t.setAttribute("tabindex","-1"),t.id="tdt-L7-marker",t.style.position="absolute",t.style.left="",t.style.top="",t.style.zIndex="600",t.style.width="0px",t.style.height="0px",t.style.overflow="visible"}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"resize",value:function(e){this.sceneContainer.style.width=e.newSize.x+"px",this.sceneContainer.style.height=e.newSize.y+"px"}},{key:"update",value:function(){var e=this.map.getBounds(),t=this.map.lngLatToLayerPoint({lng:e.getSouthWest().lng,lat:e.getNorthEast().lat}),n=t.x,r=t.y;this.sceneContainer.style.transition="",this.sceneContainer.style.transformOrigin="center",this.sceneContainer.style.transform="translate3d(".concat(n,"px, ").concat(r,"px, 0px) scale(1)"),this.markerContainer.style.transition="",this.markerContainer.style.transformOrigin="center",this.markerContainer.style.transform="translate3d(".concat(-n,"px, ").concat(-r,"px, 0px) scale(1)"),this.sceneContainer._tdt_pos=new T.Point(n,r),this.handleCameraChanged()}},{key:"getZoomScale",value:function(e,t){var n=this.map.options.IW;return t=void 0===t?this.map.getZoom():t,n.scale(e)/n.scale(t)}},{key:"zoomStartUpdate",value:function(e){var t=e.center,n=e.zoom,r=this.getZoomScale(n,this.map.getZoom()),i=T._Q.getPosition(this.sceneContainer),o=this.map.getSize().GQ(.5),a=this.map.options.IW.qW(this.map.getCenter(),n),s=this.map.options.IW.qW(t,n).DQ(a),u=new T.Point(o.x,o.y).GQ(-r);u.aQ(i),u.aQ(o),u.DQ(s),this.sceneContainer.style.transform="translate3d(".concat(u.x,"px,").concat(u.y,"px,0px) scale(").concat(r,")"),this.sceneContainer.style.transformOrigin="0 0",this.sceneContainer.style.transition="transform 0.25s cubic-bezier(0,0,0.25,1)",this.handleCameraChanged()}},{key:"getOverlayContainer",value:function(){var e,t=null===(e=this.map.getPanes())||void 0===e?void 0:e.overlayPane,n=document.createElement("div");t.parentElement.appendChild(n),n.id="tdt-L7";var r=this.map.getSize();return n.style.zIndex="200",n.style.width="".concat(r.x,"px"),n.style.height="".concat(r.y,"px"),this.sceneContainer=n,n}},{key:"init",value:(t=R()(S()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,f,p,d,v,m;return S()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.viewport=new me,t=this.config,n=t.id,r=t.mapInstance,i=t.center,o=void 0===i?[121.30654632240122,31.25744185633306]:i,a=t.token,s=void 0===a?"b15e548080c79819617367d3f6095c69":a,u=t.minZoom,l=void 0===u?1:u,c=t.maxZoom,h=void 0===c?18:c,f=t.zoom,p=void 0===f?3:f,window.T){e.next=5;break}return e.next=5,Kr({tk:s});case 5:if(!r){e.next=15;break}this.map=r,this.map.centerAndZoom(new window.T.LngLat(o[0],o[1]),p),this.$mapContainer=this.map.getContainer(),d=new window.T.LngLat(o[0],o[1]),this.map.centerAndZoom(d,p),this.setMinZoom(l),this.setMaxZoom(h),e.next=22;break;case 15:if(n){e.next=17;break}throw Error("No container id specified");case 17:this.$mapContainer=this.creatMapContainer(n),v=new T.Map(this.$mapContainer,{center:window.T.LngLat(o[0],o[1]),minZoom:l,maxZoom:h,zoom:p,projection:"EPSG:900913"}),this.map=v,m=new window.T.Control.Zoom,v.addControl(m);case 22:this.map.getContainer().querySelector(".tdt-pane").style.zIndex=1,this.handleCameraChanged(),this.map.on("move",this.update,this),this.map.on("Ge",this.zoomStartUpdate,this),this.map.on("resize",this.resize,this);case 29:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){}},{key:"on",value:function(e,t){var n=this;if(-1!==L.MapServiceEvent.indexOf(e))this.eventEmitter.on(e,t);else{var r=function(e){var r=n.evtCbProxyMap.get(e);if(r||n.evtCbProxyMap.set(e,r=new Map),!r.get(t)){var i=function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];!r[0]||"object"!==qe()(r[0])||r[0].lngLat||r[0].lnglat||(r[0].lngLat=r[0].latlng||r[0].latLng,r[0].map=n.map),t.apply(void 0,r)};r.set(t,i),n.map.on(e,i)}};Array.isArray($r[e])?$r[e].forEach((function(t){r(t||e)})):r($r[e]||e)}}},{key:"off",value:function(e,t){var n=this;if(-1===L.MapServiceEvent.indexOf(e)){var r=function(r){var i,o,a=null===(i=n.evtCbProxyMap.get(e))||void 0===i?void 0:i.get(t);a&&(null===(o=n.evtCbProxyMap.get(r))||void 0===o||o.delete(t),n.map.off(r,a))};Array.isArray($r[e])?$r[e].forEach((function(t){r(t||e)})):r($r[e]||e)}else this.eventEmitter.off(e,t)}},{key:"once",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getMapContainer",value:function(){return this.map.getContainer()}},{key:"getType",value:function(){return"tdtmap"}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByClassName("tdt-container")[0]}},{key:"getSize",value:function(){var e=this.map.getSize();return[e.x,e.y]}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return 0}},{key:"getRotation",value:function(){return 0}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy([e,t])}},{key:"fitBounds",value:function(e){var t=g()(e,2),n=t[0],r=t[1];this.map.setViewport([new window.T.LngLat(n[0],n[1]),new window.T.LngLat(r[0],r[1])])}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.enableDoubleClickZoom(),!1===e.doubleClickZoom&&this.map.disableDoubleClickZoom(),!1===e.dragEnable&&this.map.disableDrag(),!0===e.dragEnable&&this.map.enableDrag(),!1===e.keyboardEnable&&this.map.disableKeyboard(),!0===e.keyboardEnable&&this.map.enableKeyboard(),!1===e.zoomEnable&&this.map.disableScrollWheelZoom(),!0===e.zoomEnable&&this.map.enableScrollWheelZoom()}},{key:"getModelMatrix",value:function(){throw new Error("Method not implemented.")}},{key:"pixelToLngLat",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.map.layerPointToLngLat({x:n,y:r});return{lng:i.lng,lat:i.lat}}},{key:"lngLatToPixel",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.map.lngLatToLayerPoint({lng:n,lat:r});return{x:i.x,y:i.y}}},{key:"containerToLngLat",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.map.containerPointToLngLat({x:n,y:r});return{lng:i.lng,lat:i.lat}}},{key:"lngLatToContainer",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.map.lngLatToContainerPoint({lat:r,lng:n});return{x:i.x,y:i.y}}},{key:"lngLatToCoord",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.lngLatToPixel([n,r]);return[i.x,i.y]}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return Array.isArray(e[0])?t.lngLatToCoords(e):t.lngLatToCoord(e)}))}},{key:"getBounds",value:function(){var e=this.map.getBounds(),t=e.getSouthWest(),n=e.getNorthEast();return[[t.lng,t.lat],[n.lng,n.lat]]}},{key:"lngLatToMercator",value:function(e,t){var n=Ft.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getCustomCoordCenter",value:function(){throw new Error("Method not implemented.")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_tdt_div"+Qr++,t.appendChild(n),n}}]),r}($e),ei=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return Jr}}]),n}(v);if(!window)throw Error("Google Map JSAPI can only be used in Browser.");var ti=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(ti||{}),ni={key:""},ri={GMap:ti.notload},ii=[],oi=function(e){if("function"==typeof e){if(ri.GMap===ti.loaded)return void e(window.google.maps.Map);ii.push(e)}},ai=function(e){return new Promise((function(t,n){if(ri.GMap===ti.failed)n("");else if(ri.GMap===ti.notload){var r=e.key;if(!r)return void n("请填写key");ni.key=r,ri.GMap=ti.loading,window.initMap=function(e){if(delete window.initMap,e)ri.GMap=ti.failed,n(e);else for(ri.GMap=ti.loaded;ii.length;)ii.splice(0,1)[0](window.google.maps.Map)};var i=document.createElement("script");i.type="text/javascript",i.async=!1,i.src="https://maps.googleapis.com/maps/api/js?key=".concat(ni.key,"&callback=initMap"),i.onerror=function(e){ri.GMap=ti.failed,n(e)},(document.body||document.head).appendChild(i),oi(t)}else if(ri.GMap===ti.loaded){if(e.key&&e.key!==ni.key)return void n("多个不一致的 key");oi(t)}}))},si=["id","mapInstance","center","token","minZoom","maxZoom","logoVisible"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}("img[src*='//mapapi.qq.com/web/jsapi/logo/logo_def.png'],.logo-text {\n  display: none !important;\n}\n");var ui={mapmove:"center_changed",camerachange:["drag","pan","rotate","tilt","zoom_changed"],zoomchange:"zoom_changed",dragging:"drag"},li=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"viewport",null),d()(k()(e),"evtCbProxyMap",new Map),d()(k()(e),"handleCameraChanged",(function(){e.emit("mapchange");var t=e.map,n=t.getCenter(),r=n.lng,i=n.lat,o={center:[r(),i()],viewportHeight:t.getDiv().clientHeight,viewportWidth:t.getDiv().clientWidth,bearing:t.getHeading(),pitch:t.getTilt(),zoom:t.getZoom()-1};e.viewport.syncWithMapCamera(o),e.updateCoordinateSystemService(),e.cameraChangedCallback(e.viewport)})),e}return a()(r,[{key:"init",value:(t=R()(S()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p,d,v,m,g,y;return S()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.viewport=new me,n=this.config,r=n.id,i=n.mapInstance,o=n.center,a=void 0===o?[121.30654632240122,31.25744185633306]:o,s=n.token,u=void 0===s?"AIzaSyDBDCfl4pvuDtaazdCog3LmhA7CQLhmcRE":s,l=n.minZoom,c=void 0===l?3:l,h=n.maxZoom,p=void 0===h?18:h,d=n.logoVisible,v=void 0===d||d,m=C()(n,si),null!==(t=window.google)&&void 0!==t&&null!==(t=t.maps)&&void 0!==t&&t.Map||i){e.next=5;break}return e.next=5,ai({key:u});case 5:if(!i){e.next=11;break}this.map=i,this.$mapContainer=this.map.getDiv(),!1===v&&this.hideLogo(),e.next=18;break;case 11:if(r){e.next=13;break}throw Error("No container id specified");case 13:g=D.SO.getContainer(r),y=new google.maps.Map(g,f()({maxZoom:p,minZoom:c,zoomControl:!1,fullscreenControl:!1,center:new google.maps.LatLng(a[1],a[0])},m)),this.map=y,this.$mapContainer=y.getDiv(),!1===v&&this.hideLogo();case 18:google.maps.event.addListener(this.map,"drag",this.handleCameraChanged),google.maps.event.addListener(this.map,"pan",this.handleCameraChanged),google.maps.event.addListener(this.map,"rotate",this.handleCameraChanged),google.maps.event.addListener(this.map,"idle",this.handleCameraChanged),google.maps.event.addListener(this.map,"zoom_changed",this.handleCameraChanged),this.handleCameraChanged();case 24:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.map.setMap(null)}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"addMarkerContainer",value:function(){}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getCanvasOverlays",value:function(){return this.map.getDiv()}},{key:"on",value:function(e,t){var n=this;if(-1!==L.MapServiceEvent.indexOf(e))this.eventEmitter.on(e,t);else{var r=function(e){var r=n.evtCbProxyMap.get(e);if(r||n.evtCbProxyMap.set(e,r=new Map),!r.get(t)){var i=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];!n[0]||"object"!==qe()(n[0])||n[0].lngLat||n[0].lnglat||(n[0].lngLat=n[0].latlng||n[0].latLng),t.apply(void 0,n)};r.set(t,i),n.map.on(e,i)}};Array.isArray(ui[e])?ui[e].forEach((function(t){r(t||e)})):r(ui[e]||e)}}},{key:"off",value:function(e,t){var n=this;if(-1===L.MapServiceEvent.indexOf(e)){var r=function(r){var i,o,a=null===(i=n.evtCbProxyMap.get(e))||void 0===i?void 0:i.get(t);a&&(null===(o=n.evtCbProxyMap.get(r))||void 0===o||o.delete(t),n.map.off(r,a))};Array.isArray(ui[e])?ui[e].forEach((function(t){r(t||e)})):r(ui[e]||e)}else this.eventEmitter.off(e,t)}},{key:"once",value:function(){throw new Error("Method not implemented.")}},{key:"getContainer",value:function(){return this.map.getDiv()}},{key:"getSize",value:function(){return[this.map.width,this.map.height]}},{key:"getMinZoom",value:function(){return this.map.transform._minZoom}},{key:"getMaxZoom",value:function(){return this.map.transform._maxZoom}},{key:"getType",value:function(){return"googlemap"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var e=this.map.getCenter(),t=e.lng,n=e.lat;return{lng:t(),lat:n()}}},{key:"getPitch",value:function(){return this.map.getTilt()}},{key:"getRotation",value:function(){return this.map.getHeading()}},{key:"getBounds",value:function(){var e=this.map.getBounds(),t=null==e?void 0:e.getNorthEast(),n=null==e?void 0:e.getSouthWest();return[[n.lng(),n.lat()],[t.lng(),t.lat()]]}},{key:"getMapContainer",value:function(){return this.map.getDiv()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getDiv())||void 0===e?void 0:e.getElementsByTagName("canvas")[0]}},{key:"getMapStyleConfig",value:function(){throw new Error("Method not implemented.")}},{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"setMapStyle",value:function(e){this.map.setMapStyleId(e)}},{key:"setRotation",value:function(e){this.map.setHeading(e)}},{key:"zoomIn",value:function(){var e=this.map.getZoom();this.map.setZoom(e+1)}},{key:"zoomOut",value:function(){var e=this.map.getZoom();this.map.setZoom(e-1)}},{key:"panTo",value:function(e){var t=g()(e,2),n=t[0],r=t[1];this.map.panTo({lat:r,lng:n})}},{key:"panBy",value:function(e,t){this.map.panBy(e,t)}},{key:"fitBounds",value:function(e,t){var n=g()(e,2),r=n[0],i=n[1],o=new google.maps.LatLngBounds({lat:r[1],lng:r[0]},{lat:i[1],lng:i[0]});this.map.fitBounds(o,t)}},{key:"setZoomAndCenter",value:function(e,t){var n=g()(t,2),r=n[0],i=n[1];this.map.setZoom(e),this.map.setCenter({lat:i,lng:r})}},{key:"setCenter",value:function(e){var t=g()(e,2),n=t[0],r=t[1];this.map.setCenter({lat:r,lng:n})}},{key:"setPitch",value:function(e){this.map.setTilt(e)}},{key:"setZoom",value:function(e){this.map.setZoom(e)}},{key:"setMapStatus",value:function(e){var t=this;Object.keys(e).map((function(n){switch(n){case"doubleClickZoom":t.map.setOptions({gestureHandling:e.doubleClickZoom?"auto":"none"});break;case"dragEnable":t.map.setOptions({draggable:e.dragEnable});break;case"rotateEnable":break;case"zoomEnable":t.map.setOptions({zoomControl:e.zoomEnable});break;case"keyboardEnable":case"resizeEnable":case"showIndoorMap":throw Error("Options may not be supported")}}))}},{key:"meterToCoord",value:function(e,t){var n=g()(e,2),r=n[0],i=n[1],o=g()(t,2),a=o[0],s=o[1],u=google.maps.geometry.spherical.computeDistanceBetween([new google.maps.LatLng(i,r),new google.maps.LatLng(s,a)]),l=this.lngLatToCoord([r,i]),c=g()(l,2),h=c[0],f=c[1],p=this.lngLatToCoord([a,s]),d=g()(p,2),v=d[0],m=d[1];return Math.sqrt(Math.pow(h-v,2)+Math.pow(f-m,2))/u}},{key:"pixelToLngLat",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.map.getCenter(),o=i.lng,a=i.lat,s=this.lngLatToPixel([o(),a()]),u=s.x,l=s.y,c=this.lngLatToContainer([o(),a()]),h=c.x,f=c.y,p=this.map.unprojectFromContainer(new google.maps.Point(h+(n-u),f+(r-l))),d=p.lng,v=p.lat;return this.containerToLngLat([d,v])}},{key:"lngLatToPixel",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=new google.maps.LatLng(r,n),o=this.map.getProjection().fromLatLngToPoint(i);return{x:o.x,y:o.y}}},{key:"containerToLngLat",value:function(e){var t,n=g()(e,2),r=n[0],i=n[1],o=new google.maps.Point(r,i),a=null===(t=this.map.getProjection())||void 0===t?void 0:t.fromPointToLatLng(o);return{lng:a.lng(),lat:a.lat()}}},{key:"lngLatToContainer",value:function(e){var t,n,r=g()(e,2),i=r[0],o=r[1],a=new google.maps.LatLng(o,i),s=null===(t=this.map.getProjection())||void 0===t||null===(n=t.fromLatLngToContainerPixel)||void 0===n?void 0:n.call(t,a);return{x:s.x,y:s.y}}},{key:"lngLatToCoord",value:function(e){var t=g()(e,2),n=t[0],r=t[1],i=this.lngLatToPixel([n,r]);return[i.x,-i.y]}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return Array.isArray(e[0])?t.lngLatToCoords(e):t.lngLatToCoord(e)}))}},{key:"lngLatToMercator",value:function(e,t){var n=Ft.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=O.create();return O.translate(o,o,P.fromValues(i[0],i[1],t)),O.scale(o,o,P.fromValues(r[0],r[1],r[2])),O.rotateX(o,o,n[0]),O.rotateY(o,o,n[1]),O.rotateZ(o,o,n[2]),o}},{key:"getCustomCoordCenter",value:function(){throw new Error("Method not implemented.")}},{key:"exportMap",value:function(e){var t=this.getMapCanvasContainer();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"rotateY",value:function(){throw new Error("Method not implemented.")}},{key:"hideLogo",value:function(){var e=this.map.getDiv();e&&D.SO.addClass(e,"tmap-contianer--hide-logo")}}]),r}($e),ci=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return li}}]),n}(v)},8677:function(e,t,n){"use strict";n.d(t,{x:function(){return Bi}});var r,i=n(1448),o=n.n(i),a=n(3100),s=n.n(a),u=n(9558),l=n.n(u),c=n(9989),h=n.n(c),f=n(4528),p=n.n(f),d=n(8798),v=n.n(d),m=n(9057),g=n.n(m),y=n(4278),_=n(3292),b=n(240),x=n(8833),E=n(5171),S=n.n(E),A=function(){function e(t,n){p()(this,e),g()(this,"attribute",void 0),g()(this,"buffer",void 0);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return v()(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),T=g()(g()(g()(g()(g()(g()(g()({},_.gl.POINTS,"points"),_.gl.LINES,"lines"),_.gl.LINE_LOOP,"line loop"),_.gl.LINE_STRIP,"line strip"),_.gl.TRIANGLES,"triangles"),_.gl.TRIANGLE_FAN,"triangle fan"),_.gl.TRIANGLE_STRIP,"triangle strip"),C=g()(g()(g()({},_.gl.STATIC_DRAW,"static"),_.gl.DYNAMIC_DRAW,"dynamic"),_.gl.STREAM_DRAW,"stream"),w=g()(g()(g()(g()(g()(g()({},_.gl.BYTE,"int8"),_.gl.INT,"int32"),_.gl.UNSIGNED_BYTE,"uint8"),_.gl.UNSIGNED_SHORT,"uint16"),_.gl.UNSIGNED_INT,"uint32"),_.gl.FLOAT,"float"),R=g()(g()(g()(g()(g()(g()(g()(g()(g()(g()({},_.gl.ALPHA,"alpha"),_.gl.LUMINANCE,"luminance"),_.gl.LUMINANCE_ALPHA,"luminance alpha"),_.gl.RGB,"rgb"),_.gl.RGBA,"rgba"),_.gl.RGBA4,"rgba4"),_.gl.RGB5_A1,"rgb5 a1"),_.gl.RGB565,"rgb565"),_.gl.DEPTH_COMPONENT,"depth"),_.gl.DEPTH_STENCIL,"depth stencil"),M=g()(g()(g()({},_.gl.DONT_CARE,"dont care"),_.gl.NICEST,"nice"),_.gl.FASTEST,"fast"),k=g()(g()(g()(g()(g()(g()({},_.gl.NEAREST,"nearest"),_.gl.LINEAR,"linear"),_.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),_.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),_.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),_.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),L=g()(g()(g()({},_.gl.REPEAT,"repeat"),_.gl.CLAMP_TO_EDGE,"clamp"),_.gl.MIRRORED_REPEAT,"mirror"),O=g()(g()({},_.gl.NONE,"none"),_.gl.BROWSER_DEFAULT_WEBGL,"browser"),P=g()(g()(g()(g()(g()(g()(g()(g()({},_.gl.NEVER,"never"),_.gl.ALWAYS,"always"),_.gl.LESS,"less"),_.gl.LEQUAL,"lequal"),_.gl.GREATER,"greater"),_.gl.GEQUAL,"gequal"),_.gl.EQUAL,"equal"),_.gl.NOTEQUAL,"notequal"),I=g()(g()(g()(g()(g()({},_.gl.FUNC_ADD,"add"),_.gl.MIN_EXT,"min"),_.gl.MAX_EXT,"max"),_.gl.FUNC_SUBTRACT,"subtract"),_.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),N=(r={},g()(g()(g()(g()(g()(g()(g()(g()(g()(g()(r,_.gl.ZERO,"zero"),_.gl.ONE,"one"),_.gl.SRC_COLOR,"src color"),_.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),_.gl.SRC_ALPHA,"src alpha"),_.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),_.gl.DST_COLOR,"dst color"),_.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),_.gl.DST_ALPHA,"dst alpha"),_.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),g()(g()(g()(g()(g()(r,_.gl.CONSTANT_COLOR,"constant color"),_.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),_.gl.CONSTANT_ALPHA,"constant alpha"),_.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),_.gl.SRC_ALPHA_SATURATE,"src alpha saturate")),D=g()(g()(g()(g()(g()(g()(g()(g()({},_.gl.NEVER,"never"),_.gl.ALWAYS,"always"),_.gl.LESS,"less"),_.gl.LEQUAL,"lequal"),_.gl.GREATER,"greater"),_.gl.GEQUAL,"gequal"),_.gl.EQUAL,"equal"),_.gl.NOTEQUAL,"notequal"),B=g()(g()(g()(g()(g()(g()(g()(g()({},_.gl.ZERO,"zero"),_.gl.KEEP,"keep"),_.gl.REPLACE,"replace"),_.gl.INVERT,"invert"),_.gl.INCR,"increment"),_.gl.DECR,"decrement"),_.gl.INCR_WRAP,"increment wrap"),_.gl.DECR_WRAP,"decrement wrap"),F=g()(g()({},_.gl.FRONT,"front"),_.gl.BACK,"back"),U=function(){function e(t,n){p()(this,e),g()(this,"buffer",void 0),g()(this,"isDestroyed",!1);var r=n.data,i=n.usage,o=n.type;this.buffer=t.buffer({data:r,usage:C[i||_.gl.STATIC_DRAW],type:w[o||_.gl.UNSIGNED_BYTE]})}return v()(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(e){var t=e.data,n=e.offset;this.buffer.subdata(t,n)}}]),e}(),z=function(){function e(t,n){p()(this,e),g()(this,"elements",void 0);var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=t.elements({data:r,usage:C[i||_.gl.STATIC_DRAW],type:w[o||_.gl.UNSIGNED_BYTE],count:a})}return v()(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(e){var t=e.data;this.elements.subdata(t)}},{key:"destroy",value:function(){}}]),e}(),G=function(){function e(t,n){p()(this,e),g()(this,"framebuffer",void 0);var r=n.width,i=n.height,o=n.color,a=n.colors,s={width:r,height:i};Array.isArray(a)&&(s.colors=a.map((function(e){return e.get()}))),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=t.framebuffer(s)}return v()(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.framebuffer.resize(t,n)}}]),e}(),j=n(5570),V=n.n(j),H=function(e){return null==e},W={}.toString,Z=function(e,t){return W.call(e)==="[object "+t+"]"},X=function(e){return Z(e,"Number")},Y=function(e,t,n){return e<t?t:e>n?n:e},q=function(e,t){return q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},q(e,t)};function K(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}q(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Q=function(){return Q=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Q.apply(this,arguments)};function $(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function J(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function ee(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}Object.create;function te(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ne(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function re(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}Object.create;"function"==typeof SuppressedError&&SuppressedError;var ie,oe,ae,se,ue,le,ce,he,fe,pe,de,ve,me,ge,ye,_e,be,xe,Ee,Se,Ae,Te,Ce,we,Re,Me,ke,Le=n(5158);function Oe(e,t,n){return e<<16|t<<8|n}function Pe(e){return e>>>8&255}function Ie(e){return e>>>16&255}function Ne(e){return 255&e}function De(e){switch(e){case we.F32:case we.U32:case we.S32:return 4;case we.U16:case we.S16:case we.F16:return 2;case we.U8:case we.S8:return 1;default:throw new Error("whoops")}}function Be(e){return De(Ie(e))}function Fe(e){var t=Ne(e);if(t&Me.Depth)return Se.Depth;if(t&Me.Normalized)return Se.Float;var n=Ie(e);if(n===we.F16||n===we.F32)return Se.Float;if(n===we.U8||n===we.U16||n===we.U32)return Se.Uint;if(n===we.S8||n===we.S16||n===we.S32)return Se.Sint;throw new Error("whoops")}function Ue(e,t){if(void 0===t&&(t=""),!e)throw new Error("Assert fail: ".concat(t))}function ze(e){if(null!=e)return e;throw new Error("Missing object")}function Ge(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function je(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function Ve(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}function He(e,t,n,r){return void 0===r&&(r=1),{r:e,g:t,b:n,a:r}}!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"}(ie||(ie={})),function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool",e[e.RenderBundle=11]="RenderBundle"}(oe||(oe={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(ae||(ae={})),function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"}(se||(se={})),function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"}(ue||(ue={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(le||(le={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"}(ce||(ce={})),function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"}(he||(he={})),function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"}(fe||(fe={})),function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"}(pe||(pe={})),function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"}(de||(de={})),function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"}(ve||(ve={})),function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"}(me||(me={})),function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"}(ge||(ge={})),function(e){e.LOADED="loaded"}(ye||(ye={})),function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"}(_e||(_e={})),function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"}(be||(be={})),function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"}(xe||(xe={})),function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"}(Ee||(Ee={})),function(e){e[e.Float=0]="Float",e[e.UnfilterableFloat=1]="UnfilterableFloat",e[e.Uint=2]="Uint",e[e.Sint=3]="Sint",e[e.Depth=4]="Depth"}(Se||(Se={})),function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"}(Ae||(Ae={})),function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"}(Te||(Te={})),function(e){e[e.OcclusionConservative=0]="OcclusionConservative"}(Ce||(Ce={})),function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"}(we||(we={})),function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"}(Re||(Re={})),function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"}(Me||(Me={})),function(e){e[e.ALPHA=Oe(we.U8,Re.A,Me.None)]="ALPHA",e[e.U8_LUMINANCE=Oe(we.U8,Re.A,Me.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=Oe(we.F16,Re.A,Me.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=Oe(we.F32,Re.A,Me.Luminance)]="F32_LUMINANCE",e[e.F16_R=Oe(we.F16,Re.R,Me.None)]="F16_R",e[e.F16_RG=Oe(we.F16,Re.RG,Me.None)]="F16_RG",e[e.F16_RGB=Oe(we.F16,Re.RGB,Me.None)]="F16_RGB",e[e.F16_RGBA=Oe(we.F16,Re.RGBA,Me.None)]="F16_RGBA",e[e.F32_R=Oe(we.F32,Re.R,Me.None)]="F32_R",e[e.F32_RG=Oe(we.F32,Re.RG,Me.None)]="F32_RG",e[e.F32_RGB=Oe(we.F32,Re.RGB,Me.None)]="F32_RGB",e[e.F32_RGBA=Oe(we.F32,Re.RGBA,Me.None)]="F32_RGBA",e[e.U8_R=Oe(we.U8,Re.R,Me.None)]="U8_R",e[e.U8_R_NORM=Oe(we.U8,Re.R,Me.Normalized)]="U8_R_NORM",e[e.U8_RG=Oe(we.U8,Re.RG,Me.None)]="U8_RG",e[e.U8_RG_NORM=Oe(we.U8,Re.RG,Me.Normalized)]="U8_RG_NORM",e[e.U8_RGB=Oe(we.U8,Re.RGB,Me.None)]="U8_RGB",e[e.U8_RGB_NORM=Oe(we.U8,Re.RGB,Me.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=Oe(we.U8,Re.RGB,Me.sRGB|Me.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=Oe(we.U8,Re.RGBA,Me.None)]="U8_RGBA",e[e.U8_RGBA_NORM=Oe(we.U8,Re.RGBA,Me.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=Oe(we.U8,Re.RGBA,Me.sRGB|Me.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=Oe(we.U16,Re.R,Me.None)]="U16_R",e[e.U16_R_NORM=Oe(we.U16,Re.R,Me.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=Oe(we.U16,Re.RG,Me.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=Oe(we.U16,Re.RGBA,Me.Normalized)]="U16_RGBA_NORM",e[e.U16_RGBA=Oe(we.U16,Re.RGBA,Me.None)]="U16_RGBA",e[e.U16_RGB=Oe(we.U16,Re.RGB,Me.None)]="U16_RGB",e[e.U16_RG=Oe(we.U16,Re.RG,Me.None)]="U16_RG",e[e.U32_R=Oe(we.U32,Re.R,Me.None)]="U32_R",e[e.U32_RG=Oe(we.U32,Re.RG,Me.None)]="U32_RG",e[e.U32_RGB=Oe(we.U32,Re.RGB,Me.None)]="U32_RGB",e[e.U32_RGBA=Oe(we.U32,Re.RGBA,Me.None)]="U32_RGBA",e[e.S8_R=Oe(we.S8,Re.R,Me.None)]="S8_R",e[e.S8_R_NORM=Oe(we.S8,Re.R,Me.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=Oe(we.S8,Re.RG,Me.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=Oe(we.S8,Re.RGB,Me.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=Oe(we.S8,Re.RGBA,Me.Normalized)]="S8_RGBA_NORM",e[e.S16_R=Oe(we.S16,Re.R,Me.None)]="S16_R",e[e.S16_RG=Oe(we.S16,Re.RG,Me.None)]="S16_RG",e[e.S16_RG_NORM=Oe(we.S16,Re.RG,Me.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=Oe(we.S16,Re.RGB,Me.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=Oe(we.S16,Re.RGBA,Me.None)]="S16_RGBA",e[e.S16_RGBA_NORM=Oe(we.S16,Re.RGBA,Me.Normalized)]="S16_RGBA_NORM",e[e.S32_R=Oe(we.S32,Re.R,Me.None)]="S32_R",e[e.S32_RG=Oe(we.S32,Re.RG,Me.None)]="S32_RG",e[e.S32_RGB=Oe(we.S32,Re.RGB,Me.None)]="S32_RGB",e[e.S32_RGBA=Oe(we.S32,Re.RGBA,Me.None)]="S32_RGBA",e[e.U16_RGBA_5551=Oe(we.U16_PACKED_5551,Re.RGBA,Me.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=Oe(we.U16_PACKED_565,Re.RGB,Me.Normalized)]="U16_RGB_565",e[e.BC1=Oe(we.BC1,Re.RGBA,Me.Normalized)]="BC1",e[e.BC1_SRGB=Oe(we.BC1,Re.RGBA,Me.Normalized|Me.sRGB)]="BC1_SRGB",e[e.BC2=Oe(we.BC2,Re.RGBA,Me.Normalized)]="BC2",e[e.BC2_SRGB=Oe(we.BC2,Re.RGBA,Me.Normalized|Me.sRGB)]="BC2_SRGB",e[e.BC3=Oe(we.BC3,Re.RGBA,Me.Normalized)]="BC3",e[e.BC3_SRGB=Oe(we.BC3,Re.RGBA,Me.Normalized|Me.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=Oe(we.BC4_UNORM,Re.R,Me.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=Oe(we.BC4_SNORM,Re.R,Me.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=Oe(we.BC5_UNORM,Re.RG,Me.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=Oe(we.BC5_SNORM,Re.RG,Me.Normalized)]="BC5_SNORM",e[e.D24=Oe(we.D24,Re.R,Me.Depth)]="D24",e[e.D24_S8=Oe(we.D24S8,Re.RG,Me.Depth|Me.Stencil)]="D24_S8",e[e.D32F=Oe(we.D32F,Re.R,Me.Depth)]="D32F",e[e.D32F_S8=Oe(we.D32FS8,Re.RG,Me.Depth|Me.Stencil)]="D32F_S8",e[e.U8_RGB_RT=Oe(we.U8,Re.RGB,Me.RenderTarget|Me.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=Oe(we.U8,Re.RGBA,Me.RenderTarget|Me.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=Oe(we.U8,Re.RGBA,Me.RenderTarget|Me.Normalized|Me.sRGB)]="U8_RGBA_RT_SRGB"}(ke||(ke={}));var We=He(0,0,0,0),Ze=(He(0,0,0,1),He(1,1,1,0));He(1,1,1,1);function Xe(e){return!(!e||0!=(e&e-1))}function Ye(e,t){return null!=e?e:t}function qe(e,t){var n=t-1;return e+n&~n}function Ke(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function Qe(e,t){return void 0===e&&(e={}),e.compare=t.compare,e.depthFailOp=t.depthFailOp,e.passOp=t.passOp,e.failOp=t.failOp,e.mask=t.mask,e}function $e(e,t){return void 0===e&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),Ke(e.rgbBlendState,t.rgbBlendState),Ke(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function Je(e,t){e.length!==t.length&&(e.length=t.length);for(var n=0;n<t.length;n++)e[n]=$e(e[n],t[n])}function et(e){var t=Object.assign({},e);return t.attachmentsState=[],Je(t.attachmentsState,e.attachmentsState),t.blendConstant=t.blendConstant&&Ve(t.blendConstant),t.stencilFront=Qe(void 0,e.stencilFront),t.stencilBack=Qe(void 0,e.stencilBack),t}var tt={blendMode:ce.ADD,blendSrcFactor:le.ONE,blendDstFactor:le.ZERO},nt={attachmentsState:[{channelWriteMask:xe.ALL,rgbBlendState:tt,alphaBlendState:tt}],blendConstant:Ve(We),depthWrite:!0,depthCompare:ae.LEQUAL,stencilWrite:!1,stencilFront:{compare:ae.ALWAYS,passOp:Ee.KEEP,depthFailOp:Ee.KEEP,failOp:Ee.KEEP},stencilBack:{compare:ae.ALWAYS,passOp:Ee.KEEP,depthFailOp:Ee.KEEP,failOp:Ee.KEEP},cullMode:ue.NONE,frontFace:se.CCW,polygonOffset:!1};!function(e,t){void 0===e&&(e=null),void 0===t&&(t=nt);var n=et(t);null!==e&&function(e,t){void 0!==t.attachmentsState&&Je(e.attachmentsState,t.attachmentsState),e.blendConstant&&t.blendConstant&&je(e.blendConstant,t.blendConstant),e.depthCompare=Ye(t.depthCompare,e.depthCompare),e.depthWrite=Ye(t.depthWrite,e.depthWrite),e.stencilWrite=Ye(t.stencilWrite,e.stencilWrite),e.stencilFront&&t.stencilFront&&Qe(e.stencilFront,t.stencilFront),e.stencilBack&&t.stencilBack&&Qe(e.stencilBack,t.stencilBack),e.cullMode=Ye(t.cullMode,e.cullMode),e.frontFace=Ye(t.frontFace,e.frontFace),e.polygonOffset=Ye(t.polygonOffset,e.polygonOffset)}(n,e)}({depthCompare:ae.ALWAYS,depthWrite:!1},nt);var rt,it={texture:null,sampler:null,formatKind:Se.Float,dimension:_e.TEXTURE_2D};function ot(e,t,n){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}function at(e,t){for(var n=Array(e.length),r=0;r<e.length;r++)n[r]=t(e[r]);return n}function st(e,t){return e.texture===t.texture&&e.binding===t.binding}function ut(e,t){return e.buffer===t.buffer&&e.size===t.size&&e.binding===t.binding&&e.offset===t.offset}function lt(e,t){return null===e?null===t:null!==t&&(e.sampler===t.sampler&&e.texture===t.texture&&e.dimension===t.dimension&&e.formatKind===t.formatKind&&e.comparison===t.comparison)}function ct(e,t){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],e.samplerBindings.length===t.samplerBindings.length&&(!!ot(e.samplerBindings,t.samplerBindings,lt)&&(!!ot(e.uniformBufferBindings,t.uniformBufferBindings,ut)&&(!!ot(e.storageBufferBindings,t.storageBufferBindings,ut)&&!!ot(e.storageTextureBindings,t.storageTextureBindings,st))))}function ht(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function ft(e,t){return!!ht(e.rgbBlendState,t.rgbBlendState)&&(!!ht(e.alphaBlendState,t.alphaBlendState)&&e.channelWriteMask===t.channelWriteMask)}function pt(e,t){return e.compare==t.compare&&e.depthFailOp===t.depthFailOp&&e.failOp===t.failOp&&e.passOp===t.passOp&&e.mask===t.mask}function dt(e,t){return e.id===t.id}function vt(e,t){return e===t}function mt(e,t){return e.topology===t.topology&&(e.inputLayout===t.inputLayout&&(e.sampleCount===t.sampleCount&&(!(e.megaStateDescriptor&&t.megaStateDescriptor&&!function(e,t){return!(!ot(e.attachmentsState,t.attachmentsState,ft)||e.blendConstant&&t.blendConstant&&!Ge(e.blendConstant,t.blendConstant)||e.stencilFront&&t.stencilFront&&!pt(e.stencilFront,t.stencilFront)||e.stencilBack&&t.stencilBack&&!pt(e.stencilBack,t.stencilBack)||e.depthCompare!==t.depthCompare||e.depthWrite!==t.depthWrite||e.stencilWrite!==t.stencilWrite||e.cullMode!==t.cullMode||e.frontFace!==t.frontFace||e.polygonOffset!==t.polygonOffset)}(e.megaStateDescriptor,t.megaStateDescriptor))&&(!!dt(e.program,t.program)&&(!!ot(e.colorAttachmentFormats,t.colorAttachmentFormats,vt)&&e.depthStencilAttachmentFormat===t.depthStencilAttachmentFormat)))))}function gt(e,t){return e.offset===t.offset&&e.shaderLocation===t.shaderLocation&&e.format===t.format&&e.divisor===t.divisor}function yt(e,t){return H(e)?H(t):!H(t)&&(e.arrayStride===t.arrayStride&&e.stepMode===t.stepMode&&ot(e.attributes,t.attributes,gt))}function _t(e,t){return e.indexBufferFormat===t.indexBufferFormat&&(!!ot(e.vertexBufferDescriptors,t.vertexBufferDescriptors,yt)&&!!dt(e.program,t.program))}function bt(e){return{sampler:e.sampler,texture:e.texture,dimension:e.dimension,formatKind:e.formatKind,comparison:e.comparison}}function xt(e){var t=e.buffer,n=e.size;return{binding:e.binding,buffer:t,offset:e.offset,size:n}}function Et(e){return{binding:e.binding,texture:e.texture}}function St(e){return{shaderLocation:e.shaderLocation,format:e.format,offset:e.offset,divisor:e.divisor}}function At(e){return H(e)?e:{arrayStride:e.arrayStride,stepMode:e.stepMode,attributes:at(e.attributes,St)}}var Tt=/([^[]*)(\[[0-9]+\])?/;function Ct(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};var t=e.match(Tt);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:Boolean(t[2])}}function wt(){var e=null;return function(t,n,r){var i=e!==r;return i&&(t.uniform1i(n,r),e=r),i}}function Rt(e,t,n,r){var i=null,o=null;return function(a,s,u){var l=t(u,n),c=l.length,h=!1;if(null===i)i=new Float32Array(c),o=c,h=!0;else{Ue(o===c,"Uniform length cannot change.");for(var f=0;f<c;++f)if(l[f]!==i[f]){h=!0;break}}return h&&(r(a,e,s,l),i.set(l)),h}}function Mt(e,t,n,r){e[t](n,r)}function kt(e,t,n,r){e[t](n,!1,r)}var Lt={},Ot={},Pt={},It=[0];function Nt(e,t,n,r){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(It[0]=e,e=It);var i=e.length;if(e instanceof n)return e;var o=r[i];o||(o=new n(i),r[i]=o);for(var a=0;a<i;a++)o[a]=e[a];return o}function Dt(e,t){return Nt(e,t,Float32Array,Lt)}function Bt(e,t){return Nt(e,t,Int32Array,Ot)}function Ft(e,t){return Nt(e,t,Uint32Array,Pt)}var Ut=((rt={})[ie.FLOAT]=Rt.bind(null,"uniform1fv",Dt,1,Mt),rt[ie.FLOAT_VEC2]=Rt.bind(null,"uniform2fv",Dt,2,Mt),rt[ie.FLOAT_VEC3]=Rt.bind(null,"uniform3fv",Dt,3,Mt),rt[ie.FLOAT_VEC4]=Rt.bind(null,"uniform4fv",Dt,4,Mt),rt[ie.INT]=Rt.bind(null,"uniform1iv",Bt,1,Mt),rt[ie.INT_VEC2]=Rt.bind(null,"uniform2iv",Bt,2,Mt),rt[ie.INT_VEC3]=Rt.bind(null,"uniform3iv",Bt,3,Mt),rt[ie.INT_VEC4]=Rt.bind(null,"uniform4iv",Bt,4,Mt),rt[ie.BOOL]=Rt.bind(null,"uniform1iv",Bt,1,Mt),rt[ie.BOOL_VEC2]=Rt.bind(null,"uniform2iv",Bt,2,Mt),rt[ie.BOOL_VEC3]=Rt.bind(null,"uniform3iv",Bt,3,Mt),rt[ie.BOOL_VEC4]=Rt.bind(null,"uniform4iv",Bt,4,Mt),rt[ie.FLOAT_MAT2]=Rt.bind(null,"uniformMatrix2fv",Dt,4,kt),rt[ie.FLOAT_MAT3]=Rt.bind(null,"uniformMatrix3fv",Dt,9,kt),rt[ie.FLOAT_MAT4]=Rt.bind(null,"uniformMatrix4fv",Dt,16,kt),rt[ie.UNSIGNED_INT]=Rt.bind(null,"uniform1uiv",Ft,1,Mt),rt[ie.UNSIGNED_INT_VEC2]=Rt.bind(null,"uniform2uiv",Ft,2,Mt),rt[ie.UNSIGNED_INT_VEC3]=Rt.bind(null,"uniform3uiv",Ft,3,Mt),rt[ie.UNSIGNED_INT_VEC4]=Rt.bind(null,"uniform4uiv",Ft,4,Mt),rt[ie.FLOAT_MAT2x3]=Rt.bind(null,"uniformMatrix2x3fv",Dt,6,kt),rt[ie.FLOAT_MAT2x4]=Rt.bind(null,"uniformMatrix2x4fv",Dt,8,kt),rt[ie.FLOAT_MAT3x2]=Rt.bind(null,"uniformMatrix3x2fv",Dt,6,kt),rt[ie.FLOAT_MAT3x4]=Rt.bind(null,"uniformMatrix3x4fv",Dt,12,kt),rt[ie.FLOAT_MAT4x2]=Rt.bind(null,"uniformMatrix4x2fv",Dt,8,kt),rt[ie.FLOAT_MAT4x3]=Rt.bind(null,"uniformMatrix4x3fv",Dt,12,kt),rt[ie.SAMPLER_2D]=wt,rt[ie.SAMPLER_CUBE]=wt,rt[ie.SAMPLER_3D]=wt,rt[ie.SAMPLER_2D_SHADOW]=wt,rt[ie.SAMPLER_2D_ARRAY]=wt,rt[ie.SAMPLER_2D_ARRAY_SHADOW]=wt,rt[ie.SAMPLER_CUBE_SHADOW]=wt,rt[ie.INT_SAMPLER_2D]=wt,rt[ie.INT_SAMPLER_3D]=wt,rt[ie.INT_SAMPLER_CUBE]=wt,rt[ie.INT_SAMPLER_2D_ARRAY]=wt,rt[ie.UNSIGNED_INT_SAMPLER_2D]=wt,rt[ie.UNSIGNED_INT_SAMPLER_3D]=wt,rt[ie.UNSIGNED_INT_SAMPLER_CUBE]=wt,rt[ie.UNSIGNED_INT_SAMPLER_2D_ARRAY]=wt,rt);function zt(e,t,n){var r=Ut[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,e,t)}var Gt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function jt(e,t){return"#define ".concat(e," ").concat(t)}function Vt(e){if(void 0===e)return null;var t=/binding\s*=\s*(\d+)/.exec(e);if(null!==t){var n=parseInt(t[1],10);if(!Number.isNaN(n))return n}return null}function Ht(e){return[e,""]}function Wt(e,t,n,r,i){var o;void 0===r&&(r=null),void 0===i&&(i=!0);var a="#version 100"===e.glslVersion,s="frag"===t&&(null===(o=n.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))||void 0===o?void 0:o.length)>1,u=n.replace("\r\n","\n").split("\n").map((function(e){return e.replace(/[/][/].*$/,"")})).filter((function(e){return!(!e||/^\s+$/.test(e))})),l="";null!==r&&(l=Object.keys(r).map((function(e){return jt(e,r[e])})).join("\n"));var c=u.find((function(e){return e.startsWith("precision")}))||"precision mediump float;",h=i?u.filter((function(e){return!e.startsWith("precision")})).join("\n"):u.join("\n"),f="";if(e.viewportOrigin===Ae.UPPER_LEFT&&(f+="".concat(jt("VIEWPORT_ORIGIN_TL","1"),"\n")),e.clipSpaceNearZ===Te.ZERO&&(f+="".concat(jt("CLIPSPACE_NEAR_ZERO","1"),"\n")),e.explicitBindingLocations){var p=0,d=0,v=0;h=h.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,(function(e,t,n,r){var i=n?"".concat(n,", "):"";return"layout(".concat(i,"set = ").concat(p,", binding = ").concat(d++,") uniform ").concat(r)})),p++,d=0,Ue(e.separateSamplerTextures),h=h.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(e,n,r,i,o){var a=Vt(r);null===a&&(a=d++);var s=ne(Ht(i),2),u=s[0],l=s[1];return"frag"===t?"\nlayout(set = ".concat(p,", binding = ").concat(2*a+0,") uniform texture").concat(u," T_").concat(o,";\nlayout(set = ").concat(p,", binding = ").concat(2*a+1,") uniform sampler").concat(l," S_").concat(o,";").trim():""})),h=h.replace("frag"===t?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,(function(e,t){return"layout(location = ".concat(v++,") ").concat(t)})),f+="".concat(jt("gl_VertexID","gl_VertexIndex"),"\n"),f+="".concat(jt("gl_InstanceID","gl_InstanceIndex"),"\n"),c=c.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var m=0;h=h.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(e,t,n,r,i){var o=Vt(n);return null===o&&(o=m++),"uniform sampler".concat(r," ").concat(i,"; // BINDING=").concat(o)}))}if(h=(h=(h=h.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"SAMPLER_".concat(t,"(P_").concat(n,")")}))).replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"PP_SAMPLER_".concat(t,"(P_").concat(n,")")}))).replace(/\bPU_TEXTURE\((.*?)\)/g,(function(e,t){return"TEXTURE(P_".concat(t,")")})),e.separateSamplerTextures)h=h.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){var r=ne(Ht(t),2),i=r[0],o=r[1];return"texture".concat(i," T_P_").concat(n,", sampler").concat(o," S_P_").concat(n)})),h=(h=(h=h.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"T_".concat(n,", S_").concat(n)}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"sampler".concat(t,"(T_").concat(n,", S_").concat(n,")")}))).replace(/\bTEXTURE\((.*?)\)/g,(function(e,t){return"T_".concat(t)}));else{var g=[];h=(h=(h=h.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"sampler".concat(t," P_").concat(n)}))).replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return n}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return g.push([n,t]),n})),a&&g.forEach((function(e){var t=ne(e,2),n=t[0],r=t[1];h=h.replace(new RegExp("texture\\(".concat(n),"g"),(function(){return"texture".concat(r,"(").concat(n)}))})),h=h.replace(/\bTEXTURE\((.*?)\)/g,(function(e,t){return t}))}var y="".concat(a?"":e.glslVersion,"\n").concat(a&&s?"#extension GL_EXT_draw_buffers : require\n":"","\n").concat(a&&"frag"===t?"#extension GL_OES_standard_derivatives : enable\n":"").concat(i?c:"","\n").concat(f||"").concat(l?l+"\n":"","\n").concat(h,"\n").trim();if(e.explicitBindingLocations&&"frag"===t&&(y=y.replace(/^\b(out)\b/g,(function(e,t){return"layout(location = 0) ".concat(t)}))),a){if("frag"===t&&(y=y.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"varying ".concat(t," ").concat(n,";\n")}))),"vert"===t&&(y=(y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"varying ".concat(t," ").concat(n,";\n")}))).replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"attribute ".concat(t," ").concat(n,";\n")}))),y=y.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(e,t){return t.trim().replace(/^.*$/gm,(function(e){var t=e.trim();return t.startsWith("#")?t:e?"uniform ".concat(t):""}))})),"frag"===t)if(s){var _=[],b=(y=y.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,(function(e,t){return _.push(t),"vec4 ".concat(t,";\n")}))).lastIndexOf("}");y=y.substring(0,b)+"\n    ".concat(_.map((function(e,t){return"gl_FragData[".concat(t,"] = ").concat(e,";\n    ")})).join("\n"))+y.substring(b)}else{var x;if(y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return x=n,"".concat(t," ").concat(n,";\n")})),x){b=y.lastIndexOf("}");y=y.substring(0,b)+"\n  gl_FragColor = vec4(".concat(x,");\n")+y.substring(b)}}y=y.replace(/^\s*layout\((.*)\)/gm,"")}return y}var Zt=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this)||this;return i.id=n,i.device=r,null!==i.device.resourceCreationTracker&&i.device.resourceCreationTracker.trackResourceCreated(i),i}return K(t,e),t.prototype.destroy=function(){null!==this.device.resourceCreationTracker&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(Le),Xt=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=oe.Bindings;var a=i.uniformBufferBindings,s=i.samplerBindings;return o.uniformBufferBindings=a||[],o.samplerBindings=s||[],o.bindingLayouts=o.createBindingLayouts(),o}return K(t,e),t.prototype.createBindingLayouts=function(){var e=0,t=0,n=[],r=this.uniformBufferBindings.length,i=this.samplerBindings.length;return n.push({firstUniformBuffer:e,numUniformBuffers:r,firstSampler:t,numSamplers:i}),{numUniformBuffers:e+=r,numSamplers:t+=i,bindingLayoutTables:n}},t}(Zt);function Yt(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}function qt(e){switch(Ie(e)){case we.BC1:case we.BC2:case we.BC3:case we.BC4_UNORM:case we.BC4_SNORM:case we.BC5_UNORM:case we.BC5_SNORM:return!0;default:return!1}}function Kt(e){if(Ne(e)&Me.Normalized)return!1;var t=Ie(e);return t===we.S8||t===we.S16||t===we.S32||(t===we.U8||t===we.U16||t===we.U32)}function Qt(e){return e&ve.INDEX?ie.ELEMENT_ARRAY_BUFFER:e&ve.VERTEX?ie.ARRAY_BUFFER:e&ve.UNIFORM?ie.UNIFORM_BUFFER:void 0}function $t(e){var t=Ie(e),n=Pe(e),r=Ne(e),i=function(e){switch(e){case we.U8:return ie.UNSIGNED_BYTE;case we.U16:return ie.UNSIGNED_SHORT;case we.U32:return ie.UNSIGNED_INT;case we.S8:return ie.BYTE;case we.S16:return ie.SHORT;case we.S32:return ie.INT;case we.F16:return ie.HALF_FLOAT;case we.F32:return ie.FLOAT;default:throw new Error("whoops")}}(t),o=function(e){switch(e){case Re.R:return 1;case Re.RG:return 2;case Re.RGB:return 3;case Re.RGBA:return 4;default:return 1}}(n);return{size:o,type:i,normalized:!!(r&Me.Normalized)}}function Jt(e){switch(e){case he.CLAMP_TO_EDGE:return ie.CLAMP_TO_EDGE;case he.REPEAT:return ie.REPEAT;case he.MIRRORED_REPEAT:return ie.MIRRORED_REPEAT;default:throw new Error("whoops")}}function en(e,t){if(t===pe.LINEAR&&e===fe.BILINEAR)return ie.LINEAR_MIPMAP_LINEAR;if(t===pe.LINEAR&&e===fe.POINT)return ie.NEAREST_MIPMAP_LINEAR;if(t===pe.NEAREST&&e===fe.BILINEAR)return ie.LINEAR_MIPMAP_NEAREST;if(t===pe.NEAREST&&e===fe.POINT)return ie.NEAREST_MIPMAP_NEAREST;if(t===pe.NO_MIP&&e===fe.BILINEAR)return ie.LINEAR;if(t===pe.NO_MIP&&e===fe.POINT)return ie.NEAREST;throw new Error("Unknown texture filter mode")}function tn(e,t){void 0===t&&(t=0);var n=e;return n.gl_buffer_pages[t/n.pageByteSize|0]}function nn(e){return e.gl_texture}function rn(e){return e.gl_sampler}function on(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function an(e,t){for(var n=[];;){var r=t.exec(e);if(!r)break;n.push(r)}return n}function sn(e){return e.blendMode==ce.ADD&&e.blendSrcFactor==le.ONE&&e.blendDstFactor===le.ZERO}function un(e){if(e===_e.TEXTURE_2D)return ie.TEXTURE_2D;if(e===_e.TEXTURE_2D_ARRAY)return ie.TEXTURE_2D_ARRAY;if(e===_e.TEXTURE_CUBE_MAP)return ie.TEXTURE_CUBE_MAP;if(e===_e.TEXTURE_3D)return ie.TEXTURE_3D;throw new Error("whoops")}function ln(e,t,n,r){return e%n==0&&t%r==0}var cn,hn=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=oe.Buffer;var a=i.viewOrSize,s=i.usage,u=i.hint,l=void 0===u?me.STATIC:u,c=r.uniformBufferMaxPageByteSize,h=r.gl,f=s&ve.UNIFORM;f||(Yt(h)?h.bindVertexArray(null):r.OES_vertex_array_object.bindVertexArrayOES(null));var p,d=X(a)?qe(a,4):qe(a.byteLength,4);if(o.gl_buffer_pages=[],f){for(var v=d;v>0;)o.gl_buffer_pages.push(o.createBufferPage(Math.min(v,c),s,l)),v-=c;p=c}else o.gl_buffer_pages.push(o.createBufferPage(d,s,l)),p=d;return o.pageByteSize=p,o.byteSize=d,o.usage=s,o.gl_target=Qt(s),X(a)||o.setSubData(0,new Uint8Array(a.buffer)),f||(Yt(h)?h.bindVertexArray(o.device.currentBoundVAO):r.OES_vertex_array_object.bindVertexArrayOES(o.device.currentBoundVAO)),o}return K(t,e),t.prototype.setSubData=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=t.byteLength-n);for(var i=this.device.gl,o=this.pageByteSize,a=e+r,s=e,u=e%o;s<a;){var l=Yt(i)?i.COPY_WRITE_BUFFER:this.gl_target,c=tn(this,s);if(c.ubo)return;i.bindBuffer(l,c),Yt(i)?i.bufferSubData(l,u,t,n,Math.min(a-s,o)):i.bufferSubData(l,u,t),s+=o,u=0,n+=o,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(e,t,n){var r=this.device.gl,i=t&ve.UNIFORM;if(!Yt(r)&&i)return{ubo:!0};var o=this.device.ensureResourceExists(r.createBuffer()),a=Qt(t),s=function(e){switch(e){case me.STATIC:return ie.STATIC_DRAW;case me.DYNAMIC:return ie.DYNAMIC_DRAW}}(n);return r.bindBuffer(a,o),r.bufferData(a,e,s),o},t}(Zt),fn=function(e){function t(t){var n,r,i,o,a,s=t.id,u=t.device,l=t.descriptor,c=e.call(this,{id:s,device:u})||this;c.type=oe.InputLayout;var h=l.vertexBufferDescriptors,f=l.indexBufferFormat,p=l.program;Ue(f===ke.U16_R||f===ke.U32_R||null===f);var d=null!==f?function(e){switch(e){case ke.U8_R:return ie.UNSIGNED_BYTE;case ke.U16_R:return ie.UNSIGNED_SHORT;case ke.U32_R:return ie.UNSIGNED_INT;default:throw new Error("whoops")}}(f):null,v=null!==f?Be(f):null,m=c.device.gl,g=c.device.ensureResourceExists(Yt(m)?m.createVertexArray():u.OES_vertex_array_object.createVertexArrayOES());Yt(m)?m.bindVertexArray(g):u.OES_vertex_array_object.bindVertexArrayOES(g),m.bindBuffer(m.ARRAY_BUFFER,tn(c.device.fallbackVertexBuffer));try{for(var y=te(l.vertexBufferDescriptors),_=y.next();!_.done;_=y.next()){var b=_.value,x=b.stepMode,E=b.attributes;try{for(var S=(i=void 0,te(E)),A=S.next();!A.done;A=S.next()){var T=A.value,C=T.shaderLocation,w=T.format,R=T.divisor,M=void 0===R?1:R,k=Yt(m)?C:null===(a=p.attributes[C])||void 0===a?void 0:a.location,L=$t(w);if(T.vertexFormat=L,!H(k)){Kt(w);var O=L.size,P=L.type,I=L.normalized;m.vertexAttribPointer(k,O,P,I,0,0),x===ge.INSTANCE&&(Yt(m)?m.vertexAttribDivisor(k,M):u.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(k,M)),m.enableVertexAttribArray(k)}}}catch(e){i={error:e}}finally{try{A&&!A.done&&(o=S.return)&&o.call(S)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{_&&!_.done&&(r=y.return)&&r.call(y)}finally{if(n)throw n.error}}return Yt(m)?m.bindVertexArray(null):u.OES_vertex_array_object.bindVertexArrayOES(null),c.vertexBufferDescriptors=h,c.vao=g,c.indexBufferFormat=f,c.indexBufferType=d,c.indexBufferCompByteSize=v,c.program=p,c}return K(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(Yt(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(Zt),pn=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=t.fake,a=e.call(this,{id:n,device:r})||this;a.type=oe.Texture,i=Q({dimension:_e.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},i);var s,u,l=a.device.gl,c=a.clampmipLevelCount(i);if(a.immutable=i.usage===be.RENDER_TARGET,a.pixelStore=i.pixelStore,a.format=i.format,a.dimension=i.dimension,a.formatKind=Fe(i.format),a.width=i.width,a.height=i.height,a.depthOrArrayLayers=i.depthOrArrayLayers,a.mipmaps=c>=1,!o){u=a.device.ensureResourceExists(l.createTexture());var h=a.device.translateTextureType(i.format),f=a.device.translateTextureInternalFormat(i.format);if(a.device.setActiveTexture(l.TEXTURE0),a.device.currentTextures[0]=null,a.preprocessImage(),i.dimension===_e.TEXTURE_2D){if(s=ie.TEXTURE_2D,l.bindTexture(s,u),a.immutable)if(Yt(l))l.texStorage2D(s,c,f,i.width,i.height);else{var p=(f===ie.DEPTH_COMPONENT||a.isNPOT(),0);(a.format!==ke.D32F&&a.format!==ke.D24_S8||Yt(l)||r.WEBGL_depth_texture)&&(l.texImage2D(s,p,f,i.width,i.height,0,f,h,null),a.mipmaps&&(a.mipmaps=!1,l.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),l.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),l.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE)))}Ue(1===i.depthOrArrayLayers)}else if(i.dimension===_e.TEXTURE_2D_ARRAY)s=ie.TEXTURE_2D_ARRAY,l.bindTexture(s,u),a.immutable&&Yt(l)&&l.texStorage3D(s,c,f,i.width,i.height,i.depthOrArrayLayers);else if(i.dimension===_e.TEXTURE_3D)s=ie.TEXTURE_3D,l.bindTexture(s,u),a.immutable&&Yt(l)&&l.texStorage3D(s,c,f,i.width,i.height,i.depthOrArrayLayers);else{if(i.dimension!==_e.TEXTURE_CUBE_MAP)throw new Error("whoops");s=ie.TEXTURE_CUBE_MAP,l.bindTexture(s,u),a.immutable&&Yt(l)&&l.texStorage2D(s,c,f,i.width,i.height),Ue(6===i.depthOrArrayLayers)}}return a.gl_texture=u,a.gl_target=s,a.mipLevelCount=c,a}return K(t,e),t.prototype.setImageData=function(e,t){void 0===t&&(t=0);var n=this.device.gl;qt(this.format);var r,i=this.gl_target===ie.TEXTURE_3D||this.gl_target===ie.TEXTURE_2D_ARRAY,o=this.gl_target===ie.TEXTURE_CUBE_MAP,a=(r=e[0],Object.prototype.toString.call(r)in Gt);this.device.setActiveTexture(n.TEXTURE0),this.device.currentTextures[0]=null;var s,u,l=e[0];a?(s=this.width,u=this.height):(s=l.width,u=l.height,this.width=s,this.height=u),n.bindTexture(this.gl_target,this.gl_texture);var c=this.device.translateTextureFormat(this.format),h=Yt(n)?this.device.translateInternalTextureFormat(this.format):c,f=this.device.translateTextureType(this.format);this.preprocessImage();for(var p=0;p<this.depthOrArrayLayers;p++){var d=e[p],v=this.gl_target;o&&(v=ie.TEXTURE_CUBE_MAP_POSITIVE_X+p%6),this.immutable?n.texSubImage2D(v,t,0,0,s,u,c,f,d):Yt(n)?i?n.texImage3D(v,t,h,s,u,this.depthOrArrayLayers,0,c,f,d):n.texImage2D(v,t,h,s,u,0,c,f,d):a?n.texImage2D(v,t,c,s,u,0,c,f,d):n.texImage2D(v,t,c,c,f,d)}this.mipmaps&&this.generateMipmap(i)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(nn(this))},t.prototype.clampmipLevelCount=function(e){if(e.dimension===_e.TEXTURE_2D_ARRAY&&e.depthOrArrayLayers>1&&Ie(e.format)===we.BC1)for(var t=e.width,n=e.height,r=0;r<e.mipLevelCount;r++){if(t<=2||n<=2)return r-1;t=Math.max(t/2|0,1),n=Math.max(n/2|0,1)}return e.mipLevelCount},t.prototype.preprocessImage=function(){var e=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&e.pixelStorei(ie.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&e.pixelStorei(ie.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&e.pixelStorei(ie.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(e){void 0===e&&(e=!1);var t=this.device.gl;return!Yt(t)&&this.isNPOT()||this.gl_texture&&this.gl_target&&(t.bindTexture(this.gl_target,this.gl_texture),e?(t.texParameteri(this.gl_target,ie.TEXTURE_BASE_LEVEL,0),t.texParameteri(this.gl_target,ie.TEXTURE_MAX_LEVEL,Math.log2(this.width)),t.texParameteri(this.gl_target,ie.TEXTURE_MIN_FILTER,ie.LINEAR_MIPMAP_LINEAR),t.texParameteri(this.gl_target,ie.TEXTURE_MAG_FILTER,ie.LINEAR)):t.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.NEAREST_MIPMAP_LINEAR),t.generateMipmap(this.gl_target),t.bindTexture(this.gl_target,null)),this},t.prototype.isNPOT=function(){return!Yt(this.device.gl)&&(!Xe(this.width)||!Xe(this.height))},t}(Zt),dn=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=oe.RenderTarget,o.gl_renderbuffer=null,o.texture=null;var a=o.device.gl,s=i.format,u=i.width,l=i.height,c=i.sampleCount,h=void 0===c?1:c,f=i.texture,p=!1;if(s!==ke.D32F&&s!==ke.D24_S8||!f||Yt(a)||r.WEBGL_depth_texture||(f.destroy(),o.texture=null,p=!0),!p&&f)o.texture=f;else{o.gl_renderbuffer=o.device.ensureResourceExists(a.createRenderbuffer()),a.bindRenderbuffer(a.RENDERBUFFER,o.gl_renderbuffer);var d=o.device.translateTextureInternalFormat(s,!0);Yt(a)&&h>1?a.renderbufferStorageMultisample(ie.RENDERBUFFER,h,d,u,l):a.renderbufferStorage(ie.RENDERBUFFER,d,u,l)}return o.format=s,o.width=u,o.height=l,o.sampleCount=h,o}return K(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),null!==this.gl_renderbuffer&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(Zt);!function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"}(cn||(cn={}));var vn,mn=function(e){function t(t,n){var r=t.id,i=t.device,o=t.descriptor,a=e.call(this,{id:r,device:i})||this;a.rawVertexGLSL=n,a.type=oe.Program,a.uniformSetters={},a.attributes=[];var s=a.device.gl;return a.descriptor=o,a.gl_program=a.device.ensureResourceExists(s.createProgram()),a.gl_shader_vert=null,a.gl_shader_frag=null,a.compileState=cn.NeedsCompile,a.tryCompileProgram(),a}return K(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){Ue(this.compileState===cn.NeedsCompile);var e=this.descriptor,t=e.vertex,n=e.fragment,r=this.device.gl;(null==t?void 0:t.glsl)&&(null==n?void 0:n.glsl)&&(this.gl_shader_vert=this.compileShader(t.postprocess?t.postprocess(t.glsl):t.glsl,r.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(n.postprocess?n.postprocess(n.glsl):n.glsl,r.FRAGMENT_SHADER),r.attachShader(this.gl_program,this.gl_shader_vert),r.attachShader(this.gl_program,this.gl_shader_frag),r.linkProgram(this.gl_program),this.compileState=cn.Compiling,Yt(r)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var e,t=this.device.gl,n=t.getProgramParameter(this.gl_program,t.ACTIVE_ATTRIBUTES),r=function(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,(function(e,n,r){var i=Number(r);return t[n]=isNaN(i)?r:i,""})),t}(this.descriptor.vertex.glsl),i=function(e,t){var n=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,(function(e,r,i){var o=Number(r);return n.push({location:isNaN(o)?t[r]:o,name:i}),""})),n}(this.rawVertexGLSL,r),o=function(n){var r=t.getActiveAttrib(a.gl_program,n),o=r.name,s=r.type,u=r.size,l=t.getAttribLocation(a.gl_program,o),c=null===(e=i.find((function(e){return e.name===o})))||void 0===e?void 0:e.location;l>=0&&!H(c)&&(a.attributes[c]={name:o,location:l,type:s,size:u})},a=this,s=0;s<n;s++)o(s)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var e=this.device.gl,t=e.getProgramParameter(this.gl_program,e.ACTIVE_UNIFORMS),n=0;n<t;n++){var r=e.getActiveUniform(this.gl_program,n),i=Ct(r.name).name,o=e.getUniformLocation(this.gl_program,i);if(this.uniformSetters[i]=zt(e,o,r),r&&r.size>1)for(var a=0;a<r.size;a++)o=e.getUniformLocation(this.gl_program,"".concat(i,"[").concat(a,"]")),this.uniformSetters["".concat(i,"[").concat(a,"]")]=zt(e,o,r)}},t.prototype.compileShader=function(e,t){var n=this.device.gl,r=this.device.ensureResourceExists(n.createShader(t));return n.shaderSource(r,e),n.compileShader(r),r},t.prototype.setUniformsLegacy=function(e){void 0===e&&(e={});var t=this.device.gl;if(!Yt(t)){var n=!1;for(var r in e){n||(t.useProgram(this.gl_program),n=!0);var i=e[r],o=this.uniformSetters[r];if(o){var a=i;a instanceof pn&&(a=a.textureIndex),o(a)}}}return this},t}(Zt),gn=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=oe.QueryPool;var a=o.device.gl;if(Yt(a)){var s=i.elemCount,u=i.type;o.gl_query=function(e,t){for(var n=new Array(e),r=0;r<e;r++)n[r]=t();return n}(s,(function(){return o.device.ensureResourceExists(a.createQuery())})),o.gl_query_type=function(e){if(e===Ce.OcclusionConservative)return ie.ANY_SAMPLES_PASSED_CONSERVATIVE;throw new Error("whoops")}(u)}return o}return K(t,e),t.prototype.queryResultOcclusion=function(e){var t=this.device.gl;if(Yt(t)){var n=this.gl_query[e];return t.getQueryParameter(n,t.QUERY_RESULT_AVAILABLE)?!!t.getQueryParameter(n,t.QUERY_RESULT):null}return null},t.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(Yt(t))for(var n=0;n<this.gl_query.length;n++)t.deleteQuery(this.gl_query[n])},t}(Zt),yn=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=oe.Readback,i.gl_pbo=null,i.gl_sync=null,i}return K(t,e),t.prototype.clientWaitAsync=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=10);var r=this.device.gl;return new Promise((function(i,o){!function a(){var s=r.clientWaitSync(e,t,0);s!=r.WAIT_FAILED?s!=r.TIMEOUT_EXPIRED?i():setTimeout(a,Y(n,0,r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL)):o()}()}))},t.prototype.getBufferSubDataAsync=function(e,t,n,r,i,o){return J(this,void 0,void 0,(function(){var a;return ee(this,(function(s){switch(s.label){case 0:return Yt(a=this.device.gl)?(this.gl_sync=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0),a.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return s.sent(),a.bindBuffer(e,t),a.getBufferSubData(e,n,r,i,o),a.bindBuffer(e,null),[2,r];case 2:return[2]}}))}))},t.prototype.readTexture=function(e,t,n,r,i,o,a,s){return void 0===a&&(a=0),void 0===s&&(s=o.byteLength||0),J(this,void 0,void 0,(function(){var u,l,c,h,f;return ee(this,(function(p){var d;return u=this.device.gl,l=e,c=this.device.translateTextureFormat(l.format),h=this.device.translateTextureType(l.format),d=l.format,f=De(Ie(d))*Pe(d),Yt(u)?(this.gl_pbo=this.device.ensureResourceExists(u.createBuffer()),u.bindBuffer(u.PIXEL_PACK_BUFFER,this.gl_pbo),u.bufferData(u.PIXEL_PACK_BUFFER,s,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),u.bindFramebuffer(ie.READ_FRAMEBUFFER,this.device.readbackFramebuffer),u.framebufferTexture2D(ie.READ_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,l.gl_texture,0),u.bindBuffer(u.PIXEL_PACK_BUFFER,this.gl_pbo),u.readPixels(t,n,r,i,c,h,a*f),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(u.PIXEL_PACK_BUFFER,this.gl_pbo,0,o,a,0)]):[2,this.readTextureSync(e,t,n,r,i,o,a,s)]}))}))},t.prototype.readTextureSync=function(e,t,n,r,i,o,a,s){void 0===s&&(s=o.byteLength||0);var u=this.device.gl,l=e,c=this.device.translateTextureType(l.format);return u.bindFramebuffer(ie.FRAMEBUFFER,this.device.readbackFramebuffer),u.framebufferTexture2D(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,l.gl_texture,0),u.pixelStorei(u.PACK_ALIGNMENT,4),u.readPixels(t,n,r,i,u.RGBA,c,o),o},t.prototype.readBuffer=function(e,t,n,r,i){return J(this,void 0,void 0,(function(){var o;return ee(this,(function(a){return Yt(o=this.device.gl)?[2,this.getBufferSubDataAsync(o.ARRAY_BUFFER,tn(e,t),t,n,r,i)]:[2,Promise.reject()]}))}))},t.prototype.destroy=function(){e.prototype.destroy.call(this),Yt(this.device.gl)&&(null!==this.gl_sync&&this.device.gl.deleteSync(this.gl_sync),null!==this.gl_pbo&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(Zt),_n=function(e){function t(t){var n,r,i=t.id,o=t.device,a=t.descriptor,s=e.call(this,{id:i,device:o})||this;return s.type=oe.RenderPipeline,s.drawMode=function(e){switch(e){case de.TRIANGLES:return ie.TRIANGLES;case de.POINTS:return ie.POINTS;case de.TRIANGLE_STRIP:return ie.TRIANGLE_STRIP;case de.LINES:return ie.LINES;case de.LINE_STRIP:return ie.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}(null!==(n=a.topology)&&void 0!==n?n:de.TRIANGLES),s.program=a.program,s.inputLayout=a.inputLayout,s.megaState=Q(Q({},et(nt)),a.megaStateDescriptor),s.colorAttachmentFormats=a.colorAttachmentFormats.slice(),s.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,s.sampleCount=null!==(r=a.sampleCount)&&void 0!==r?r:1,s}return K(t,e),t}(Zt),bn=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;return o.type=oe.ComputePipeline,o.descriptor=i,o}return K(t,e),t}(Zt),xn=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(e){this.creationStacks.set(e,(new Error).stack),this.liveObjects.add(e)},e.prototype.trackResourceDestroyed=function(e){this.deletionStacks.has(e)&&console.warn("Object double freed:",e,"\n\nCreation stack: ",this.creationStacks.get(e),"\n\nDeletion stack: ",this.deletionStacks.get(e),"\n\nThis stack: ",(new Error).stack),this.deletionStacks.set(e,(new Error).stack),this.liveObjects.delete(e)},e.prototype.checkForLeaks=function(){var e,t;try{for(var n=te(this.liveObjects.values()),r=n.next();!r.done;r=n.next()){var i=r.value;console.warn("Object leaked:",i,"Creation stack:",this.creationStacks.get(i))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.setResourceLeakCheck=function(e,t){t?this.liveObjects.add(e):this.liveObjects.delete(e)},e}(),En=function(e){function t(t){var n,r,i=t.id,o=t.device,a=t.descriptor,s=e.call(this,{id:i,device:o})||this;s.type=oe.Sampler;var u=s.device.gl;if(Yt(u)){var l=s.device.ensureResourceExists(u.createSampler());u.samplerParameteri(l,ie.TEXTURE_WRAP_S,Jt(a.addressModeU)),u.samplerParameteri(l,ie.TEXTURE_WRAP_T,Jt(a.addressModeV)),u.samplerParameteri(l,ie.TEXTURE_WRAP_R,Jt(null!==(n=a.addressModeW)&&void 0!==n?n:a.addressModeU)),u.samplerParameteri(l,ie.TEXTURE_MIN_FILTER,en(a.minFilter,a.mipmapFilter)),u.samplerParameteri(l,ie.TEXTURE_MAG_FILTER,en(a.magFilter,pe.NO_MIP)),void 0!==a.lodMinClamp&&u.samplerParameterf(l,ie.TEXTURE_MIN_LOD,a.lodMinClamp),void 0!==a.lodMaxClamp&&u.samplerParameterf(l,ie.TEXTURE_MAX_LOD,a.lodMaxClamp),void 0!==a.compareFunction&&(u.samplerParameteri(l,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE),u.samplerParameteri(l,u.TEXTURE_COMPARE_FUNC,a.compareFunction));var c=null!==(r=a.maxAnisotropy)&&void 0!==r?r:1;c>1&&null!==s.device.EXT_texture_filter_anisotropic&&(Ue(a.minFilter===fe.BILINEAR&&a.magFilter===fe.BILINEAR&&a.mipmapFilter===pe.LINEAR),u.samplerParameterf(l,s.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c)),s.gl_sampler=l}else s.descriptor=a;return s}return K(t,e),t.prototype.setTextureParameters=function(e,t,n){var r,i=this.device.gl,o=this.descriptor;this.isNPOT(t,n)?i.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR):i.texParameteri(e,ie.TEXTURE_MIN_FILTER,en(o.minFilter,o.mipmapFilter)),i.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,Jt(o.addressModeU)),i.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,Jt(o.addressModeV)),i.texParameteri(e,ie.TEXTURE_MAG_FILTER,en(o.magFilter,pe.NO_MIP));var a=null!==(r=o.maxAnisotropy)&&void 0!==r?r:1;a>1&&null!==this.device.EXT_texture_filter_anisotropic&&(Ue(o.minFilter===fe.BILINEAR&&o.magFilter===fe.BILINEAR&&o.mipmapFilter===pe.LINEAR),i.texParameteri(e,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a))},t.prototype.destroy=function(){e.prototype.destroy.call(this),Yt(this.device.gl)&&this.device.gl.deleteSampler(rn(this))},t.prototype.isNPOT=function(e,t){return!Xe(e)||!Xe(t)},t}(Zt),Sn=function(){function e(){}return e.prototype.dispatchWorkgroups=function(e,t,n){},e.prototype.dispatchWorkgroupsIndirect=function(e,t){},e.prototype.setPipeline=function(e){},e.prototype.setBindings=function(e){},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e}(),An=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=oe.RenderBundle,t.commands=[],t}return K(t,e),t.prototype.push=function(e){this.commands.push(e)},t.prototype.replay=function(){this.commands.forEach((function(e){return e()}))},t}(Zt),Tn=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,Cn=function(){function e(e,t){void 0===t&&(t={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=et(nt),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=Ae.LOWER_LEFT,this.clipSpaceNearZ=Te.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=e,this.contextAttributes=ze(e.getContextAttributes()),Yt(e)?(this.EXT_texture_norm16=e.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=e.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=e.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),e.getExtension("EXT_frag_depth"),e.getExtension("OES_element_index_uint"),e.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=e.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=e.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=e.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=e.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=e.getExtension("KHR_parallel_shader_compile"),Yt(e)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new pn({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:_e.TEXTURE_2D,mipLevelCount:1,usage:be.RENDER_TARGET,format:!1===this.contextAttributes.alpha?ke.U8_RGB_RT:ke.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=Se.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(_e.TEXTURE_2D,Se.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(_e.TEXTURE_2D,Se.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:ve.VERTEX,hint:me.STATIC}),Yt(e)&&(this.fallbackTexture2DArray=this.createFallbackTexture(_e.TEXTURE_2D_ARRAY,Se.Float),this.fallbackTexture3D=this.createFallbackTexture(_e.TEXTURE_3D,Se.Float),this.fallbackTextureCube=this.createFallbackTexture(_e.TEXTURE_CUBE_MAP,Se.Float)),this.currentMegaState.depthCompare=ae.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=xe.ALL,e.enable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new xn)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(e,t){var n=e===_e.TEXTURE_CUBE_MAP?6:1,r=t===Se.Depth?ke.D32F:ke.U8_RGBA_NORM,i=this.createTexture({dimension:e,format:r,usage:be.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return t===Se.Float&&i.setImageData([new Uint8Array(4*n)]),nn(i)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var e=this.gl;if(this.maxVertexAttribs=e.getParameter(ie.MAX_VERTEX_ATTRIBS),Yt(e)){this.uniformBufferMaxPageByteSize=Math.min(e.getParameter(ie.MAX_UNIFORM_BLOCK_SIZE),65536),this.uniformBufferWordAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=e.getInternalformatParameter(e.RENDERBUFFER,e.DEPTH32F_STENCIL8,e.SAMPLES);this.supportedSampleCounts=t?re([],ne(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=65536;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort((function(e,t){return e-t}))},e.prototype.configureSwapChain=function(e,t,n){var r,i=this.scTexture;i.width=e,i.height=t,this.scPlatformFramebuffer=void 0===(r=n)?null:r},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(e,t){switch(void 0===t&&(t=!1),e){case ke.ALPHA:return ie.ALPHA;case ke.U8_LUMINANCE:case ke.F16_LUMINANCE:case ke.F32_LUMINANCE:return ie.LUMINANCE;case ke.F16_R:return ie.R16F;case ke.F16_RG:return ie.RG16F;case ke.F16_RGB:return ie.RGB16F;case ke.F16_RGBA:return ie.RGBA16F;case ke.F32_R:return ie.R32F;case ke.F32_RG:return ie.RG32F;case ke.F32_RGB:return ie.RGB32F;case ke.F32_RGBA:return Yt(this.gl)?ie.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:ie.RGBA;case ke.U8_R_NORM:return ie.R8;case ke.U8_RG_NORM:return ie.RG8;case ke.U8_RGB_NORM:case ke.U8_RGB_RT:return ie.RGB8;case ke.U8_RGB_SRGB:return ie.SRGB8;case ke.U8_RGBA_NORM:case ke.U8_RGBA_RT:return Yt(this.gl)?ie.RGBA8:t?ie.RGBA4:ie.RGBA;case ke.U8_RGBA:return ie.RGBA;case ke.U8_RGBA_SRGB:case ke.U8_RGBA_RT_SRGB:return ie.SRGB8_ALPHA8;case ke.U16_R:return ie.R16UI;case ke.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case ke.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case ke.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case ke.U16_RGBA_5551:return ie.RGB5_A1;case ke.U16_RGB_565:return ie.RGB565;case ke.U32_R:return ie.R32UI;case ke.S8_RGBA_NORM:return ie.RGBA8_SNORM;case ke.S8_RG_NORM:return ie.RG8_SNORM;case ke.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case ke.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case ke.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case ke.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case ke.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case ke.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case ke.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case ke.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case ke.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case ke.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case ke.D32F_S8:return Yt(this.gl)?ie.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?ie.DEPTH_STENCIL:ie.DEPTH_COMPONENT16;case ke.D24_S8:return Yt(this.gl)?ie.DEPTH24_STENCIL8:this.WEBGL_depth_texture?ie.DEPTH_STENCIL:ie.DEPTH_COMPONENT16;case ke.D32F:return Yt(this.gl)?ie.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?ie.DEPTH_COMPONENT:ie.DEPTH_COMPONENT16;case ke.D24:return Yt(this.gl)?ie.DEPTH_COMPONENT24:this.WEBGL_depth_texture?ie.DEPTH_COMPONENT:ie.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(e){switch(Ie(e)){case we.U8:return ie.UNSIGNED_BYTE;case we.U16:return ie.UNSIGNED_SHORT;case we.U32:return ie.UNSIGNED_INT;case we.S8:return ie.BYTE;case we.F16:return ie.HALF_FLOAT;case we.F32:return ie.FLOAT;case we.U16_PACKED_5551:return ie.UNSIGNED_SHORT_5_5_5_1;case we.D32F:return Yt(this.gl)?ie.FLOAT:this.WEBGL_depth_texture?ie.UNSIGNED_INT:ie.UNSIGNED_BYTE;case we.D24:return Yt(this.gl)?ie.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?ie.UNSIGNED_SHORT:ie.UNSIGNED_BYTE;case we.D24S8:return Yt(this.gl)?ie.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?ie.UNSIGNED_INT_24_8_WEBGL:ie.UNSIGNED_BYTE;case we.D32FS8:return ie.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateInternalTextureFormat=function(e){switch(e){case ke.F32_R:return ie.R32F;case ke.F32_RG:return ie.RG32F;case ke.F32_RGB:return ie.RGB32F;case ke.F32_RGBA:return ie.RGBA32F;case ke.F16_R:return ie.R16F;case ke.F16_RG:return ie.RG16F;case ke.F16_RGB:return ie.RGB16F;case ke.F16_RGBA:return ie.RGBA16F}return this.translateTextureFormat(e)},e.prototype.translateTextureFormat=function(e){if(qt(e)||e===ke.F32_LUMINANCE||e===ke.U8_LUMINANCE)return this.translateTextureInternalFormat(e);var t=Yt(this.gl)||!Yt(this.gl)&&!!this.WEBGL_depth_texture;switch(e){case ke.D24_S8:case ke.D32F_S8:return t?ie.DEPTH_STENCIL:ie.RGBA;case ke.D24:case ke.D32F:return t?ie.DEPTH_COMPONENT:ie.RGBA}var n=Kt(e);switch(Pe(e)){case Re.A:return ie.ALPHA;case Re.R:return n?ie.RED_INTEGER:ie.RED;case Re.RG:return n?ie.RG_INTEGER:ie.RG;case Re.RGB:return n?ie.RGB_INTEGER:ie.RGB;case Re.RGBA:return ie.RGBA}},e.prototype.setActiveTexture=function(e){this.currentActiveTexture!==e&&(this.gl.activeTexture(e),this.currentActiveTexture=e)},e.prototype.bindVAO=function(e){this.currentBoundVAO!==e&&(Yt(this.gl)?this.gl.bindVertexArray(e):this.OES_vertex_array_object.bindVertexArrayOES(e),this.currentBoundVAO=e)},e.prototype.programCompiled=function(e){Ue(e.compileState!==cn.NeedsCompile),e.compileState===cn.Compiling&&(e.compileState=cn.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(e))},e.prototype.useProgram=function(e){this.currentProgram!==e&&(this.programCompiled(e),this.gl.useProgram(e.gl_program),this.currentProgram=e)},e.prototype.ensureResourceExists=function(e){if(null===e){var t=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(t))}return e},e.prototype.createBuffer=function(e){return new hn({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTexture=function(e){return new pn({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createSampler=function(e){return new En({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTarget=function(e){return new dn({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTargetFromTexture=function(e){var t=e,n=t.format,r=t.width,i=t.height;return Ue(1===t.mipLevelCount),this.createRenderTarget({format:n,width:r,height:i,sampleCount:1,texture:e})},e.prototype.createProgram=function(e){var t,n,r,i=null===(t=e.vertex)||void 0===t?void 0:t.glsl;return(null===(n=e.vertex)||void 0===n?void 0:n.glsl)&&(e.vertex.glsl=Wt(this.queryVendorInfo(),"vert",e.vertex.glsl)),(null===(r=e.fragment)||void 0===r?void 0:r.glsl)&&(e.fragment.glsl=Wt(this.queryVendorInfo(),"frag",e.fragment.glsl)),this.createProgramSimple(e,i)},e.prototype.createProgramSimple=function(e,t){return new mn({id:this.getNextUniqueId(),device:this,descriptor:e},t)},e.prototype.createBindings=function(e){return new Xt({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createInputLayout=function(e){return new fn({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderPipeline=function(e){return new _n({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createComputePass=function(){return new Sn},e.prototype.createComputePipeline=function(e){return new bn({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createReadback=function(){return new yn({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(e,t){return new gn({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(e){var t,n,r,i,o,a,s=e.colorAttachment;e.depthClearValue=null!==(t=e.depthClearValue)&&void 0!==t?t:"load",e.stencilClearValue=null!==(n=e.stencilClearValue)&&void 0!==n?n:"load";for(var u=0;u<s.length;u++)e.colorAttachmentLevel||(e.colorAttachmentLevel=[]),e.colorAttachmentLevel[u]=null!==(r=e.colorAttachmentLevel[u])&&void 0!==r?r:0,e.colorResolveToLevel||(e.colorResolveToLevel=[]),e.colorResolveToLevel[u]=null!==(i=e.colorResolveToLevel[u])&&void 0!==i?i:0,e.colorClearColor||(e.colorClearColor=[]),e.colorClearColor[u]=null!==(o=e.colorClearColor[u])&&void 0!==o?o:"load",e.colorStore||(e.colorStore=[]),e.colorStore[u]=null!==(a=e.colorStore[u])&&void 0!==a&&a},e.prototype.createRenderBundle=function(){return new An({id:this.getNextUniqueId(),device:this})},e.prototype.beginBundle=function(e){this.renderBundle=e},e.prototype.endBundle=function(){this.renderBundle=void 0},e.prototype.executeBundles=function(e){e.forEach((function(e){e.replay()}))},e.prototype.createRenderPass=function(e){null!==this.currentRenderPassDescriptor&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=e,this.formatRenderPassDescriptor(e);var t=e.colorAttachment,n=e.colorAttachmentLevel,r=e.colorClearColor,i=e.colorResolveTo,o=e.colorResolveToLevel,a=e.depthStencilAttachment,s=e.depthClearValue,u=e.stencilClearValue,l=e.depthStencilResolveTo;this.setRenderPassParametersBegin(t.length);for(var c=0;c<t.length;c++)this.setRenderPassParametersColor(c,t[c],n[c],i[c],o[c]);this.setRenderPassParametersDepthStencil(a,l),this.validateCurrentAttachments();for(c=0;c<t.length;c++){var h=r[c];"load"!==h&&this.setRenderPassParametersClearColor(c,h.r,h.g,h.b,h.a)}return this.setRenderPassParametersClearDepthStencil(s,u),this},e.prototype.submitPass=function(e){Ue(null!==this.currentRenderPassDescriptor),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(e,t,n,r,i,o){var a=this.gl,s=e,u=r;if(Ue(1===u.mipLevelCount),Ue(1===s.mipLevelCount),Yt(a))s===this.scTexture?a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,s,0)),a.bindFramebuffer(a.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,u,0),a.blitFramebuffer(i,o,i+u.width,o+u.height,t,n,t+u.width,n+u.height,a.COLOR_BUFFER_BIT,a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null);else if(s===this.scTexture){var l=this.createRenderTargetFromTexture(r);this.submitBlitRenderPass(l,s)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(e,t,n){switch(e){case ke.BC1_SRGB:case ke.BC2_SRGB:case ke.BC3_SRGB:return null!==this.WEBGL_compressed_texture_s3tc_srgb&&ln(t,n,4,4);case ke.BC1:case ke.BC2:case ke.BC3:return null!==this.WEBGL_compressed_texture_s3tc&&ln(t,n,4,4);case ke.BC4_UNORM:case ke.BC4_SNORM:case ke.BC5_UNORM:case ke.BC5_SNORM:return null!==this.EXT_texture_compression_rgtc&&ln(t,n,4,4);case ke.U16_R_NORM:case ke.U16_RG_NORM:case ke.U16_RGBA_NORM:return null!==this.EXT_texture_norm16;case ke.F32_R:case ke.F32_RG:case ke.F32_RGB:case ke.F32_RGBA:return null!==this.OES_texture_float_linear;case ke.F16_R:case ke.F16_RG:case ke.F16_RGB:case ke.F16_RGBA:return null!==this.OES_texture_half_float_linear;default:return!0}},e.prototype.queryProgramReady=function(e){var t=this.gl;if(e.compileState===cn.NeedsCompile)throw new Error("whoops");if(e.compileState===cn.Compiling){var n=void 0;return(n=null===this.KHR_parallel_shader_compile||t.getProgramParameter(e.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR))&&this.programCompiled(e),n}return e.compileState===cn.NeedsBind||e.compileState===cn.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(e){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(e){return e},e.prototype.setResourceName=function(e,t){if(e.name=t,e.type===oe.Buffer)for(var n=e.gl_buffer_pages,r=0;r<n.length;r++)on(n[r],"".concat(t," Page ").concat(r));else if(e.type===oe.Texture)on(nn(e),t);else if(e.type===oe.Sampler)on(rn(e),t);else if(e.type===oe.RenderTarget){var i=e.gl_renderbuffer;null!==i&&on(i,t)}else e.type===oe.InputLayout&&on(e.vao,t)},e.prototype.setResourceLeakCheck=function(e,t){null!==this.resourceCreationTracker&&this.resourceCreationTracker.setResourceLeakCheck(e,t)},e.prototype.checkForLeaks=function(){null!==this.resourceCreationTracker&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e.prototype.programPatched=function(e,t){Ue(this.shaderDebug)},e.prototype.getBufferData=function(e,t,n){void 0===n&&(n=0);var r=this.gl;Yt(r)&&(r.bindBuffer(r.COPY_READ_BUFFER,tn(e,4*n)),r.getBufferSubData(r.COPY_READ_BUFFER,4*n,t))},e.prototype.debugGroupStatisticsDrawCall=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=e},e.prototype.debugGroupStatisticsBufferUpload=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=e},e.prototype.debugGroupStatisticsTextureBind=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=e},e.prototype.debugGroupStatisticsTriangles=function(e){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=e},e.prototype.reportShaderError=function(e,t){var n=this.gl,r=n.getShaderParameter(e,n.COMPILE_STATUS);if(!r){console.error(function(e,t){return void 0===t&&(t=1),e.split("\n").map((function(e,n){return"".concat(function(e,t,n){for(void 0===n&&(n="0");e.length<t;)e="".concat(n).concat(e);return e}(""+(t+n),4," "),"  ").concat(e)})).join("\n")}(t));var i=n.getExtension("WEBGL_debug_shaders");i&&console.error(i.getTranslatedShaderSource(e)),console.error(n.getShaderInfoLog(e))}return r},e.prototype.checkProgramCompilationForErrors=function(e){var t=this.gl,n=e.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var r=e.descriptor;if(!this.reportShaderError(e.gl_shader_vert,r.vertex.glsl))return;if(!this.reportShaderError(e.gl_shader_frag,r.fragment.glsl))return;console.error(t.getProgramInfoLog(e.gl_program))}},e.prototype.bindFramebufferAttachment=function(e,t,n,r){var i=this.gl;if(H(n))i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,null);else if(n.type===oe.RenderTarget)null!==n.gl_renderbuffer?i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,n.gl_renderbuffer):null!==n.texture&&i.framebufferTexture2D(e,t,ie.TEXTURE_2D,nn(n.texture),r);else if(n.type===oe.Texture){var o=nn(n);n.dimension===_e.TEXTURE_2D?i.framebufferTexture2D(e,t,ie.TEXTURE_2D,o,r):Yt(i)&&(n.dimension,_e.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(e,t){var n=this.gl,r=H(t)?Me.Depth|Me.Stencil:Ne(t.format),i=!!(r&Me.Depth),o=!!(r&Me.Stencil);i&&o?Yt(this.gl)||!Yt(this.gl)&&!!this.WEBGL_depth_texture?this.bindFramebufferAttachment(e,n.DEPTH_STENCIL_ATTACHMENT,t,0):this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,t,0):i?(this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,null,0)):o&&(this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var e=-1,t=-1,n=-1,r=0;r<this.currentColorAttachments.length;r++){var i=this.currentColorAttachments[r];null!==i&&(-1===e?(e=i.sampleCount,t=i.width,n=i.height):(Ue(e===i.sampleCount),Ue(t===i.width),Ue(n===i.height)))}this.currentDepthStencilAttachment&&(-1===e?e=this.currentDepthStencilAttachment.sampleCount:(Ue(e===this.currentDepthStencilAttachment.sampleCount),Ue(t===this.currentDepthStencilAttachment.width),Ue(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=e},e.prototype.setRenderPassParametersBegin=function(e){var t=this.gl;if(Yt(t)?t.bindFramebuffer(ie.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||t.bindFramebuffer(ie.FRAMEBUFFER,this.renderPassDrawFramebuffer),Yt(t)?t.drawBuffers([ie.COLOR_ATTACHMENT0,ie.COLOR_ATTACHMENT1,ie.COLOR_ATTACHMENT2,ie.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([ie.COLOR_ATTACHMENT0_WEBGL,ie.COLOR_ATTACHMENT1_WEBGL,ie.COLOR_ATTACHMENT2_WEBGL,ie.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=e;n<this.currentColorAttachments.length;n++){var r=Yt(t)?ie.DRAW_FRAMEBUFFER:ie.FRAMEBUFFER,i=Yt(t)?ie.COLOR_ATTACHMENT0:ie.COLOR_ATTACHMENT0_WEBGL;t.framebufferRenderbuffer(r,i+n,ie.RENDERBUFFER,null),t.framebufferTexture2D(r,i+n,ie.TEXTURE_2D,null,0)}this.currentColorAttachments.length=e},e.prototype.setRenderPassParametersColor=function(e,t,n,r,i){var o=Yt(this.gl);this.currentColorAttachments[e]===t&&this.currentColorAttachmentLevels[e]===n||(this.currentColorAttachments[e]=t,this.currentColorAttachmentLevels[e]=n,(o||!o&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(o?ie.DRAW_FRAMEBUFFER:ie.FRAMEBUFFER,(o?ie.COLOR_ATTACHMENT0:ie.COLOR_ATTACHMENT0_WEBGL)+e,t,n),this.resolveColorAttachmentsChanged=!0),this.currentColorResolveTos[e]===r&&this.currentColorResolveToLevels[e]===i||(this.currentColorResolveTos[e]=r,this.currentColorResolveToLevels[e]=i,null!==r&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(e,t){var n=this.gl;this.currentDepthStencilAttachment!==e&&(this.currentDepthStencilAttachment=e,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(Yt(n)?ie.DRAW_FRAMEBUFFER:ie.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(e,t,n,r,i){var o,a=this.gl;null!==this.OES_draw_buffers_indexed?(o=this.currentMegaState.attachmentsState[e])&&o.channelWriteMask!==xe.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(e,!0,!0,!0,!0),o.channelWriteMask=xe.ALL):(o=this.currentMegaState.attachmentsState[0])&&o.channelWriteMask!==xe.ALL&&(a.colorMask(!0,!0,!0,!0),o.channelWriteMask=xe.ALL);this.setScissorRectEnabled(!1),Yt(a)?a.clearBufferfv(a.COLOR,e,[t,n,r,i]):(a.clearColor(t,n,r,i),a.clear(a.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(e,t){void 0===e&&(e="load"),void 0===t&&(t="load");var n=this.gl;"load"!==e&&(Ue(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),Yt(n)?n.clearBufferfv(n.DEPTH,0,[e]):(n.clearDepth(e),n.clear(n.DEPTH_BUFFER_BIT))),"load"!==t&&(Ue(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),Yt(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(e){var t,n=this;if(this.renderBundle)this.renderBundle.push((function(){return n.setBindings(e)}));else{var r=this.gl,i=e,o=i.uniformBufferBindings,a=i.samplerBindings,s=i.bindingLayouts;Ue(0<s.bindingLayoutTables.length);var u=s.bindingLayoutTables[0];Ue(o.length>=u.numUniformBuffers),Ue(a.length>=u.numSamplers);for(var l=0;l<o.length;l++){if(0!==(m=o[l]).size){var c=u.firstUniformBuffer+l,h=m.buffer,f=m.offset||0,p=m.size||h.byteSize;if(h!==this.currentUniformBuffers[c]||f!==this.currentUniformBufferByteOffsets[c]||p!==this.currentUniformBufferByteSizes[c]){var d=f%h.pageByteSize,v=h.gl_buffer_pages[f/h.pageByteSize|0];Ue(d+p<=h.pageByteSize),Yt(r)&&r.bindBufferRange(r.UNIFORM_BUFFER,c,v,d,p),this.currentUniformBuffers[c]=h,this.currentUniformBufferByteOffsets[c]=f,this.currentUniformBufferByteSizes[c]=p}}}for(l=0;l<u.numSamplers;l++){var m=a[l],g=u.firstSampler+l,y=null!==m&&null!==m.sampler?rn(m.sampler):null,_=null!==m&&null!==m.texture?nn(m.texture):null;if(this.currentSamplers[g]!==y&&(Yt(r)&&r.bindSampler(g,y),this.currentSamplers[g]=y),this.currentTextures[g]!==_){if(this.setActiveTexture(r.TEXTURE0+g),null!==_){var b=ze(m).texture,x=b.gl_target,E=b.width,S=b.height;m.texture.textureIndex=g,r.bindTexture(x,_),Yt(r)||null===(t=m.sampler)||void 0===t||t.setTextureParameters(x,E,S),this.debugGroupStatisticsTextureBind()}else{var A=Q(Q({},m),it),T=A.dimension,C=A.formatKind;x=un(T);r.bindTexture(x,this.getFallbackTexture(Q({gl_target:x,formatKind:C},A)))}this.currentTextures[g]=_}}}},e.prototype.setViewport=function(e,t,n,r){this.gl.viewport(e,t,n,r)},e.prototype.setScissorRect=function(e,t,n,r){var i=this.gl;this.setScissorRectEnabled(!0),i.scissor(e,t,n,r)},e.prototype.applyAttachmentStateIndexed=function(e,t,n){var r=this.gl,i=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(i.colorMaskiOES(e,!!(n.channelWriteMask&xe.RED),!!(n.channelWriteMask&xe.GREEN),!!(n.channelWriteMask&xe.BLUE),!!(n.channelWriteMask&xe.ALPHA)),t.channelWriteMask=n.channelWriteMask);var o=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,a=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(a||o)&&(sn(t.rgbBlendState)&&sn(t.alphaBlendState)?i.enableiOES(e,r.BLEND):sn(n.rgbBlendState)&&sn(n.alphaBlendState)&&i.disableiOES(e,r.BLEND)),o&&(i.blendEquationSeparateiOES(e,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),a&&(i.blendFuncSeparateiOES(e,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(e,t){var n=this.gl;e.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(t.channelWriteMask&xe.RED),!!(t.channelWriteMask&xe.GREEN),!!(t.channelWriteMask&xe.BLUE),!!(t.channelWriteMask&xe.ALPHA)),e.channelWriteMask=t.channelWriteMask);var r=e.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||e.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,i=e.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||e.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||e.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||e.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(i||r)&&(sn(e.rgbBlendState)&&sn(e.alphaBlendState)?n.enable(n.BLEND):sn(t.rgbBlendState)&&sn(t.alphaBlendState)&&n.disable(n.BLEND)),r&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),e.rgbBlendState.blendMode=t.rgbBlendState.blendMode,e.alphaBlendState.blendMode=t.alphaBlendState.blendMode),i&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),e.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,e.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,e.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(e){var t=this.gl,n=this.currentMegaState;if(null!==this.OES_draw_buffers_indexed)for(var r=0;r<e.attachmentsState.length;r++)this.applyAttachmentStateIndexed(r,n.attachmentsState[0],e.attachmentsState[0]);else Ue(1===e.attachmentsState.length),this.applyAttachmentState(n.attachmentsState[0],e.attachmentsState[0]);if(Ge(n.blendConstant,e.blendConstant)||(t.blendColor(e.blendConstant.r,e.blendConstant.g,e.blendConstant.b,e.blendConstant.a),je(n.blendConstant,e.blendConstant)),n.depthCompare!==e.depthCompare&&(t.depthFunc(e.depthCompare),n.depthCompare=e.depthCompare),!!n.depthWrite!=!!e.depthWrite&&(t.depthMask(e.depthWrite),n.depthWrite=e.depthWrite),!!n.stencilWrite!=!!e.stencilWrite&&(t.stencilMask(e.stencilWrite?255:0),n.stencilWrite=e.stencilWrite),!pt(n.stencilFront,e.stencilFront)){var i=e.stencilFront,o=i.passOp,a=i.failOp,s=i.depthFailOp,u=i.compare;n.stencilFront.passOp===o&&n.stencilFront.failOp===a&&n.stencilFront.depthFailOp===s||(t.stencilOpSeparate(t.FRONT,a,s,o),n.stencilFront.passOp=o,n.stencilFront.failOp=a,n.stencilFront.depthFailOp=s),n.stencilFront.compare!==u&&(this.setStencilReference(0),n.stencilFront.compare=u)}if(!pt(n.stencilBack,e.stencilBack)){var l=e.stencilBack;o=l.passOp,a=l.failOp,s=l.depthFailOp,u=l.compare;n.stencilBack.passOp===o&&n.stencilBack.failOp===a&&n.stencilBack.depthFailOp===s||(t.stencilOpSeparate(t.BACK,a,s,o),n.stencilBack.passOp=o,n.stencilBack.failOp=a,n.stencilBack.depthFailOp=s),n.stencilBack.compare!==u&&(this.setStencilReference(0),n.stencilBack.compare=u)}n.stencilFront.mask===e.stencilFront.mask&&n.stencilBack.mask===e.stencilBack.mask||(n.stencilFront.mask=e.stencilFront.mask,n.stencilBack.mask=e.stencilBack.mask,this.applyStencil()),n.cullMode!==e.cullMode&&(n.cullMode===ue.NONE?t.enable(t.CULL_FACE):e.cullMode===ue.NONE&&t.disable(t.CULL_FACE),e.cullMode===ue.BACK?t.cullFace(t.BACK):e.cullMode===ue.FRONT?t.cullFace(t.FRONT):e.cullMode===ue.FRONT_AND_BACK&&t.cullFace(t.FRONT_AND_BACK),n.cullMode=e.cullMode),n.frontFace!==e.frontFace&&(t.frontFace(e.frontFace),n.frontFace=e.frontFace),n.polygonOffset!==e.polygonOffset&&(e.polygonOffset?(t.polygonOffset(1,1),t.enable(t.POLYGON_OFFSET_FILL)):t.disable(t.POLYGON_OFFSET_FILL),n.polygonOffset=e.polygonOffset)},e.prototype.validatePipelineFormats=function(e){for(var t=0;t<this.currentColorAttachments.length;t++)this.currentColorAttachments[t];this.currentDepthStencilAttachment&&Ue(this.currentDepthStencilAttachment.format===e.depthStencilAttachmentFormat),-1!==this.currentSampleCount&&Ue(this.currentSampleCount===e.sampleCount)},e.prototype.setPipeline=function(e){var t=this;if(this.renderBundle)this.renderBundle.push((function(){return t.setPipeline(e)}));else{this.currentPipeline=e,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var n=this.currentPipeline.program;if(this.useProgram(n),n.compileState===cn.NeedsBind){var r=this.gl,i=n.gl_program,o=n.descriptor,a=an(o.vertex.glsl,Tn);if(Yt(r))for(var s=0;s<a.length;s++){var u=ne(a[s],2)[1],l=r.getUniformBlockIndex(i,u);-1!==l&&4294967295!==l&&r.uniformBlockBinding(i,l,s)}var c=an(o.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm);for(s=0;s<c.length;s++){var h=ne(c[s],3),f=h[1],p=h[2],d=r.getUniformLocation(i,f);r.uniform1i(d,parseInt(p))}n.compileState=cn.ReadyToUse}}},e.prototype.setVertexInput=function(e,t,n){var r,i,o,a=this;if(this.renderBundle)this.renderBundle.push((function(){return a.setVertexInput(e,t,n)}));else if(null!==e){Ue(this.currentPipeline.inputLayout===e);var s=e;this.bindVAO(s.vao);for(var u=this.gl,l=0;l<s.vertexBufferDescriptors.length;l++){var c=s.vertexBufferDescriptors[l],h=c.arrayStride,f=c.attributes;try{for(var p=(r=void 0,te(f)),d=p.next();!d.done;d=p.next()){var v=d.value,m=v.shaderLocation,g=v.offset,y=Yt(u)?m:null===(o=s.program.attributes[m])||void 0===o?void 0:o.location;if(!H(y)){var _=t[l];if(null===_)continue;var b=v.vertexFormat;u.bindBuffer(u.ARRAY_BUFFER,tn(_.buffer));var x=(_.offset||0)+g;u.vertexAttribPointer(y,b.size,b.type,b.normalized,h,x)}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}if(Ue(null!==n==(null!==s.indexBufferFormat)),null!==n){var E=n.buffer;Ue(E.usage===ve.INDEX),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,tn(E)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else Ue(null===this.currentPipeline.inputLayout),Ue(null===n),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(e){this.currentStencilRef!==e&&(this.currentStencilRef=e,this.applyStencil())},e.prototype.draw=function(e,t,n,r){var i,o=this;if(this.renderBundle)this.renderBundle.push((function(){return o.draw(e,t,n,r)}));else{var a=this.gl,s=this.currentPipeline;if(t){var u=[s.drawMode,n||0,e,t];Yt(a)?a.drawArraysInstanced.apply(a,re([],ne(u),!1)):(i=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(i,re([],ne(u),!1))}else a.drawArrays(s.drawMode,n,e);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))}},e.prototype.drawIndexed=function(e,t,n,r,i){var o,a=this;if(this.renderBundle)this.renderBundle.push((function(){return a.drawIndexed(e,t,n,r,i)}));else{var s=this.gl,u=this.currentPipeline,l=ze(u.inputLayout),c=ze(this.currentIndexBufferByteOffset)+n*l.indexBufferCompByteSize;if(t){var h=[u.drawMode,e,l.indexBufferType,c,t];Yt(s)?s.drawElementsInstanced.apply(s,re([],ne(h),!1)):(o=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(o,re([],ne(h),!1))}else s.drawElements(u.drawMode,e,l.indexBufferType,c);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))}},e.prototype.drawIndirect=function(e,t){},e.prototype.drawIndexedIndirect=function(e,t){},e.prototype.beginOcclusionQuery=function(e){var t=this.gl;if(Yt(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[e])}},e.prototype.endOcclusionQuery=function(){var e=this.gl;if(Yt(e)){var t=this.currentRenderPassDescriptor.occlusionQueryPool;e.endQuery(t.gl_query_type)}},e.prototype.pipelineQueryReady=function(e){var t=e;return this.queryProgramReady(t.program)},e.prototype.pipelineForceReady=function(e){},e.prototype.endPass=function(){for(var e=this.gl,t=Yt(e),n=!1,r=0;r<this.currentColorAttachments.length;r++){var i=this.currentColorAttachments[r];if(null!==i){var o=this.currentColorResolveTos[r],a=!1;null!==o&&(Ue(i.width===o.width&&i.height===o.height),this.setScissorRectEnabled(!1),t&&e.bindFramebuffer(e.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,i,this.currentColorAttachmentLevels[r]),a=!0,o===this.scTexture?e.bindFramebuffer(t?ie.DRAW_FRAMEBUFFER:ie.FRAMEBUFFER,this.scPlatformFramebuffer):(e.bindFramebuffer(t?ie.DRAW_FRAMEBUFFER:ie.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&e.framebufferTexture2D(t?ie.DRAW_FRAMEBUFFER:ie.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o.gl_texture,this.currentColorResolveToLevels[r])),t?(e.blitFramebuffer(0,0,i.width,i.height,0,0,o.width,o.height,e.COLOR_BUFFER_BIT,e.LINEAR),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(i,o),n=!0),this.currentRenderPassDescriptor.colorStore[r]||a||(e.bindFramebuffer(t?ie.READ_FRAMEBUFFER:ie.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?ie.READ_FRAMEBUFFER:ie.FRAMEBUFFER,e.COLOR_ATTACHMENT0,i,this.currentColorAttachmentLevels[r])),e.bindFramebuffer(t?ie.READ_FRAMEBUFFER:ie.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var s=this.currentDepthStencilAttachment;if(s){var u=this.currentDepthStencilResolveTo;a=!1;u&&(Ue(s.width===u.width&&s.height===u.height),this.setScissorRectEnabled(!1),e.bindFramebuffer(t?ie.READ_FRAMEBUFFER:ie.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),e.bindFramebuffer(t?ie.DRAW_FRAMEBUFFER:ie.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?ie.READ_FRAMEBUFFER:ie.FRAMEBUFFER,s),this.bindFramebufferDepthStencilAttachment(t?ie.DRAW_FRAMEBUFFER:ie.FRAMEBUFFER,u)),a=!0,t&&e.blitFramebuffer(0,0,s.width,s.height,0,0,u.width,u.height,e.DEPTH_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(t?ie.DRAW_FRAMEBUFFER:ie.FRAMEBUFFER,null),n=!0),this.currentRenderPassDescriptor.depthStencilStore||(a||(e.bindFramebuffer(t?ie.READ_FRAMEBUFFER:ie.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?ie.READ_FRAMEBUFFER:ie.FRAMEBUFFER,s),a=!0),t&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[e.DEPTH_STENCIL_ATTACHMENT])),a&&e.bindFramebuffer(t?ie.READ_FRAMEBUFFER:ie.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||e.bindFramebuffer(t?ie.DRAW_FRAMEBUFFER:ie.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(e){if(this.currentScissorEnabled!==e){var t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=e}},e.prototype.applyStencil=function(){H(this.currentStencilRef)||(this.gl.stencilFuncSeparate(ie.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(ie.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},e.prototype.getFallbackTexture=function(e){var t=e.gl_target,n=e.formatKind;if(t===ie.TEXTURE_2D)return n===Se.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===ie.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===ie.TEXTURE_3D)return this.fallbackTexture3D;if(t===ie.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(e,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:"layout(location = 0) in vec2 a_Position;\nout vec2 v_TexCoord;\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}"},fragment:{glsl:"uniform sampler2D u_Texture;\nin vec2 v_TexCoord;\nout vec4 outputColor;\nvoid main() {\n  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);\n}"}}),this.blitVertexBuffer=this.createBuffer({usage:ve.VERTEX|ve.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:8,stepMode:ge.VERTEX,attributes:[{format:ke.F32_RG,offset:0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:de.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[ke.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:et(nt)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:e.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:e}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var r=this.createRenderPass({colorAttachment:[e],colorResolveTo:[t],colorClearColor:[Ze]}),i=this.getCanvas(),o=i.width,a=i.height;r.setPipeline(this.blitRenderPipeline),r.setBindings(this.blitBindings),r.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),r.setViewport(0,0,o,a),this.gl.disable(this.gl.BLEND),r.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),wn=function(){function e(e){this.pluginOptions=e}return e.prototype.createSwapChain=function(e){return J(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,l,c,h,f,p;return ee(this,(function(d){return t=this.pluginOptions,n=t.targets,r=t.xrCompatible,i=t.antialias,o=void 0!==i&&i,a=t.preserveDrawingBuffer,s=void 0!==a&&a,u=t.premultipliedAlpha,l=void 0===u||u,c=t.shaderDebug,h=t.trackResources,f={antialias:o,preserveDrawingBuffer:s,stencil:!0,premultipliedAlpha:l,xrCompatible:r},this.handleContextEvents(e),n.includes("webgl2")&&(p=e.getContext("webgl2",f)||e.getContext("experimental-webgl2",f)),!p&&n.includes("webgl1")&&(p=e.getContext("webgl",f)||e.getContext("experimental-webgl",f)),[2,new Cn(p,{shaderDebug:c,trackResources:h})]}))}))},e.prototype.handleContextEvents=function(e){var t=this.pluginOptions,n=t.onContextLost,r=t.onContextRestored,i=t.onContextCreationError;i&&e.addEventListener("webglcontextcreationerror",i,!1),n&&e.addEventListener("webglcontextlost",n,!1),r&&e.addEventListener("webglcontextrestored",r,!1)},e}(),Rn="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:function(){throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&Rn.decode();var Mn=null;function kn(){return null!==Mn&&0!==Mn.byteLength||(Mn=new Uint8Array(vn.memory.buffer)),Mn}function Ln(e,t){return e>>>=0,Rn.decode(kn().subarray(e,e+t))}var On=new Array(128).fill(void 0);On.push(void 0,null,!0,!1);var Pn=On.length;function In(e){return On[e]}function Nn(e){var t=In(e);return function(e){e<132||(On[e]=Pn,Pn=e)}(e),t}var Dn=0,Bn="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:function(){throw Error("TextEncoder not available")}},Fn="function"==typeof Bn.encodeInto?function(e,t){return Bn.encodeInto(e,t)}:function(e,t){var n=Bn.encode(e);return t.set(n),{read:e.length,written:n.length}};function Un(e,t,n){if(void 0===n){var r=Bn.encode(e),i=t(r.length,1)>>>0;return kn().subarray(i,i+r.length).set(r),Dn=r.length,i}for(var o=e.length,a=t(o,1)>>>0,s=kn(),u=0;u<o;u++){var l=e.charCodeAt(u);if(l>127)break;s[a+u]=l}if(u!==o){0!==u&&(e=e.slice(u)),a=n(a,o,o=u+3*e.length,1)>>>0;var c=kn().subarray(a+u,a+o);u+=Fn(e,c).written}return Dn=u,a}var zn=null;function Gn(){return null!==zn&&0!==zn.byteLength||(zn=new Int32Array(vn.memory.buffer)),zn}function jn(e,t,n){var r,i;try{var o=vn.__wbindgen_add_to_stack_pointer(-16),a=Un(e,vn.__wbindgen_malloc,vn.__wbindgen_realloc),s=Dn,u=Un(t,vn.__wbindgen_malloc,vn.__wbindgen_realloc),l=Dn;vn.glsl_compile(o,a,s,u,l,n);var c=Gn()[o/4+0],h=Gn()[o/4+1];return r=c,i=h,Ln(c,h)}finally{vn.__wbindgen_add_to_stack_pointer(16),vn.__wbindgen_free(r,i,1)}}var Vn,Hn,Wn=function(){function e(){p()(this,e);var t=vn.wgslcomposer_new();return e.__wrap(t)}return v()(e,[{key:"__destroy_into_raw",value:function(){var e=this.__wbg_ptr;return this.__wbg_ptr=0,e}},{key:"free",value:function(){var e=this.__destroy_into_raw();vn.__wbg_wgslcomposer_free(e)}},{key:"load_composable",value:function(e){var t=Un(e,vn.__wbindgen_malloc,vn.__wbindgen_realloc),n=Dn;vn.wgslcomposer_load_composable(this.__wbg_ptr,t,n)}},{key:"wgsl_compile",value:function(e){var t,n;try{var r=vn.__wbindgen_add_to_stack_pointer(-16),i=Un(e,vn.__wbindgen_malloc,vn.__wbindgen_realloc),o=Dn;vn.wgslcomposer_wgsl_compile(r,this.__wbg_ptr,i,o);var a=Gn()[r/4+0],s=Gn()[r/4+1];return t=a,n=s,Ln(a,s)}finally{vn.__wbindgen_add_to_stack_pointer(16),vn.__wbindgen_free(t,n,1)}}}],[{key:"__wrap",value:function(t){t>>>=0;var n=Object.create(e.prototype);return n.__wbg_ptr=t,n}}]),e}();function Zn(e,t){return Xn.apply(this,arguments)}function Xn(){return(Xn=h()(l()().mark((function e(t,n){var r,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("function"==typeof Response&&t instanceof Response)){e.next=23;break}if("function"!=typeof WebAssembly.instantiateStreaming){e.next=15;break}return e.prev=2,e.next=5,WebAssembly.instantiateStreaming(t,n);case 5:case 20:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e.catch(2),"application/wasm"==t.headers.get("Content-Type")){e.next=14;break}console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e.t0),e.next=15;break;case 14:throw e.t0;case 15:return e.next=17,t.arrayBuffer();case 17:return r=e.sent,e.next=20,WebAssembly.instantiate(r,n);case 23:return e.next=25,WebAssembly.instantiate(t,n);case 25:if(!((i=e.sent)instanceof WebAssembly.Instance)){e.next=30;break}return e.abrupt("return",{instance:i,module:t});case 30:return e.abrupt("return",i);case 31:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function Yn(){var e={wbg:{}};return e.wbg.__wbindgen_string_new=function(e,t){return function(e){Pn===On.length&&On.push(On.length+1);var t=Pn;return Pn=On[t],On[t]=e,t}(Ln(e,t))},e.wbg.__wbindgen_object_drop_ref=function(e){Nn(e)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(In(e))},e.wbg.__wbg_log_576ca876af0d4a77=function(e,t){console.log(In(e),In(t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(Ln(e,t))},e}function qn(e,t){return vn=e.exports,Kn.__wbindgen_wasm_module=t,zn=null,Mn=null,vn}function Kn(e){return Qn.apply(this,arguments)}function Qn(){return(Qn=h()(l()().mark((function e(t){var n,r,i,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===vn){e.next=2;break}return e.abrupt("return",vn);case 2:return n=Yn(),("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t)),e.t0=Zn,e.next=7,t;case 7:return e.t1=e.sent,e.t2=n,e.next=11,(0,e.t0)(e.t1,e.t2);case 11:return r=e.sent,i=r.instance,o=r.module,e.abrupt("return",qn(i,o));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $n(e){if(e===ke.U8_R_NORM)return"r8unorm";if(e===ke.S8_R_NORM)return"r8snorm";if(e===ke.U8_RG_NORM)return"rg8unorm";if(e===ke.S8_RG_NORM)return"rg8snorm";if(e===ke.U32_R)return"r32uint";if(e===ke.S32_R)return"r32sint";if(e===ke.F32_R)return"r32float";if(e===ke.U16_RG)return"rg16uint";if(e===ke.S16_RG)return"rg16sint";if(e===ke.F16_RG)return"rg16float";if(e===ke.U8_RGBA_RT)return"bgra8unorm";if(e===ke.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===ke.U8_RGBA_NORM)return"rgba8unorm";if(e===ke.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===ke.S8_RGBA_NORM)return"rgba8snorm";if(e===ke.U32_RG)return"rg32uint";if(e===ke.S32_RG)return"rg32sint";if(e===ke.F32_RG)return"rg32float";if(e===ke.U16_RGBA)return"rgba16uint";if(e===ke.S16_RGBA)return"rgba16sint";if(e===ke.F16_RGBA)return"rgba16float";if(e===ke.F32_RGBA)return"rgba32float";if(e===ke.U32_RGBA)return"rgba32uint";if(e===ke.S32_RGBA)return"rgba32sint";if(e===ke.D24)return"depth24plus";if(e===ke.D24_S8)return"depth24plus-stencil8";if(e===ke.D32F)return"depth32float";if(e===ke.D32F_S8)return"depth32float-stencil8";if(e===ke.BC1)return"bc1-rgba-unorm";if(e===ke.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===ke.BC2)return"bc2-rgba-unorm";if(e===ke.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===ke.BC3)return"bc3-rgba-unorm";if(e===ke.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===ke.BC4_SNORM)return"bc4-r-snorm";if(e===ke.BC4_UNORM)return"bc4-r-unorm";if(e===ke.BC5_SNORM)return"bc5-rg-snorm";if(e===ke.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function Jn(e){if(e===_e.TEXTURE_2D)return"2d";if(e===_e.TEXTURE_CUBE_MAP)return"cube";if(e===_e.TEXTURE_2D_ARRAY)return"2d-array";if(e===_e.TEXTURE_3D)return"3d";throw new Error("whoops")}function er(e){if(e===he.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===he.REPEAT)return"repeat";if(e===he.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function tr(e){if(e===fe.BILINEAR)return"linear";if(e===fe.POINT)return"nearest";throw new Error("whoops")}function nr(e){if(e===pe.LINEAR)return"linear";if(e===pe.NEAREST)return"nearest";if(e===pe.NO_MIP)return"nearest";throw new Error("whoops")}function rr(e){return e.gpuBuffer}function ir(e){if(e===Ce.OcclusionConservative)return"occlusion";throw new Error("whoops")}function or(e){switch(e){case de.TRIANGLES:return"triangle-list";case de.POINTS:return"point-list";case de.TRIANGLE_STRIP:return"triangle-strip";case de.LINES:return"line-list";case de.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function ar(e){if(e===ue.NONE)return"none";if(e===ue.FRONT)return"front";if(e===ue.BACK)return"back";throw new Error("whoops")}function sr(e){if(e===se.CCW)return"ccw";if(e===se.CW)return"cw";throw new Error("whoops")}function ur(e){if(e===le.ZERO)return"zero";if(e===le.ONE)return"one";if(e===le.SRC)return"src";if(e===le.ONE_MINUS_SRC)return"one-minus-src";if(e===le.DST)return"dst";if(e===le.ONE_MINUS_DST)return"one-minus-dst";if(e===le.SRC_ALPHA)return"src-alpha";if(e===le.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===le.DST_ALPHA)return"dst-alpha";if(e===le.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===le.CONST)return"constant";if(e===le.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===le.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function lr(e){if(e===ce.ADD)return"add";if(e===ce.SUBSTRACT)return"subtract";if(e===ce.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===ce.MIN)return"min";if(e===ce.MAX)return"max";throw new Error("whoops")}function cr(e){return{operation:lr(e.blendMode),srcFactor:ur(e.blendSrcFactor),dstFactor:ur(e.blendDstFactor)}}function hr(e){return e.blendMode===ce.ADD&&e.blendSrcFactor===le.ONE&&e.blendDstFactor===le.ZERO}function fr(e){return hr(e.rgbBlendState)&&hr(e.alphaBlendState)?void 0:{color:cr(e.rgbBlendState),alpha:cr(e.alphaBlendState)}}function pr(e,t){return t.attachmentsState.map((function(t,n){return function(e,t){return{format:$n(t),blend:fr(e),writeMask:e.channelWriteMask}}(t,e[n])}))}function dr(e){if(e===ae.NEVER)return"never";if(e===ae.LESS)return"less";if(e===ae.EQUAL)return"equal";if(e===ae.LEQUAL)return"less-equal";if(e===ae.GREATER)return"greater";if(e===ae.NOTEQUAL)return"not-equal";if(e===ae.GEQUAL)return"greater-equal";if(e===ae.ALWAYS)return"always";throw new Error("whoops")}function vr(e){if(e===Ee.KEEP)return"keep";if(e===Ee.REPLACE)return"replace";if(e===Ee.ZERO)return"zero";if(e===Ee.DECREMENT_CLAMP)return"decrement-clamp";if(e===Ee.DECREMENT_WRAP)return"decrement-wrap";if(e===Ee.INCREMENT_CLAMP)return"increment-clamp";if(e===Ee.INCREMENT_WRAP)return"increment-wrap";if(e===Ee.INVERT)return"invert";throw new Error("whoops")}function mr(e){if(e===ge.VERTEX)return"vertex";if(e===ge.INSTANCE)return"instance";throw new Error("whoops")}function gr(e){if(e===ke.U8_R)return"uint8x2";if(e===ke.U8_RG)return"uint8x2";if(e===ke.U8_RGB)return"uint8x4";if(e===ke.U8_RGBA)return"uint8x4";if(e===ke.U8_RG_NORM)return"unorm8x2";if(e===ke.U8_RGBA_NORM)return"unorm8x4";if(e===ke.S8_RGB_NORM)return"snorm8x4";if(e===ke.S8_RGBA_NORM)return"snorm8x4";if(e===ke.U16_RG_NORM)return"unorm16x2";if(e===ke.U16_RGBA_NORM)return"unorm16x4";if(e===ke.S16_RG_NORM)return"snorm16x2";if(e===ke.S16_RGBA_NORM)return"snorm16x4";if(e===ke.S16_RG)return"uint16x2";if(e===ke.F16_RG)return"float16x2";if(e===ke.F16_RGBA)return"float16x4";if(e===ke.F32_R)return"float32";if(e===ke.F32_RG)return"float32x2";if(e===ke.F32_RGB)return"float32x3";if(e===ke.F32_RGBA)return"float32x4";throw"whoops"}function yr(e,t,n,r){switch(void 0===n&&(n=!1),e){case ke.S8_R:case ke.S8_R_NORM:case ke.S8_RG_NORM:case ke.S8_RGB_NORM:case ke.S8_RGBA_NORM:var i=(ArrayBuffer,new Int8Array(t));return r&&i.set(new Int8Array(r)),i;case ke.U8_R:case ke.U8_R_NORM:case ke.U8_RG:case ke.U8_RG_NORM:case ke.U8_RGB:case ke.U8_RGB_NORM:case ke.U8_RGB_SRGB:case ke.U8_RGBA:case ke.U8_RGBA_NORM:case ke.U8_RGBA_SRGB:var o=(ArrayBuffer,new Uint8Array(t));return r&&o.set(new Uint8Array(r)),o;case ke.S16_R:case ke.S16_RG:case ke.S16_RG_NORM:case ke.S16_RGB_NORM:case ke.S16_RGBA:case ke.S16_RGBA_NORM:var a=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(n?t/2:t);return r&&a.set(new Int16Array(r)),a;case ke.U16_R:case ke.U16_RGB:case ke.U16_RGBA_5551:case ke.U16_RGBA_NORM:case ke.U16_RG_NORM:case ke.U16_R_NORM:var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(n?t/2:t);return r&&s.set(new Uint16Array(r)),s;case ke.S32_R:var u=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(n?t/4:t);return r&&u.set(new Int32Array(r)),u;case ke.U32_R:case ke.U32_RG:var l=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(n?t/4:t);return r&&l.set(new Uint32Array(r)),l;case ke.F32_R:case ke.F32_RG:case ke.F32_RGB:case ke.F32_RGBA:var c=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(n?t/4:t);return r&&c.set(new Float32Array(r)),c}var h=(ArrayBuffer,new Uint8Array(t));return r&&h.set(new Uint8Array(r)),h}function _r(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth16unorm":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":case"depth32float":default:return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8}}}!function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"}(Vn||(Vn={})),function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"}(Hn||(Hn={}));var br,xr=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this)||this;return i.id=n,i.device=r,i}return K(t,e),t.prototype.destroy=function(){},t}(Le),Er=function(e){function t(t){var n,r,i=t.id,o=t.device,a=t.descriptor,s=e.call(this,{id:i,device:o})||this;s.type=oe.Bindings;var u=a.pipeline;Ue(!!u);var l=a.uniformBufferBindings,c=a.storageBufferBindings,h=a.samplerBindings,f=a.storageTextureBindings;s.numUniformBuffers=(null==l?void 0:l.length)||0;var p=[[],[],[],[]],d=0;if(l&&l.length)for(var v=0;v<l.length;v++){var m=a.uniformBufferBindings[v],g=m.binding,y=m.size,_=m.offset,b={buffer:rr(m.buffer),offset:null!=_?_:0,size:y};p[0].push({binding:null!=g?g:d++,resource:b})}if(h&&h.length){d=0;for(v=0;v<h.length;v++){var x=Q(Q({},h[v]),it),E=null!==(g=a.samplerBindings[v]).texture?g.texture:s.device.getFallbackTexture(x);x.dimension=E.dimension,x.formatKind=Fe(E.format);var S=E.gpuTextureView;if(p[1].push({binding:null!==(n=g.textureBinding)&&void 0!==n?n:d++,resource:S}),-1!==g.samplerBinding){var A=null!==g.sampler?g.sampler:s.device.getFallbackSampler(x),T=A.gpuSampler;p[1].push({binding:null!==(r=g.samplerBinding)&&void 0!==r?r:d++,resource:T})}}}if(c&&c.length){d=0;for(v=0;v<c.length;v++){var C=a.storageBufferBindings[v];g=C.binding,y=C.size,_=C.offset,b={buffer:rr(C.buffer),offset:null!=_?_:0,size:y};p[2].push({binding:null!=g?g:d++,resource:b})}}if(f&&f.length){d=0;for(v=0;v<f.length;v++){var w=a.storageTextureBindings[v];g=w.binding,S=(E=w.texture).gpuTextureView;p[3].push({binding:null!=g?g:d++,resource:S})}}var R=p.findLastIndex((function(e){return!!e.length}));return s.gpuBindGroup=p.map((function(e,t){return t<=R&&s.device.device.createBindGroup({layout:u.getBindGroupLayout(t),entries:e})})),s}return K(t,e),t}(xr),Sr=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=oe.Buffer;var a=i.usage,s=i.viewOrSize,u=!!(a&ve.MAP_READ);o.usage=function(e){var t=0;return e&ve.INDEX&&(t|=GPUBufferUsage.INDEX),e&ve.VERTEX&&(t|=GPUBufferUsage.VERTEX),e&ve.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),e&ve.STORAGE&&(t|=GPUBufferUsage.STORAGE),e&ve.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),e&ve.INDIRECT&&(t|=GPUBufferUsage.INDIRECT),t|GPUBufferUsage.COPY_DST}(a),u&&(o.usage=ve.MAP_READ|ve.COPY_DST);var l=!X(s);(o.view=X(s)?null:s,o.size=X(s)?qe(s,4):qe(s.byteLength,4),X(s))?o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!!u&&l}):(o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!0}),new(s&&s.constructor||Float32Array)(o.gpuBuffer.getMappedRange()).set(s),o.gpuBuffer.unmap());return o}return K(t,e),t.prototype.setSubData=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=this.gpuBuffer;r=r||t.byteLength,r=Math.min(r,this.size-e);var o=t.byteOffset+n,a=o+r,s=r+3&-4;if(s!==r){var u=new Uint8Array(t.buffer.slice(o,a));(t=new Uint8Array(s)).set(u),n=0,o=0,a=s,r=s}for(var l=15728640,c=0;a-(o+c)>l;)this.device.device.queue.writeBuffer(i,e+c,t.buffer,o+c,l),c+=l;this.device.device.queue.writeBuffer(i,e+c,t.buffer,o+c,r-c)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(xr),Ar=function(){function e(){this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(e,t,n){this.gpuComputePassEncoder.dispatchWorkgroups(e,t,n)},e.prototype.dispatchWorkgroupsIndirect=function(e,t){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(e.gpuBuffer,t)},e.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},e.prototype.beginComputePass=function(e){Ue(null===this.gpuComputePassEncoder),this.frameCommandEncoder=e,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(e){var t=ze(e.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(t)},e.prototype.setBindings=function(e){var t=this,n=e;n.gpuBindGroup.forEach((function(e,r){e&&t.gpuComputePassEncoder.setBindGroup(r,n.gpuBindGroup[r])}))},e.prototype.pushDebugGroup=function(e){this.gpuComputePassEncoder.pushDebugGroup(e)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(e){this.gpuComputePassEncoder.insertDebugMarker(e)},e}(),Tr=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=oe.ComputePipeline,o.gpuComputePipeline=null,o.descriptor=i;var a=i.program.computeStage;if(null===a)return o;var s={layout:"auto",compute:Q({},a)};return o.gpuComputePipeline=o.device.device.createComputePipeline(s),void 0!==o.name&&(o.gpuComputePipeline.label=o.name),o}return K(t,e),t.prototype.getBindGroupLayout=function(e){return this.gpuComputePipeline.getBindGroupLayout(e)},t}(xr),Cr=function(e){function t(t){var n,r,i,o,a=t.id,s=t.device,u=t.descriptor,l=e.call(this,{id:a,device:s})||this;l.type=oe.InputLayout;var c=[];try{for(var h=te(u.vertexBufferDescriptors),f=h.next();!f.done;f=h.next()){var p=f.value,d=p.arrayStride,v=p.stepMode,m=p.attributes;c.push({arrayStride:d,stepMode:mr(v),attributes:[]});try{for(var g=(i=void 0,te(m)),y=g.next();!y.done;y=g.next()){var _=y.value,b=_.shaderLocation,x=_.format,E=_.offset;c[c.length-1].attributes.push({shaderLocation:b,format:gr(x),offset:E})}}catch(e){i={error:e}}finally{try{y&&!y.done&&(o=g.return)&&o.call(g)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}return l.indexFormat=function(e){if(null!==e){if(e===ke.U16_R)return"uint16";if(e===ke.U32_R)return"uint32";throw new Error("whoops")}}(u.indexBufferFormat),l.buffers=c,l}return K(t,e),t}(xr),wr=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;return o.type=oe.Program,o.vertexStage=null,o.fragmentStage=null,o.computeStage=null,o.descriptor=i,i.vertex&&(o.vertexStage=o.createShaderStage(i.vertex,"vertex")),i.fragment&&(o.fragmentStage=o.createShaderStage(i.fragment,"fragment")),i.compute&&(o.computeStage=o.createShaderStage(i.compute,"compute")),o}return K(t,e),t.prototype.setUniformsLegacy=function(e){},t.prototype.createShaderStage=function(e,t){var n,r,i=e.glsl,o=e.wgsl,a=e.entryPoint,s=e.postprocess,u=o;if(!u)try{u=this.device.glsl_compile(i,t,!1)}catch(e){throw console.error(e,i),new Error("whoops")}var l=function(e){if(!u.includes(e))return"continue";u=(u=u.replace("var T_".concat(e,": texture_2d<f32>;"),"var T_".concat(e,": texture_depth_2d;"))).replace(new RegExp("textureSample\\(T_".concat(e,"(.*)\\);$"),"gm"),(function(t,n){return"vec4<f32>(textureSample(T_".concat(e).concat(n,"), 0.0, 0.0, 0.0);")}))};try{for(var c=te(["u_TextureFramebufferDepth"]),h=c.next();!h.done;h=c.next()){l(h.value)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return s&&(u=s(u)),{module:this.device.device.createShaderModule({code:u}),entryPoint:a||"main"}},t}(xr),Rr=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=oe.QueryPool;var a=i.elemCount,s=i.type;return o.querySet=o.device.device.createQuerySet({type:ir(s),count:a}),o.resolveBuffer=o.device.device.createBuffer({size:8*a,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),o.cpuBuffer=o.device.device.createBuffer({size:8*a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o.results=null,o}return K(t,e),t.prototype.queryResultOcclusion=function(e){return null===this.results?null:this.results[e]!==BigInt(0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(xr),Mr=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=oe.Readback,i}return K(t,e),t.prototype.readTexture=function(e,t,n,r,i,o,a,s){return void 0===a&&(a=0),J(this,void 0,void 0,(function(){var s,u,l,c,h,f,p;return ee(this,(function(d){return 0,u=_r((s=e).gpuTextureformat),l=Math.ceil(r/u.width)*u.length,c=256*Math.ceil(l/256),h=c*i,f=this.device.createBuffer({usage:ve.STORAGE|ve.MAP_READ|ve.COPY_DST,hint:me.STATIC,viewOrSize:h}),(p=this.device.device.createCommandEncoder()).copyTextureToBuffer({texture:s.gpuTexture,mipLevel:0,origin:{x:t,y:n,z:Math.max(0,0)}},{buffer:f.gpuBuffer,offset:0,bytesPerRow:c},{width:r,height:i,depthOrArrayLayers:1}),this.device.device.queue.submit([p.finish()]),[2,this.readBuffer(f,0,o.byteLength===h?o:null,a,h,s.format,!0,!1,l,c,i)]}))}))},t.prototype.readTextureSync=function(e,t,n,r,i,o,a,s){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(e,t,n,r,i,o,a,s,u,l,c){var h=this;void 0===t&&(t=0),void 0===n&&(n=null),void 0===i&&(i=0),void 0===o&&(o=ke.U8_RGB),void 0===a&&(a=!1),void 0===u&&(u=0),void 0===l&&(l=0),void 0===c&&(c=0);var f=e,p=i||f.size,d=n||f.view,v=d&&d.constructor&&d.constructor.BYTES_PER_ELEMENT||Be(o),m=f;if(!(f.usage&ve.MAP_READ&&f.usage&ve.COPY_DST)){var g=this.device.device.createCommandEncoder();m=this.device.createBuffer({usage:ve.STORAGE|ve.MAP_READ|ve.COPY_DST,hint:me.STATIC,viewOrSize:p}),g.copyBufferToBuffer(f.gpuBuffer,t,m.gpuBuffer,0,p),this.device.device.queue.submit([g.finish()])}return new Promise((function(e,n){m.gpuBuffer.mapAsync(Hn.READ,t,p).then((function(){var n=m.gpuBuffer.getMappedRange(t,p),r=d;if(a)r=null===r?yr(o,p,!0,n):yr(o,r.buffer,void 0,n);else if(null===r)switch(v){case 1:(r=new Uint8Array(p)).set(new Uint8Array(n));break;case 2:r=h.getHalfFloatAsFloatRGBAArrayBuffer(p/2,n);break;case 4:(r=new Float32Array(p/4)).set(new Float32Array(n))}else switch(v){case 1:(r=new Uint8Array(r.buffer)).set(new Uint8Array(n));break;case 2:r=h.getHalfFloatAsFloatRGBAArrayBuffer(p/2,n,d);break;case 4:var i=d&&d.constructor||Float32Array;(r=new i(r.buffer)).set(new i(n))}if(u!==l){1!==v||a||(u*=2,l*=2);for(var s=new Uint8Array(r.buffer),f=u,g=0,y=1;y<c;++y){g=y*l;for(var _=0;_<u;++_)s[f++]=s[g++]}r=0===v||a?new Uint8Array(s.buffer,0,f):new Float32Array(s.buffer,0,f/4)}m.gpuBuffer.unmap(),e(r)}),(function(e){return n(e)}))}))},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(e,t,n){n||(n=new Float32Array(e));for(var r,i,o,a,s=new Uint16Array(t);e--;)n[e]=(r=s[e],i=void 0,o=void 0,a=void 0,i=(32768&r)>>15,a=1023&r,0===(o=(31744&r)>>10)?(i?-1:1)*Math.pow(2,-14)*(a/Math.pow(2,10)):31==o?a?NaN:1/0*(i?-1:1):(i?-1:1)*Math.pow(2,o-15)*(1+a/Math.pow(2,10)));return n},t}(xr),kr=function(){function e(e){this.device=e,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getEncoder=function(){var e;return(null===(e=this.renderBundle)||void 0===e?void 0:e.renderBundleEncoder)||this.gpuRenderPassEncoder},e.prototype.getTextureView=function(e,t){return Ue(t<e.mipLevelCount),1===e.mipLevelCount?e.gpuTextureView:e.gpuTexture.createView({baseMipLevel:t,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(e){var t,n,r,i,o,a;this.descriptor=e,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var s=e.colorAttachment.length;this.gfxColorAttachment.length=s,this.gfxColorResolveTo.length=s;for(var u=0;u<e.colorAttachment.length;u++){var l=e.colorAttachment[u],c=e.colorResolveTo[u];if(null===l&&null!==c&&(l=c,c=null),this.gfxColorAttachment[u]=l,this.gfxColorResolveTo[u]=c,this.gfxColorAttachmentLevel[u]=(null===(t=e.colorAttachmentLevel)||void 0===t?void 0:t[u])||0,this.gfxColorResolveToLevel[u]=(null===(n=e.colorResolveToLevel)||void 0===n?void 0:n[u])||0,null===l){this.gpuColorAttachments.length=u,this.gfxColorAttachment.length=u,this.gfxColorResolveTo.length=u;break}void 0===this.gpuColorAttachments[u]&&(this.gpuColorAttachments[u]={}),(f=this.gpuColorAttachments[u]).view=this.getTextureView(l,(null===(r=this.gfxColorAttachmentLevel)||void 0===r?void 0:r[u])||0);var h=null!==(o=null===(i=e.colorClearColor)||void 0===i?void 0:i[u])&&void 0!==o?o:"load";"load"===h?f.loadOp="load":(f.loadOp="clear",f.clearValue=h),f.storeOp=(null===(a=e.colorStore)||void 0===a?void 0:a[u])?"store":"discard",f.resolveTarget=void 0,null!==c&&(l.sampleCount>1?f.resolveTarget=this.getTextureView(c,this.gfxColorResolveToLevel[u]):f.storeOp="store")}if(this.gfxDepthStencilAttachment=e.depthStencilAttachment,this.gfxDepthStencilResolveTo=e.depthStencilResolveTo,e.depthStencilAttachment){var f,p=e.depthStencilAttachment;(f=this.gpuDepthStencilAttachment).view=p.gpuTextureView,!!(Ne(p.format)&Me.Depth)?("load"===e.depthClearValue?f.depthLoadOp="load":(f.depthLoadOp="clear",f.depthClearValue=e.depthClearValue),e.depthStencilStore||null!==this.gfxDepthStencilResolveTo?f.depthStoreOp="store":f.depthStoreOp="discard"):(f.depthLoadOp=void 0,f.depthStoreOp=void 0),!!(Ne(p.format)&Me.Stencil)?("load"===e.stencilClearValue?f.stencilLoadOp="load":(f.stencilLoadOp="clear",f.stencilClearValue=e.stencilClearValue),e.depthStencilStore||null!==this.gfxDepthStencilResolveTo?f.stencilStoreOp="store":f.stencilStoreOp="discard"):(f.stencilLoadOp=void 0,f.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=H(e.occlusionQueryPool)?void 0:e.occlusionQueryPool.querySet},e.prototype.beginRenderPass=function(e,t){Ue(null===this.gpuRenderPassEncoder),this.setRenderPassDescriptor(t),this.frameCommandEncoder=e,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(e,t){return this.device.swapChainHeight-e-t},e.prototype.setViewport=function(e,t,n,r,i,o){void 0===i&&(i=0),void 0===o&&(o=1),this.gpuRenderPassEncoder.setViewport(e,this.flipY(t,r),n,r,i,o)},e.prototype.setScissorRect=function(e,t,n,r){this.gpuRenderPassEncoder.setScissorRect(e,this.flipY(t,r),n,r)},e.prototype.setPipeline=function(e){var t=ze(e.gpuRenderPipeline);this.getEncoder().setPipeline(t)},e.prototype.setVertexInput=function(e,t,n){if(null!==e){var r=this.getEncoder(),i=e;null!==n&&r.setIndexBuffer(rr(n.buffer),ze(i.indexFormat),n.offset);for(var o=0;o<t.length;o++){var a=t[o];null!==a&&r.setVertexBuffer(o,rr(a.buffer),a.offset)}}},e.prototype.setBindings=function(e){var t=e,n=this.getEncoder();t.gpuBindGroup.forEach((function(e,r){e&&n.setBindGroup(r,t.gpuBindGroup[r])}))},e.prototype.setStencilReference=function(e){this.gpuRenderPassEncoder.setStencilReference(e)},e.prototype.draw=function(e,t,n,r){this.getEncoder().draw(e,t,n,r)},e.prototype.drawIndexed=function(e,t,n,r,i){this.getEncoder().drawIndexed(e,t,n,r,i)},e.prototype.drawIndirect=function(e,t){this.getEncoder().drawIndirect(rr(e),t)},e.prototype.drawIndexedIndirect=function(e,t){this.getEncoder().drawIndexedIndirect(rr(e),t)},e.prototype.beginOcclusionQuery=function(e){this.gpuRenderPassEncoder.beginOcclusionQuery(e)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(e){this.gpuRenderPassEncoder.pushDebugGroup(e)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(e){this.gpuRenderPassEncoder.insertDebugMarker(e)},e.prototype.beginBundle=function(e){this.renderBundle=e},e.prototype.endBundle=function(){this.renderBundle.finish()},e.prototype.executeBundles=function(e){this.gpuRenderPassEncoder.executeBundles(e.map((function(e){return e.renderBundle})))},e.prototype.finish=function(){var e;null===(e=this.gpuRenderPassEncoder)||void 0===e||e.end(),this.gpuRenderPassEncoder=null;for(var t=0;t<this.gfxColorAttachment.length;t++){var n=this.gfxColorAttachment[t],r=this.gfxColorResolveTo[t];null!==n&&null!==r&&1===n.sampleCount&&this.copyAttachment(r,this.gfxColorAttachmentLevel[t],n,this.gfxColorResolveToLevel[t])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},e.prototype.copyAttachment=function(e,t,n,r){Ue(1===n.sampleCount);var i={texture:n.gpuTexture,mipLevel:r},o={texture:e.gpuTexture,mipLevel:t};Ue(n.width>>>r==e.width>>>t),Ue(n.height>>>r==e.height>>>t),Ue(!!(n.usage&Vn.COPY_SRC)),Ue(!!(e.usage&Vn.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(i,o,[e.width,e.height,1])},e}(),Lr=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;return o.type=oe.RenderPipeline,o.isCreatingAsync=!1,o.gpuRenderPipeline=null,o.descriptor=i,o.device.createRenderPipelineInternal(o,!1),o}return K(t,e),t.prototype.getBindGroupLayout=function(e){return this.gpuRenderPipeline.getBindGroupLayout(e)},t}(xr),Or=function(e){function t(t){var n,r,i=t.id,o=t.device,a=t.descriptor,s=e.call(this,{id:i,device:o})||this;s.type=oe.Sampler;var u=a.lodMinClamp,l=a.mipmapFilter===pe.NO_MIP?a.lodMinClamp:a.lodMaxClamp,c=null!==(n=a.maxAnisotropy)&&void 0!==n?n:1;return c>1&&Ue(a.minFilter===fe.BILINEAR&&a.magFilter===fe.BILINEAR&&a.mipmapFilter===pe.LINEAR),s.gpuSampler=s.device.device.createSampler({addressModeU:er(a.addressModeU),addressModeV:er(a.addressModeV),addressModeW:er(null!==(r=a.addressModeW)&&void 0!==r?r:a.addressModeU),lodMinClamp:u,lodMaxClamp:l,minFilter:tr(a.minFilter),magFilter:tr(a.magFilter),mipmapFilter:nr(a.mipmapFilter),compare:void 0!==a.compareFunction?dr(a.compareFunction):void 0,maxAnisotropy:c}),s}return K(t,e),t}(xr),Pr=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=t.skipCreate,a=t.sampleCount,s=e.call(this,{id:n,device:r})||this;s.type=oe.Texture,s.flipY=!1;var u=i.format,l=i.dimension,c=i.width,h=i.height,f=i.depthOrArrayLayers,p=i.mipLevelCount,d=i.usage,v=i.pixelStore;return s.flipY=!!(null==v?void 0:v.unpackFlipY),s.device.createTextureShared({format:u,dimension:null!=l?l:_e.TEXTURE_2D,width:c,height:h,depthOrArrayLayers:null!=f?f:1,mipLevelCount:null!=p?p:1,usage:d,sampleCount:null!=a?a:1},s,o),s}return K(t,e),t.prototype.textureFromImageBitmapOrCanvas=function(e,t,n){for(var r=t[0].width,i=t[0].height,o={size:{width:r,height:i,depthOrArrayLayers:n},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},a=e.createTexture(o),s=0;s<t.length;s++)e.queue.copyExternalImageToTexture({source:t[s],flipY:this.flipY},{texture:a,origin:[0,0,s]},[r,i]);return[a,r,i]},t.prototype.isImageBitmapOrCanvases=function(e){var t=e[0];return t instanceof ImageBitmap||t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas},t.prototype.isVideo=function(e){return e[0]instanceof HTMLVideoElement},t.prototype.setImageData=function(e,t){var n,r,i,o,a=this,s=this.device.device;if(this.isImageBitmapOrCanvases(e))r=(n=ne(this.textureFromImageBitmapOrCanvas(s,e,this.depthOrArrayLayers),3))[0],i=n[1],o=n[2];else if(this.isVideo(e))r=s.importExternalTexture({source:e[0]});else{var u=_r(this.gpuTextureformat),l=Math.ceil(this.width/u.width)*u.length;e.forEach((function(e){s.queue.writeTexture({texture:a.gpuTexture},e,{bytesPerRow:l},{width:a.width,height:a.height})}))}this.width=i,this.height=o,r&&(this.gpuTexture=r),this.gpuTextureView=this.gpuTexture.createView({dimension:Jn(this.dimension)})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(xr),Ir=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=oe.RenderBundle,i.renderBundleEncoder=i.device.device.createRenderBundleEncoder({colorFormats:[i.device.swapChainFormat]}),i}return K(t,e),t.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},t}(xr),Nr=function(){function e(e,t,n,r,i,o){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=Vn.RENDER_ATTACHMENT|Vn.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=Ae.UPPER_LEFT,this.clipSpaceNearZ=Te.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=t,this.canvas=n,this.canvasContext=r,this.glsl_compile=i,this.WGSLComposer=o,this.fallbackTexture2D=this.createFallbackTexture(_e.TEXTURE_2D,Se.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(_e.TEXTURE_2D,Se.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(_e.TEXTURE_2D_ARRAY,Se.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(_e.TEXTURE_3D,Se.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(_e.TEXTURE_CUBE_MAP,Se.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:he.REPEAT,addressModeV:he.REPEAT,minFilter:fe.POINT,magFilter:fe.POINT,mipmapFilter:pe.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:he.REPEAT,addressModeV:he.REPEAT,minFilter:fe.POINT,magFilter:fe.POINT,mipmapFilter:pe.NEAREST,compareFunction:ae.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(e){console.error(e.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(e,t){this.swapChainWidth===e&&this.swapChainHeight===t||(this.swapChainWidth=e,this.swapChainHeight=t)},e.prototype.getOnscreenTexture=function(){var e=this.canvasContext.getCurrentTexture(),t=e.createView(),n=new Pr({id:0,device:this,descriptor:{format:ke.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:_e.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=e,n.gpuTextureView=t,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){Ue(0===this.frameCommandEncoderPool.length)},e.prototype.endFrame=function(){Ue(this.frameCommandEncoderPool.every((function(e){return null!==e}))),this.device.queue.submit(this.frameCommandEncoderPool.map((function(e){return e.finish()}))),this.frameCommandEncoderPool=[]},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(e){return new Sr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTexture=function(e){return new Pr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createSampler=function(e){return new Or({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTarget=function(e){var t=new Pr({id:this.getNextUniqueId(),device:this,descriptor:Q(Q({},e),{dimension:_e.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:be.RENDER_TARGET}),sampleCount:e.sampleCount});return t.depthOrArrayLayers=1,t.type=oe.RenderTarget,t},e.prototype.createRenderTargetFromTexture=function(e){var t=e,n=t.format,r=t.width,i=t.height,o=t.depthOrArrayLayers,a=t.sampleCount,s=t.mipLevelCount,u=t.gpuTexture,l=t.gpuTextureView,c=t.usage;Ue(!!(c&Vn.RENDER_ATTACHMENT));var h=new Pr({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:r,height:i,depthOrArrayLayers:o,dimension:_e.TEXTURE_2D,mipLevelCount:s,usage:c},skipCreate:!0});return h.depthOrArrayLayers=o,h.sampleCount=a,h.gpuTexture=u,h.gpuTextureView=l,h},e.prototype.createProgram=function(e){var t,n;return(null===(t=e.vertex)||void 0===t?void 0:t.glsl)&&(e.vertex.glsl=Wt(this.queryVendorInfo(),"vert",e.vertex.glsl)),(null===(n=e.fragment)||void 0===n?void 0:n.glsl)&&(e.fragment.glsl=Wt(this.queryVendorInfo(),"frag",e.fragment.glsl)),new wr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createProgramSimple=function(e){return new wr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTextureShared=function(e,t,n){var r={width:e.width,height:e.height,depthOrArrayLayers:e.depthOrArrayLayers},i=e.mipLevelCount,o=$n(e.format),a=function(e){if(e===_e.TEXTURE_2D)return"2d";if(e===_e.TEXTURE_CUBE_MAP)return"2d";if(e===_e.TEXTURE_2D_ARRAY)return"2d";if(e===_e.TEXTURE_3D)return"3d";throw new Error("whoops")}(e.dimension),s=function(e){var t=0;return e&be.SAMPLED&&(t|=Vn.TEXTURE_BINDING|Vn.COPY_DST|Vn.COPY_SRC),e&be.STORAGE&&(t|=Vn.TEXTURE_BINDING|Vn.STORAGE_BINDING|Vn.COPY_SRC|Vn.COPY_DST),e&be.RENDER_TARGET&&(t|=Vn.RENDER_ATTACHMENT|Vn.TEXTURE_BINDING|Vn.COPY_SRC|Vn.COPY_DST),t}(e.usage);if(t.gpuTextureformat=o,t.dimension=e.dimension,t.format=e.format,t.width=e.width,t.height=e.height,t.depthOrArrayLayers=e.depthOrArrayLayers,t.mipLevelCount=i,t.usage=s,t.sampleCount=e.sampleCount,!n){var u=this.device.createTexture({size:r,mipLevelCount:i,format:o,dimension:a,sampleCount:e.sampleCount,usage:s}),l=u.createView();t.gpuTexture=u,t.gpuTextureView=l}},e.prototype.getFallbackSampler=function(e){return e.formatKind===Se.Depth&&e.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(e){var t=e.dimension,n=e.formatKind;if(t===_e.TEXTURE_2D)return n===Se.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===_e.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===_e.TEXTURE_3D)return this.fallbackTexture3D;if(t===_e.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(e,t){var n=e===_e.TEXTURE_CUBE_MAP?6:1,r=t===Se.Float?ke.U8_RGBA_NORM:ke.D24;return this.createTexture({dimension:e,format:r,usage:be.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(e){return new Er({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createInputLayout=function(e){return new Cr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createComputePipeline=function(e){return new Tr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderPipeline=function(e){return new Lr({id:this.getNextUniqueId(),device:this,descriptor:Q({},e)})},e.prototype.createQueryPool=function(e,t){return new Rr({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})},e.prototype.createRenderPipelineInternal=function(e,t){var n;if(null===e.gpuRenderPipeline){var r=e.descriptor,i=r.program,o=i.vertexStage,a=i.fragmentStage;if(null!==o&&null!==a){var s=r.megaStateDescriptor||{},u=s.stencilBack,l=s.stencilFront,c=$(s,["stencilBack","stencilFront"]),h=et(nt);r.megaStateDescriptor=Q(Q(Q({},h),{stencilBack:Q(Q({},h.stencilBack),u),stencilFront:Q(Q({},h.stencilFront),l)}),c);var f=r.megaStateDescriptor.attachmentsState[0];r.colorAttachmentFormats.forEach((function(e,t){r.megaStateDescriptor.attachmentsState[t]||(r.megaStateDescriptor.attachmentsState[t]=$e(void 0,f))}));var p,d,v=(p=null!==(n=r.topology)&&void 0!==n?n:de.TRIANGLES,d=r.megaStateDescriptor,{topology:or(p),cullMode:ar(d.cullMode),frontFace:sr(d.frontFace)}),m=pr(r.colorAttachmentFormats,r.megaStateDescriptor),g=function(e,t){if(!H(e))return{format:$n(e),depthWriteEnabled:!!t.depthWrite,depthCompare:dr(t.depthCompare),depthBias:t.polygonOffset?1:0,depthBiasSlopeScale:t.polygonOffset?1:0,stencilFront:{compare:dr(t.stencilFront.compare),passOp:vr(t.stencilFront.passOp),failOp:vr(t.stencilFront.failOp),depthFailOp:vr(t.stencilFront.depthFailOp)},stencilBack:{compare:dr(t.stencilBack.compare),passOp:vr(t.stencilBack.passOp),failOp:vr(t.stencilBack.failOp),depthFailOp:vr(t.stencilBack.depthFailOp)},stencilReadMask:4294967295,stencilWriteMask:4294967295}}(r.depthStencilAttachmentFormat,r.megaStateDescriptor),y=void 0;null!==r.inputLayout&&(y=r.inputLayout.buffers);var _=r.sampleCount,b={layout:"auto",vertex:Q(Q({},o),{buffers:y}),primitive:v,depthStencil:g,multisample:{count:_},fragment:Q(Q({},a),{targets:m})};e.gpuRenderPipeline=this.device.createRenderPipeline(b)}}},e.prototype.createReadback=function(){return new Mr({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderBundle=function(){return new Ir({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(e){var t=this.renderPassPool.pop();void 0===t&&(t=new kr(this));var n=this.frameCommandEncoderPool.pop();return void 0===n&&(n=this.device.createCommandEncoder()),t.beginRenderPass(n,e),t},e.prototype.createComputePass=function(){var e=this.computePassPool.pop();void 0===e&&(e=new Ar);var t=this.frameCommandEncoderPool.pop();return void 0===t&&(t=this.device.createCommandEncoder()),e.beginComputePass(t),e},e.prototype.submitPass=function(e){var t=e;t instanceof kr?(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.renderPassPool.push(t)):t instanceof Ar&&(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.computePassPool.push(t))},e.prototype.copySubTexture2D=function(e,t,n,r,i,o,a){var s=this.device.createCommandEncoder(),u=e,l=r,c={texture:l.gpuTexture,origin:[i,o,0],mipLevel:0,aspect:"all"},h={texture:u.gpuTexture,origin:[t,n,0],mipLevel:0,aspect:"all"};Ue(!!(l.usage&Vn.COPY_SRC)),Ue(!!(u.usage&Vn.COPY_DST)),s.copyTextureToTexture(c,h,[l.width,l.height,a||1]),this.device.queue.submit([s.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(e,t,n){if(function(e){switch(Ie(e)){case we.BC1:case we.BC2:case we.BC3:case we.BC4_SNORM:case we.BC4_UNORM:case we.BC5_SNORM:case we.BC5_UNORM:return!0;default:return!1}}(e)){if(!this.featureTextureCompressionBC)return!1;var r=function(e){switch(Ie(e)){case we.BC1:case we.BC2:case we.BC3:case we.BC4_SNORM:case we.BC4_UNORM:case we.BC5_SNORM:case we.BC5_UNORM:return 4;default:return 1}}(e);return t%r==0&&n%r==0&&this.featureTextureCompressionBC}switch(e){case ke.U16_RGBA_NORM:case ke.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(e){return e.descriptor},e.prototype.queryRenderTarget=function(e){return e},e.prototype.setResourceName=function(e,t){if(e.name=t,e.type===oe.Buffer)(n=e).gpuBuffer.label=t;else if(e.type===oe.Texture){(n=e).gpuTexture.label=t,n.gpuTextureView.label=t}else if(e.type===oe.RenderTarget){(n=e).gpuTexture.label=t,n.gpuTextureView.label=t}else if(e.type===oe.Sampler){(n=e).gpuSampler.label=t}else if(e.type===oe.RenderPipeline){var n;null!==(n=e).gpuRenderPipeline&&(n.gpuRenderPipeline.label=t)}},e.prototype.setResourceLeakCheck=function(e,t){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(e){},e.prototype.pipelineQueryReady=function(e){return null!==e.gpuRenderPipeline},e.prototype.pipelineForceReady=function(e){var t=e;this.createRenderPipelineInternal(t,!1)},e}(),Dr=function(){function e(e){this.pluginOptions=e}return e.prototype.createSwapChain=function(e){return J(this,void 0,void 0,(function(){var t,n,r,i,o,a,s;return ee(this,(function(u){switch(u.label){case 0:if(void 0===globalThis.navigator.gpu)return[2,null];t=null,u.label=1;case 1:return u.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return t=u.sent(),[3,4];case 3:return r=u.sent(),console.log(r),[3,4];case 4:return null===t?[2,null]:(i=["depth32float-stencil8","texture-compression-bc","float32-filterable"].filter((function(e){return t.features.has(e)})),[4,t.requestDevice({requiredFeatures:i})]);case 5:if((o=u.sent())&&(a=this.pluginOptions.onContextLost,o.lost.then((function(){a&&a()}))),null===o)return[2,null];if(!(s=e.getContext("webgpu")))return[2,null];u.label=6;case 6:return u.trys.push([6,8,,9]),[4,Kn(this.pluginOptions.shaderCompilerPath)];case 7:case 8:return u.sent(),[3,9];case 9:return[2,new Nr(t,o,e,s,jn,Wn&&new Wn)]}}))}))},e}(),Br=n(6490),Fr=Br.rU.isPlainObject,Ur=Br.rU.isTypedArray,zr=function(){function e(t,n){p()(this,e),g()(this,"reGl",void 0),g()(this,"destroyed",!1),g()(this,"drawCommand",void 0),g()(this,"drawParams",void 0),g()(this,"options",void 0),g()(this,"uniforms",{}),this.reGl=t;var r=n.vs,i=n.fs,o=n.attributes,a=n.uniforms,s=n.primitive,u=n.count,l=n.elements,c=n.depth,h=n.cull,f=n.instances,d={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:Ae.LOWER_LEFT,clipSpaceNearZ:Te.NEGATIVE_ONE,supportMRT:!1},v={};this.options=n,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach((function(e){v[e]=t.prop(e)})));var m={};Object.keys(o).forEach((function(e){m[e]=o[e].get()}));var y=(0,_.removeDuplicateUniforms)(Wt(d,"frag",i,null,!1)),b=(0,_.removeDuplicateUniforms)(Wt(d,"vert",r,null,!1)),x={attributes:m,frag:y,uniforms:v,vert:b,colorMask:t.prop("colorMask"),lineWidth:1,blend:{enable:t.prop("blend.enable"),func:t.prop("blend.func"),equation:t.prop("blend.equation"),color:t.prop("blend.color")},stencil:{enable:t.prop("stencil.enable"),mask:t.prop("stencil.mask"),func:t.prop("stencil.func"),opFront:t.prop("stencil.opFront"),opBack:t.prop("stencil.opBack")},primitive:T[void 0===s?_.gl.TRIANGLES:s]};f&&(x.instances=f),u?x.count=u:l&&(x.elements=l.get()),this.initDepthDrawParams({depth:c},x),this.initCullDrawParams({cull:h},x),this.drawCommand=t(x),this.drawParams=x}return v()(e,[{key:"updateAttributesAndElements",value:function(e,t){var n={};Object.keys(e).forEach((function(t){n[t]=e[t].get()})),this.drawParams.attributes=n,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(e){var t={};Object.keys(e).forEach((function(n){t[n]=e[n].get()})),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(e){this.uniforms=o()(o()({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e,t){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=o()(o()({},this.uniforms),this.extractUniforms(e.uniforms||{})),r={};Object.keys(n).forEach((function(e){var t=V()(n[e]);"boolean"===t||"number"===t||Array.isArray(n[e])||n[e].BYTES_PER_ELEMENT?r[e]=n[e]:r[e]=n[e].get()})),r.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(e),r.stencil=this.getStencilDrawParams(e),r.colorMask=this.getColorMaskDrawParams(e,t),this.drawCommand(r)}}},{key:"destroy",value:function(){var e;null===(e=this.drawParams)||void 0===e||null===(e=e.elements)||void 0===e||e.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(e){null==e||e.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(e,t){var n=e.depth;n&&(t.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:P[n.func||_.gl.LESS],range:n.range||[0,1]})}},{key:"getBlendDrawParams",value:function(e){var t=e.blend||{},n=t.enable,r=t.func,i=t.equation,o=t.color,a=void 0===o?[0,0,0,0]:o;return{enable:!!n,func:{srcRGB:N[r&&r.srcRGB||_.gl.SRC_ALPHA],srcAlpha:N[r&&r.srcAlpha||_.gl.SRC_ALPHA],dstRGB:N[r&&r.dstRGB||_.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:N[r&&r.dstAlpha||_.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:I[i&&i.rgb||_.gl.FUNC_ADD],alpha:I[i&&i.alpha||_.gl.FUNC_ADD]},color:a}}},{key:"getStencilDrawParams",value:function(e){var t=e.stencil||{},n=t.enable,r=t.mask,i=void 0===r?-1:r,a=t.func,s=void 0===a?{cmp:_.gl.ALWAYS,ref:0,mask:-1}:a,u=t.opFront,l=void 0===u?{fail:_.gl.KEEP,zfail:_.gl.KEEP,zpass:_.gl.KEEP}:u,c=t.opBack,h=void 0===c?{fail:_.gl.KEEP,zfail:_.gl.KEEP,zpass:_.gl.KEEP}:c;return{enable:!!n,mask:i,func:o()(o()({},s),{},{cmp:D[s.cmp]}),opFront:{fail:B[l.fail],zfail:B[l.zfail],zpass:B[l.zpass]},opBack:{fail:B[h.fail],zfail:B[h.zfail],zpass:B[h.zpass]}}}},{key:"getColorMaskDrawParams",value:function(e,t){var n=e.stencil;return null!=n&&n.enable&&n.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0]}},{key:"initCullDrawParams",value:function(e,t){var n=e.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?_.gl.BACK:i;t.cull={enable:!!r,face:F[o]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||Ur(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:(Fr(t)&&Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,o){Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e,"[").concat(o,"]"))}))})))}}]),e}(),Gr=function(){function e(t,n){p()(this,e),g()(this,"texture",void 0),g()(this,"width",void 0),g()(this,"height",void 0),g()(this,"isDestroy",!1);var r=n.data,i=n.type,o=void 0===i?_.gl.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,l=void 0!==u&&u,c=n.format,h=void 0===c?_.gl.RGBA:c,f=n.mipmap,d=void 0!==f&&f,v=n.wrapS,m=void 0===v?_.gl.CLAMP_TO_EDGE:v,y=n.wrapT,b=void 0===y?_.gl.CLAMP_TO_EDGE:y,x=n.aniso,E=void 0===x?0:x,S=n.alignment,A=void 0===S?1:S,T=n.premultiplyAlpha,C=void 0!==T&&T,P=n.mag,I=void 0===P?_.gl.NEAREST:P,N=n.min,D=void 0===N?_.gl.NEAREST:N,B=n.colorSpace,F=void 0===B?_.gl.BROWSER_DEFAULT_WEBGL:B,U=n.x,z=void 0===U?0:U,G=n.y,j=void 0===G?0:G,V=n.copy,H=void 0!==V&&V;this.width=a,this.height=s;var W={width:a,height:s,type:w[o],format:R[h],wrapS:L[m],wrapT:L[b],mag:k[I],min:k[D],alignment:A,flipY:l,colorSpace:O[F],premultiplyAlpha:C,aniso:E,x:z,y:j,copy:H};r&&(W.data=r),"number"==typeof d?W.mipmap=M[d]:"boolean"==typeof d&&(W.mipmap=d),this.texture=t.texture(W)}return v()(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(e)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.texture.resize(t,n),this.width=t,this.height=n}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){var e;this.isDestroy||(null===(e=this.texture)||void 0===e||e.destroy());this.isDestroy=!0}}]),e}(),jr=function(){function e(){var t=this;p()(this,e),g()(this,"uniformBuffers",[]),g()(this,"extensionObject",void 0),g()(this,"gl",void 0),g()(this,"$container",void 0),g()(this,"canvas",void 0),g()(this,"width",void 0),g()(this,"height",void 0),g()(this,"isDirty",void 0),g()(this,"queryVerdorInfo",(function(){return"WebGL1"})),g()(this,"createModel",(function(e){return new zr(t.gl,e)})),g()(this,"createAttribute",(function(e){return new A(t.gl,e)})),g()(this,"createBuffer",(function(e){return new U(t.gl,e)})),g()(this,"createElements",(function(e){return new z(t.gl,e)})),g()(this,"createTexture2D",(function(e){return new Gr(t.gl,e)})),g()(this,"createFramebuffer",(function(e){return new G(t.gl,e)})),g()(this,"useFramebuffer",(function(e,n){t.gl({framebuffer:e?e.get():null})(n)})),g()(this,"useFramebufferAsync",function(){var e=h()(l()().mark((function e(n,r){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.gl({framebuffer:n?n.get():null})(r);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),g()(this,"clear",(function(e){var n,r=e.color,i=e.depth,o=e.stencil,a=e.framebuffer,s=void 0===a?null:a,u={color:r,depth:i,stencil:o};u.framebuffer=null===s?s:s.get(),null===(n=t.gl)||void 0===n||n.clear(u)})),g()(this,"viewport",(function(e){var n=e.x,r=e.y,i=e.width,o=e.height;t.gl._gl.viewport(n,r,i,o),t.width=i,t.height=o,t.gl._refresh()})),g()(this,"readPixels",(function(e){var n=e.framebuffer,r={x:e.x,y:e.y,width:e.width,height:e.height};return n&&(r.framebuffer=n.get()),t.gl.read(r)})),g()(this,"readPixelsAsync",function(){var e=h()(l()().mark((function e(n){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.readPixels(n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),g()(this,"getViewportSize",(function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}})),g()(this,"getContainer",(function(){var e;return null===(e=t.canvas)||void 0===e?void 0:e.parentElement})),g()(this,"getCanvas",(function(){return t.canvas})),g()(this,"getGLContext",(function(){return t.gl._gl})),g()(this,"destroy",(function(){var e;t.canvas=null,null===(e=t.gl)||void 0===e||null===(e=e._gl)||void 0===e||null===(e=e.getExtension("WEBGL_lose_context"))||void 0===e||e.loseContext(),t.gl.destroy(),t.gl=null}))}var t;return v()(e,[{key:"init",value:(t=h()(l()().mark((function e(t,n,r){var i=this;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canvas=t,!r){e.next=5;break}this.gl=r,e.next=8;break;case 5:return e.next=7,new Promise((function(e,t){S()({canvas:i.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(n,r){!n&&r||t(n),e(r)}})}));case 7:this.gl=e.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(e){return!!this.getGLContext().getExtension(e)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var e=this.getGLContext();e.disable(e.CULL_FACE)}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}(),Vr=function(){function e(t,n){p()(this,e),g()(this,"attribute",void 0),g()(this,"buffer",void 0);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor,l=n.shaderLocation;this.buffer=r,this.attribute={shaderLocation:l,buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return v()(e,[{key:"get",value:function(){return this.buffer}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Hr=g()(g()(g()(g()(g()(g()({},_.gl.FLOAT,Float32Array),_.gl.UNSIGNED_BYTE,Uint8Array),_.gl.SHORT,Int16Array),_.gl.UNSIGNED_SHORT,Uint16Array),_.gl.INT,Int32Array),_.gl.UNSIGNED_INT,Uint32Array),Wr=g()(g()(g()(g()(g()(g()(g()({},_.gl.POINTS,de.POINTS),_.gl.LINES,de.LINES),_.gl.LINE_LOOP,de.LINES),_.gl.LINE_STRIP,de.LINE_STRIP),_.gl.TRIANGLES,de.TRIANGLES),_.gl.TRIANGLE_FAN,de.TRIANGLES),_.gl.TRIANGLE_STRIP,de.TRIANGLE_STRIP),Zr=g()(g()(g()(g()({},1,ke.F32_R),2,ke.F32_RG),3,ke.F32_RGB),4,ke.F32_RGBA),Xr=g()(g()(g()({},_.gl.STATIC_DRAW,me.STATIC),_.gl.DYNAMIC_DRAW,me.DYNAMIC),_.gl.STREAM_DRAW,me.DYNAMIC),Yr=g()(g()(g()({},_.gl.REPEAT,he.REPEAT),_.gl.CLAMP_TO_EDGE,he.CLAMP_TO_EDGE),_.gl.MIRRORED_REPEAT,he.MIRRORED_REPEAT),qr=g()(g()(g()(g()(g()(g()(g()(g()({},_.gl.NEVER,ae.NEVER),_.gl.ALWAYS,ae.ALWAYS),_.gl.LESS,ae.LESS),_.gl.LEQUAL,ae.LEQUAL),_.gl.GREATER,ae.GREATER),_.gl.GEQUAL,ae.GEQUAL),_.gl.EQUAL,ae.EQUAL),_.gl.NOTEQUAL,ae.NOTEQUAL),Kr=g()(g()({},_.gl.FRONT,ue.FRONT),_.gl.BACK,ue.BACK),Qr=g()(g()(g()(g()(g()({},_.gl.FUNC_ADD,ce.ADD),_.gl.MIN_EXT,ce.MIN),_.gl.MAX_EXT,ce.MAX),_.gl.FUNC_SUBTRACT,ce.SUBSTRACT),_.gl.FUNC_REVERSE_SUBTRACT,ce.REVERSE_SUBSTRACT),$r=(br={},g()(g()(g()(g()(g()(g()(g()(g()(g()(g()(br,_.gl.ZERO,le.ZERO),_.gl.ONE,le.ONE),_.gl.SRC_COLOR,le.SRC),_.gl.ONE_MINUS_SRC_COLOR,le.ONE_MINUS_SRC),_.gl.SRC_ALPHA,le.SRC_ALPHA),_.gl.ONE_MINUS_SRC_ALPHA,le.ONE_MINUS_SRC_ALPHA),_.gl.DST_COLOR,le.DST),_.gl.ONE_MINUS_DST_COLOR,le.ONE_MINUS_DST),_.gl.DST_ALPHA,le.DST_ALPHA),_.gl.ONE_MINUS_DST_ALPHA,le.ONE_MINUS_DST_ALPHA),g()(g()(g()(g()(g()(br,_.gl.CONSTANT_COLOR,le.CONST),_.gl.ONE_MINUS_CONSTANT_COLOR,le.ONE_MINUS_CONSTANT),_.gl.CONSTANT_ALPHA,le.CONST),_.gl.ONE_MINUS_CONSTANT_ALPHA,le.ONE_MINUS_CONSTANT),_.gl.SRC_ALPHA_SATURATE,le.SRC_ALPHA_SATURATE)),Jr=g()(g()(g()(g()(g()(g()(g()(g()({},_.gl.REPLACE,Ee.REPLACE),_.gl.KEEP,Ee.KEEP),_.gl.ZERO,Ee.ZERO),_.gl.INVERT,Ee.INVERT),_.gl.INCR,Ee.INCREMENT_CLAMP),_.gl.DECR,Ee.DECREMENT_CLAMP),_.gl.INCR_WRAP,Ee.INCREMENT_WRAP),_.gl.DECR_WRAP,Ee.DECREMENT_WRAP),ei=g()(g()(g()(g()(g()(g()(g()(g()({},_.gl.ALWAYS,ae.ALWAYS),_.gl.EQUAL,ae.EQUAL),_.gl.GEQUAL,ae.GEQUAL),_.gl.GREATER,ae.GREATER),_.gl.LEQUAL,ae.LEQUAL),_.gl.LESS,ae.LESS),_.gl.NEVER,ae.NEVER),_.gl.NOTEQUAL,ae.NOTEQUAL),ti={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function ni(e){return Object.prototype.toString.call(e)in ti}var ri=function(){function e(t,n){p()(this,e),g()(this,"buffer",void 0),g()(this,"isDestroyed",!1),g()(this,"type",void 0),g()(this,"size",void 0);var r,i=n.data,o=n.usage,a=n.type,s=n.isUBO,u=n.label;r=ni(i)?i:new Hr[this.type||_.gl.FLOAT](i),this.type=a,this.size=r.byteLength,this.buffer=t.createBuffer({viewOrSize:r,usage:s?ve.UNIFORM:ve.VERTEX,hint:Xr[o||_.gl.STATIC_DRAW]}),u&&t.setResourceName(this.buffer,u)}return v()(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(e){var t,n=e.data,r=e.offset;t=ni(n)?n:new Hr[this.type||_.gl.FLOAT](n),this.buffer.setSubData(r,new Uint8Array(t.buffer))}}]),e}(),ii=n(6970),oi=n.n(ii);function ai(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e+=t,e+=e<<10,(e+=e>>>6)>>>0}function si(e){return e+=e<<3,e^=e>>>11,(e+=e<<15)>>>0}function ui(){return 0}var li=v()((function e(){p()(this,e),g()(this,"keys",[]),g()(this,"values",[])})),ci=function(){function e(t,n){p()(this,e),g()(this,"buckets",new Map),this.keyEqualFunc=t,this.keyHashFunc=n}return v()(e,[{key:"findBucketIndex",value:function(e,t){for(var n=0;n<e.keys.length;n++)if(this.keyEqualFunc(t,e.keys[n]))return n;return-1}},{key:"findBucket",value:function(e){var t=this.keyHashFunc(e);return this.buckets.get(t)}},{key:"get",value:function(e){var t=this.findBucket(e);if(void 0===t)return null;var n=this.findBucketIndex(t,e);return n<0?null:t.values[n]}},{key:"add",value:function(e,t){var n=this.keyHashFunc(e);void 0===this.buckets.get(n)&&this.buckets.set(n,new li);var r=this.buckets.get(n);r.keys.push(e),r.values.push(t)}},{key:"delete",value:function(e){var t=this.findBucket(e);if(void 0!==t){var n=this.findBucketIndex(t,e);-1!==n&&(t.keys.splice(n,1),t.values.splice(n,1))}}},{key:"clear",value:function(){this.buckets.clear()}},{key:"size",value:function(){var e,t=0,n=oi()(this.buckets.values());try{for(n.s();!(e=n.n()).done;){t+=e.value.values.length}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"values",value:l()().mark((function e(){var t,n,r,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=oi()(this.buckets.values()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=14;break}r=n.value,i=r.values.length-1;case 6:if(!(i>=0)){e.next=12;break}return e.next=9,r.values[i];case 9:i--,e.next=6;break;case 12:e.next=3;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),t.e(e.t0);case 19:return e.prev=19,t.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[1,16,19,22]])}))}]),e}();function hi(e,t){return e=ai(e,t.blendMode),e=ai(e,t.blendSrcFactor),e=ai(e,t.blendDstFactor)}function fi(e,t){return e=hi(e,t.rgbBlendState),e=ai(e=hi(e,t.alphaBlendState),t.channelWriteMask)}function pi(e,t){for(var n,r,i,o,a,s,u,l,c=0;c<t.attachmentsState.length;c++)e=fi(e,t.attachmentsState[c]);return e=function(e,t){return ai(e,t.r<<24|t.g<<16|t.b<<8|t.a)}(e,t.blendConstant||We),e=ai(e,t.depthCompare),e=ai(e,t.depthWrite?1:0),e=ai(e,null===(n=t.stencilFront)||void 0===n?void 0:n.compare),e=ai(e,null===(r=t.stencilFront)||void 0===r?void 0:r.passOp),e=ai(e,null===(i=t.stencilFront)||void 0===i?void 0:i.failOp),e=ai(e,null===(o=t.stencilFront)||void 0===o?void 0:o.depthFailOp),e=ai(e,null===(a=t.stencilBack)||void 0===a?void 0:a.compare),e=ai(e,null===(s=t.stencilBack)||void 0===s?void 0:s.passOp),e=ai(e,null===(u=t.stencilBack)||void 0===u?void 0:u.failOp),e=ai(e,null===(l=t.stencilBack)||void 0===l?void 0:l.depthFailOp),e=ai(e,t.stencilWrite?1:0),e=ai(e,t.cullMode),e=ai(e,t.frontFace?1:0),e=ai(e,t.polygonOffset?1:0)}function di(e){var t=0;t=ai(t,e.program.id),null!==e.inputLayout&&(t=ai(t,e.inputLayout.id)),t=pi(t,e.megaStateDescriptor);for(var n=0;n<e.colorAttachmentFormats.length;n++)t=ai(t,e.colorAttachmentFormats[n]||0);return si(t=ai(t,e.depthStencilAttachmentFormat||0))}function vi(e){var t=0;if(e.samplerBindings)for(var n=0;n<e.samplerBindings.length;n++){var r=e.samplerBindings[n];null!==r&&null!==r.texture&&(t=ai(t,r.texture.id))}if(e.uniformBufferBindings)for(var i=0;i<e.uniformBufferBindings.length;i++){var o=e.uniformBufferBindings[i];null!==o&&null!==o.buffer&&(t=ai(t,o.buffer.id),t=ai(t,o.binding),t=ai(t,o.offset),t=ai(t,o.size))}if(e.storageBufferBindings)for(var a=0;a<e.storageBufferBindings.length;a++){var s=e.storageBufferBindings[a];null!==s&&null!==s.buffer&&(t=ai(t,s.buffer.id),t=ai(t,s.binding),t=ai(t,s.offset),t=ai(t,s.size))}if(e.storageTextureBindings)for(var u=0;u<e.storageTextureBindings.length;u++){var l=e.storageTextureBindings[u];null!==l&&null!==l.texture&&(t=ai(t,l.texture.id),t=ai(t,l.binding))}return si(t)}function mi(e,t){var n,r,i,o;return(null===(n=e.vertex)||void 0===n?void 0:n.glsl)===(null===(r=t.vertex)||void 0===r?void 0:r.glsl)&&(null===(i=e.fragment)||void 0===i?void 0:i.glsl)===(null===(o=t.fragment)||void 0===o?void 0:o.glsl)}var gi=function(){function e(t){p()(this,e),g()(this,"bindingsCache",new ci(ct,vi)),g()(this,"renderPipelinesCache",new ci(mt,di)),g()(this,"inputLayoutsCache",new ci(_t,ui)),g()(this,"programCache",new ci(mi,ui)),this.device=t}return v()(e,[{key:"createBindings",value:function(e){var t,n=this.bindingsCache.get(e);if(null===n){var r,i={samplerBindings:(t=e).samplerBindings&&at(t.samplerBindings,bt),uniformBufferBindings:t.uniformBufferBindings&&at(t.uniformBufferBindings,xt),storageBufferBindings:t.storageBufferBindings&&at(t.storageBufferBindings,xt),storageTextureBindings:t.storageTextureBindings&&at(t.storageTextureBindings,Et),pipeline:t.pipeline};i.uniformBufferBindings=null===(r=i.uniformBufferBindings)||void 0===r?void 0:r.filter((function(e){var t=e.size;return t&&t>0})),n=this.device.createBindings(i),this.bindingsCache.add(i,n)}return n}},{key:"createRenderPipeline",value:function(e){var t,n,r,i,o=this.renderPipelinesCache.get(e);if(null===o){var a=(n=(t=e).inputLayout,r=t.program,i=t.topology,{inputLayout:n,megaStateDescriptor:t.megaStateDescriptor&&et(t.megaStateDescriptor),program:r,topology:i,colorAttachmentFormats:t.colorAttachmentFormats.slice(),depthStencilAttachmentFormat:t.depthStencilAttachmentFormat,sampleCount:t.sampleCount});a.colorAttachmentFormats=a.colorAttachmentFormats.filter((function(e){return e})),o=this.device.createRenderPipeline(a),this.renderPipelinesCache.add(a,o)}return o}},{key:"createInputLayout",value:function(e){e.vertexBufferDescriptors=e.vertexBufferDescriptors.filter((function(e){return!!e}));var t,n=this.inputLayoutsCache.get(e);if(null===n){var r={vertexBufferDescriptors:at((t=e).vertexBufferDescriptors,At),indexBufferFormat:t.indexBufferFormat,program:t.program};n=this.device.createInputLayout(r),this.inputLayoutsCache.add(r,n)}return n}},{key:"createProgram",value:function(e){var t,n,r,i=this.programCache.get(e);if(null===i){var o={vertex:{glsl:null===(n=(t=e).vertex)||void 0===n?void 0:n.glsl},fragment:{glsl:null===(r=t.fragment)||void 0===r?void 0:r.glsl}};i=this.device.createProgram(e),this.programCache.add(o,i)}return i}},{key:"destroy",value:function(){var e,t=oi()(this.bindingsCache.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(e){t.e(e)}finally{t.f()}var n,r=oi()(this.renderPipelinesCache.values());try{for(r.s();!(n=r.n()).done;){n.value.destroy()}}catch(e){r.e(e)}finally{r.f()}var i,o=oi()(this.inputLayoutsCache.values());try{for(o.s();!(i=o.n()).done;){i.value.destroy()}}catch(e){o.e(e)}finally{o.f()}var a,s=oi()(this.programCache.values());try{for(s.s();!(a=s.n()).done;){a.value.destroy()}}catch(e){s.e(e)}finally{s.f()}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}}]),e}(),yi=function(){function e(t,n){p()(this,e),g()(this,"indexBuffer",void 0),g()(this,"type",void 0),g()(this,"count",void 0);var r,i=n.data,o=n.type,a=n.count,s=void 0===a?0:a;r=ni(i)?i:new Hr[this.type||_.gl.UNSIGNED_INT](i),this.type=o,this.count=s,this.indexBuffer=t.createBuffer({viewOrSize:r,usage:ve.INDEX})}return v()(e,[{key:"get",value:function(){return this.indexBuffer}},{key:"subData",value:function(e){var t,n=e.data;t=ni(n)?n:new Hr[this.type||_.gl.UNSIGNED_INT](n),this.indexBuffer.setSubData(0,new Uint8Array(t.buffer))}},{key:"destroy",value:function(){this.indexBuffer.destroy()}}]),e}();function _i(e){return!(!e||!e.texture)}var bi=function(){function e(t,n){p()(this,e),g()(this,"texture",void 0),g()(this,"sampler",void 0),g()(this,"width",void 0),g()(this,"height",void 0),g()(this,"isDestroy",!1),this.device=t,this.options=n;var r=n.wrapS,i=void 0===r?_.gl.CLAMP_TO_EDGE:r,o=n.wrapT,a=void 0===o?_.gl.CLAMP_TO_EDGE:o,s=n.aniso,u=n.mag,l=void 0===u?_.gl.NEAREST:u,c=n.min,h=void 0===c?_.gl.NEAREST:c;this.createTexture(n),this.sampler=t.createSampler({addressModeU:Yr[i],addressModeV:Yr[a],minFilter:h===_.gl.NEAREST?fe.POINT:fe.BILINEAR,magFilter:l===_.gl.NEAREST?fe.POINT:fe.BILINEAR,mipmapFilter:pe.NO_MIP,maxAnisotropy:s})}return v()(e,[{key:"createTexture",value:function(e){var t=e.type,n=void 0===t?_.gl.UNSIGNED_BYTE:t,r=e.width,i=e.height,o=e.flipY,a=void 0!==o&&o,s=e.format,u=void 0===s?_.gl.RGBA:s,l=e.alignment,c=void 0===l?1:l,h=e.usage,f=void 0===h?_.TextureUsage.SAMPLED:h,p=e.unorm,d=void 0!==p&&p,v=e.label,m=e.data;this.width=r,this.height=i;var g=ke.U8_RGBA_RT;if(n===_.gl.UNSIGNED_BYTE&&u===_.gl.RGBA)g=d?ke.U8_RGBA_NORM:ke.U8_RGBA_RT;else if(n===_.gl.UNSIGNED_BYTE&&u===_.gl.LUMINANCE)g=ke.U8_LUMINANCE;else if(n===_.gl.FLOAT&&u===_.gl.RGB)"WebGPU"===this.device.queryVendorInfo().platformString?(m&&(m=function(e,t){for(var n=e.length,r=n+Math.ceil(n/3),i=new Float32Array(r),o=0;o<r;o+=4)i[o]=e[o/4*3],i[o+1]=e[o/4*3+1],i[o+2]=e[o/4*3+2],i[o+3]=t;return i}(m,0)),g=ke.F32_RGBA):g=ke.F32_RGB;else if(n===_.gl.FLOAT&&u===_.gl.RGBA)g=ke.F32_RGBA;else{if(n!==_.gl.FLOAT||u!==_.gl.RED)throw new Error("create texture error, type: ".concat(n,", format: ").concat(u));g=ke.F32_R}this.texture=this.device.createTexture({format:g,width:r,height:i,usage:f===_.TextureUsage.SAMPLED?be.SAMPLED:be.RENDER_TARGET,pixelStore:{unpackFlipY:a,packAlignment:c},mipLevelCount:1}),v&&this.device.setResourceName(this.texture,v),m&&this.texture.setImageData([m])}},{key:"get",value:function(){return this.texture}},{key:"update",value:function(e){var t=e.data;this.texture.setImageData([t])}},{key:"bind",value:function(){}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.width===t&&this.height===n||this.destroy(),this.options.width=t,this.options.height=n,this.createTexture(this.options),this.isDestroy=!1}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){var e;this.isDestroy||this.texture.destroyed||(null===(e=this.texture)||void 0===e||e.destroy());this.isDestroy=!0}}]),e}(),xi=function(){function e(t,n){p()(this,e),g()(this,"colorRenderTarget",void 0),g()(this,"colorTexture",void 0),g()(this,"depthRenderTarget",void 0),g()(this,"depthTexture",void 0),g()(this,"width",void 0),g()(this,"height",void 0),this.device=t,this.options=n,this.createColorRenderTarget(),this.createDepthRenderTarget()}return v()(e,[{key:"createColorRenderTarget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.options,n=t.width,r=t.height,i=t.color;i&&(_i(i)?(e&&i.resize({width:n,height:r}),this.colorTexture=i.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=i.width,this.height=i.height):n&&r&&(this.colorTexture=this.device.createTexture({format:ke.U8_RGBA_RT,usage:be.RENDER_TARGET,width:n,height:r}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=n,this.height=r))}},{key:"createDepthRenderTarget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.options,n=t.width,r=t.height,i=t.depth;i&&(_i(i)?(e&&i.resize({width:n,height:r}),this.depthTexture=i.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=i.width,this.height=i.height):n&&r&&(this.depthTexture=this.device.createTexture({format:ke.D24_S8,usage:be.RENDER_TARGET,width:n,height:r}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=n,this.height=r))}},{key:"get",value:function(){return this.colorRenderTarget}},{key:"destroy",value:function(){var e,t;null===(e=this.colorRenderTarget)||void 0===e||e.destroy(),null===(t=this.depthRenderTarget)||void 0===t||t.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.width===t&&this.height===n||(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=t,this.options.height=n,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}}]),e}(),Ei=Br.rU.isPlainObject,Si=Br.rU.isTypedArray,Ai=function(){function e(t,n,r){var i=this;p()(this,e),g()(this,"destroyed",!1),g()(this,"uniforms",{}),g()(this,"program",void 0),g()(this,"inputLayout",void 0),g()(this,"pipeline",void 0),g()(this,"indexBuffer",void 0),g()(this,"vertexBuffers",[]),g()(this,"bindings",void 0),this.device=t,this.options=n,this.service=r;var o=n.vs,a=n.fs,s=n.attributes,u=n.uniforms,l=n.count,c=n.elements,h=n.diagnosticDerivativeUniformityEnabled;this.options=n;var f=h?"":this.service.viewportOrigin===Ae.UPPER_LEFT?"diagnostic(off,derivative_uniformity);":"";this.program=r.renderCache.createProgram({vertex:{glsl:o},fragment:{glsl:a,postprocess:function(e){return f+e}}}),u&&(this.uniforms=this.extractUniforms(u));var d=[],v=0;Object.keys(s).forEach((function(e){var t=s[e],n=t.get();i.vertexBuffers.push(n.get());var r=t.attribute,o=r.offset,a=void 0===o?0:o,u=r.stride,l=void 0===u?0:u,c=r.size,h=void 0===c?1:c,f=r.divisor,p=void 0===f?0:f,m=r.shaderLocation,g=void 0===m?0:m;d.push({arrayStride:l||4*h,stepMode:ge.VERTEX,attributes:[{format:Zr[h],shaderLocation:g,offset:a,divisor:p}]}),v=n.size/h})),l||(this.options.count=v),c&&(this.indexBuffer=c.get());var m=r.renderCache.createInputLayout({vertexBufferDescriptors:d,indexBufferFormat:c?ke.U32_R:null,program:this.program});this.inputLayout=m,this.pipeline=this.createPipeline(n)}return v()(e,[{key:"createPipeline",value:function(e,t){var n=e.primitive,r=void 0===n?_.gl.TRIANGLES:n,i=e.depth,o=e.cull,a=e.blend,s=e.stencil,u=this.initDepthDrawParams({depth:i}),l=!(!u||!u.enable),c=this.initCullDrawParams({cull:o}),h=!(!c||!c.enable),f=this.getBlendDrawParams({blend:a}),p=!(!f||!f.enable),d=this.getStencilDrawParams({stencil:s}),v=!(!d||!d.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:Wr[r],colorAttachmentFormats:[ke.U8_RGBA_RT],depthStencilAttachmentFormat:ke.D24_S8,megaStateDescriptor:{attachmentsState:[t?{channelWriteMask:xe.ALL,rgbBlendState:{blendMode:ce.ADD,blendSrcFactor:le.ONE,blendDstFactor:le.ZERO},alphaBlendState:{blendMode:ce.ADD,blendSrcFactor:le.ONE,blendDstFactor:le.ZERO}}:{channelWriteMask:v&&d.opFront.zpass===Ee.REPLACE?xe.NONE:xe.ALL,rgbBlendState:{blendMode:p&&f.equation.rgb||ce.ADD,blendSrcFactor:p&&f.func.srcRGB||le.SRC_ALPHA,blendDstFactor:p&&f.func.dstRGB||le.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:p&&f.equation.alpha||ce.ADD,blendSrcFactor:p&&f.func.srcAlpha||le.ONE,blendDstFactor:p&&f.func.dstAlpha||le.ONE}}],blendConstant:p?We:void 0,depthWrite:l,depthCompare:l&&u.func||ae.LESS,cullMode:h&&c.face||ue.NONE,stencilWrite:v,stencilFront:{compare:v?d.func.cmp:ae.ALWAYS,passOp:d.opFront.zpass,failOp:d.opFront.fail,depthFailOp:d.opFront.zfail,mask:d.opFront.mask},stencilBack:{compare:v?d.func.cmp:ae.ALWAYS,passOp:d.opBack.zpass,failOp:d.opBack.fail,depthFailOp:d.opBack.zfail,mask:d.opBack.mask}}})}},{key:"updateAttributesAndElements",value:function(){}},{key:"updateAttributes",value:function(){}},{key:"addUniforms",value:function(e){this.uniforms=o()(o()({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e,t){var n=this,r=o()(o()({},this.options),e),i=r.count,a=void 0===i?0:i,s=r.instances,u=r.elements,l=r.uniforms,c=void 0===l?{}:l,h=r.uniformBuffers,f=r.textures;this.uniforms=o()(o()({},this.uniforms),this.extractUniforms(c));var p=this.service,d=p.renderPass,v=p.currentFramebuffer,m=p.width,g=p.height,y=p.renderCache;this.pipeline=this.createPipeline(r,t);var _=this.service.device,b=_.swapChainHeight;if(_.swapChainHeight=(null==v?void 0:v.height)||g,d.setViewport(0,0,(null==v?void 0:v.width)||m,(null==v?void 0:v.height)||g),_.swapChainHeight=b,d.setPipeline(this.pipeline),d.setStencilReference(1),d.setVertexInput(this.inputLayout,this.vertexBuffers.map((function(e){return{buffer:e}})),u?{buffer:this.indexBuffer,offset:0}:null),h&&(this.bindings=y.createBindings({pipeline:this.pipeline,uniformBufferBindings:h.map((function(e,t){var n=e;return{binding:t,buffer:n.get(),size:n.size}})),samplerBindings:null==f?void 0:f.map((function(e){return{texture:e.texture,sampler:e.sampler}}))})),this.bindings&&(d.setBindings(this.bindings),Object.keys(this.uniforms).forEach((function(e){var t=n.uniforms[e];t instanceof bi?n.uniforms[e]=t.get():t instanceof xi&&(n.uniforms[e]=t.get().texture)})),this.program.setUniformsLegacy(this.uniforms)),u){var x=u.count;0===x?d.draw(a,s):d.drawIndexed(x,s)}else d.draw(a,s)}},{key:"destroy",value:function(){var e,t,n;this.program.destroy(),null===(e=this.vertexBuffers)||void 0===e||e.forEach((function(e){return e.destroy()})),null===(t=this.indexBuffer)||void 0===t||t.destroy(),null===(n=this.bindings)||void 0===n||n.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(e){var t=e.depth;if(t)return{enable:void 0===t.enable||!!t.enable,mask:void 0===t.mask||!!t.mask,func:qr[t.func||_.gl.LESS],range:t.range||[0,1]}}},{key:"getBlendDrawParams",value:function(e){var t=e.blend||{},n=t.enable,r=t.func,i=t.equation,o=t.color,a=void 0===o?[0,0,0,0]:o;return{enable:!!n,func:{srcRGB:$r[r&&r.srcRGB||_.gl.SRC_ALPHA],srcAlpha:$r[r&&r.srcAlpha||_.gl.SRC_ALPHA],dstRGB:$r[r&&r.dstRGB||_.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:$r[r&&r.dstAlpha||_.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Qr[i&&i.rgb||_.gl.FUNC_ADD],alpha:Qr[i&&i.alpha||_.gl.FUNC_ADD]},color:a}}},{key:"getStencilDrawParams",value:function(e){var t=e.stencil||{},n=t.enable,r=t.mask,i=void 0===r?4294967295:r,a=t.func,s=void 0===a?{cmp:_.gl.ALWAYS,ref:0,mask:4294967295}:a,u=t.opFront,l=void 0===u?{fail:_.gl.KEEP,zfail:_.gl.KEEP,zpass:_.gl.KEEP}:u,c=t.opBack,h=void 0===c?{fail:_.gl.KEEP,zfail:_.gl.KEEP,zpass:_.gl.KEEP}:c;return{enable:!!n,mask:i,func:o()(o()({},s),{},{cmp:ei[s.cmp]}),opFront:{fail:Jr[l.fail],zfail:Jr[l.zfail],zpass:Jr[l.zpass],mask:s.mask},opBack:{fail:Jr[h.fail],zfail:Jr[h.zfail],zpass:Jr[h.zpass],mask:s.mask}}}},{key:"initCullDrawParams",value:function(e){var t=e.cull;if(t){var n=t.enable,r=t.face,i=void 0===r?_.gl.BACK:r;return{enable:!!n,face:Kr[i]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||Si(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:(Ei(t)&&Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,o){Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e,"[").concat(o,"]"))}))})))}}]),e}();function Ti(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}var Ci=Br.rU.isUndefined,wi=function(){function e(){var t=this;p()(this,e),g()(this,"uniformBuffers",[]),g()(this,"extensionObject",void 0),g()(this,"device",void 0),g()(this,"swapChain",void 0),g()(this,"$container",void 0),g()(this,"canvas",void 0),g()(this,"width",void 0),g()(this,"height",void 0),g()(this,"isDirty",void 0),g()(this,"renderPass",void 0),g()(this,"preRenderPass",void 0),g()(this,"mainColorRT",void 0),g()(this,"mainDepthRT",void 0),g()(this,"renderCache",void 0),g()(this,"currentFramebuffer",void 0),g()(this,"queryVerdorInfo",(function(){return t.device.queryVendorInfo().platformString})),g()(this,"viewportOrigin",void 0),g()(this,"createModel",(function(e){return new Ai(t.device,e,t)})),g()(this,"createAttribute",(function(e){return new Vr(t.device,e)})),g()(this,"createBuffer",(function(e){return new ri(t.device,e)})),g()(this,"createElements",(function(e){return new yi(t.device,e)})),g()(this,"createTexture2D",(function(e){return new bi(t.device,e)})),g()(this,"createFramebuffer",(function(e){return new xi(t.device,e)})),g()(this,"useFramebuffer",(function(e,n){t.currentFramebuffer=e,t.beginFrame(),n(),t.endFrame(),t.currentFramebuffer=null})),g()(this,"useFramebufferAsync",function(){var e=h()(l()().mark((function e(n,r){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.currentFramebuffer=n,t.preRenderPass=t.renderPass,t.beginFrame(),e.next=5,r();case 5:t.endFrame(),t.currentFramebuffer=null,t.renderPass=t.preRenderPass;case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),g()(this,"clear",(function(e){var n=e.color,r=e.depth,i=e.stencil,o=e.framebuffer,a=void 0===o?null:o;if(a)a.clearOptions={color:n,depth:r,stencil:i};else{var s=t.queryVerdorInfo();if("WebGL1"===s){var u=t.getGLContext();Ci(i)?Ci(r)||(u.clearDepth(r),u.clear(u.DEPTH_BUFFER_BIT)):(u.clearStencil(i),u.clear(u.STENCIL_BUFFER_BIT))}else if("WebGL2"===s){var l=t.getGLContext();Ci(i)?Ci(r)||l.clearBufferfv(l.DEPTH,0,[r]):l.clearBufferiv(l.STENCIL,0,[i])}}})),g()(this,"viewport",(function(e){var n=e.width,r=e.height;t.swapChain.configureSwapChain(n,r),t.createMainColorDepthRT(n,r),t.width=n,t.height=r})),g()(this,"readPixels",(function(e){var n=e.framebuffer,r=e.x,i=e.y,o=e.width,a=e.height,s=t.device.createReadback(),u=n.colorTexture,l=s.readTextureSync(u,r,t.viewportOrigin===Ae.LOWER_LEFT?i:t.height-i,o,a,new Uint8Array(o*a*4));return s.destroy(),l})),g()(this,"readPixelsAsync",function(){var e=h()(l()().mark((function e(n){var r,i,o,a,s,u,c,h,f,p;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.framebuffer,i=n.x,o=n.y,a=n.width,s=n.height,u=t.device.createReadback(),c=r.colorTexture,e.next=5,u.readTexture(c,i,t.viewportOrigin===Ae.LOWER_LEFT?o:t.height-o,a,s,new Uint8Array(a*s*4));case 5:if(h=e.sent,t.viewportOrigin!==Ae.LOWER_LEFT)for(f=0;f<h.length;f+=4)p=h[f],h[f]=h[f+2],h[f+2]=p;return u.destroy(),e.abrupt("return",h);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),g()(this,"getViewportSize",(function(){return{width:t.width,height:t.height}})),g()(this,"getContainer",(function(){var e;return null===(e=t.canvas)||void 0===e?void 0:e.parentElement})),g()(this,"getCanvas",(function(){return t.canvas})),g()(this,"getGLContext",(function(){return t.device.gl})),g()(this,"destroy",(function(){var e;t.canvas=null,null===(e=t.uniformBuffers)||void 0===e||e.forEach((function(e){e.destroy()})),t.device.destroy(),t.renderCache.destroy()}))}var t;return v()(e,[{key:"init",value:(t=h()(l()().mark((function e(t,n){var r,i,o,a,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.enableWebGPU,i=n.shaderCompilerPath,this.canvas=t,o=r?new Dr({shaderCompilerPath:i}):new wn({targets:["webgl2","webgl1"],onContextLost:function(e){console.warn("context lost",e)},onContextCreationError:function(e){console.warn("context creation error",e)},onContextRestored:function(e){console.warn("context restored",e)}}),e.next=5,o.createSwapChain(t);case 5:(a=e.sent).configureSwapChain(t.width,t.height),this.device=a.getDevice(),this.swapChain=a,this.renderCache=new gi(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin,s=this.device.gl,this.extensionObject={OES_texture_float:!Ti(s)&&this.device.OES_texture_float},this.createMainColorDepthRT(t.width,t.height);case 15:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"createMainColorDepthRT",value:function(e,t){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:ke.U8_RGBA_RT,width:e,height:t,usage:be.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:ke.D24_S8,width:e,height:t,usage:be.RENDER_TARGET}))}},{key:"beginFrame",value:function(){this.device.beginFrame();var e=this.currentFramebuffer,t=this.swapChain,n=this.mainColorRT,r=this.mainDepthRT,i=e?e.colorRenderTarget:n,o=e?null:t.getOnscreenTexture(),a=e?e.depthRenderTarget:r,s=(null==e?void 0:e.clearOptions)||{},u=s.color,l=void 0===u?[0,0,0,0]:u,c=s.depth,h=void 0===c?1:c,f=s.stencil,p=void 0===f?0:f,d=i?He(255*l[0],255*l[1],255*l[2],l[3]):We,v=a?h:void 0,m=a?p:void 0,g=this.device.createRenderPass({colorAttachment:[i],colorResolveTo:[o],colorClearColor:[d],colorStore:[!0],depthStencilAttachment:a,depthClearValue:v,stencilClearValue:m});this.renderPass=g}},{key:"endFrame",value:function(){this.device.submitPass(this.renderPass),this.device.endFrame()}},{key:"getPointSizeRange",value:function(){var e=this.device.gl;return e.getParameter(e.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(e){return!!this.getGLContext().getExtension(e)}},{key:"setState",value:function(){}},{key:"setBaseState",value:function(){}},{key:"setCustomLayerDefaults",value:function(){}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}}]),e}(),Ri=n(6626),Mi=n.n(Ri),ki=n(7267),Li=n.n(ki),Oi=n(9913),Pi=n.n(Oi),Ii=n(2490),Ni=["selectstart","selecting","selectend"],Di=function(e){Li()(n,e);var t=Pi()(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p()(this,n),r=t.call(this),g()(Mi()(r),"scene",void 0),g()(Mi()(r),"options",void 0),g()(Mi()(r),"isEnable",!1),g()(Mi()(r),"box",void 0),g()(Mi()(r),"startEvent",void 0),g()(Mi()(r),"endEvent",void 0),g()(Mi()(r),"onDragStart",(function(e){r.box.style.display="block",r.startEvent=r.endEvent=e,r.syncBoxBound(),r.emit("selectstart",r.getLngLatBox(),r.startEvent,r.endEvent)})),g()(Mi()(r),"onDragging",(function(e){r.endEvent=e,r.syncBoxBound(),r.emit("selecting",r.getLngLatBox(),r.startEvent,r.endEvent)})),g()(Mi()(r),"onDragEnd",(function(e){r.endEvent=e,r.box.style.display="none",r.emit("selectend",r.getLngLatBox(),r.startEvent,r.endEvent)})),r.scene=e,r.options=i,r}return v()(n,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var e=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var t=Br.SO.create("div",void 0,this.container);t.classList.add("l7-select-box"),e&&t.classList.add(e),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var e=this.startEvent,t=e.x,n=e.y,r=this.endEvent,i=r.x,o=r.y,a=Math.min(t,i),s=Math.min(n,o),u=Math.abs(t-i),l=Math.abs(n-o);this.box.style.top="".concat(s,"px"),this.box.style.left="".concat(a,"px"),this.box.style.width="".concat(u,"px"),this.box.style.height="".concat(l,"px")}},{key:"getLngLatBox",value:function(){var e=this.startEvent.lngLat,t=e.lng,n=e.lat,r=this.endEvent.lngLat,i=r.lng,o=r.lat;return(0,Br.Ol)([[t,n],[i,o]])}}]),n}(Ii.EventEmitter),Bi=function(){function e(t){p()(this,e),g()(this,"sceneService",void 0),g()(this,"mapService",void 0),g()(this,"controlService",void 0),g()(this,"layerService",void 0),g()(this,"debugService",void 0),g()(this,"iconService",void 0),g()(this,"markerService",void 0),g()(this,"popupService",void 0),g()(this,"fontService",void 0),g()(this,"interactionService",void 0),g()(this,"boxSelect",void 0),g()(this,"container",void 0);var n=t.id,r=t.map,i=t.canvas,o=t.renderer,a=void 0===o?"regl":o,s=(0,_.createSceneContainer)();this.container=s,r.setContainer(s,n,i),s.rendererService="regl"===a?new jr:new wi,this.sceneService=s.sceneService,this.mapService=s.mapService,this.iconService=s.iconService,this.fontService=s.fontService,this.controlService=s.controlService,this.layerService=s.layerService,this.debugService=s.debugService,this.debugService.setEnable(t.debug),this.markerService=s.markerService,this.interactionService=s.interactionService,this.popupService=s.popupService,this.boxSelect=new Di(this,{}),this.initComponent(n),this.sceneService.init(t),this.initControl()}var t,n,r,i,a;return v()(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:(a=h()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"exportMap",value:(i=h()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"registerRenderService",value:function(e){var t=this;this.sceneService.loaded?new e(this).init():this.on("loaded",(function(){new e(t).init()}))}},{key:"setBgColor",value:function(e){this.mapService.setBgColor(e)}},{key:"addLayer",value:function(e){var t=this;this.loaded?this.preAddLayer(e):this.once("loaded",(function(){t.preAddLayer(e)}))}},{key:"preAddLayer",value:function(e){var t=this,n=(0,_.createLayerContainer)(this.container);if(e.setContainer(n),this.sceneService.addLayer(e),e.inited){this.initTileLayer(e);var r=this.initMask(e);this.addMask(r,e.id)}else e.on("inited",(function(){t.initTileLayer(e);var n=t.initMask(e);t.addMask(n,e.id)}))}},{key:"initMask",value:function(e){var t=e.getLayerConfig(),n=t.mask,r=t.maskfence,i=t.maskColor,o=void 0===i?"#000":i,a=t.maskOpacity,s=void 0===a?0:a;if(n&&r)return(new b.Z).source(r).shape("fill").style({color:o,opacity:s})}},{key:"addMask",value:function(e,t){if(e){var n=this.getLayer(t);if(n){var r=(0,_.createLayerContainer)(this.container);e.setContainer(r),n.addMaskLayer(e),this.sceneService.addMask(e)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(e){return this.layerService.getLayer(e)}},{key:"getLayerByName",value:function(e){return this.layerService.getLayerByName(e)}},{key:"removeLayer",value:(r=h()(l()().mark((function e(t,n){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.remove(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"removeAllLayer",value:(n=h()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.removeAllLayers();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(e){this.layerService.setEnableRender(e)}},{key:"addIconFont",value:function(e,t){this.fontService.addIconFont(e,t)}},{key:"addIconFonts",value:function(e){var t=this;e.forEach((function(e){var n=s()(e,2),r=n[0],i=n[1];t.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(e,t){var n=this;this.fontService.once("fontloaded",(function(e){n.emit("fontloaded",e)})),this.fontService.addFontFace(e,t)}},{key:"addImage",value:(t=h()(l()().mark((function e(t,n){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iconService.addImage(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"hasImage",value:function(e){return this.iconService.hasImage(e)}},{key:"removeImage",value:function(e){this.iconService.removeImage(e)}},{key:"addIconFontGlyphs",value:function(e,t){this.fontService.addIconGlyphs(t)}},{key:"addControl",value:function(e){this.controlService.addControl(e,this.container)}},{key:"removeControl",value:function(e){this.controlService.removeControl(e)}},{key:"getControlByName",value:function(e){return this.controlService.getControlByName(e)}},{key:"addMarker",value:function(e){this.markerService.addMarker(e)}},{key:"addMarkerLayer",value:function(e){this.markerService.addMarkerLayer(e)}},{key:"removeMarkerLayer",value:function(e){this.markerService.removeMarkerLayer(e)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers 已废弃，请使用 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(e){this.popupService.addPopup(e)}},{key:"removePopup",value:function(e){this.popupService.removePopup(e)}},{key:"on",value:function(e,t){var n;Ni.includes(e)?null===(n=this.boxSelect)||void 0===n||n.on(e,t):_.SceneEventList.includes(e)?this.sceneService.on(e,t):this.mapService.on(e,t)}},{key:"once",value:function(e,t){var n;Ni.includes(e)?null===(n=this.boxSelect)||void 0===n||n.once(e,t):_.SceneEventList.includes(e)?this.sceneService.once(e,t):this.mapService.once(e,t)}},{key:"emit",value:function(e,t){-1===_.SceneEventList.indexOf(e)?this.mapService.on(e,t):this.sceneService.emit(e,t)}},{key:"off",value:function(e,t){var n;Ni.includes(e)?null===(n=this.boxSelect)||void 0===n||n.off(e,t):_.SceneEventList.includes(e)?this.sceneService.off(e,t):this.mapService.off(e,t)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(e){return this.mapService.getCenter(e)}},{key:"setCenter",value:function(e,t){return this.mapService.setCenter(e,t)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(e){return this.mapService.setPitch(e)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(e){this.mapService.setRotation(e)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(e){this.mapService.panTo(e)}},{key:"panBy",value:function(e,t){this.mapService.panBy(e,t)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(e){this.mapService.setZoom(e)}},{key:"fitBounds",value:function(e,t){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(e,t||o()(o()({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(e,t){this.mapService.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.mapService.setMapStyle(e)}},{key:"setMapStatus",value:function(e){this.mapService.setMapStatus(e)}},{key:"pixelToLngLat",value:function(e){return this.mapService.pixelToLngLat(e)}},{key:"lngLatToPixel",value:function(e){return this.mapService.lngLatToPixel(e)}},{key:"containerToLngLat",value:function(e){return this.mapService.containerToLngLat(e)}},{key:"lngLatToContainer",value:function(e){return this.mapService.lngLatToContainer(e)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(e){this.container.postProcessingPass.name=new e}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.boxSelect.enable(),t&&this.boxSelect.once("selectend",(function(){e.disableBoxSelect()}))}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(e){return Br.SA.REGISTERED_PROTOCOLS[e]}},{key:"startAnimate",value:function(){this.layerService.startAnimate()}},{key:"stopAnimate",value:function(){this.layerService.stopAnimate()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(e){this.controlService.init({container:Br.SO.getContainer(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var e=this.sceneService.getSceneConfig(),t=e.logoVisible,n=e.logoPosition;t&&this.addControl(new y.Logo({position:n}))}},{key:"initTileLayer",value:function(e){e.getSource().isTile&&(e.tileLayer=new x.Z(e))}}],[{key:"addProtocol",value:function(e,t){Br.SA.REGISTERED_PROTOCOLS[e]=t}},{key:"removeProtocol",value:function(e){delete Br.SA.REGISTERED_PROTOCOLS[e]}}]),e}()},8368:function(e,t,n){"use strict";n.d(t,{default:function(){return Ot}});var r={},i={},o=function(e){return i[e]},a=function(e,t){i[e]=t},s=function(e,t){r[e]=t},u={},l={};function c(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function h(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function f(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function p(e){var t,n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":((t=e.getUTCFullYear())<0?"-"+f(-t,6):t>9999?"+"+f(t,6):f(t,4))+"-"+f(e.getUTCMonth()+1,2)+"-"+f(e.getUTCDate(),2)+(o?"T"+f(n,2)+":"+f(r,2)+":"+f(i,2)+"."+f(o,3)+"Z":i?"T"+f(n,2)+":"+f(r,2)+":"+f(i,2)+"Z":r||n?"T"+f(n,2)+":"+f(r,2)+"Z":"")}var d=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],o=e.length,a=0,s=0,c=o<=0,h=!1;function f(){if(c)return l;if(h)return h=!1,u;var t,r,i=a;if(34===e.charCodeAt(i)){for(;a++<o&&34!==e.charCodeAt(a)||34===e.charCodeAt(++a););return(t=a)>=o?c=!0:10===(r=e.charCodeAt(a++))?h=!0:13===r&&(h=!0,10===e.charCodeAt(a)&&++a),e.slice(i+1,t-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=e.charCodeAt(t=a++)))h=!0;else if(13===r)h=!0,10===e.charCodeAt(a)&&++a;else if(r!==n)continue;return e.slice(i,t)}return c=!0,e.slice(i,o)}for(10===e.charCodeAt(o-1)&&--o,13===e.charCodeAt(o-1)&&--o;(r=f())!==l;){for(var p=[];r!==u&&r!==l;)p.push(r),r=f();t&&null==(p=t(p,s++))||i.push(p)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return a(t[e])})).join(e)}))}function o(t){return t.map(a).join(e)}function a(e){return null==e?"":e instanceof Date?p(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,o=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=c(e);return function(r,i){return t(n(r),i,e)}}(e,t):c(e)}));return o.columns=i||[],o},parseRows:r,format:function(t,n){return null==n&&(n=h(t)),[n.map(a).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=h(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(o).join("\n")},formatRow:o,formatValue:a}}(","),v=d.parse,m=(d.parseRows,d.format,d.formatBody,d.formatRows,d.formatRow,d.formatValue,n(1448)),g=n.n(m),y=n(1772),_=n(1612),b=n(6490),x=n(2531),E=n.n(x);function S(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function A(e){var t=Object.isFrozen(e)?b.rU.cloneDeep(e):e;return E()(t,!0),t}function T(e,t){return e||[[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]}function C(e,t){var n=t.x,r=t.y,i=t.x1,o=t.y1,a=t.coordinates,s=t.geometry,u=[];if(!Array.isArray(e))return{dataArray:[]};if(s)return e.filter((function(e){return e[s]&&e[s].type&&e[s].coordinates&&e[s].coordinates.length>0})).forEach((function(e,t){var n=A(e[s]);(0,_.nG)(n,(function(n){var r=(0,y.r7)(n),i=g()(g()({},e),{},{_id:t,coordinates:r});u.push(i)}))})),{dataArray:u};for(var l=0;l<e.length;l++){var c=e[l],h=[];if(a){var f="Polygon";Array.isArray(a[0])||(f="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(f="LineString"),h=A({type:f,coordinates:c[a]}).coordinates}else if(n&&r&&i&&o){h=[[parseFloat(c[n]),parseFloat(c[r])],[parseFloat(c[i]),parseFloat(c[o])]]}else n&&r&&(h=[parseFloat(c[n]),parseFloat(c[r])]);var p=g()(g()({},c),{},{_id:l,coordinates:h});u.push(p)}return{dataArray:u}}var w=n(9558),R=n.n(w),M=n(9989),k=n.n(M);function L(e,t,n,r){for(var i,o=r,a=n-t>>1,s=n-t,u=e[t],l=e[t+1],c=e[n],h=e[n+1],f=t+3;f<n;f+=3){var p=O(e[f],e[f+1],u,l,c,h);if(p>o)i=f,o=p;else if(p===o){var d=Math.abs(f-a);d<s&&(i=f,s=d)}}o>r&&(i-t>3&&L(e,t,i,r),e[i+2]=o,n-i>3&&L(e,i,n,r))}function O(e,t,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((e-n)*a+(t-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=e-n)*a+(s=t-r)*s}function P(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)I(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)I(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)I(e,t[r][i])}(i),i}function I(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function N(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=t.id;if(n.promoteId?u=t.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)D(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)D(i[l],s);else if("LineString"===o)B(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],B(i[l],s,a,!1),e.push(P(u,"LineString",s,t.properties));return}F(i,s,a,!1)}else if("Polygon"===o)F(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<t.geometry.geometries.length;l++)N(e,{id:u,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];F(i[l],c,a,!0),s.push(c)}}e.push(P(u,o,s,t.properties))}}function D(e,t){t.push(U(e[0])),t.push(z(e[1])),t.push(0)}function B(e,t,n,r){for(var i,o,a=0,s=0;s<e.length;s++){var u=U(e[s][0]),l=z(e[s][1]);t.push(u),t.push(l),t.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=t.length-3;t[2]=1,L(t,0,c,n),t[c+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function F(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];B(e[i],o,n,r),t.push(o)}}function U(e){return e/360+.5}function z(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function G(e,t,n,r,i,o,a,s){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;for(var u=[],l=0;l<e.length;l++){var c=e[l],h=c.geometry,f=c.type,p=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(p>=n&&d<r)u.push(c);else if(!(d<n||p>=r)){var v=[];if("Point"===f||"MultiPoint"===f)j(h,v,n,r,i);else if("LineString"===f)V(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===f)W(h,v,n,r,i,!1);else if("Polygon"===f)W(h,v,n,r,i,!0);else if("MultiPolygon"===f)for(var m=0;m<h.length;m++){var g=[];W(h[m],g,n,r,i,!0),g.length&&v.push(g)}if(v.length){if(s.lineMetrics&&"LineString"===f){for(m=0;m<v.length;m++)u.push(P(c.id,f,v[m],c.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===v.length?(f="LineString",v=v[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===v.length?"Point":"MultiPoint"),u.push(P(c.id,f,v,c.tags))}}}return u.length?u:null}function j(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=n&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function V(e,t,n,r,i,o,a){for(var s,u,l=H(e),c=0===i?X:Y,h=e.start,f=0;f<e.length-3;f+=3){var p=e[f],d=e[f+1],v=e[f+2],m=e[f+3],g=e[f+4],y=0===i?p:d,_=0===i?m:g,b=!1;a&&(s=Math.sqrt(Math.pow(p-m,2)+Math.pow(d-g,2))),y<n?_>n&&(u=c(l,p,d,m,g,n),a&&(l.start=h+s*u)):y>r?_<r&&(u=c(l,p,d,m,g,r),a&&(l.start=h+s*u)):Z(l,p,d,v),_<n&&y>=n&&(u=c(l,p,d,m,g,n),b=!0),_>r&&y<=r&&(u=c(l,p,d,m,g,r),b=!0),!o&&b&&(a&&(l.end=h+s*u),t.push(l),l=H(e)),a&&(h+=s)}var x=e.length-3;p=e[x],d=e[x+1],v=e[x+2],(y=0===i?p:d)>=n&&y<=r&&Z(l,p,d,v),x=l.length-3,o&&x>=3&&(l[x]!==l[0]||l[x+1]!==l[1])&&Z(l,l[0],l[1],l[2]),l.length&&t.push(l)}function H(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function W(e,t,n,r,i,o){for(var a=0;a<e.length;a++)V(e[a],t,n,r,i,o,!1)}function Z(e,t,n,r){e.push(t),e.push(n),e.push(r)}function X(e,t,n,r,i,o){var a=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*a),e.push(1),a}function Y(e,t,n,r,i,o){var a=(o-n)/(i-n);return e.push(t+(r-t)*a),e.push(o),e.push(1),a}function q(e,t){for(var n=[],r=0;r<e.length;r++){var i,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=K(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(K(o.geometry[s],t))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(K(o.geometry[s][l],t));i.push(u)}n.push(P(o.id,a,i,o.tags))}return n}function K(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function Q(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,a=e.x,s=e.y;for(n=0;n<e.features.length;n++){var u=e.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push($(l[r],l[r+1],t,o,a,s));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push($(l[r][i],l[r][i+1],t,o,a,s));u.geometry.push(h)}}return e.transformed=!0,e}function $(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function J(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,ee(a,e[s],o,i);var u=e[s].minX,l=e[s].minY,c=e[s].maxX,h=e[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function ee(e,t,n,r){var i=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)te(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)te(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)te(a,l[s],e,n,!0,0===s)}if(a.length){var c=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var f={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(f.id=t.id),e.features.push(f)}}function te(e,t,n,r,i,o){var a=r*r;if(r>0&&t.size<(i?a:r))n.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>a)&&(n.numSimplified++,s.push(t[u]),s.push(t[u+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=a,e[i-1-r]=s}}(s,o),e.push(s)}}function ne(e,t){t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t);var n=t.debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)N(n,e.features[r],t,r);else"Feature"===e.type?N(n,e,t):N(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(e,t){var n=t.buffer/t.extent,r=e,i=G(e,1,-1-n,n,0,-1,2,t),o=G(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=G(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=q(i,1).concat(r)),o&&(r=r.concat(q(o,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function re(e,t,n){return 32*((1<<e)*n+t)+e}ne.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ne.prototype.splitTile=function(e,t,n,r,i,o,a){for(var s=[e,t,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,h=re(t,n,r),f=this.tiles[h];if(!f&&(l>1&&console.time("creation"),f=this.tiles[h]=J(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=e,i){if(t===u.maxZoom||t===i)continue;var d=1<<i-t;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(t===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue;if(f.source=null,0!==e.length){l>1&&console.time("clipping");var v,m,g,y,_,b,x=.5*u.buffer/u.extent,E=.5-x,S=.5+x,A=1+x;v=m=g=y=null,_=G(e,c,n-x,n+S,0,f.minX,f.maxX,u),b=G(e,c,n+E,n+A,0,f.minX,f.maxX,u),e=null,_&&(v=G(_,c,r-x,r+S,1,f.minY,f.maxY,u),m=G(_,c,r+E,r+A,1,f.minY,f.maxY,u),_=null),b&&(g=G(b,c,r-x,r+S,1,f.minY,f.maxY,u),y=G(b,c,r+E,r+A,1,f.minY,f.maxY,u),b=null),l>1&&console.timeEnd("clipping"),s.push(v||[],t+1,2*n,2*r),s.push(m||[],t+1,2*n,2*r+1),s.push(g||[],t+1,2*n+1,2*r),s.push(y||[],t+1,2*n+1,2*r+1)}}},ne.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var a=1<<e,s=re(e,t=(t%a+a)%a,n);if(this.tiles[s])return Q(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var u,l=e,c=t,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[re(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?Q(this.tiles[s],i):null):null};var ie=n(4528),oe=n.n(ie),ae=n(8798),se=n.n(ae),ue=n(9057),le=n.n(ue),ce=function(){function e(t,n,r,i){oe()(this,e),le()(this,"vectorTile",void 0),le()(this,"vectorLayerCache",{}),le()(this,"x",void 0),le()(this,"y",void 0),le()(this,"z",void 0),this.x=n,this.y=r,this.z=i,this.vectorTile=t}return se()(e,[{key:"getTileData",value:function(e){return e&&this.vectorTile.layers[e]?this.vectorLayerCache[e]?this.vectorLayerCache[e]:this.vectorTile.layers[e].features:[]}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),he={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function fe(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)t=e[i],r+=((n=e[a]).x-t.x)*(t.y+n.y);return r}var pe=["Unknown","Point","LineString","Polygon"];function de(e,t,n,r,i){var o,a,s=i.geometry,u=i.type,l=i.tags,c=i.id,h=e*Math.pow(2,r),f=e*t,p=e*n,d=pe[u];function v(e){for(var t=0;t<e.length;t++){var n=e[t];if(n[3])break;var r=180-360*(n[1]+p)/h,i=360*(n[0]+f)/h-180,o=360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90;e[t]=[i,o,0,1]}}switch(u){case 1:var m=[];for(o=0;o<s.length;o++)m[o]=s[o][0];v(s=m);break;case 2:for(o=0;o<s.length;o++)v(s[o]);break;case 3:for(s=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var a=fe(e[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}return n&&i.push(n),i}(s),o=0;o<s.length;o++)for(a=0;a<s[o].length;a++)v(s[o][a])}return 1===s.length?s=s[0]:d="Multi"+d,{type:"Feature",geometry:{type:d,coordinates:s},properties:l,id:c,tileOrigin:[0,0],coord:""}}var ve=function(){var e=k()(R()().mark((function e(t,n,r,i){return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var o=n.getTile(t.z,t.x,t.y),a=o?o.features.map((function(e){return de(i,r.x,r.y,r.z,e)})):[];e(new ce({layers:{defaultLayer:{features:a}}},t.x,t.y,t.z))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}();function me(e,t){var n=t.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=t.coordinates,o=t.requestParameters,a=void 0===o?{}:o,s=new Promise((function(t){e instanceof HTMLImageElement||(0,b.fg)(e)?t([e]):function(e,t,n){var r=[];if("string"==typeof e)(0,b.gJ)(g()(g()({},t),{},{url:e}),(function(e,t){t&&(r.push(t),n(r))}));else{var i=e.length,o=0;e.forEach((function(e){(0,b.gJ)(g()(g()({},t),{},{url:e}),(function(e,t){o++,t&&r.push(t),o===i&&n(r)}))}))}}(e,a,(function(e){t(e)}))})),u=T(i,r);return{originData:e,images:s,_id:1,dataArray:[{_id:0,coordinates:u}]}}var ge=function(){var e=k()(R()().mark((function e(t,n,r,i){var o,a;return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={x:n.x,y:n.y,z:n.z},a=(0,b.z0)(t,o),e.abrupt("return",new Promise((function(e){i?i(o,(function(t,r){if(t||!r){var i=new ce({layers:{defaultLayer:{features:[]}}},n.x,n.y,n.z);e(i)}else{var o={layers:{defaultLayer:{features:r.features}}},a=new ce(o,n.x,n.y,n.z);e(a)}})):(0,b.Yu)(g()(g()({},r),{},{url:a}),(function(t,r){if(t||!r){var i=new ce({layers:{defaultLayer:{features:[]}}},n.x,n.y,n.z);e(i)}else{var o=JSON.parse(r),a=new ce({layers:{defaultLayer:{features:o}}},n.x,n.y,n.z);e(a)}}))})));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}();var ye=n(9308),_e=n(3093),be=n.n(_e),xe=function(){function e(t,n,r,i){oe()(this,e),le()(this,"vectorTile",void 0),le()(this,"vectorLayerCache",{}),le()(this,"x",void 0),le()(this,"y",void 0),le()(this,"z",void 0),this.x=n,this.y=r,this.z=i,this.vectorTile=new ye.VectorTile(new(be())(t))}return se()(e,[{key:"getTileData",value:function(e){if(!e||!this.vectorTile.layers[e])return[];if(this.vectorLayerCache[e])return this.vectorLayerCache[e];var t=this.vectorTile.layers[e];if(Array.isArray(t.features))return this.vectorLayerCache[e]=t.features,t.features;for(var n=[],r=0;r<t.length;r++){var i=t.feature(r).toGeoJSON(this.x,this.y,this.z);n.push(g()(g()({},i),{},{properties:g()({id:i.id},i.properties)}))}return this.vectorLayerCache[e]=n,n}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Ee={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},Se=function(){var e=k()(R()().mark((function e(t,n,r,i,o){var a;return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,b.z0)(t,n),e.abrupt("return",new Promise((function(e){if(o)o({x:r.x,y:r.y,z:r.z},(function(t,n){if(t||!n)e(void 0);else{var i=new xe(n,r.x,r.y,r.z);e(i)}}));else{var t=(0,b.ks)(g()(g()({},i),{},{url:a}),(function(t,n){if(t||!n)e(void 0);else{var i=new xe(n,r.x,r.y,r.z);e(i)}}));r.xhrCancel=function(){return t.cancel()}}})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();var Ae=n(5570),Te=n.n(Ae),Ce=n(4479),we=n.n(Ce),Re=n(3100),Me=n.n(Re);function ke(e,t){for(var n=t[0],r=n.width,i=n.height,o=t.map((function(e){return e.rasterData})),a=r*i,s=[],u=JSON.stringify(e),l=0;l<a;l++){var c=JSON.parse(u),h=Le(c,o,l);if("number"==typeof h)s.push(h);else{var f=Oe(c);s.push(f)}}return s}function Le(e,t,n){if(2===e.length&&"band"===e[0]&&"number"==typeof e[1])try{return t[e[1]][n]}catch(e){return console.warn("Raster Data err!"),0}e.map((function(r,i){if(Array.isArray(r)&&r.length>0)if("band"===r[0])try{e[i]=t[r[1]][n]}catch(t){console.warn("Raster Data err!"),e[i]=0}else Le(r,t,n)}))}function Oe(e){var t=function(e){var t=Me()(e,3),n=t[0],r=t[1],i=void 0===r?-1:r,o=t[2],a=void 0===o?-1:o;return void 0===n?(console.warn("Express err!"),["+",0,0]):[n.replace(/\s+/g,""),i,a]}(e),n=t[0],r=t[1],i=t[2];return Array.isArray(r)&&(r=Oe(e[1])),Array.isArray(i)&&(i=Oe(e[2])),function(e,t,n){switch(e){case"+":return t+n;case"-":return t-n;case"*":return t*n;case"/":return t/n;case"%":return t%n;case"^":return Math.pow(t,n);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return-1===n?Math.atan(t):Math.atan2(t,n);case"min":return Math.min(t,n);case"max":return Math.max(t,n);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}(n,r,i)}var Pe={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:function(e,t){for(var n=e[0].rasterData,r=e[1].rasterData,i=e[2].rasterData,o=[],a=(null==t?void 0:t.countCut)||[2,98],s=Me()(a,2),u=s[0],l=s[1],c=(null==t?void 0:t.RMinMax)||Ie(n,u,l),h=(null==t?void 0:t.GMinMax)||Ie(r,u,l),f=(null==t?void 0:t.BMinMax)||Ie(i,u,l),p=0;p<n.length;p++)o.push(Math.max(0,n[p]-c[0])),o.push(Math.max(0,r[p]-h[0])),o.push(Math.max(0,i[p]-f[0]));return{rasterData:o,rMinMax:c,gMinMax:h,bMinMax:f}}}};function Ie(e,t,n){var r=e.slice().sort((function(e,t){return e-t})),i=r.length;return[r[Math.ceil(i*t/100)],r[Math.ceil(i*n/100)]]}function Ne(e,t,n){return De.apply(this,arguments)}function De(){return De=k()(R()().mark((function e(t,n,r){var i,o,a,s,u,l;return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return e.next=4,Promise.all(t.map((function(e){var t=e.data,r=e.bands;return n(t,void 0===r?[0]:r)})));case 4:i=e.sent,o=[],i.forEach((function(e){Array.isArray(e)?o.push.apply(o,we()(e)):o.push(e)})),a=o[0],s=a.width,u=a.height,e.t0=Te()(r),e.next="function"===e.t0?11:"object"===e.t0?13:15;break;case 11:return l=r(o),e.abrupt("break",16);case 13:return l=Array.isArray(r)?{rasterData:ke(r,o)}:Be(r,o),e.abrupt("break",16);case 15:l={rasterData:o[0].rasterData};case 16:return e.abrupt("return",g()(g()({},l),{},{width:s,height:u}));case 17:case"end":return e.stop()}}),e)}))),De.apply(this,arguments)}function Be(e,t){var n=Pe[e.type];return"function"===n.type?n.method(t,null==e?void 0:e.options):"operation"===n.type?"rgb"===e.type?function(e,t){void 0===e.r&&console.warn("Channel R lost in Operation! Use band[0] to fill!");void 0===e.g&&console.warn("Channel G lost in Operation! Use band[0] to fill!");void 0===e.b&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var n=ke(e.r||["band",0],t),r=ke(e.g||["band",0],t),i=ke(e.b||["band",0],t);return[n,r,i]}(n.expression,t):{rasterData:ke(n.expression,t)}:void 0}function Fe(e,t,n,r){return Ue.apply(this,arguments)}function Ue(){return(Ue=k()(R()().mark((function e(t,n,r,i){var o;return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ne(t,n,r);case 2:o=e.sent,i(null,{data:o});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ze=n(3292),Ge=function(){var e=k()(R()().mark((function e(t,n,r,i){return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){n({x:t.x,y:t.y,z:t.z},(function(t,n){t||0===n.length?o(t):n&&Fe([{data:n,bands:[0]}],r,i,(function(t,n){t?o(t):n&&e(n)}))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),je=function(){var e=k()(R()().mark((function e(t,n){return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){n({x:t.x,y:t.y,z:t.z},(function(t,n){!t&&n?n instanceof ArrayBuffer?(0,b.Co)(n,(function(t,n){t&&r(t),e(n)})):n instanceof HTMLImageElement?e(n):r(t):r(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function Ve(e,t){return Array.isArray(e)?"string"==typeof e[0]?e.map((function(e){return(0,b.z0)(e,t)})):e.map((function(e){return{url:(0,b.z0)(e.url,t),bands:e.bands||[0]}})):(0,b.z0)(e,t)}function He(e,t){e.xhrCancel=function(){t.map((function(e){e.abort()}))}}var We=function(){var e=k()(R()().mark((function e(t,n,r,i,o){var a,s,u,l,c,h;return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=n.url,!((a="string"==typeof f?[{url:f,bands:[0]}]:"string"==typeof f[0]?f.map((function(e){return{url:e,bands:[0]}})):f).length>1)){e.next=15;break}return e.next=4,Ze(a,n);case 4:if(s=e.sent,u=s.rasterFiles,l=s.xhrList,c=s.errList,He(t,l),!(c.length>0)){e.next=12;break}return r(c,null),e.abrupt("return");case 12:Fe(u,i,o,r),e.next=17;break;case 15:h=(0,b.ks)(n,(function(e,t){if(e)r(e);else if(t){Fe([{data:t,bands:a[0].bands}],i,o,r)}})),He(t,[h]);case 17:case"end":return e.stop()}var f}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();function Ze(e,t){return Xe.apply(this,arguments)}function Xe(){return(Xe=k()(R()().mark((function e(t,n){var r,i,o,a,s,u,l,c,h,f,p;return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=[],o=[],a=0;case 4:if(!(a<t.length)){e.next=20;break}return s=t[a],u=g()(g()({},n),{},{url:s.url}),l=s.bands,e.next=10,(0,b.LF)(g()(g()({},u),{},{type:"arrayBuffer"}));case 10:c=e.sent,h=c.err,f=c.data,p=c.xhr,h&&o.push(h),i.push(p),r.push({data:f,bands:l});case 17:a++,e.next=4;break;case 20:return e.abrupt("return",{rasterFiles:r,xhrList:i,errList:o});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ye=function(){var e=k()(R()().mark((function e(t,n,r,i,o){var a;return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={url:Ve(t,n)},e.abrupt("return",new Promise((function(e,t){We(r,a,(function(n,r){n?t(n):r&&e(r)}),i,o)})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),qe=function(){var e=k()(R()().mark((function e(t,n,r,i){var o,a,s,u;return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Array.isArray(t)?t[0]:t,i.wmtsOptions?(s=(null==i?void 0:i.getURLFromTemplate)||b.jG,o=s(a,g()(g()({},n),i.wmtsOptions))):(u=(null==i?void 0:i.getURLFromTemplate)||b.z0,o=u(a,n)),e.abrupt("return",new Promise((function(e,t){var n,a=(0,b.gJ)({url:o,type:(null==i||null===(n=i.requestParameters)||void 0===n?void 0:n.type)||"arrayBuffer"},(function(n,r){n?t(n):r&&e(r)}),i.transformResponse);r.xhrCancel=function(){return a.cancel()}})));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),Ke=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Qe={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};ze.RasterTileType.ARRAYBUFFER,ze.RasterTileType.RGB;function $e(e){return!(!Array.isArray(e)||0!==e.length)||!Array.isArray(e)&&"string"!=typeof e}var Je=n(2760),et=n.n(Je),tt=["extent","coordinates","min","max","width","height","format","operation"];var nt={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},rt=function(){var e=k()(R()().mark((function e(t){return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=Me()(t.bounds,4),r=n[0],i=n[1],o=n[2],a=n[3];e({layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(r+o)/2,y:(i+a)/2},geometry:{type:"LineString",coordinates:[[o,a],[o,i],[r,i],[r,i]]}}]}}})})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var it=["extent","coordinates","width","height"];var ot=["extent","coordinates","width","height"];var at=n(6626),st=n.n(at),ut=n(7267),lt=n.n(ut),ct=n(9913),ht=n.n(ct),ft=n(7204),pt=n(2490),dt=n(4068),vt=n.n(dt);function mt(e,t){var n=t.radius,r=void 0===n?40:n,i=t.maxZoom,o=void 0===i?18:i,a=t.minZoom,s=void 0===a?0:a,u=t.zoom,l=void 0===u?2:u;if(e.pointIndex){var c=e.pointIndex.getClusters(e.extent,Math.floor(l));return e.dataArray=c.map((function(e,t){return g()({coordinates:e.geometry.coordinates,_id:t+1},e.properties)})),e}var h=new(vt())({radius:r,minZoom:s,maxZoom:o}),f={type:"FeatureCollection",features:[]};return f.features=e.dataArray.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:g()({},e)}})),h.load(f.features),h}function gt(e){if(0===e.length)return 0;for(var t,n=e[0],r=0,i=1;i<e.length;i++)t=n+1*e[i],Math.abs(n)>=Math.abs(e[i])?r+=n-t+e[i]:r+=e[i]-t+n,n=t;return n+1*r}var yt={min:function(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t},max:function(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t},mean:function(e){if(0===e.length)throw new Error("mean requires at least one data point");return gt(e)/e.length},sum:gt},_t=b.rU.cloneDeep,bt=b.rU.isFunction,xt=b.rU.isString,Et=b.rU.mergeWith;function St(e,t){if(Array.isArray(t))return t}var At=function(e){lt()(a,e);var t,n,i=ht()(a);function a(e,t){var n;return oe()(this,a),n=i.call(this),le()(st()(n),"type","source"),le()(st()(n),"isTile",!1),le()(st()(n),"inited",!1),le()(st()(n),"data",void 0),le()(st()(n),"center",void 0),le()(st()(n),"extent",void 0),le()(st()(n),"hooks",{init:new ft.ni}),le()(st()(n),"parser",{type:"geojson"}),le()(st()(n),"transforms",[]),le()(st()(n),"cluster",!1),le()(st()(n),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),le()(st()(n),"tileset",void 0),le()(st()(n),"invalidExtent",!1),le()(st()(n),"dataArrayChanged",!1),le()(st()(n),"originData",void 0),le()(st()(n),"rawData",void 0),le()(st()(n),"cfg",{autoRender:!0}),le()(st()(n),"clusterIndex",void 0),n.originData=e,n.initCfg(t),n.init().then((function(){n.inited=!0,n.emit("update",{type:"inited"})})),n}return se()(a,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}},{key:"getClustersLeaves",value:function(e){return this.clusterIndex.getLeaves(e,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(e){var t=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,a=n.field,s=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,s.forEach((function(e){e.id||(e.properties.point_count=1)})),(a||bt(i))&&(s=s.map((function(e){var n=e.id;if(n){var r,o=t.clusterIndex.getLeaves(n,1/0).map((function(e){return e.properties}));if(xt(i)&&a){var s=function(e,t){return e.map((function(e){return 1*e[t]}))}(o,a);r=yt[i](s)}bt(i)&&(r=i(o)),e.properties.stat=r}else e.properties.point_count=1;return e}))),this.data=o("geojson")({type:"FeatureCollection",features:s}),this.executeTrans()}},{key:"getFeatureById",value:function(e){var t=this.parser,n=t.type,r=void 0===n?"geojson":n,i=t.geometry;if("geojson"!==r||this.cluster)return"json"===r&&i?this.data.dataArray.find((function(t){return t._id===e})):e<this.data.dataArray.length?this.data.dataArray[e]:"null";var o=e<this.originData.features.length?this.originData.features[e]:"null",a=_t(o);if(null!=a&&a.properties&&(0!==this.transforms.length||this.dataArrayChanged)){var s=this.data.dataArray.find((function(t){return t._id===e}));a.properties=s}return a}},{key:"updateFeaturePropertiesById",value:function(e,t){this.data.dataArray=this.data.dataArray.map((function(n){return n._id===e?g()(g()({},n),t):n})),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(e,t){var n=this.data.dataArray.find((function(n){return n[e]===t}));return null==n?void 0:n._id}},{key:"setData",value:function(e,t){var n=this;this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init().then((function(){n.emit("update",{type:"update"})}))}},{key:"reloadAllTile",value:function(){var e;null===(e=this.tileset)||void 0===e||e.reloadAll()}},{key:"reloadTilebyId",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileById(e,t,n)}},{key:"reloadTileByLnglat",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileByLnglat(e,t,n)}},{key:"getTileExtent",value:function(e,t){var n;return null===(n=this.tileset)||void 0===n?void 0:n.getTileExtent(e,t)}},{key:"getTileByZXY",value:function(e,t,n){var r;return null===(r=this.tileset)||void 0===r?void 0:r.getTileByZXY(e,t,n)}},{key:"reloadTileByExtent",value:function(e,t){var n;null===(n=this.tileset)||void 0===n||n.reloadTileByExtent(e,t)}},{key:"destroy",value:function(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null===(e=this.tileset)||void 0===e||e.destroy()}},{key:"processData",value:(n=k()(R()().mark((function e(){var t=this;return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){try{t.excuteParser(),t.initCluster(),t.executeTrans(),e({})}catch(e){n(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"initCfg",value:function(e){this.cfg=Et(this.cfg,e,St);var t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=g()(g()({},this.clusterOptions),t.clusterOptions)))}},{key:"init",value:(t=k()(R()().mark((function e(){return R()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.inited=!1,e.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"excuteParser",value:function(){var e=this.parser,t=e.type||"geojson",n=o(t);this.data=n(this.originData,e),this.tileset=this.initTileset(),e.cancelExtent||(this.extent=(0,b.We)(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var e=this.data.tilesetOptions;if(e)return this.isTile=!0,this.tileset?(this.tileset.updateOptions(e),this.tileset):new b.nx(g()({},e))}},{key:"executeTrans",value:function(){var e=this;this.transforms.forEach((function(t){var n=function(e){return r[e]}(t.type)(e.data,t);Object.assign(e.data,n)}))}},{key:"initCluster",value:function(){if(this.cluster){var e=this.clusterOptions||{};this.clusterIndex=mt(this.data,e)}}},{key:"caculClusterExtent",value:function(e){var t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=(0,b.yA)((0,b.ds)(this.extent),e)),t[0].concat(t[1])}}]),a}(pt.EventEmitter);var Tt=n(6970),Ct=n.n(Tt),wt=6378e3;var Rt=Math.PI/3,Mt=[0,Rt,2*Rt,3*Rt,4*Rt,5*Rt];function kt(e){return e[0]}function Lt(e){return e[1]}n(9397);a("rasterTile",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if($e(e))throw new Error("tile server url is error");var n=(null==t?void 0:t.dataType)||ze.RasterTileType.IMAGE;n===ze.RasterTileType.RGB&&(n=ze.RasterTileType.ARRAYBUFFER);var r=function(r,i){switch(n){case ze.RasterTileType.IMAGE:return qe(e,r,i,t);case ze.RasterTileType.CUSTOMIMAGE:case ze.RasterTileType.CUSTOMTERRAINRGB:return je(i,null==t?void 0:t.getCustomData);case ze.RasterTileType.ARRAYBUFFER:return Ye(e,r,i,(null==t?void 0:t.format)||Ke,null==t?void 0:t.operation);case ze.RasterTileType.CUSTOMARRAYBUFFER:case ze.RasterTileType.CUSTOMRGB:return Ge(i,null==t?void 0:t.getCustomData,(null==t?void 0:t.format)||Ke,null==t?void 0:t.operation);default:return qe(e,r,i,t)}},i=g()(g()(g()({},Qe),t),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}})),a("mvt",(function(e,t){var n=Array.isArray(e)?e[0]:e,r=g()(g()(g()({},Ee),t),{},{getTileData:function(e,r){return Se(n,e,r,null==t?void 0:t.requestParameters,null==t?void 0:t.getCustomData)}});return{data:n,dataArray:[],tilesetOptions:r,isTile:!0}})),a("geojsonvt",(function(e,t){var n=function(e){var t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return void 0===e||void 0===e.geojsonvtOptions?t:g()(g()({},t),e.geojsonvtOptions)}(t),r=n.extent||4096,i=function(e,t){return new ne(e,t)}(e,n);return{data:e,dataArray:[],tilesetOptions:g()(g()(g()({},he),t),{},{getTileData:function(e,t){return ve(t,i,e,r)}}),isTile:!0}})),a("testTile",(function(e,t){return{data:e,dataArray:[],tilesetOptions:g()(g()(g()({},nt),t),{},{getTileData:function(e){return rt(e)}}),isTile:!0}})),a("geojson",(function(e,t){var n=[],r={};return e.features?(e.features=e.features.filter((function(e){var t=e.geometry;return null!=e&&t&&t.type&&t.coordinates&&t.coordinates.length>0})),0===(e=A(e)).features.length?{dataArray:[],featureKeys:r}:((0,_.nG)(e,(function(e,r){var i,o,a=(i=e,void 0===(o=null==t?void 0:t.featureId)?null:"number"==typeof(1*i.properties[o])?1*i.properties[o]:i.properties&&i.properties[o]?function(e){for(var t=e.toString(),n=5381,r=t.length;r;)n=33*n^t.charCodeAt(--r);return n>>>0}(i.properties[o]+"")%1000019:null);null===a&&(a=r);var s=a,u=(0,y.r7)(e),l=g()(g()({},e.properties),{},{coordinates:u,_id:s});n.push(l)})),{dataArray:n,featureKeys:r})):(e.features=[],{dataArray:[]})})),a("jsonTile",(function(e,t){return{dataArray:[],tilesetOptions:g()(g()({},t),{},{getTileData:function(n,r){return ge(e,r,null==t?void 0:t.requestParameters,t.getCustomData)}}),isTile:!0}})),a("image",me),a("csv",(function(e,t){return C(v(e),t)})),a("json",C),a("raster",(function(e,t){var n,r,i,o=t.extent,a=void 0===o?[121.168,30.2828,121.384,30.4219]:o,s=t.coordinates,u=t.width,l=t.height,c=t.min,h=t.max,f=t.format,p=t.operation;return void 0===f||S(e)?(n=Array.from(e),r=u,i=l):n=Ne(Array.isArray(e)?e:[e],f,p),{_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:c,max:h,coordinates:T(s,a)}]}})),a("rasterRgb",(function(e,t){var n,r=t.extent,i=t.coordinates,o=t.min,a=t.max,s=t.width,u=t.height,l=t.format,c=t.operation,h=et()(t,tt);n=void 0===l||S(e)?Array.from(e):Ne(Array.isArray(e)?e:[e],l,c);var f=T(i,r);return{_id:1,dataArray:[g()(g()({_id:1,data:n,width:s,height:u},h),{},{min:o,max:a,coordinates:f})]}})),a("rgb",(function(e,t){var n=t.extent,r=t.coordinates,i=t.width,o=t.height,a=et()(t,it);e.length<3&&console.warn("RGB解析需要三个波段的数据");for(var s=a.bands||[0,1,2],u=Me()(s,3),l=u[0],c=u[1],h=u[2],f=[e[l],e[c],e[h]],p=[],d=(null==a?void 0:a.countCut)||[2,98],v=Me()(d,2),m=v[0],y=v[1],_=(null==a?void 0:a.RMinMax)||Ie(f[0],m,y),b=(null==a?void 0:a.GMinMax)||Ie(f[1],m,y),x=(null==a?void 0:a.BMinMax)||Ie(f[2],m,y),E=0;E<f[0].length;E++)p.push(Math.max(0,f[0][E]-_[0])),p.push(Math.max(0,f[1][E]-b[0])),p.push(Math.max(0,f[2][E]-x[0]));var S=T(r,n);return{_id:1,dataArray:[g()(g()({_id:1,data:p,width:i,height:o,rMinMax:_,gMinMax:b,bMinMax:x},a),{},{coordinates:S})]}})),a("ndi",(function(e,t){var n=t.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=t.coordinates,o=t.width,a=t.height,s=et()(t,ot);e.length<2&&console.warn("RGB解析需要2个波段的数据");for(var u=s.bands||[0,1],l=Me()(u,2),c=l[0],h=l[1],f=[e[c],e[h]],p=[],d=0;d<f[0].length;d++)p.push((f[1][d]-f[0][d])/(f[1][d]+f[0][d]));var v=T(i,r);return{_id:1,dataArray:[g()(g()({_id:1,data:p,width:o,height:a},s),{},{coordinates:v})]}})),s("cluster",mt),s("filter",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.filter(n)),e})),s("join",(function(e,t){var n=t.sourceField,r=t.targetField,i=t.data,o={};return i.forEach((function(e){o[e[n]]=e})),e.dataArray=e.dataArray.map((function(e){var t=e[r];return g()(g()({},e),o[t])})),e})),s("map",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.map(n)),e})),s("grid",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=i/(2*Math.PI*wt)*(256<<20)/2,a=function(e,t){var n,r,i=1/0,o=-1/0,a=Ct()(e);try{for(a.s();!(r=a.n()).done;){n=r.value.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}}catch(e){a.e(e)}finally{a.f()}var s=(u=t,l=(i+o)/2,f=u,c=f/wt*(180/Math.PI),h=function(e,t){return t/wt*(180/Math.PI)/Math.cos(e*Math.PI/180)}(l,u),{yOffset:c,xOffset:h});var u,l,c,h,f;if(s.xOffset<=0||s.yOffset<=0)return{gridHash:{},gridOffset:s};var p,d={},v=Ct()(e);try{for(v.s();!(p=v.n()).done;){var m=p.value,g=m.coordinates[1],y=m.coordinates[0];if(Number.isFinite(g)&&Number.isFinite(y)){var _=Math.floor((g+90)/s.yOffset),b=Math.floor((y+180)/s.xOffset),x="".concat(_,"-").concat(b);d[x]=d[x]||{count:0,points:[]},d[x].count+=1,d[x].points.push(m)}}}catch(e){v.e(e)}finally{v.f()}return{gridHash:d,gridOffset:s}}(n,i),s=function(e,t,n){return Object.keys(e).reduce((function(r,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),l={};if(n.field&&n.method){var c=b.a5.getColumn(e[i].points,n.field);l[n.method]=b.a5.statMap[n.method](c)}return Object.assign(l,{_id:o,coordinates:(0,b.Z)([t.xOffset*(u+.5)-180,t.yOffset*(s+.5)-90]),rawData:e[i].points,count:e[i].count}),r.push(l),r}),[])}(a.gridHash,a.gridOffset,t);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:s}})),s("hexagon",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=t.method,a=void 0===o?"sum":o,s=i/(2*Math.PI*6378e3)*(256<<20)/2,u=n.map((function(e){var t=(0,b.Z)(e.coordinates),n=Me()(t,2),r=n[0],i=n[1];return g()(g()({},e),{},{coordinates:[r,i]})})),l=function(){var e,t,n,r=0,i=0,o=1,a=1,s=kt,u=Lt;function l(e){var r,i={},o=[],a=e.length;for(r=0;r<a;++r)if(!isNaN(c=+s.call(null,l=e[r],r,e))&&!isNaN(h=+u.call(null,l,r,e))){var l,c,h,f=Math.round(h/=n),p=Math.round(c=c/t-(1&f)/2),d=h-f;if(3*Math.abs(d)>1){var v=c-p,m=p+(c<p?-1:1)/2,g=f+(h<f?-1:1),y=c-m,_=h-g;v*v+d*d>y*y+_*_&&(p=m+(1&f?1:-1)/2,f=g)}var b=p+"-"+f,x=i[b];x?x.push(l):(o.push(x=i[b]=[l]),x.x=(p+(1&f)/2)*t,x.y=f*n)}return o}function c(e){var t=0,n=0;return Mt.map((function(r){var i=Math.sin(r)*e,o=-Math.cos(r)*e,a=i-t,s=o-n;return t=i,n=o,[a,s]}))}return l.hexagon=function(t){return"m"+c(null==t?e:+t).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(i/n),l=Math.round(r/t),c=u*n;c<a+e;c+=n,++u)for(var h=l*t+(1&u)*t/2;h<o+t/2;h+=t)s.push([h,c]);return s},l.mesh=function(){var t=c(e).slice(0,4).join("l");return l.centers().map((function(e){return"M"+e+"m"+t})).join("")},l.x=function(e){return arguments.length?(s=e,l):s},l.y=function(e){return arguments.length?(u=e,l):u},l.radius=function(r){return arguments.length?(t=2*(e=+r)*Math.sin(Rt),n=1.5*e,l):e},l.size=function(e){return arguments.length?(r=i=0,o=+e[0],a=+e[1],l):[o-r,a-i]},l.extent=function(e){return arguments.length?(r=+e[0][0],i=+e[0][1],o=+e[1][0],a=+e[1][1],l):[[r,i],[o,a]]},l.radius(1)}().radius(s).x((function(e){return e.coordinates[0]})).y((function(e){return e.coordinates[1]}));return{dataArray:l(u).map((function(e,n){if(t.field&&a){var r=b.a5.getColumn(e,t.field);e[a]=b.a5.statMap[a](r)}return le()(le()(le()(le()(le()({},t.method,e[a]),"count",e.length),"rawData",e),"coordinates",[e.x,e.y]),"_id",n)})),radius:s,xOffset:s,yOffset:s,type:"hexagon"}}));var Ot=At},9397:function(){},6490:function(e,t,n){"use strict";n.d(t,{Uj:function(){return S},e2:function(){return dn},SO:function(){return r},iH:function(){return Ot},z6:function(){return Mn},Qj:function(){return Wn},T:function(){return gn},a5:function(){return i},SA:function(){return x},LZ:function(){return nr},nx:function(){return sr},dD:function(){return Hn},Z:function(){return qt},TG:function(){return Qt},S8:function(){return $t},rQ:function(){return F},bV:function(){return B},zi:function(){return U},ds:function(){return rn},Ev:function(){return Lt},oO:function(){return nn},mt:function(){return un},Lw:function(){return an},SI:function(){return hn},Rx:function(){return fn},W0:function(){return V},LS:function(){return fr},h8:function(){return vn},Z6:function(){return H},Gk:function(){return lr},We:function(){return zt},ls:function(){return cn},Co:function(){return D},hj:function(){return X},Cl:function(){return W},Oc:function(){return q},M4:function(){return Z},NJ:function(){return Y},_O:function(){return ln},ks:function(){return R},Ol:function(){return pn},fj:function(){return ee},Yu:function(){return k},ZB:function(){return Q},gJ:function(){return N},xA:function(){return w},Y3:function(){return E},an:function(){return Ct},rJ:function(){return er},qD:function(){return tr},z0:function(){return cr},jG:function(){return hr},M8:function(){return mn},Dt:function(){return Mt},D5:function(){return G},fg:function(){return At},Ro:function(){return kt},Xj:function(){return ur},hJ:function(){return Tt},Tt:function(){return Rt},pq:function(){return Xt},LT:function(){return wn},wj:function(){return Rn},if:function(){return Ut},vP:function(){return Ht},yM:function(){return Jt},rU:function(){return Xe},MS:function(){return Zt},LF:function(){return T},Uv:function(){return Wt},Fv:function(){return on},RV:function(){return Qn},cN:function(){return $n},yA:function(){return tn},qC:function(){return M},iV:function(){return en},CI:function(){return j},_0:function(){return L},Dv:function(){return Jn},Jo:function(){return jt},ih:function(){return Kt},Fb:function(){return Yt}});var r={};n.r(r),n.d(r,{DPR:function(){return pt},addClass:function(){return et},addStyle:function(){return dt},appendElementType:function(){return Et},clearChildren:function(){return bt},create:function(){return $e},css2Style:function(){return gt},empty:function(){return at},findParentElement:function(){return St},getClass:function(){return ot},getContainer:function(){return qe},getDiffRect:function(){return yt},getStyleList:function(){return vt},getViewPortScale:function(){return ht},hasClass:function(){return nt},printCanvas:function(){return ct},remove:function(){return Je},removeClass:function(){return tt},removeStyle:function(){return mt},setChecked:function(){return _t},setClass:function(){return rt},setTransform:function(){return ut},setUnDraggable:function(){return xt},splitWords:function(){return Qe},toggleClass:function(){return it},triggerResize:function(){return lt},trim:function(){return Ke}});var i={};n.r(i),n.d(i,{getColumn:function(){return Dn},getSatByColumn:function(){return Bn},max:function(){return kn},mean:function(){return Pn},min:function(){return Ln},mode:function(){return In},statMap:function(){return Nn},sum:function(){return On}});var o=n(1448),a=n.n(o),s=n(8798),u=n.n(s),l=n(4528),c=n.n(l),h=n(6626),f=n.n(h),p=n(7267),d=n.n(p),v=n(9913),m=n.n(v),g=n(9845),y=n.n(g),_=n(9057),b=n.n(_),x={REGISTERED_PROTOCOLS:{}},E=function(e){return x.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))]},S=function(e){d()(n,e);var t=m()(n);function n(e,r,i,o){var a;return c()(this,n),a=t.call(this,"AJAXError: ".concat(r," (").concat(e,"): ").concat(i)),b()(f()(a),"status",void 0),b()(f()(a),"statusText",void 0),b()(f()(a),"url",void 0),b()(f()(a),"body",void 0),a.status=e,a.statusText=r,a.url=i,a.body=o,a}return u()(n)}(y()(Error));function A(e,t){var n=new XMLHttpRequest,r=Array.isArray(e.url)?e.url[0]:e.url;for(var i in n.open(e.method||"GET",r,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer"),e.headers)e.headers.hasOwnProperty(i)&&n.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===e.type)try{i=JSON.parse(n.response)}catch(e){return t(e)}t(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"),n)}else{var o=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});t(new S(n.status,n.statusText,r.toString(),o))}},n.cancel=n.abort,n.send(e.body),n}function T(e){return new Promise((function(t,n){A(e,(function(e,r,i,o,a){e?n({err:e,data:null,xhr:a}):t({err:null,data:r,cacheControl:i,expires:o,xhr:a})}))}))}function C(e,t){return A(e,t)}var w=function(e,t){return(E(e.url)||C)(a()(a()({},e),{},{type:"json"}),t)},R=function(e,t){return(E(e.url)||C)(a()(a()({},e),{},{type:"arrayBuffer"}),t)},M=function(e,t){return C(a()(a()({},e),{},{method:"POST"}),t)},k=function(e,t){return C(a()(a()({},e),{},{method:"GET"}),t)};function L(e){var t=window.document.createElement("a");return t.href=e,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}var O="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function P(e,t){var n=new window.Image,r=window.URL||window.webkitURL;n.crossOrigin="anonymous",n.onload=function(){t(null,n),r.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((function(){n.src=O}))},n.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?r.createObjectURL(i):O}function I(e,t){var n=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(n).then((function(e){t(null,e)})).catch((function(e){t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}var N=function(e,t,n){var r=function(e,r){if(e)t(e);else if(r){var i="function"==typeof createImageBitmap,o=n?n(r):r;i?I(o,t):P(o,t)}};return"json"===e.type?w(e,r):R(e,r)},D=function(e,t){"function"==typeof createImageBitmap?I(e,t):P(e,t)},B=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),F={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function U(e,t,n){var r=e.classList;for(var i in F)F.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(t))}var z=n(3905);function G(e){return"string"==typeof e&&!!z.ZP(e)}function j(e){var t=z.ZP(e),n=[0,0,0,0];return null!=t&&(n[0]=t.r/255,n[1]=t.g/255,n[2]=t.b/255,n[3]=t.opacity),n}function V(e){return(e&&e[0])+256*(e&&e[1])+65536*(e&&e[2])-1}function H(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function W(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r,i=n.createLinearGradient(0,0,256,1),o=e.positions[0],a=e.positions[e.positions.length-1],s=0;s<e.colors.length;++s){var u=(e.positions[s]-o)/(a-o);i.addColorStop(u,e.colors[s])}return n.fillStyle=i,n.fillRect(0,0,256,1),r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),t=null,n=null,{data:r,width:256,height:1}}function Z(e,t){var n=window.document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),o=t[1]-t[0],a=0;a<e.colors.length;++a){var s=Math.max((e.positions[a]-t[0])/o,0);i.addColorStop(s,e.colors[a])}r.fillStyle=i,r.fillRect(0,0,256,1);var u=r.getImageData(0,0,256,1).data,l=K(r,u);return n=null,r=null,l}function X(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;var r=n.createImageData(256,1);return r.data.fill(0),e.positions.forEach((function(t,n){var i=j(e.colors[n]);r.data[4*t+0]=255*i[0],r.data[4*t+1]=255*i[1],r.data[4*t+2]=255*i[2],r.data[4*t+3]=255*i[3]})),t=null,n=null,r}function Y(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;for(var r=256/e.colors.length,i=0;i<e.colors.length;i++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[i],n.moveTo(i*r,0),n.lineTo((i+1)*r,0),n.stroke();var o=n.getImageData(0,0,256,1).data,a=K(n,o);return t=null,n=null,a}function q(e,t){var n=window.document.createElement("canvas"),r=n.getContext("2d");r.globalAlpha=1,n.width=256,n.height=1;var i=t[1]-t[0];e.positions.length-e.colors.length!=1&&console.warn("positions 的数字个数应当比 colors 的样式多一个,poisitions 的首尾值一般为数据的最大最新值");for(var o=0;o<e.colors.length;o++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[o],r.moveTo((e.positions[o]-t[0])/i*255,0),r.lineTo((e.positions[o+1]-t[0])/i*255,0),r.stroke();var a=r.getImageData(0,0,256,1).data,s=K(r,a);return n=null,r=null,s}function K(e,t){for(var n=e.createImageData(256,1),r=0;r<n.data.length;r+=4)n.data[r+0]=t[r+0],n.data[r+1]=t[r+1],n.data[r+2]=t[r+2],n.data[r+3]=t[r+3];return n}function Q(e){return"cat"===(null==e?void 0:e.type)?[0,255]:[0,1]}var $=1029,J=1028;function ee(e){switch(e){case"GAODE1.x":case"GAODE2.x":case"GLOBEL":return $;default:return J}}var te=n(4479),ne=n.n(te),re=n(3100),ie=n.n(re),oe=n(6812),ae=n.n(oe),se=n(4412),ue=n.n(se),le=n(4654),ce=n.n(le),he=n(3903),fe=n.n(he),pe=n(5189),de=n.n(pe),ve=n(8243),me=n.n(ve),ge=n(3714),ye=n.n(ge),_e=n(8904),be=n.n(_e),xe=n(5304),Ee=n.n(xe),Se=n(5128),Ae=n.n(Se),Te=n(4434),Ce=n.n(Te),we=n(870),Re=n.n(we),Me=n(1276),ke=n.n(Me),Le=n(3361),Oe=n.n(Le),Pe=n(2788),Ie=n.n(Pe),Ne=n(3214),De=n.n(Ne),Be=n(3002),Fe=n.n(Be),Ue=n(5229),ze=n.n(Ue),Ge=n(8032),je=n.n(Ge),Ve=n(5437),He=n.n(Ve),We=n(5057),Ze=n.n(We),Xe={isNil:ye(),merge:Re(),throttle:Ie(),isString:Ae(),debounce:ce(),pull:Oe(),isTypedArray:Ce(),isPlainObject:Ee(),isNumber:be(),isBoolean:de(),isEqual:me(),cloneDeep:ue(),uniq:De(),clamp:ae(),upperFirst:Fe(),get:fe(),mergeWith:ke(),isFunction:ze(),isObject:je(),isUndefined:He(),camelCase:Ze()},Ye=Xe.pull;function qe(e){var t=e;return"string"==typeof e&&(t=window.document.getElementById(e)),t}function Ke(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Qe(e){return Ke(e).split(/\s+/)}function $e(e,t,n){var r=window.document.createElement(e);return t&&(r.className=t||""),n&&n.appendChild(r),r}function Je(e){var t=e.parentNode;t&&t.removeChild(e)}function et(e,t){if(void 0!==e.classList)for(var n=Qe(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!nt(e,t)){var o=ot(e);rt(e,(o?o+" ":"")+t)}}function tt(e,t){void 0!==e.classList?Qe(t).forEach((function(t){e.classList.remove(t)})):rt(e,Ke((" "+ot(e)+" ").replace(" "+t+" "," ")))}function nt(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=ot(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function rt(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function it(e,t,n){void 0===n?nt(e,t)?tt(e,t):et(e,t):n?et(e,t):tt(e,t)}function ot(e){return e instanceof SVGElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function at(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var st=function(e){var t,n=null===(t=document)||void 0===t||null===(t=t.documentElement)||void 0===t?void 0:t.style;if(!n)return e[0];for(var r in e)if(e[r]&&e[r]in n)return e[r];return e[0]}(["transform","WebkitTransform"]);function ut(e,t){e.style[st]=t}function lt(){if("function"==typeof Event)window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function ct(e){var t=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log("%c\n",t.join(""))}function ht(){var e,t=window.document.querySelector('meta[name="viewport"]');if(!t)return 1;var n=(null===(e=t.content)||void 0===e?void 0:e.split(",")).find((function(e){var t=e.split("=");return"initial-scale"===ie()(t,1)[0]}));return n?1*n.split("=")[1]:1}var ft,pt=ht()<1?1:window.devicePixelRatio;function dt(e,t){e.setAttribute("style","".concat(e.style.cssText).concat(t))}function vt(e){return e.split(";").map((function(e){return e.trim()})).filter((function(e){return e}))}function mt(e,t){var n,r=vt(null!==(n=e.getAttribute("style"))&&void 0!==n?n:""),i=vt(t),o=Ye.apply(void 0,[r].concat(ne()(i)));e.setAttribute("style",o.join(";"))}function gt(e){return Object.entries(e).map((function(e){var t=ie()(e,2),n=t[0],r=t[1];return"".concat(n,": ").concat(r)})).join(";")}function yt(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function _t(e,t){e.checked=t,t?e.setAttribute("checked","true"):e.removeAttribute("checked")}function bt(e){e.innerHTML=""}function xt(e){e.setAttribute("draggable","false")}function Et(e,t){if("string"==typeof t){var n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)e.append(n.firstChild)}else Array.isArray(t)?e.append.apply(e,ne()(t)):e.append(t)}function St(e,t){for(var n=Array.isArray(t)?t:[t],r=e;r instanceof Element&&r!==window.document.body;){var i,o;if(n.find((function(e){var t;return null===(t=r)||void 0===t?void 0:t.matches(e)})))return r;r=null!==(i=null===(o=r)||void 0===o?void 0:o.parentElement)&&void 0!==i?i:null}}function At(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}function Tt(){return"function"==typeof importScripts}var Ct=Tt()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===window.location.protocol?window.parent:window).location.href},wt=null===(ft=navigator)||void 0===ft?void 0:ft.userAgent,Rt=!!wt.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Mt=wt.indexOf("Android")>-1||wt.indexOf("Adr")>-1;function kt(){for(var e=wt,t=!0,n=0,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];n<r.length;n++){var i=r[n];if(e.indexOf(i)>0){t=!1;break}}return t}function Lt(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}var Ot=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;c()(this,e),b()(this,"duration",16),b()(this,"timestamp",(new Date).getTime()),this.duration=t}return u()(e,[{key:"run",value:function(e){var t=(new Date).getTime(),n=t-this.timestamp;this.timestamp=t,n>=this.duration&&e()}}]),e}(),Pt=n(1612);function It(e){var t=[1/0,1/0,-1/0,-1/0];return(0,Pt.pZ)(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}It.default=It;var Nt=It,Dt=n(2928);function Bt(e){return"number"==typeof e}var Ft=2*Math.PI*6378137/2;function Ut(e,t){var n=ie()(t,4),r=n[0],i=n[1],o=n[2],a=n[3];return e.lng>r&&e.lng<=o&&e.lat>i&&e.lat<=a}function zt(e){var t=[1/0,1/0,-1/0,-1/0];return e.forEach((function(e){var n=e.coordinates;Gt(t,n)})),t}function Gt(e,t){return Array.isArray(t[0])?t.forEach((function(t){Gt(e,t)})):(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])),e}function jt(e,t){return Vt(e,t)}function Vt(e,t){return Array.isArray(e[0])?e.map((function(e){return Vt(e,t)})):t(e)}function Ht(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1},r=(e=Yt(e,t))[0],i=e[1],o=r*Ft/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*Ft/180,n.enable&&(o=Number(o.toFixed(n.decimal)),a=Number(a.toFixed(n.decimal))),3===e.length?[o,a,e[2]]:[o,a]}function Wt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=e[0],r=e[1],i=n/Ft*180,o=r/Ft*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),null!=t&&(i=Number(i.toFixed(t)),o=Number(o.toFixed(t))),3===e.length?[i,o,e[2]]:[i,o]}function Zt(e){if(null==e)throw new Error("lng is required");return(e>180||e<-180)&&((e%=360)>180&&(e=-360+e),e<-180&&(e=360+e),0===e&&(e=0)),e}function Xt(e){if(null==e)throw new Error("lat is required");return(e>90||e<-90)&&((e%=180)>90&&(e=-180+e),e<-90&&(e=180+e),0===e&&(e=0)),e}function Yt(e,t){if(!1===t)return e;var n=Zt(e[0]),r=Xt(e[1]);return r>85&&(r=85),r<-85&&(r=-85),3===e.length?[n,r,e[2]]:[n,r]}function qt(e){var t=85.0511287798,n=Math.max(Math.min(t,e[1]),-t),r=256<<20,i=Math.PI/180,o=e[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));return o=r*(.5/Math.PI*o+.5),a=r*(-.5/Math.PI*a+(i=.5)),[Math.floor(o),Math.floor(a)]}function Kt(e){var t=.5/Math.PI,n=-.5/Math.PI,r=.5,i=256<<20,o=ie()(e,2),a=o[0],s=o[1];return a=(a/i-.5)/t,s=(s/i-r)/n,s=2*(Math.atan(Math.pow(Math.E,s))-Math.PI/4),[a/(r=Math.PI/180),s/r]}function Qt(e,t){var n=85.0511287798,r=Math.PI/180,i=6378137;return t=Math.max(Math.min(n,t),-n),t*=r,[(e*=r)*i,(t=Math.log(Math.tan(Math.PI/4+t/2)))*i]}function $t(e,t){var n=Math.PI/180,r=6378137;return[e/r/n,2*(Math.atan(Math.exp(t/r))-Math.PI/4)/n]}function Jt(e,t,n){var r=(0,Dt.Ht)(t[1]-e[1]),i=(0,Dt.Ht)(t[0]-e[0]),o=(0,Dt.Ht)(e[1]),a=(0,Dt.Ht)(t[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return(0,Dt.DL)(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function en(e){var t=Math.PI/180,n=85.0511287798,r=6378137,i=Math.max(Math.min(n,e[1]),-n),o=Math.sin(i*t);return[r*e[0]*t,r*Math.log((1+o)/(1-o))/2]}function tn(e,t){var n=Math.abs(e[1][1]-e[0][1])*t,r=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-r,e[0][1]-n],[e[1][0]+r,e[1][1]+n]]}function nn(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function rn(e){return[[e[0],e[1]],[e[2],e[3]]]}function on(e){var t=an(e,[0,0]);return[e[0]/t,e[1]/t]}function an(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function sn(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function un(e,t){return 180*Math.acos(function(e,t){return e[0]*t[0]+e[1]*t[1]}(e,t)/(sn(e)*sn(t)))/Math.PI}function ln(e,t){return t[0]>0?t[1]>0?90-180*Math.atan(t[1]/t[0])/Math.PI:90+180*Math.atan(-t[1]/t[0])/Math.PI:t[1]<0?90-180*Math.atan(t[1]/t[0])/Math.PI+180:270+180*Math.atan(t[1]/-t[0])/Math.PI}function cn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(e&&!(e.length<2)){for(var n=0,r=[],i=0;i<e.length-1;i++){var o=e[i],a=e[i+1],s=an(o,a);n+=s;var u=[o[0]-a[0],o[1]-a[1]],l=ln(0,u);if(i>0){var c=r[i-1].rotation;c-l>360-c+l&&(l+=360)}r.push({start:o,end:a,dis:s,rotation:l,duration:0})}return r.map((function(e){e.duration=t*(e.dis/n)})),r}}function hn(e){if(Bt(e[0]))return e;if(Bt(e[0][0]))throw new Error("当前数据不支持标注");if(Bt(e[0][0][0])){var t=0,n=0,r=0;return e.forEach((function(e){e.forEach((function(e){t+=e[0],n+=e[1],r++}))})),[t/r,n/r,0]}throw new Error("当前数据不支持标注")}function fn(e){for(var t=e[0],n=e[1],r=e[0],i=e[1],o=0,a=0,s=0,u=0;u<e.length;u+=2){var l=e[u],c=e[u+1];l&&c&&(t=Math.max(l,t),n=Math.max(c,n),r=Math.min(l,r),i=Math.min(c,i),o+=l,a+=c,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(t-r,2)+Math.pow(n-i,2))/2}}function pn(e){return Nt((0,Dt.uf)([(0,Dt.Tu)(e)]))}function dn(e){var t=0;e+="x";for(var n=Math.floor(65745979961613.07),r=0;r<e.length;r++)t>n&&(t=Math.floor(t/137)),t=131*t+e.charCodeAt(r);return t}function vn(e){for(var t=5381,n=(e=e.toString()).length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}function mn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}var gn=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function yn(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=arguments.length>6?arguments[6]:void 0,s=n;return a&&(s=Math.round(n*(o-1))/(o-1)),xn(e,t,s,r||.314,i)}function _n(e,t){var n=1-t;return(e[0]*n+e[1]*t)*n+(e[1]*n+e[2]*t)*t}function bn(e,t,n){var r,i,o=[t[0]-e[0],t[1]-e[1]],a=(r=o,i=[0,0],Math.sqrt(Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2))),s=Math.atan2(o[1],o[0]),u=a/2/Math.cos(n),l=s+n;return[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]]}function xn(e,t,n,r,i){if(i===gn["GAODE2.x"]){var o=Qt(e[0],e[1]),a=Qt(t[0],t[1]),s=bn(o,a,r),u=[o[0],s[0],a[0]],l=[o[1],s[1],a[1]];return[].concat(ne()($t(_n(u,n),_n(l,n))),[0])}var c=bn(e,t,r),h=[e[0],c[0],t[0]],f=[e[1],c[1],t[1]];return[_n(h,n),_n(f,n),0]}function En(e,t,n,r,i){var o=arguments.length>6?arguments[6]:void 0,a=n;return o&&(a=Math.round(29*n)/29),An(e,t,a,i)}function Sn(e,t){var n=1-t;return(e[0]*n+e[1]*t)*n+(e[1]*n+e[2]*t)*t}function An(e,t,n,r){var i=[(0,Dt.Ht)(e[0]),(0,Dt.Ht)(e[1])],o=[(0,Dt.Ht)(t[0]),(0,Dt.Ht)(t[1])];if("GAODE2.x"===r){var a=function(e,t){var n=[t[0]-e[0],t[1]-e[1]],r=an(n,[0,0]),i=Math.atan2(n[1],n[0]),o=r/2/Math.cos(.314),a=i+.314;return[o*Math.cos(a)+e[0],o*Math.sin(a)+e[1]]}(i,o),s=[i[0],a[0],o[0]],u=[i[1],a[1],o[1]];return[Sn(s,n),Sn(u,n),0]}var l=function(e,t){var n=[e[0]-t[0],e[1]-t[1]],r=[Math.sin(n[0]/2),Math.sin(n[1]/2)],i=r[1]*r[1]+Math.cos(e[1])*Math.cos(t[1])*r[0]*r[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}(i,o);if(Math.abs(l-Math.PI)<.001)return[(1-n)*i[0]+n*o[0],(1-n)*i[1]+n*o[1]];var c=Math.sin((1-n)*l)/Math.sin(l),h=Math.sin(n*l)/Math.sin(l),f=[Math.sin(i[0]),Math.sin(i[1])],p=[Math.cos(i[0]),Math.cos(i[1])],d=[Math.sin(o[0]),Math.sin(o[1])],v=[Math.cos(o[0]),Math.cos(o[1])],m=c*p[1]*p[0]+h*v[1]*v[0],g=c*p[1]*f[0]+h*v[1]*d[0],y=c*f[1]+h*d[1];return[(0,Dt.vi)(Math.atan2(g,m)),(0,Dt.vi)(Math.atan2(y,Math.sqrt(m*m+g*g)))]}function Tn(e,t,n){return[e[0]*n+t[0]*(1-n),e[1]*n+t[1]*(1-n)]}function Cn(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function wn(e,t){var n=t.featureId,r=e.data.dataArray;return"number"==typeof n&&(r=r.filter((function(e){return e.id===n}))),r.map((function(e){var n=function(e,t){var n=t.offset,r=t.shape,i=t.thetaOffset,o=t.mapVersion,a=t.segmentNumber,s=void 0===a?30:a,u=t.autoFit,l=void 0===u||u,c=e.coordinates;if("line"===r)return function(e,t){for(var n=0,r=[],i=0;i<e.length-1;i++){var o=e[i],a=e[i+1],s=Cn(o,a),u=n;n+=s,r.push({p1:o,p2:a,totalDistance:n,distance:s,lastTotalDistance:u})}for(var l,c,h=n*t,f=0,p=r;f<p.length;f++){var d=p[f];if(d.totalDistance>h){var v=d.p1,m=Tn(d.p2,v,(h-d.lastTotalDistance)/d.distance);l=m[0],c=m[1];break}}return{lng:l,lat:c,height:0}}(c,n);var h,f=c[0],p=c[1],d="string"==typeof i?e[i]||0:i;switch(r){case"arc":default:h=yn;break;case"greatcircle":h=En}var v=h(f,p,n,d,o,s,l),m=ie()(v,3),g=m[0],y=m[1],_=m[2];return{lng:g,lat:y,height:_}}(e,t);return a()(a()({},e),n)}))}function Rn(e,t){return new Promise((function(n){e.inited?n(wn(e,t)):e.once("update",(function(){n(wn(e,t))}))}))}var Mn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;c()(this,e),b()(this,"limit",void 0),b()(this,"cache",void 0),b()(this,"destroy",void 0),b()(this,"order",void 0),this.limit=t,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return u()(e,[{key:"clear",value:function(){var e=this;this.order.forEach((function(t){e.delete(t)})),this.cache={},this.order=[]}},{key:"get",value:function(e){var t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}},{key:"set",value:function(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}},{key:"delete",value:function(e){var t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}},{key:"deleteCache",value:function(e){delete this.cache[e]}},{key:"deleteOrder",value:function(e){var t=this.order.findIndex((function(t){return t===e}));t>=0&&this.order.splice(t,1)}},{key:"appendOrder",value:function(e){this.order.push(e)}},{key:"defaultDestroy",value:function(e,t){return null}}]),e}();function kn(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return 1*t}function Ln(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return 1*t}function On(e){if(0===e.length)return 0;for(var t=1*e[0],n=1;n<e.length;n++)t+=1*e[n];return t}function Pn(e){if(0===e.length)throw new Error("mean requires at least one data point");return On(e)/e.length}function In(e){if(0===e.length)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var t=e[0],n=NaN,r=0,i=1,o=1;o<e.length+1;o++)e[o]!==t?(i>r&&(r=i,n=t),i=1,t=e[o]):i++;return 1*n}var Nn={min:Ln,max:kn,mean:Pn,sum:On,mode:In};function Dn(e,t){return e.map((function(e){return e[t]}))}function Bn(e,t){return Nn[e](t)}var Fn=n(9558),Un=n.n(Fn),zn=n(9989),Gn=n.n(zn);var jn=n(2490),Vn=n.n(jn),Hn=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),Wn=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({});function Zn(e){for(;e;){if(e.isLoaded)return e.properties.state|=2,!0;e=e.parent}return!1}function Xn(e){e.children.forEach((function(e){e.isLoaded?e.properties.state|=2:Xn(e)}))}var Yn=[-1/0,-1/0,1/0,1/0],qn=b()(b()(b()({},Hn.Realtime,(function(e){e.forEach((function(e){e.isCurrent&&(e.isVisible=e.isLoaded)}))})),Hn.Overlap,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&!Zn(e)&&Xn(e)})),e.forEach((function(e){e.isVisible=Boolean(2&e.properties.state)}))})),Hn.Replace,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&Zn(e)})),e.slice().sort((function(e,t){return e.z-t.z})).forEach((function(e){e.isVisible=Boolean(2&e.properties.state),e.children.length&&(e.isVisible||1&e.properties.state)?e.children.forEach((function(e){e.properties.state=1})):e.isCurrent&&Xn(e)}))})),Kn=function(){};function Qn(e,t,n){return[Math.floor((e+180)/360*Math.pow(2,n)),Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,n))]}function $n(e,t,n){var r=e/Math.pow(2,n)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}var Jn=function(e,t,n){var r=$n(e,t,n),i=ie()(r,2),o=i[0],a=i[1],s=$n(e+1,t+1,n),u=ie()(s,2),l=u[0];return[o,u[1],l,a]};function er(e){var t=e.zoom,n=e.latLonBounds,r=e.maxZoom,i=void 0===r?1/0:r,o=e.minZoom,a=void 0===o?0:o,s=e.zoomOffset,u=void 0===s?0:s,l=e.extent,c=void 0===l?Yn:l,h=Math.ceil(t)+u;if(Number.isFinite(a)&&h<a)return[];Number.isFinite(i)&&h>i&&(h=i);for(var f=ie()(n,4),p=f[0],d=f[1],v=f[2],m=f[3],g=[Math.max(p,c[0]),Math.max(d,c[1]),Math.min(v,c[2]),Math.min(m,c[3])],y=[],_=Qn(g[0],g[1],h),b=ie()(_,2),x=b[0],E=b[1],S=Qn(g[2],g[3],h),A=ie()(S,2),T=A[0],C=A[1],w=x;w<=T;w++)for(var R=C;R<=E;R++)y.push({x:w,y:R,z:h});var M=(T+x)/2,k=(E+C)/2,L=function(e,t){return Math.abs(e-M)+Math.abs(t-k)};return y.sort((function(e,t){return L(e.x,e.y)-L(t.x,t.y)})),y}var tr=function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Math.pow(2,n),o=i-1,a=e;return r&&(a<0?a+=i:a>o&&(a%=i)),{warpX:a,warpY:t}},nr=function(e){d()(r,e);var t,n=m()(r);function r(e){var t;c()(this,r),t=n.call(this),b()(f()(t),"x",void 0),b()(f()(t),"y",void 0),b()(f()(t),"z",void 0),b()(f()(t),"warp",void 0),b()(f()(t),"tileSize",256),b()(f()(t),"isVisible",!1),b()(f()(t),"isCurrent",!1),b()(f()(t),"isVisibleChange",!1),b()(f()(t),"loadedLayers",0),b()(f()(t),"isLayerLoaded",!1),b()(f()(t),"isLoad",!1),b()(f()(t),"isChildLoad",!1),b()(f()(t),"parent",null),b()(f()(t),"children",[]),b()(f()(t),"data",null),b()(f()(t),"properties",{}),b()(f()(t),"xhrCancel",void 0),b()(f()(t),"loadStatus",void 0),b()(f()(t),"abortController",void 0),b()(f()(t),"loadDataId",0);var i=e.x,o=e.y,a=e.z,s=e.tileSize,u=e.warp,l=void 0===u||u;return t.x=i,t.y=o,t.z=a,t.warp=l||!0,t.tileSize=s,t}return u()(r,[{key:"isLoading",get:function(){return this.loadStatus===Wn.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Wn.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Wn.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===Wn.Cancelled}},{key:"isDone",get:function(){return[Wn.Loaded,Wn.Cancelled,Wn.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Jn(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var e=ie()(this.bounds,4),t=e[0],n=e[1],r=[(e[2]-t)/2,(e[3]-n)/2],i=function(e,t){void 0===t&&(t={});var n=Number(e[0]),r=Number(e[1]),i=Number(e[2]),o=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[n,r],s=[n,o],u=[i,o],l=[i,r];return(0,Dt.yu)([[a,l,u,s,a]],t.properties,{bbox:e,id:t.id})}(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:r,meta:"\n      ".concat(this.key,"\n      ")}});return i}},{key:"key",get:function(){return"".concat(this.x,"_").concat(this.y,"_").concat(this.z)}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:(t=Gn()(Un()().mark((function e(t){var n,r,i,o,a,s,u,l,c,h,f,p,d,v,m,g,y;return Un()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getData,r=t.onLoad,i=t.onError,this.loadDataId++,o=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Wn.Loading,a=null,e.prev=7,u=this.x,l=this.y,c=this.z,h=this.bounds,f=this.tileSize,p=this.warp,d=tr(u,l,c,p),v=d.warpX,m=d.warpY,g=this.abortController.signal,y={x:v,y:m,z:c,bounds:h,tileSize:f,signal:g,warp:p},e.next=14,n(y,this);case 14:a=e.sent,e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),s=e.t0;case 20:if(o===this.loadDataId){e.next=22;break}return e.abrupt("return");case 22:if(!this.isCancelled||a){e.next=24;break}return e.abrupt("return");case 24:if(!s&&a){e.next=28;break}return this.loadStatus=Wn.Failure,i(s,this),e.abrupt("return");case 28:this.loadStatus=Wn.Loaded,this.data=a,r(this);case 31:case"end":return e.stop()}}),e,this,[[7,17]])}))),function(e){return t.apply(this,arguments)})},{key:"reloadData",value:function(e){this.isLoading&&this.abortLoad(),this.loadData(e)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Wn.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(jn.EventEmitter),rr=n(6970),ir=n.n(rr),or=Xe.throttle,ar=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),sr=function(e){d()(n,e);var t=m()(n);function n(e){var r;return c()(this,n),r=t.call(this),b()(f()(r),"currentZoom",void 0),b()(f()(r),"currentTiles",[]),b()(f()(r),"options",void 0),b()(f()(r),"cacheTiles",new Map),b()(f()(r),"lastViewStates",void 0),b()(f()(r),"throttleUpdate",or((function(e,t){r.update(e,t)}),16)),b()(f()(r),"onTileLoad",(function(e){r.emit(ar.TileLoaded,e),r.updateTileVisible(),r.loadFinished()})),b()(f()(r),"onTileError",(function(e,t){r.emit(ar.TileError,{error:e,tile:t}),r.updateTileVisible(),r.loadFinished()})),b()(f()(r),"onTileUnload",(function(e){r.emit(ar.TileUnload,e),r.loadFinished()})),r.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:Yn,getTileData:Kn,warp:!0,updateStrategy:Hn.Replace},r.updateOptions(e),r}return u()(n,[{key:"isLoaded",get:function(){return this.currentTiles.every((function(e){return e.isDone}))}},{key:"tiles",get:function(){return Array.from(this.cacheTiles.values()).sort((function(e,t){return e.z-t.z}))}},{key:"updateOptions",value:function(e){var t=void 0===e.minZoom?this.options.minZoom:Math.ceil(e.minZoom),n=void 0===e.maxZoom?this.options.maxZoom:Math.floor(e.maxZoom);this.options=a()(a()(a()({},this.options),e),{},{minZoom:t,maxZoom:n})}},{key:"update",value:function(e,t){var n=this,r=Math.max(0,Math.ceil(e));if(!this.lastViewStates||this.lastViewStates.zoom!==r||!function(e,t){return nn(rn(e),rn(t))}(this.lastViewStates.latLonBoundsBuffer,t)){var i=function(e,t){var n=tn(rn(e),t),r=85.0511287798065;return[Math.max(n[0][0],-900),Math.max(n[0][1],-r),Math.min(n[1][0],900),Math.min(n[1][1],r)]}(t,.2);this.lastViewStates={zoom:r,latLonBounds:t,latLonBoundsBuffer:i},this.currentZoom=r;var o=!1,a=this.getTileIndices(r,i).filter((function(e){return n.options.warp||e.x>=0&&e.x<Math.pow(2,r)}));this.emit(ar.TilesLoadStart),this.currentTiles=a.map((function(e){var t,r,i=e.x,a=e.y,s=e.z,u=n.getTile(i,a,s);return u?(((null===(t=u)||void 0===t?void 0:t.isFailure)||(null===(r=u)||void 0===r?void 0:r.isCancelled))&&u.loadData({getData:n.options.getTileData,onLoad:n.onTileLoad,onError:n.onTileError}),u):(u=n.createTile(i,a,s),o=!0,u)})),o&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var e,t=ir()(this.cacheTiles);try{for(t.s();!(e=t.n()).done;){var n=ie()(e.value,2),r=n[0],i=n[1];if(!this.currentTiles.includes(i))return this.cacheTiles.delete(r),void this.onTileUnload(i);this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(e){t.e(e)}finally{t.f()}}},{key:"reloadTileById",value:function(e,t,n){var r=this.cacheTiles.get("".concat(t,",").concat(n,",").concat(e));r&&(this.onTileUnload(r),r.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(e,t,n){var r=this.getTileByLngLat(e,t,n);r&&this.reloadTileById(r.z,r.x,r.y)}},{key:"reloadTileByExtent",value:function(e,t){var n=this;this.getTileIndices(t,e).forEach((function(e){n.reloadTileById(e.z,e.x,e.y)}))}},{key:"pruneRequests",value:function(){var e,t=[],n=ir()(this.cacheTiles.values());try{for(n.s();!(e=n.n()).done;){var r=e.value;r.isLoading&&(r.isCurrent||r.isVisible||t.push(r))}}catch(e){n.e(e)}finally{n.f()}for(;t.length>0;){t.shift().abortLoad()}}},{key:"getTileByLngLat",value:function(e,t,n){var r=this.options.zoomOffset,i=Math.ceil(n)+r,o=Qn(e,t,i);return this.tiles.filter((function(e){return e.key==="".concat(o[0],"_").concat(o[1],"_").concat(i)}))[0]}},{key:"getTileExtent",value:function(e,t){return this.getTileIndices(t,e)}},{key:"getTileByZXY",value:function(e,t,n){return this.tiles.filter((function(r){return r.key==="".concat(t,"_").concat(n,"_").concat(e)}))[0]}},{key:"clear",value:function(){var e,t=ir()(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isLoading?n.abortLoad():this.onTileUnload(n)}}catch(e){t.e(e)}finally{t.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var e,t=this.options.updateStrategy,n=new Map,r=ir()(this.cacheTiles.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;n.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1}}catch(e){r.e(e)}finally{r.f()}var o,a=ir()(this.currentTiles);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isCurrent=!0,s.isVisible=!0}}catch(e){a.e(e)}finally{a.f()}var u=Array.from(this.cacheTiles.values());"function"==typeof t?t(u):qn[t](u);var l=!1;Array.from(this.cacheTiles.values()).forEach((function(e){e.isVisible!==n.get(e.key)?(e.isVisibleChange=!0,l=!0):e.isVisibleChange=!1})),l&&this.emit(ar.TileUpdate)}},{key:"getTileIndices",value:function(e,t){var n=this.options,r=n.tileSize,i=n.extent,o=n.zoomOffset;return er({maxZoom:Math.floor(this.options.maxZoom),minZoom:Math.ceil(this.options.minZoom),zoomOffset:o,tileSize:r,zoom:e,latLonBounds:t,extent:i})}},{key:"getTileId",value:function(e,t,n){return"".concat(e,",").concat(t,",").concat(n)}},{key:"loadFinished",value:function(){var e=!this.currentTiles.some((function(e){return!e.isDone}));return e&&this.emit(ar.TilesLoadFinished),e}},{key:"getTile",value:function(e,t,n){var r=this.getTileId(e,t,n);return this.cacheTiles.get(r)}},{key:"createTile",value:function(e,t,n){var r=this.getTileId(e,t,n),i=new nr({x:e,y:t,z:n,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(r,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}},{key:"resizeCacheTiles",value:function(){var e=5*this.currentTiles.length;if(this.cacheTiles.size>e){var t,n=ir()(this.cacheTiles);try{for(n.s();!(t=n.n()).done;){var r=ie()(t.value,2),i=r[0],o=r[1];if(o.isVisible||this.currentTiles.includes(o)||(this.cacheTiles.delete(i),this.onTileUnload(o)),this.cacheTiles.size<=e)break}}catch(e){n.e(e)}finally{n.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var e,t=ir()(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.parent=null,n.children.length=0}}catch(e){t.e(e)}finally{t.f()}var r,i=ir()(this.cacheTiles.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.getNearestAncestor(o.x,o.y,o.z);o.parent=a,null!=a&&a.children&&a.children.push(o)}}catch(e){i.e(e)}finally{i.f()}}},{key:"getNearestAncestor",value:function(e,t,n){for(;n>this.options.minZoom;){e=Math.floor(e/2),t=Math.floor(t/2),n-=1;var r=this.getTile(e,t,n);if(r)return r}return null}}]),n}(Vn());function ur(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function lr(e){var t=[],n=/\{([a-z])-([a-z])\}/.exec(e);if(n){var r,i=n[1].charCodeAt(0),o=n[2].charCodeAt(0);for(r=i;r<=o;++r)t.push(e.replace(n[0],String.fromCharCode(r)));return t}if(n=/\{(\d+)-(\d+)\}/.exec(e)){for(var a=parseInt(n[2],10),s=parseInt(n[1],10);s<=a;s++)t.push(e.replace(n[0],s.toString()));return t}return t.push(e),t}function cr(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");var n=t.x,r=t.y,i=t.z,o=lr(e),a=Math.abs(n+r)%o.length;return(E(o[a])?"".concat(o[a],"/{z}/{x}/{y}"):o[a]).replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,Jn(n,r,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-r-1).toString())}function hr(e,t){var n=t.x,r=t.y,i=t.z,o=t.layer,a=t.version,s=void 0===a?"1.0.0":a,u=t.style,l=void 0===u?"default":u,c=t.format,h=t.service,f=void 0===h?"WMTS":h,p=t.tileMatrixset,d=lr(e),v=Math.abs(n+r)%d.length;return"".concat(d[v],"&SERVICE=").concat(f,"&REQUEST=GetTile&VERSION=").concat(s,"&LAYER=").concat(o,"&STYLE=").concat(l,"&TILEMATRIXSET=").concat(p,"&FORMAT=").concat(c,"&TILECOL=").concat(n,"&TILEROW=").concat(r,"&TILEMATRIX=").concat(i)}function fr(e,t){return null==e?t:e}},7282:function(e,t,n){"use strict";var r,i,o,a=n(5570).default;o=function(){function e(e){var r=[];return e.AMapUI&&r.push(t(e.AMapUI)),e.Loca&&r.push(n(e.Loca)),Promise.all(r)}function t(e){return new Promise((function(t,n){var i=[];if(e.plugins)for(var u=0;u<e.plugins.length;u+=1)-1==o.AMapUI.plugins.indexOf(e.plugins[u])&&i.push(e.plugins[u]);if(a.AMapUI===r.failed)n("前次请求 AMapUI 失败");else if(a.AMapUI===r.notload){a.AMapUI=r.loading,o.AMapUI.version=e.version||o.AMapUI.version,u=o.AMapUI.version;var l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/ui/"+u+"/main.js",c.onerror=function(e){a.AMapUI=r.failed,n("请求 AMapUI 失败")},c.onload=function(){if(a.AMapUI=r.loaded,i.length)window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},l.appendChild(c)}else a.AMapUI===r.loaded?e.version&&e.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t():e.version&&e.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.AMapUI.push((function(e){e?n(e):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t()}))}))}function n(e){return new Promise((function(t,n){if(a.Loca===r.failed)n("前次请求 Loca 失败");else if(a.Loca===r.notload){a.Loca=r.loading,o.Loca.version=e.version||o.Loca.version;var i=o.Loca.version,u=o.AMap.version.startsWith("2"),l=i.startsWith("2");if(u&&!l||!u&&l)n("JSAPI 与 Loca 版本不对应！！");else{u=o.key,l=document.body||document.head;var c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/loca?v="+i+"&key="+u,c.onerror=function(e){a.Loca=r.failed,n("请求 AMapUI 失败")},c.onload=function(){for(a.Loca=r.loaded,t();s.Loca.length;)s.Loca.splice(0,1)[0]()},l.appendChild(c)}}else a.Loca===r.loaded?e.version&&e.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):t():e.version&&e.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):s.Loca.push((function(e){e?n(e):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r,i;(i=r||(r={})).notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed";var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]},u=[];return{load:function(t){return new Promise((function(n,i){if(a.AMap==r.failed)i("");else if(a.AMap==r.notload){var s=t.key,l=t.version,c=t.plugins;s?(window.AMap&&"lbs.amap.com"!==location.host&&i("禁止多种API加载方式混用"),o.key=s,o.AMap.version=l||o.AMap.version,o.AMap.plugins=c||o.AMap.plugins,a.AMap=r.loading,l=document.body||document.head,window.___onAPILoaded=function(o){if(delete window.___onAPILoaded,o)a.AMap=r.failed,i(o);else for(a.AMap=r.loaded,e(t).then((function(){n(window.AMap)})).catch(i);u.length;)u.splice(0,1)[0]()},(c=document.createElement("script")).type="text/javascript",c.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+s+"&plugin="+o.AMap.plugins.join(","),c.onerror=function(e){a.AMap=r.failed,i(e)},l.appendChild(c)):i("请填写key")}else if(a.AMap==r.loaded)if(t.key&&t.key!==o.key)i("多个不一致的 key");else if(t.version&&t.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(s=[],t.plugins)for(l=0;l<t.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(t.plugins[l])&&s.push(t.plugins[l]);s.length?window.AMap.plugin(s,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}else if(t.key&&t.key!==o.key)i("多个不一致的 key");else if(t.version&&t.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{var h=[];if(t.plugins)for(l=0;l<t.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(t.plugins[l])&&h.push(t.plugins[l]);!function(e){"function"==typeof e&&(a.AMap===r.loaded?e(window.AMap):u.push(e))}((function(){h.length?window.AMap.plugin(h,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]}}}},"object"===a(t)?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},7204:function(e,t,n){"use strict";n.d(t,{S$:function(){return Z},bf:function(){return X},ni:function(){return F},oI:function(){return H},sX:function(){return W}});var r=n(5570),i=n.n(r),o=n(4828);function a(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function l(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function c(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var h={exports:{}},f={exports:{}},p={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0},e.exports=t.default}(p,p.exports);var d={},v={exports:{}},m={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop();return e.call(this,t,r)}},e.exports=t.default}(m,m.exports);var g={};Object.defineProperty(g,"__esModule",{value:!0}),g.fallback=E,g.wrap=S;var y,_=g.hasQueueMicrotask="function"==typeof queueMicrotask&&queueMicrotask,b=g.hasSetImmediate="function"==typeof setImmediate&&setImmediate,x=g.hasNextTick="object"===(void 0===o?"undefined":i()(o))&&"function"==typeof o.nextTick;function E(e){setTimeout(e,0)}function S(e){return function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e((function(){return t.apply(void 0,n)}))}}y=_?queueMicrotask:b?setImmediate:x?o.nextTick:E,g.default=S(y),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,i.isAsync)(e))return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop(),i=e.apply(this,t);return a(i,r)};return(0,n.default)((function(t,n){var r;try{r=e.apply(this,t)}catch(e){return n(e)}if(r&&"function"==typeof r.then)return a(r,n);n(null,r)}))};var n=o(m.exports),r=o(g),i=d;function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return e.then((function(e){s(t,null,e)}),(function(e){s(t,e&&e.message?e:new Error(e))}))}function s(e,t,n){try{e(t,n)}catch(e){(0,r.default)((function(e){throw e}),e)}}e.exports=t.default}(v,v.exports),Object.defineProperty(d,"__esModule",{value:!0}),d.isAsyncIterable=d.isAsyncGenerator=d.isAsync=void 0;var A,T=(A=v.exports)&&A.__esModule?A:{default:A};function C(e){return"AsyncFunction"===e[Symbol.toStringTag]}d.default=function(e){if("function"!=typeof e)throw new Error("expected a function");return C(e)?(0,T.default)(e):e},d.isAsync=C,d.isAsyncGenerator=function(e){return"AsyncGenerator"===e[Symbol.toStringTag]},d.isAsyncIterable=function(e){return"function"==typeof e[Symbol.asyncIterator]};var w={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){void 0===t&&(t=e.length);if(!t)throw new Error("arity is undefined");return function(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[t-1]?e.apply(this,r):new Promise((function(i,o){r[t-1]=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(e)return o(e);i(t.length>1?t:t[0])},e.apply(n,r)}))}},e.exports=t.default}(w,w.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(p.exports),r=o(d),i=o(w.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i){var o=(0,n.default)(t)?[]:{};e(t,(function(e,t,n){(0,r.default)(e)((function(e){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[t]=r,n(e)}))}),(function(e){return i(e,o)}))}),3),e.exports=t.default}(f,f.exports);var R={exports:{}},M={exports:{}},k={exports:{}},L={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null!==e){var r=e;e=null,r.apply(this,t)}}return Object.assign(t,e),t},e.exports=t.default}(L,L.exports);var O={exports:{}},P={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},e.exports=t.default}(P,P.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,n.default)(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t=(0,r.default)(e);return t?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(t):function(e){var t=e?Object.keys(e):[],n=-1,r=t.length;return function i(){var o=t[++n];return"__proto__"===o?i():n<r?{value:e[o],key:o}:null}}(e)};var n=i(p.exports),r=i(P.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(O,O.exports);var I={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null===e)throw new Error("Callback was already called.");var r=e;e=null,r.apply(this,t)}},e.exports=t.default}(I,I.exports);var N={exports:{}},D={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default={},e.exports=t.default}(D,D.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){var o=!1,a=!1,s=!1,u=0,l=0;function c(){u>=t||s||o||(s=!0,e.next().then((function(e){var t=e.value,n=e.done;if(!a&&!o){if(s=!1,n)return o=!0,void(u<=0&&i(null));u++,r(t,l,h),l++,c()}})).catch(f))}function h(e,t){if(u-=1,!a)return e?f(e):!1===e?(o=!0,void(a=!0)):t===n.default||o&&u<=0?(o=!0,i(null)):void c()}function f(e){a||(s=!1,o=!0,i(e))}c()};var n=function(e){return e&&e.__esModule?e:{default:e}}(D.exports);e.exports=t.default}(N,N.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=u(L.exports),r=u(O.exports),i=u(I.exports),o=d,a=u(N.exports),s=u(D.exports);function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t,u,l){if(l=(0,n.default)(l),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return l(null);if((0,o.isAsyncGenerator)(t))return(0,a.default)(t,e,u,l);if((0,o.isAsyncIterable)(t))return(0,a.default)(t[Symbol.asyncIterator](),e,u,l);var c=(0,r.default)(t),h=!1,f=!1,p=0,d=!1;function v(e,t){if(!f)if(p-=1,e)h=!0,l(e);else if(!1===e)h=!0,f=!0;else{if(t===s.default||h&&p<=0)return h=!0,l(null);d||m()}}function m(){for(d=!0;p<e&&!h;){var t=c();if(null===t)return h=!0,void(p<=0&&l(null));p+=1,u(t.value,t.key,(0,i.default)(v))}d=!1}m()}},e.exports=t.default}(k,k.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(k.exports),r=o(d),i=o(w.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i,o){return(0,n.default)(t)(e,(0,r.default)(i),o)}),4),e.exports=t.default}(M,M.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(M.exports),r=i(w.exports);function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,r.default)((function(e,t,r){return(0,n.default)(e,1,t,r)}),3),e.exports=t.default}(R,R.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,n.default)(r.default,e,t)};var n=i(f.exports),r=i(R.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(h,h.exports);var B=c(h.exports),F=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,B(this.tasks)},e.prototype.tap=function(e,t){var n=this;this.tasks.push((function(r){t.apply(void 0,l([],u(n.args),!1)),r(null,e)}))},e}(),U={exports:{}},z={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=l(p.exports),r=l(D.exports),i=l(M.exports),o=l(L.exports),a=l(I.exports),s=l(d),u=l(w.exports);function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){n=(0,o.default)(n);var i=0,s=0,u=e.length,l=!1;function c(e,t){!1===e&&(l=!0),!0!==l&&(e?n(e):++s!==u&&t!==r.default||n(null))}for(0===u&&n(null);i<u;i++)t(e[i],i,(0,a.default)(c))}function h(e,t,n){return(0,i.default)(e,1/0,t,n)}t.default=(0,u.default)((function(e,t,r){return((0,n.default)(e)?c:h)(e,(0,s.default)(t),r)}),3),e.exports=t.default}(z,z.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,r.default)(n.default,e,t)};var n=i(z.exports),r=i(f.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(U,U.exports);var G=c(U.exports),j=(function(){function e(){this.tasks=[]}e.prototype.promise=function(){return G(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return a(n,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,t()];case 1:return n.sent(),r(null,e),[2]}}))}))}))}}(),{exports:{}});!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(L.exports),r=a(I.exports),i=a(d),o=a(w.exports);function a(e){return e&&e.__esModule?e:{default:e}}t.default=(0,o.default)((function(e,t){if(t=(0,n.default)(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var o=0;function a(t){(0,i.default)(e[o++]).apply(void 0,t.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||o===e.length?t.apply(void 0,[n].concat(r)):void a(r)}a([])})),e.exports=t.default}(j,j.exports);var V=c(j.exports),H=(function(){function e(){this.tasks=[]}e.prototype.call=function(){return V(this.tasks)},e.prototype.tap=function(e,t){0===this.tasks.length?this.tasks.push((function(e){var n=t();e(!!n&&null,n)})):this.tasks.push((function(n,r){r(!!t.apply(void 0,l([],u(n),!1))&&null,e)}))}}(),function(){function e(){this.tasks=[]}return e.prototype.call=function(){return B(this.tasks)},e.prototype.tap=function(e,t){this.tasks.push((function(n){n(t(),e)}))},e}()),W=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,B(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return a(n,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,t.apply(void 0,l([],u(this.args),!1))];case 1:return n.sent(),r(null,e),[2]}}))}))}))},e}(),Z=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,B(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return a(n,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return[4,t.apply(void 0,l([],u(this.args),!1))];case 1:return n=i.sent(),r(n,e),[2]}}))}))}))},e}(),X=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return V(this.tasks)},e.prototype.tapPromise=function(e,t){0===this.tasks.length?this.tasks.push((function(e){t().then((function(t){e(null,t)}))})):this.tasks.push((function(e,n){t(e).then((function(e){n(null,e)}))}))},e}()},5158:function(e){"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,o),!0;case 6:return c.fn.call(c.context,t,r,i,o,a),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,i);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s},2531:function(e){function t(e,t){if(0!==e.length){n(e[0],t);for(var r=1;r<e.length;r++)n(e[r],!t)}}function n(e,t){for(var n=0,r=0,i=0,o=e.length,a=o-1;i<o;a=i++){var s=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!=!!t&&e.reverse()}e.exports=function e(n,r){var i,o=n&&n.type;if("FeatureCollection"===o)for(i=0;i<n.features.length;i++)e(n.features[i],r);else if("GeometryCollection"===o)for(i=0;i<n.geometries.length;i++)e(n.geometries[i],r);else if("Feature"===o)e(n.geometry,r);else if("Polygon"===o)t(n.coordinates,r);else if("MultiPolygon"===o)for(i=0;i<n.coordinates.length;i++)t(n.coordinates[i],r);return n}},1690:function(e){"use strict";function t(e,t){this.x=e,this.y=t}e.exports=t,t.prototype={clone:function(){return new t(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},t.convert=function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e}},6641:function(e){"use strict";e.exports=n,e.exports.default=n;var t=1e20;function n(e,t,n,r,i,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function r(e,t,n,r,o,a){for(var s=0;s<t;s++)i(e,s,t,n,r,o,a);for(var u=0;u<n;u++)i(e,u*t,1,t,r,o,a)}function i(e,n,r,i,o,a,s){var u,l,c,h;for(a[0]=0,s[0]=-t,s[1]=t,u=0;u<i;u++)o[u]=e[n+u*r];for(u=1,l=0,c=0;u<i;u++){do{h=a[l],c=(o[u]-o[h]+u*u-h*h)/(u-h)/2}while(c<=s[l]&&--l>-1);a[++l]=u,s[l]=c,s[l+1]=t}for(u=0,l=0;u<i;u++){for(;s[l+1]<u;)l++;h=a[l],e[n+u*r]=o[h]+(u-h)*(u-h)}}n.prototype._draw=function(e,n){var i,o,a,s,u,l,c,h,f,p=this.ctx.measureText(e),d=p.width,v=2*this.buffer;n&&this.useMetrics?(u=Math.floor(p.actualBoundingBoxAscent),h=this.buffer+Math.ceil(p.actualBoundingBoxAscent),l=this.buffer,c=this.buffer,i=(o=Math.min(this.size,Math.ceil(p.actualBoundingBoxRight-p.actualBoundingBoxLeft)))+v,a=(s=Math.min(this.size-l,Math.ceil(p.actualBoundingBoxAscent+p.actualBoundingBoxDescent)))+v,this.ctx.textBaseline="alphabetic"):(i=o=this.size,a=s=this.size,u=19*this.fontSize/24,l=c=0,h=this.middle,this.ctx.textBaseline="middle"),o&&s&&(this.ctx.clearRect(c,l,o,s),this.ctx.fillText(e,this.buffer,h),f=this.ctx.getImageData(c,l,o,s));var m=new Uint8ClampedArray(i*a);return function(e,n,r,i,o,a,s){a.fill(t,0,n*r),s.fill(0,0,n*r);for(var u=(n-i)/2,l=0;l<o;l++)for(var c=0;c<i;c++){var h=(l+u)*n+c+u,f=e.data[4*(l*i+c)+3]/255;if(1===f)a[h]=0,s[h]=t;else if(0===f)a[h]=t,s[h]=0;else{var p=Math.max(0,.5-f),d=Math.max(0,f-.5);a[h]=p*p,s[h]=d*d}}}(f,i,a,o,s,this.gridOuter,this.gridInner),r(this.gridOuter,i,a,this.f,this.v,this.z),r(this.gridInner,i,a,this.f,this.v,this.z),function(e,t,n,r,i,o,a){for(var s=0;s<t*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);e[s]=Math.round(255-255*(u/o+a))}}(m,i,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:m,metrics:{width:o,height:s,sdfWidth:i,sdfHeight:a,top:u,left:0,advance:d}}},n.prototype.draw=function(e){return this._draw(e,!1).data},n.prototype.drawWithMetrics=function(e){return this._draw(e,!0)}},8421:function(e){function t(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=n,this.p2y=r}e.exports=t,t.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},t.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},t.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},t.prototype.solveCurveX=function(e,t){var n,r,i,o,a;for(void 0===t&&(t=1e-6),i=e,a=0;a<8;a++){if(o=this.sampleCurveX(i)-e,Math.abs(o)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=e)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-e)<t)return i;e>o?n=i:r=i,i=.5*(r-n)+n}return i},t.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},9308:function(e,t,n){e.exports.VectorTile=n(1796),n(2281),n(9901)},1796:function(e,t,n){"use strict";var r=n(9901);function i(e,t,n){if(3===e){var i=new r(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}e.exports=function(e,t){this.layers=e.readFields(i,{},t)}},2281:function(e,t,n){"use strict";var r=n(1690);function i(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(o,this,t)}function o(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){var n=e.readVarint()+e.pos;for(;e.pos<n;){var r=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[r]=i}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function a(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)t=e[i],r+=((n=e[a]).x-t.x)*(t.y+n.y);return r}e.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,o=0,a=0,s=0,u=[];e.pos<n;){if(o<=0){var l=e.readVarint();i=7&l,o=l>>3}if(o--,1===i||2===i)a+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&u.push(t),t=[]),t.push(new r(a,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&u.push(t),u},i.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;e.pos<t;){if(r<=0){var c=e.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=e.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=e.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},i.prototype.toGeoJSON=function(e,t,n){var r,o,s=this.extent*Math.pow(2,n),u=this.extent*e,l=this.extent*t,c=this.loadGeometry(),h=i.types[this.type];function f(e){for(var t=0;t<e.length;t++){var n=e[t],r=180-360*(n.y+l)/s;e[t]=[360*(n.x+u)/s-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(r=0;r<c.length;r++)p[r]=c[r][0];f(c=p);break;case 2:for(r=0;r<c.length;r++)f(c[r]);break;case 3:for(c=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var s=a(e[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}n&&i.push(n);return i}(c),r=0;r<c.length;r++)for(o=0;o<c[r].length;o++)f(c[r][o])}1===c.length?c=c[0]:h="Multi"+h;var d={type:"Feature",geometry:{type:h,coordinates:c},properties:this.properties};return"id"in this&&(d.id=this.id),d}},9901:function(e,t,n){"use strict";var r=n(2281);function i(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(o,this,t),this.length=this._features.length}function o(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){var t=null,n=e.readVarint()+e.pos;for(;e.pos<n;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(n))}e.exports=i,i.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,t,this.extent,this._keys,this._values)}},450:function(e,t,n){"use strict";var r=n(7360);function i(){var e={},t=0,n=0,r=0;return{add:function(i,o){o||(o=i,i=0),i>n?n=i:i<r&&(r=i),e[i]||(e[i]=[]),e[i].push(o),t++},process:function(){for(var t=r;t<=n;t++)for(var i=e[t],o=0;o<i.length;o++){(0,i[o])()}},size:function(){return t}}}e.exports=function(e){var t=(e=e||{}).reporter,n=r.getOption(e,"async",!0),o=r.getOption(e,"auto",!0);o&&!n&&(t&&t.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),n=!0);var a,s=i(),u=!1;function l(){for(u=!0;s.size();){var e=s;s=i(),e.process()}u=!1}function c(){var e;e=l,a=setTimeout(e,0)}return{add:function(e,t){!u&&o&&n&&0===s.size()&&c(),s.add(e,t)},force:function(e){u||(void 0===e&&(e=n),a&&(clearTimeout(a),a=null),e?c():l())}}}},7360:function(e){"use strict";(e.exports={}).getOption=function(e,t,n){var r=e[t];if(null==r&&void 0!==n)return n;return r}},3905:function(e,t,n){"use strict";function r(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function i(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function o(){}n.d(t,{ZP:function(){return x},B8:function(){return T}});var a=.7,s=1/a,u="\\s*([+-]?\\d+)\\s*",l="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",c="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",h=/^#([0-9a-f]{3,8})$/,f=new RegExp("^rgb\\("+[u,u,u]+"\\)$"),p=new RegExp("^rgb\\("+[c,c,c]+"\\)$"),d=new RegExp("^rgba\\("+[u,u,u,l]+"\\)$"),v=new RegExp("^rgba\\("+[c,c,c,l]+"\\)$"),m=new RegExp("^hsl\\("+[l,c,c]+"\\)$"),g=new RegExp("^hsla\\("+[l,c,c,l]+"\\)$"),y={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function _(){return this.rgb().formatHex()}function b(){return this.rgb().formatRgb()}function x(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=h.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?E(t):3===n?new C(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?S(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?S(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=f.exec(e))?new C(t[1],t[2],t[3],1):(t=p.exec(e))?new C(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=d.exec(e))?S(t[1],t[2],t[3],t[4]):(t=v.exec(e))?S(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=m.exec(e))?k(t[1],t[2]/100,t[3]/100,1):(t=g.exec(e))?k(t[1],t[2]/100,t[3]/100,t[4]):y.hasOwnProperty(e)?E(y[e]):"transparent"===e?new C(NaN,NaN,NaN,0):null}function E(e){return new C(e>>16&255,e>>8&255,255&e,1)}function S(e,t,n,r){return r<=0&&(e=t=n=NaN),new C(e,t,n,r)}function A(e){return e instanceof o||(e=x(e)),e?new C((e=e.rgb()).r,e.g,e.b,e.opacity):new C}function T(e,t,n,r){return 1===arguments.length?A(e):new C(e,t,n,null==r?1:r)}function C(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function w(){return"#"+M(this.r)+M(this.g)+M(this.b)}function R(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function M(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function k(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new O(e,t,n,r)}function L(e){if(e instanceof O)return new O(e.h,e.s,e.l,e.opacity);if(e instanceof o||(e=x(e)),!e)return new O;if(e instanceof O)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),s=NaN,u=a-i,l=(a+i)/2;return u?(s=t===a?(n-r)/u+6*(n<r):n===a?(r-t)/u+2:(t-n)/u+4,u/=l<.5?a+i:2-a-i,s*=60):u=l>0&&l<1?0:s,new O(s,u,l,e.opacity)}function O(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function P(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}r(o,x,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:_,formatHex:_,formatHsl:function(){return L(this).formatHsl()},formatRgb:b,toString:b}),r(C,T,i(o,{brighter:function(e){return e=null==e?s:Math.pow(s,e),new C(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?a:Math.pow(a,e),new C(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:w,formatHex:w,formatRgb:R,toString:R})),r(O,(function(e,t,n,r){return 1===arguments.length?L(e):new O(e,t,n,null==r?1:r)}),i(o,{brighter:function(e){return e=null==e?s:Math.pow(s,e),new O(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?a:Math.pow(a,e),new O(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new C(P(e>=240?e-240:e+120,i,r),P(e,i,r),P(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}))},4778:function(e){"use strict";function t(e,t,r){r=r||2;var o,a,s,u,h,f,d,v=t&&t.length,m=v?t[0]*r:e.length,g=n(e,0,m,r,!0),y=[];if(!g||g.next===g.prev)return y;if(v&&(g=function(e,t,r,i){var o,a,s,u=[];for(o=0,a=t.length;o<a;o++)(s=n(e,t[o]*i,o<a-1?t[o+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),u.push(p(s));for(u.sort(l),o=0;o<u.length;o++)r=c(u[o],r);return r}(e,t,g,r)),e.length>80*r){o=s=e[0],a=u=e[1];for(var _=r;_<m;_+=r)(h=e[_])<o&&(o=h),(f=e[_+1])<a&&(a=f),h>s&&(s=h),f>u&&(u=f);d=0!==(d=Math.max(s-o,u-a))?32767/d:0}return i(g,y,r,o,a,d,0),y}function n(e,t,n,r,i){var o,a;if(i===C(e,t,n,r)>0)for(o=t;o<n;o+=r)a=S(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=S(o,e[o],e[o+1],a);return a&&g(a,a.next)&&(A(a),a=a.next),a}function r(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!g(r,r.next)&&0!==m(r.prev,r,r.next))r=r.next;else{if(A(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function i(e,t,n,l,c,h,p){if(e){!p&&h&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=f(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,l=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(e,l,c,h);for(var d,v,m=e;e.prev!==e.next;)if(d=e.prev,v=e.next,h?a(e,l,c,h):o(e))t.push(d.i/n|0),t.push(e.i/n|0),t.push(v.i/n|0),A(e),e=v.next,m=v.next;else if((e=v)===m){p?1===p?i(e=s(r(e),t,n),t,n,l,c,h,2):2===p&&u(e,t,n,l,c,h):i(r(e),t,n,l,c,h,1);break}}}function o(e){var t=e.prev,n=e,r=e.next;if(m(t,n,r)>=0)return!1;for(var i=t.x,o=n.x,a=r.x,s=t.y,u=n.y,l=r.y,c=i<o?i<a?i:a:o<a?o:a,h=s<u?s<l?s:l:u<l?u:l,f=i>o?i>a?i:a:o>a?o:a,p=s>u?s>l?s:l:u>l?u:l,v=r.next;v!==t;){if(v.x>=c&&v.x<=f&&v.y>=h&&v.y<=p&&d(i,s,o,u,a,l,v.x,v.y)&&m(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function a(e,t,n,r){var i=e.prev,o=e,a=e.next;if(m(i,o,a)>=0)return!1;for(var s=i.x,u=o.x,l=a.x,c=i.y,h=o.y,p=a.y,v=s<u?s<l?s:l:u<l?u:l,g=c<h?c<p?c:p:h<p?h:p,y=s>u?s>l?s:l:u>l?u:l,_=c>h?c>p?c:p:h>p?h:p,b=f(v,g,t,n,r),x=f(y,_,t,n,r),E=e.prevZ,S=e.nextZ;E&&E.z>=b&&S&&S.z<=x;){if(E.x>=v&&E.x<=y&&E.y>=g&&E.y<=_&&E!==i&&E!==a&&d(s,c,u,h,l,p,E.x,E.y)&&m(E.prev,E,E.next)>=0)return!1;if(E=E.prevZ,S.x>=v&&S.x<=y&&S.y>=g&&S.y<=_&&S!==i&&S!==a&&d(s,c,u,h,l,p,S.x,S.y)&&m(S.prev,S,S.next)>=0)return!1;S=S.nextZ}for(;E&&E.z>=b;){if(E.x>=v&&E.x<=y&&E.y>=g&&E.y<=_&&E!==i&&E!==a&&d(s,c,u,h,l,p,E.x,E.y)&&m(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;S&&S.z<=x;){if(S.x>=v&&S.x<=y&&S.y>=g&&S.y<=_&&S!==i&&S!==a&&d(s,c,u,h,l,p,S.x,S.y)&&m(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function s(e,t,n){var i=e;do{var o=i.prev,a=i.next.next;!g(o,a)&&y(o,i,i.next,a)&&x(o,a)&&x(a,o)&&(t.push(o.i/n|0),t.push(i.i/n|0),t.push(a.i/n|0),A(i),A(i.next),i=e=a),i=i.next}while(i!==e);return r(i)}function u(e,t,n,o,a,s){var u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&v(u,l)){var c=E(u,l);return u=r(u,u.next),c=r(c,c.next),i(u,t,n,o,a,s,0),void i(c,t,n,o,a,s,0)}l=l.next}u=u.next}while(u!==e)}function l(e,t){return e.x-t.x}function c(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==t);if(!n)return null;var u,l=n,c=n.x,f=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&d(o<f?i:a,o,c,f,o<f?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),x(r,e)&&(u<p||u===p&&(r.x>n.x||r.x===n.x&&h(n,r)))&&(n=r,p=u)),r=r.next}while(r!==l);return n}(e,t);if(!n)return t;var i=E(n,e);return r(i,i.next),r(n,n.next)}function h(e,t){return m(e.prev,e,t.prev)<0&&m(t.next,e,e.next)<0}function f(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function d(e,t,n,r,i,o,a,s){return(i-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(r-s)>=(n-a)*(t-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(x(e,t)&&x(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(m(e.prev,e,t.prev)||m(e,t.prev,t))||g(e,t)&&m(e.prev,e,e.next)>0&&m(t.prev,t,t.next)>0)}function m(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function g(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,r){var i=b(m(e,t,n)),o=b(m(e,t,r)),a=b(m(n,r,e)),s=b(m(n,r,t));return i!==o&&a!==s||(!(0!==i||!_(e,n,t))||(!(0!==o||!_(e,r,t))||(!(0!==a||!_(n,e,r))||!(0!==s||!_(n,t,r)))))}function _(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function b(e){return e>0?1:e<0?-1:0}function x(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function E(e,t){var n=new T(e.i,e.x,e.y),r=new T(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function S(e,t,n,r){var i=new T(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function A(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(C(e,0,o,n));if(i)for(var s=0,u=t.length;s<u;s++){var l=t[s]*n,c=s<u-1?t[s+1]*n:e.length;a-=Math.abs(C(e,l,c,n))}var h=0;for(s=0;s<r.length;s+=3){var f=r[s]*n,p=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((e[f]-e[d])*(e[p+1]-e[f+1])-(e[f]-e[p])*(e[d+1]-e[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},1476:function(e){"use strict";var t=e.exports={};t.isIE=function(e){return(-1!==(t=navigator.userAgent.toLowerCase()).indexOf("msie")||-1!==t.indexOf("trident")||-1!==t.indexOf(" edge/"))&&(!e||e===function(){var e=3,t=document.createElement("div"),n=t.getElementsByTagName("i");do{t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e"}while(n[0]);return e>4?e:undefined}());var t},t.isLegacyOpera=function(){return!!window.opera}},9740:function(e){"use strict";(e.exports={}).forEach=function(e,t){for(var n=0;n<e.length;n++){var r=t(e[n]);if(r)return r}}},3562:function(e,t,n){"use strict";var r=n(1476);e.exports=function(e){var t=(e=e||{}).reporter,n=e.batchProcessor,i=e.stateHandler.getState;if(!t)throw new Error("Missing required dependency: reporter.");function o(t){var n=e.important?" !important; ":"; ";return(t.join(n)+n).trim()}function a(e){return i(e).object}return{makeDetectable:function(e,a,s){s||(s=a,a=e,e=null),(e=e||{}).debug,r.isIE(8)?s(a):function(a,s){var u=o(["display: block","position: absolute","top: 0","left: 0","width: 100%","height: 100%","border: none","padding: 0","margin: 0","opacity: 0","z-index: -1000","pointer-events: none"]),l=!1,c=window.getComputedStyle(a),h=a.offsetWidth,f=a.offsetHeight;function p(){function n(){if("static"===c.position){a.style.setProperty("position","relative",e.important?"important":"");var n=function(t,n,r,i){var o=r[i];"auto"!==o&&"0"!==function(e){return e.replace(/[^-\d\.]/g,"")}(o)&&(t.warn("An element that is positioned static has style."+i+"="+o+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+i+" will be set to 0. Element: ",n),n.style.setProperty(i,"0",e.important?"important":""))};n(t,a,c,"top"),n(t,a,c,"right"),n(t,a,c,"bottom"),n(t,a,c,"left")}}""!==c.position&&(n(),l=!0);var o=document.createElement("object");o.style.cssText=u,o.tabIndex=-1,o.type="text/html",o.setAttribute("aria-hidden","true"),o.onload=function(){l||n(),function e(t,n){if(!t.contentDocument){var r=i(t);return r.checkForObjectDocumentTimeoutId&&window.clearTimeout(r.checkForObjectDocumentTimeoutId),void(r.checkForObjectDocumentTimeoutId=setTimeout((function(){r.checkForObjectDocumentTimeoutId=0,e(t,n)}),100))}n(t.contentDocument)}(this,(function(e){s(a)}))},r.isIE()||(o.data="about:blank"),i(a)&&(a.appendChild(o),i(a).object=o,r.isIE()&&(o.data="about:blank"))}i(a).startSize={width:h,height:f},n?n.add(p):p()}(a,s)},addListener:function(e,t){function n(){t(e)}if(r.isIE(8))i(e).object={proxy:n},e.attachEvent("onresize",n);else{var o=a(e);if(!o)throw new Error("Element is not detectable by this strategy.");o.contentDocument.defaultView.addEventListener("resize",n)}},uninstall:function(e){if(i(e)){var t=a(e);t&&(r.isIE(8)?e.detachEvent("onresize",t.proxy):e.removeChild(t),i(e).checkForObjectDocumentTimeoutId&&window.clearTimeout(i(e).checkForObjectDocumentTimeoutId),delete i(e).object)}}}}},285:function(e,t,n){"use strict";var r=n(9740).forEach;e.exports=function(e){var t=(e=e||{}).reporter,n=e.batchProcessor,i=e.stateHandler.getState,o=(e.stateHandler.hasState,e.idHandler);if(!n)throw new Error("Missing required dependency: batchProcessor");if(!t)throw new Error("Missing required dependency: reporter.");var a=function(){var e=500,t=500,n=document.createElement("div");n.style.cssText=l(["position: absolute","width: 1000px","height: 1000px","visibility: hidden","margin: 0","padding: 0"]);var r=document.createElement("div");r.style.cssText=l(["position: absolute","width: 500px","height: 500px","overflow: scroll","visibility: none","top: -1500px","left: -1500px","visibility: hidden","margin: 0","padding: 0"]),r.appendChild(n),document.body.insertBefore(r,document.body.firstChild);var i=e-r.clientWidth,o=t-r.clientHeight;return document.body.removeChild(r),{width:i,height:o}}(),s="erd_scroll_detection_container";function u(e){!function(e,t,n){function r(n,r){r=r||function(t){e.head.appendChild(t)};var i=e.createElement("style");return i.innerHTML=n,i.id=t,r(i),i}if(!e.getElementById(t)){var i=n+"_animation",o=n+"_animation_active",a="/* Created by the element-resize-detector library. */\n";a+="."+n+" > div::-webkit-scrollbar { "+l(["display: none"])+" }\n\n",a+="."+o+" { "+l(["-webkit-animation-duration: 0.1s","animation-duration: 0.1s","-webkit-animation-name: "+i,"animation-name: "+i])+" }\n",a+="@-webkit-keyframes "+i+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }\n",r(a+="@keyframes "+i+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }")}}(e,"erd_scroll_detection_scrollbar_style",s)}function l(t){var n=e.important?" !important; ":"; ";return(t.join(n)+n).trim()}function c(e,n,r){if(e.addEventListener)e.addEventListener(n,r);else{if(!e.attachEvent)return t.error("[scroll] Don't know how to add event listeners.");e.attachEvent("on"+n,r)}}function h(e,n,r){if(e.removeEventListener)e.removeEventListener(n,r);else{if(!e.detachEvent)return t.error("[scroll] Don't know how to remove event listeners.");e.detachEvent("on"+n,r)}}function f(e){return i(e).container.childNodes[0].childNodes[0].childNodes[0]}function p(e){return i(e).container.childNodes[0].childNodes[0].childNodes[1]}return u(window.document),{makeDetectable:function(e,u,h){function d(){if(e.debug){var n=Array.prototype.slice.call(arguments);if(n.unshift(o.get(u),"Scroll: "),t.log.apply)t.log.apply(null,n);else for(var r=0;r<n.length;r++)t.log(n[r])}}function v(e){var t=i(e).container.childNodes[0],n=window.getComputedStyle(t);return!n.width||-1===n.width.indexOf("px")}function m(){var e=window.getComputedStyle(u),t={};return t.position=e.position,t.width=u.offsetWidth,t.height=u.offsetHeight,t.top=e.top,t.right=e.right,t.bottom=e.bottom,t.left=e.left,t.widthCSS=e.width,t.heightCSS=e.height,t}function g(){if(d("storeStyle invoked."),i(u)){var e=m();i(u).style=e}else d("Aborting because element has been uninstalled")}function y(e,t,n){i(e).lastWidth=t,i(e).lastHeight=n}function _(){return 2*a.width+1}function b(){return 2*a.height+1}function x(e){return e+10+_()}function E(e){return e+10+b()}function S(e,t,n){var r=f(e),i=p(e),o=x(t),a=E(n),s=function(e){return 2*e+_()}(t),u=function(e){return 2*e+b()}(n);r.scrollLeft=o,r.scrollTop=a,i.scrollLeft=s,i.scrollTop=u}function A(){var e=i(u).container;if(!e){(e=document.createElement("div")).className=s,e.style.cssText=l(["visibility: hidden","display: inline","width: 0px","height: 0px","z-index: -1","overflow: hidden","margin: 0","padding: 0"]),i(u).container=e,function(e){e.className+=" "+s+"_animation_active"}(e),u.appendChild(e);var t=function(){i(u).onRendered&&i(u).onRendered()};c(e,"animationstart",t),i(u).onAnimationStart=t}return e}function T(){if(d("Injecting elements"),i(u)){!function(){var n=i(u).style;if("static"===n.position){u.style.setProperty("position","relative",e.important?"important":"");var r=function(e,t,n,r){var i=n[r];"auto"!==i&&"0"!==function(e){return e.replace(/[^-\d\.]/g,"")}(i)&&(e.warn("An element that is positioned static has style."+r+"="+i+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+r+" will be set to 0. Element: ",t),t.style[r]=0)};r(t,u,n,"top"),r(t,u,n,"right"),r(t,u,n,"bottom"),r(t,u,n,"left")}}();var n=i(u).container;n||(n=A());var r,o,h,f,p=a.width,v=a.height,m=l(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden","width: 100%","height: 100%","left: 0px","top: 0px"]),g=l(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden"].concat(["left: "+(r=(r=-(1+p))?r+"px":"0"),"top: "+(o=(o=-(1+v))?o+"px":"0"),"right: "+(f=(f=-p)?f+"px":"0"),"bottom: "+(h=(h=-v)?h+"px":"0")])),y=l(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),_=l(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),b=l(["position: absolute","left: 0","top: 0"]),x=l(["position: absolute","width: 200%","height: 200%"]),E=document.createElement("div"),S=document.createElement("div"),T=document.createElement("div"),C=document.createElement("div"),w=document.createElement("div"),R=document.createElement("div");E.dir="ltr",E.style.cssText=m,E.className=s,S.className=s,S.style.cssText=g,T.style.cssText=y,C.style.cssText=b,w.style.cssText=_,R.style.cssText=x,T.appendChild(C),w.appendChild(R),S.appendChild(T),S.appendChild(w),E.appendChild(S),n.appendChild(E),c(T,"scroll",M),c(w,"scroll",k),i(u).onExpandScroll=M,i(u).onShrinkScroll=k}else d("Aborting because element has been uninstalled");function M(){var e=i(u);e&&e.onExpand?e.onExpand():d("Aborting expand scroll handler: element has been uninstalled")}function k(){var e=i(u);e&&e.onShrink?e.onShrink():d("Aborting shrink scroll handler: element has been uninstalled")}}function C(){function a(t,n,r){var i=function(e){return f(e).childNodes[0]}(t),o=x(n),a=E(r);i.style.setProperty("width",o+"px",e.important?"important":""),i.style.setProperty("height",a+"px",e.important?"important":"")}function s(r){var s=u.offsetWidth,c=u.offsetHeight,h=s!==i(u).lastWidth||c!==i(u).lastHeight;d("Storing current size",s,c),y(u,s,c),n.add(0,(function(){if(h)if(i(u))if(l()){if(e.debug){var n=u.offsetWidth,r=u.offsetHeight;n===s&&r===c||t.warn(o.get(u),"Scroll: Size changed before updating detector elements.")}a(u,s,c)}else d("Aborting because element container has not been initialized");else d("Aborting because element has been uninstalled")})),n.add(1,(function(){i(u)?l()?S(u,s,c):d("Aborting because element container has not been initialized"):d("Aborting because element has been uninstalled")})),h&&r&&n.add(2,(function(){i(u)?l()?r():d("Aborting because element container has not been initialized"):d("Aborting because element has been uninstalled")}))}function l(){return!!i(u).container}function c(){d("notifyListenersIfNeeded invoked");var e=i(u);return void 0===i(u).lastNotifiedWidth&&e.lastWidth===e.startSize.width&&e.lastHeight===e.startSize.height?d("Not notifying: Size is the same as the start size, and there has been no notification yet."):e.lastWidth===e.lastNotifiedWidth&&e.lastHeight===e.lastNotifiedHeight?d("Not notifying: Size already notified"):(d("Current size not notified, notifying..."),e.lastNotifiedWidth=e.lastWidth,e.lastNotifiedHeight=e.lastHeight,void r(i(u).listeners,(function(e){e(u)})))}function h(){d("Scroll detected."),v(u)?d("Scroll event fired while unrendered. Ignoring..."):s(c)}if(d("registerListenersAndPositionElements invoked."),i(u)){i(u).onRendered=function(){if(d("startanimation triggered."),v(u))d("Ignoring since element is still unrendered...");else{d("Element rendered.");var e=f(u),t=p(u);0!==e.scrollLeft&&0!==e.scrollTop&&0!==t.scrollLeft&&0!==t.scrollTop||(d("Scrollbars out of sync. Updating detector elements..."),s(c))}},i(u).onExpand=h,i(u).onShrink=h;var m=i(u).style;a(u,m.width,m.height)}else d("Aborting because element has been uninstalled")}function w(){if(d("finalizeDomMutation invoked."),i(u)){var e=i(u).style;y(u,e.width,e.height),S(u,e.width,e.height)}else d("Aborting because element has been uninstalled")}function R(){h(u)}function M(){var e;d("Installing..."),i(u).listeners=[],e=m(),i(u).startSize={width:e.width,height:e.height},d("Element start size",i(u).startSize),n.add(0,g),n.add(1,T),n.add(2,C),n.add(3,w),n.add(4,R)}h||(h=u,u=e,e=null),e=e||{},d("Making detectable..."),!function(e){return!function(e){var t=e.getRootNode&&e.getRootNode().contains(e);return e===e.ownerDocument.body||e.ownerDocument.body.contains(e)||t}(e)||null===window.getComputedStyle(e)}(u)?M():(d("Element is detached"),A(),d("Waiting until element is attached..."),i(u).onRendered=function(){d("Element is now attached"),M()})},addListener:function(e,t){if(!i(e).listeners.push)throw new Error("Cannot add listener to an element that is not detectable.");i(e).listeners.push(t)},uninstall:function(e){var t=i(e);t&&(t.onExpandScroll&&h(f(e),"scroll",t.onExpandScroll),t.onShrinkScroll&&h(p(e),"scroll",t.onShrinkScroll),t.onAnimationStart&&h(t.container,"animationstart",t.onAnimationStart),t.container&&e.removeChild(t.container))},initDocument:u}}},1554:function(e,t,n){"use strict";var r=n(9740).forEach,i=n(5020),o=n(9024),a=n(831),s=n(6266),u=n(9396),l=n(1476),c=n(450),h=n(9293),f=n(3562),p=n(285);function d(e){return Array.isArray(e)||void 0!==e.length}function v(e){if(Array.isArray(e))return e;var t=[];return r(e,(function(e){t.push(e)})),t}function m(e){return e&&1===e.nodeType}function g(e,t,n){var r=e[t];return null==r&&void 0!==n?n:r}e.exports=function(e){var t;if((e=e||{}).idHandler)t={get:function(t){return e.idHandler.get(t,!0)},set:e.idHandler.set};else{var n=a(),y=s({idGenerator:n,stateHandler:h});t=y}var _=e.reporter;_||(_=u(!1===_));var b=g(e,"batchProcessor",c({reporter:_})),x={};x.callOnAdd=!!g(e,"callOnAdd",!0),x.debug=!!g(e,"debug",!1);var E,S=o(t),A=i({stateHandler:h}),T=g(e,"strategy","object"),C=g(e,"important",!1),w={reporter:_,batchProcessor:b,stateHandler:h,idHandler:t,important:C};if("scroll"===T&&(l.isLegacyOpera()?(_.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),T="object"):l.isIE(9)&&(_.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),T="object")),"scroll"===T)E=p(w);else{if("object"!==T)throw new Error("Invalid strategy name: "+T);E=f(w)}var R={};return{listenTo:function(e,n,i){function o(e){var t=S.get(e);r(t,(function(t){t(e)}))}function a(e,t,n){S.add(t,n),e&&n(t)}if(i||(i=n,n=e,e={}),!n)throw new Error("At least one element required.");if(!i)throw new Error("Listener required.");if(m(n))n=[n];else{if(!d(n))return _.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");n=v(n)}var s=0,u=g(e,"callOnAdd",x.callOnAdd),l=g(e,"onReady",(function(){})),c=g(e,"debug",x.debug);r(n,(function(e){h.getState(e)||(h.initState(e),t.set(e));var f=t.get(e);if(c&&_.log("Attaching listener to element",f,e),!A.isDetectable(e))return c&&_.log(f,"Not detectable."),A.isBusy(e)?(c&&_.log(f,"System busy making it detectable"),a(u,e,i),R[f]=R[f]||[],void R[f].push((function(){++s===n.length&&l()}))):(c&&_.log(f,"Making detectable..."),A.markBusy(e,!0),E.makeDetectable({debug:c,important:C},e,(function(e){if(c&&_.log(f,"onElementDetectable"),h.getState(e)){A.markAsDetectable(e),A.markBusy(e,!1),E.addListener(e,o),a(u,e,i);var t=h.getState(e);if(t&&t.startSize){var p=e.offsetWidth,d=e.offsetHeight;t.startSize.width===p&&t.startSize.height===d||o(e)}R[f]&&r(R[f],(function(e){e()}))}else c&&_.log(f,"Element uninstalled before being detectable.");delete R[f],++s===n.length&&l()})));c&&_.log(f,"Already detecable, adding listener."),a(u,e,i),s++})),s===n.length&&l()},removeListener:S.removeListener,removeAllListeners:S.removeAllListeners,uninstall:function(e){if(!e)return _.error("At least one element is required.");if(m(e))e=[e];else{if(!d(e))return _.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");e=v(e)}r(e,(function(e){S.removeAllListeners(e),E.uninstall(e),h.cleanState(e)}))},initDocument:function(e){E.initDocument&&E.initDocument(e)}}}},5020:function(e){"use strict";e.exports=function(e){var t=e.stateHandler.getState;return{isDetectable:function(e){var n=t(e);return n&&!!n.isDetectable},markAsDetectable:function(e){t(e).isDetectable=!0},isBusy:function(e){return!!t(e).busy},markBusy:function(e,n){t(e).busy=!!n}}}},831:function(e){"use strict";e.exports=function(){var e=1;return{generate:function(){return e++}}}},6266:function(e){"use strict";e.exports=function(e){var t=e.idGenerator,n=e.stateHandler.getState;return{get:function(e){var t=n(e);return t&&void 0!==t.id?t.id:null},set:function(e){var r=n(e);if(!r)throw new Error("setId required the element to have a resize detection state.");var i=t.generate();return r.id=i,i}}}},9024:function(e){"use strict";e.exports=function(e){var t={};function n(n){var r=e.get(n);return void 0===r?[]:t[r]||[]}return{get:n,add:function(n,r){var i=e.get(n);t[i]||(t[i]=[]),t[i].push(r)},removeListener:function(e,t){for(var r=n(e),i=0,o=r.length;i<o;++i)if(r[i]===t){r.splice(i,1);break}},removeAllListeners:function(e){var t=n(e);t&&(t.length=0)}}}},9396:function(e){"use strict";e.exports=function(e){function t(){}var n={log:t,warn:t,error:t};if(!e&&window.console){var r=function(e,t){e[t]=function(){var e=console[t];if(e.apply)e.apply(console,arguments);else for(var n=0;n<arguments.length;n++)e(arguments[n])}};r(n,"log"),r(n,"warn"),r(n,"error")}return n}},9293:function(e){"use strict";var t="_erd";function n(e){return e[t]}e.exports={initState:function(e){return e[t]={},n(e)},getState:n,cleanState:function(e){delete e[t]}}},2490:function(e){"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,o),!0;case 6:return c.fn.call(c.context,t,r,i,o,a),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,i);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s},7643:function(e,t,n){"use strict";n.d(t,{FD:function(){return o},Ib:function(){return r},WT:function(){return i}});var r=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array,o=Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)})},3311:function(e,t,n){"use strict";n.r(t),n.d(t,{add:function(){return X},adjoint:function(){return f},clone:function(){return o},copy:function(){return a},create:function(){return i},determinant:function(){return p},equals:function(){return $},exactEquals:function(){return Q},frob:function(){return Z},fromQuat:function(){return I},fromQuat2:function(){return R},fromRotation:function(){return S},fromRotationTranslation:function(){return w},fromRotationTranslationScale:function(){return O},fromRotationTranslationScaleOrigin:function(){return P},fromScaling:function(){return E},fromTranslation:function(){return x},fromValues:function(){return s},fromXRotation:function(){return A},fromYRotation:function(){return T},fromZRotation:function(){return C},frustum:function(){return N},getRotation:function(){return L},getScaling:function(){return k},getTranslation:function(){return M},identity:function(){return l},invert:function(){return h},lookAt:function(){return V},mul:function(){return J},multiply:function(){return d},multiplyScalar:function(){return q},multiplyScalarAndAdd:function(){return K},ortho:function(){return G},orthoNO:function(){return z},orthoZO:function(){return j},perspective:function(){return B},perspectiveFromFieldOfView:function(){return U},perspectiveNO:function(){return D},perspectiveZO:function(){return F},rotate:function(){return g},rotateX:function(){return y},rotateY:function(){return _},rotateZ:function(){return b},scale:function(){return m},set:function(){return u},str:function(){return W},sub:function(){return ee},subtract:function(){return Y},targetTo:function(){return H},translate:function(){return v},transpose:function(){return c}});var r=n(7643);function i(){var e=new r.WT(16);return r.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function o(e){var t=new r.WT(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function s(e,t,n,i,o,a,s,u,l,c,h,f,p,d,v,m){var g=new r.WT(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=i,g[4]=o,g[5]=a,g[6]=s,g[7]=u,g[8]=l,g[9]=c,g[10]=h,g[11]=f,g[12]=p,g[13]=d,g[14]=v,g[15]=m,g}function u(e,t,n,r,i,o,a,s,u,l,c,h,f,p,d,v,m){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=l,e[9]=c,e[10]=h,e[11]=f,e[12]=p,e[13]=d,e[14]=v,e[15]=m,e}function l(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function c(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function h(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*s-r*a,_=n*u-i*a,b=n*l-o*a,x=r*u-i*s,E=r*l-o*s,S=i*l-o*u,A=c*v-h*d,T=c*m-f*d,C=c*g-p*d,w=h*m-f*v,R=h*g-p*v,M=f*g-p*m,k=y*M-_*R+b*w+x*C-E*T+S*A;return k?(k=1/k,e[0]=(s*M-u*R+l*w)*k,e[1]=(i*R-r*M-o*w)*k,e[2]=(v*S-m*E+g*x)*k,e[3]=(f*E-h*S-p*x)*k,e[4]=(u*C-a*M-l*T)*k,e[5]=(n*M-i*C+o*T)*k,e[6]=(m*b-d*S-g*_)*k,e[7]=(c*S-f*b+p*_)*k,e[8]=(a*R-s*C+l*A)*k,e[9]=(r*C-n*R-o*A)*k,e[10]=(d*E-v*b+g*y)*k,e[11]=(h*b-c*E-p*y)*k,e[12]=(s*T-a*w-u*A)*k,e[13]=(n*w-r*T+i*A)*k,e[14]=(v*_-d*x-m*y)*k,e[15]=(c*x-h*_+f*y)*k,e):null}function f(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15];return e[0]=s*(f*g-p*m)-h*(u*g-l*m)+v*(u*p-l*f),e[1]=-(r*(f*g-p*m)-h*(i*g-o*m)+v*(i*p-o*f)),e[2]=r*(u*g-l*m)-s*(i*g-o*m)+v*(i*l-o*u),e[3]=-(r*(u*p-l*f)-s*(i*p-o*f)+h*(i*l-o*u)),e[4]=-(a*(f*g-p*m)-c*(u*g-l*m)+d*(u*p-l*f)),e[5]=n*(f*g-p*m)-c*(i*g-o*m)+d*(i*p-o*f),e[6]=-(n*(u*g-l*m)-a*(i*g-o*m)+d*(i*l-o*u)),e[7]=n*(u*p-l*f)-a*(i*p-o*f)+c*(i*l-o*u),e[8]=a*(h*g-p*v)-c*(s*g-l*v)+d*(s*p-l*h),e[9]=-(n*(h*g-p*v)-c*(r*g-o*v)+d*(r*p-o*h)),e[10]=n*(s*g-l*v)-a*(r*g-o*v)+d*(r*l-o*s),e[11]=-(n*(s*p-l*h)-a*(r*p-o*h)+c*(r*l-o*s)),e[12]=-(a*(h*m-f*v)-c*(s*m-u*v)+d*(s*f-u*h)),e[13]=n*(h*m-f*v)-c*(r*m-i*v)+d*(r*f-i*h),e[14]=-(n*(s*m-u*v)-a*(r*m-i*v)+d*(r*u-i*s)),e[15]=n*(s*f-u*h)-a*(r*f-i*h)+c*(r*u-i*s),e}function p(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11],p=e[12],d=e[13],v=e[14],m=e[15];return(t*a-n*o)*(h*m-f*v)-(t*s-r*o)*(c*m-f*d)+(t*u-i*o)*(c*v-h*d)+(n*s-r*a)*(l*m-f*p)-(n*u-i*a)*(l*v-h*p)+(r*u-i*s)*(l*d-c*p)}function d(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],_=n[0],b=n[1],x=n[2],E=n[3];return e[0]=_*r+b*s+x*h+E*v,e[1]=_*i+b*u+x*f+E*m,e[2]=_*o+b*l+x*p+E*g,e[3]=_*a+b*c+x*d+E*y,_=n[4],b=n[5],x=n[6],E=n[7],e[4]=_*r+b*s+x*h+E*v,e[5]=_*i+b*u+x*f+E*m,e[6]=_*o+b*l+x*p+E*g,e[7]=_*a+b*c+x*d+E*y,_=n[8],b=n[9],x=n[10],E=n[11],e[8]=_*r+b*s+x*h+E*v,e[9]=_*i+b*u+x*f+E*m,e[10]=_*o+b*l+x*p+E*g,e[11]=_*a+b*c+x*d+E*y,_=n[12],b=n[13],x=n[14],E=n[15],e[12]=_*r+b*s+x*h+E*v,e[13]=_*i+b*u+x*f+E*m,e[14]=_*o+b*l+x*p+E*g,e[15]=_*a+b*c+x*d+E*y,e}function v(e,t,n){var r,i,o,a,s,u,l,c,h,f,p,d,v=n[0],m=n[1],g=n[2];return t===e?(e[12]=t[0]*v+t[4]*m+t[8]*g+t[12],e[13]=t[1]*v+t[5]*m+t[9]*g+t[13],e[14]=t[2]*v+t[6]*m+t[10]*g+t[14],e[15]=t[3]*v+t[7]*m+t[11]*g+t[15]):(r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],p=t[10],d=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=l,e[7]=c,e[8]=h,e[9]=f,e[10]=p,e[11]=d,e[12]=r*v+s*m+h*g+t[12],e[13]=i*v+u*m+f*g+t[13],e[14]=o*v+l*m+p*g+t[14],e[15]=a*v+c*m+d*g+t[15]),e}function m(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function g(e,t,n,i){var o,a,s,u,l,c,h,f,p,d,v,m,g,y,_,b,x,E,S,A,T,C,w,R,M=i[0],k=i[1],L=i[2],O=Math.hypot(M,k,L);return O<r.Ib?null:(M*=O=1/O,k*=O,L*=O,o=Math.sin(n),s=1-(a=Math.cos(n)),u=t[0],l=t[1],c=t[2],h=t[3],f=t[4],p=t[5],d=t[6],v=t[7],m=t[8],g=t[9],y=t[10],_=t[11],b=M*M*s+a,x=k*M*s+L*o,E=L*M*s-k*o,S=M*k*s-L*o,A=k*k*s+a,T=L*k*s+M*o,C=M*L*s+k*o,w=k*L*s-M*o,R=L*L*s+a,e[0]=u*b+f*x+m*E,e[1]=l*b+p*x+g*E,e[2]=c*b+d*x+y*E,e[3]=h*b+v*x+_*E,e[4]=u*S+f*A+m*T,e[5]=l*S+p*A+g*T,e[6]=c*S+d*A+y*T,e[7]=h*S+v*A+_*T,e[8]=u*C+f*w+m*R,e[9]=l*C+p*w+g*R,e[10]=c*C+d*w+y*R,e[11]=h*C+v*w+_*R,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function y(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+l*r,e[5]=a*i+c*r,e[6]=s*i+h*r,e[7]=u*i+f*r,e[8]=l*i-o*r,e[9]=c*i-a*r,e[10]=h*i-s*r,e[11]=f*i-u*r,e}function _(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],l=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-l*r,e[1]=a*i-c*r,e[2]=s*i-h*r,e[3]=u*i-f*r,e[8]=o*r+l*i,e[9]=a*r+c*i,e[10]=s*r+h*i,e[11]=u*r+f*i,e}function b(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],l=t[4],c=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+l*r,e[1]=a*i+c*r,e[2]=s*i+h*r,e[3]=u*i+f*r,e[4]=l*i-o*r,e[5]=c*i-a*r,e[6]=h*i-s*r,e[7]=f*i-u*r,e}function x(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function E(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function S(e,t,n){var i,o,a,s=n[0],u=n[1],l=n[2],c=Math.hypot(s,u,l);return c<r.Ib?null:(s*=c=1/c,u*=c,l*=c,i=Math.sin(t),a=1-(o=Math.cos(t)),e[0]=s*s*a+o,e[1]=u*s*a+l*i,e[2]=l*s*a-u*i,e[3]=0,e[4]=s*u*a-l*i,e[5]=u*u*a+o,e[6]=l*u*a+s*i,e[7]=0,e[8]=s*l*a+u*i,e[9]=u*l*a-s*i,e[10]=l*l*a+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function A(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function T(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function C(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function w(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,u=i+i,l=o+o,c=r*s,h=r*u,f=r*l,p=i*u,d=i*l,v=o*l,m=a*s,g=a*u,y=a*l;return e[0]=1-(p+v),e[1]=h+y,e[2]=f-g,e[3]=0,e[4]=h-y,e[5]=1-(c+v),e[6]=d+m,e[7]=0,e[8]=f+g,e[9]=d-m,e[10]=1-(c+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function R(e,t){var n=new r.WT(3),i=-t[0],o=-t[1],a=-t[2],s=t[3],u=t[4],l=t[5],c=t[6],h=t[7],f=i*i+o*o+a*a+s*s;return f>0?(n[0]=2*(u*s+h*i+l*a-c*o)/f,n[1]=2*(l*s+h*o+c*i-u*a)/f,n[2]=2*(c*s+h*a+u*o-l*i)/f):(n[0]=2*(u*s+h*i+l*a-c*o),n[1]=2*(l*s+h*o+c*i-u*a),n[2]=2*(c*s+h*a+u*o-l*i)),w(e,t,n),e}function M(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function k(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],l=t[9],c=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(u,l,c),e}function L(e,t){var n=new r.WT(3);k(n,t);var i=1/n[0],o=1/n[1],a=1/n[2],s=t[0]*i,u=t[1]*o,l=t[2]*a,c=t[4]*i,h=t[5]*o,f=t[6]*a,p=t[8]*i,d=t[9]*o,v=t[10]*a,m=s+h+v,g=0;return m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(f-d)/g,e[1]=(p-l)/g,e[2]=(u-c)/g):s>h&&s>v?(g=2*Math.sqrt(1+s-h-v),e[3]=(f-d)/g,e[0]=.25*g,e[1]=(u+c)/g,e[2]=(p+l)/g):h>v?(g=2*Math.sqrt(1+h-s-v),e[3]=(p-l)/g,e[0]=(u+c)/g,e[1]=.25*g,e[2]=(f+d)/g):(g=2*Math.sqrt(1+v-s-h),e[3]=(u-c)/g,e[0]=(p+l)/g,e[1]=(f+d)/g,e[2]=.25*g),e}function O(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=i+i,l=o+o,c=a+a,h=i*u,f=i*l,p=i*c,d=o*l,v=o*c,m=a*c,g=s*u,y=s*l,_=s*c,b=r[0],x=r[1],E=r[2];return e[0]=(1-(d+m))*b,e[1]=(f+_)*b,e[2]=(p-y)*b,e[3]=0,e[4]=(f-_)*x,e[5]=(1-(h+m))*x,e[6]=(v+g)*x,e[7]=0,e[8]=(p+y)*E,e[9]=(v-g)*E,e[10]=(1-(h+d))*E,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function P(e,t,n,r,i){var o=t[0],a=t[1],s=t[2],u=t[3],l=o+o,c=a+a,h=s+s,f=o*l,p=o*c,d=o*h,v=a*c,m=a*h,g=s*h,y=u*l,_=u*c,b=u*h,x=r[0],E=r[1],S=r[2],A=i[0],T=i[1],C=i[2],w=(1-(v+g))*x,R=(p+b)*x,M=(d-_)*x,k=(p-b)*E,L=(1-(f+g))*E,O=(m+y)*E,P=(d+_)*S,I=(m-y)*S,N=(1-(f+v))*S;return e[0]=w,e[1]=R,e[2]=M,e[3]=0,e[4]=k,e[5]=L,e[6]=O,e[7]=0,e[8]=P,e[9]=I,e[10]=N,e[11]=0,e[12]=n[0]+A-(w*A+k*T+P*C),e[13]=n[1]+T-(R*A+L*T+I*C),e[14]=n[2]+C-(M*A+O*T+N*C),e[15]=1,e}function I(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,h=r*s,f=i*a,p=i*s,d=i*u,v=o*a,m=o*s,g=o*u;return e[0]=1-h-d,e[1]=c+g,e[2]=f-m,e[3]=0,e[4]=c-g,e[5]=1-l-d,e[6]=p+v,e[7]=0,e[8]=f+m,e[9]=p-v,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N(e,t,n,r,i,o,a){var s=1/(n-t),u=1/(i-r),l=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(a+o)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*l,e[15]=0,e}function D(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e}var B=D;function F(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=i*o,e[14]=i*r*o):(e[10]=-1,e[14]=-r),e}function U(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(i-o)*l*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function z(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),l=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*l,e[15]=1,e}var G=z;function j(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),l=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=o*l,e[15]=1,e}function V(e,t,n,i){var o,a,s,u,c,h,f,p,d,v,m=t[0],g=t[1],y=t[2],_=i[0],b=i[1],x=i[2],E=n[0],S=n[1],A=n[2];return Math.abs(m-E)<r.Ib&&Math.abs(g-S)<r.Ib&&Math.abs(y-A)<r.Ib?l(e):(f=m-E,p=g-S,d=y-A,o=b*(d*=v=1/Math.hypot(f,p,d))-x*(p*=v),a=x*(f*=v)-_*d,s=_*p-b*f,(v=Math.hypot(o,a,s))?(o*=v=1/v,a*=v,s*=v):(o=0,a=0,s=0),u=p*s-d*a,c=d*o-f*s,h=f*a-p*o,(v=Math.hypot(u,c,h))?(u*=v=1/v,c*=v,h*=v):(u=0,c=0,h=0),e[0]=o,e[1]=u,e[2]=f,e[3]=0,e[4]=a,e[5]=c,e[6]=p,e[7]=0,e[8]=s,e[9]=h,e[10]=d,e[11]=0,e[12]=-(o*m+a*g+s*y),e[13]=-(u*m+c*g+h*y),e[14]=-(f*m+p*g+d*y),e[15]=1,e)}function H(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=r[0],u=r[1],l=r[2],c=i-n[0],h=o-n[1],f=a-n[2],p=c*c+h*h+f*f;p>0&&(c*=p=1/Math.sqrt(p),h*=p,f*=p);var d=u*f-l*h,v=l*c-s*f,m=s*h-u*c;return(p=d*d+v*v+m*m)>0&&(d*=p=1/Math.sqrt(p),v*=p,m*=p),e[0]=d,e[1]=v,e[2]=m,e[3]=0,e[4]=h*m-f*v,e[5]=f*d-c*m,e[6]=c*v-h*d,e[7]=0,e[8]=c,e[9]=h,e[10]=f,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e}function W(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Z(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function X(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Y(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function q(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function K(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function Q(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function $(e,t){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],_=t[0],b=t[1],x=t[2],E=t[3],S=t[4],A=t[5],T=t[6],C=t[7],w=t[8],R=t[9],M=t[10],k=t[11],L=t[12],O=t[13],P=t[14],I=t[15];return Math.abs(n-_)<=r.Ib*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-b)<=r.Ib*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(o-x)<=r.Ib*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-E)<=r.Ib*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(s-S)<=r.Ib*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(u-A)<=r.Ib*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(l-T)<=r.Ib*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-C)<=r.Ib*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(h-w)<=r.Ib*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(f-R)<=r.Ib*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(p-M)<=r.Ib*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(d-k)<=r.Ib*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(v-L)<=r.Ib*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(m-O)<=r.Ib*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(g-P)<=r.Ib*Math.max(1,Math.abs(g),Math.abs(P))&&Math.abs(y-I)<=r.Ib*Math.max(1,Math.abs(y),Math.abs(I))}var J=d,ee=Y},6568:function(e,t,n){"use strict";n.d(t,{$X:function(){return l},AK:function(){return f},Fv:function(){return h},IH:function(){return u},JG:function(){return a},Ue:function(){return i},al:function(){return o},lu:function(){return v},t7:function(){return p},t8:function(){return s},tk:function(){return c}});var r=n(7643);function i(){var e=new r.WT(2);return r.WT!=Float32Array&&(e[0]=0,e[1]=0),e}function o(e,t){var n=new r.WT(2);return n[0]=e,n[1]=t,n}function a(e,t){return e[0]=t[0],e[1]=t[1],e}function s(e,t,n){return e[0]=t,e[1]=n,e}function u(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function l(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function c(e,t){return e[0]=-t[0],e[1]=-t[1],e}function h(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function f(e,t){return e[0]*t[0]+e[1]*t[1]}function p(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e}var d,v=l;d=i()},1648:function(e,t,n){"use strict";n.r(t),n.d(t,{add:function(){return c},angle:function(){return U},bezier:function(){return L},ceil:function(){return d},clone:function(){return o},copy:function(){return u},create:function(){return i},cross:function(){return R},dist:function(){return Y},distance:function(){return x},div:function(){return X},divide:function(){return p},dot:function(){return w},equals:function(){return V},exactEquals:function(){return j},floor:function(){return v},forEach:function(){return $},fromValues:function(){return s},hermite:function(){return k},inverse:function(){return T},len:function(){return K},length:function(){return a},lerp:function(){return M},max:function(){return g},min:function(){return m},mul:function(){return Z},multiply:function(){return f},negate:function(){return A},normalize:function(){return C},random:function(){return O},rotateX:function(){return D},rotateY:function(){return B},rotateZ:function(){return F},round:function(){return y},scale:function(){return _},scaleAndAdd:function(){return b},set:function(){return l},sqrDist:function(){return q},sqrLen:function(){return Q},squaredDistance:function(){return E},squaredLength:function(){return S},str:function(){return G},sub:function(){return W},subtract:function(){return h},transformMat3:function(){return I},transformMat4:function(){return P},transformQuat:function(){return N},zero:function(){return z}});var r=n(7643);function i(){var e=new r.WT(3);return r.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function o(e){var t=new r.WT(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function s(e,t,n){var i=new r.WT(3);return i[0]=e,i[1]=t,i[2]=n,i}function u(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function l(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function c(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function h(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function f(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function p(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function d(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function v(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function m(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function g(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function y(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function _(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function b(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function x(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)}function E(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function S(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function A(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function T(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function C(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function w(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function R(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2];return e[0]=i*u-o*s,e[1]=o*a-r*u,e[2]=r*s-i*a,e}function M(e,t,n,r){var i=t[0],o=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e}function k(e,t,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return e[0]=t[0]*s+n[0]*u+r[0]*l+i[0]*c,e[1]=t[1]*s+n[1]*u+r[1]*l+i[1]*c,e[2]=t[2]*s+n[2]*u+r[2]*l+i[2]*c,e}function L(e,t,n,r,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,h=3*u*a,f=u*o;return e[0]=t[0]*l+n[0]*c+r[0]*h+i[0]*f,e[1]=t[1]*l+n[1]*c+r[1]*h+i[1]*f,e[2]=t[2]*l+n[2]*c+r[2]*h+i[2]*f,e}function O(e,t){t=t||1;var n=2*r.FD()*Math.PI,i=2*r.FD()-1,o=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*o,e[1]=Math.sin(n)*o,e[2]=i*t,e}function P(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e}function I(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e}function N(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],u=t[1],l=t[2],c=i*l-o*u,h=o*s-r*l,f=r*u-i*s,p=i*f-o*h,d=o*c-r*f,v=r*h-i*c,m=2*a;return c*=m,h*=m,f*=m,p*=2,d*=2,v*=2,e[0]=s+c+p,e[1]=u+h+d,e[2]=l+f+v,e}function D(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function B(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function F(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function U(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),l=u&&w(e,t)/u;return Math.acos(Math.min(Math.max(l,-1),1))}function z(e){return e[0]=0,e[1]=0,e[2]=0,e}function G(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function j(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function V(e,t){var n=e[0],i=e[1],o=e[2],a=t[0],s=t[1],u=t[2];return Math.abs(n-a)<=r.Ib*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=r.Ib*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-u)<=r.Ib*Math.max(1,Math.abs(o),Math.abs(u))}var H,W=h,Z=f,X=p,Y=x,q=E,K=a,Q=S,$=(H=i(),function(e,t,n,r,i,o){var a,s;for(t||(t=3),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,a=n;a<s;a+=t)H[0]=e[a],H[1]=e[a+1],H[2]=e[a+2],i(H,H,o),e[a]=H[0],e[a+1]=H[1],e[a+2]=H[2];return e})},6749:function(e,t,n){"use strict";n.d(t,{Ue:function(){return i},al:function(){return o},bA:function(){return a},fF:function(){return s}});var r=n(7643);function i(){var e=new r.WT(4);return r.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function o(e,t,n,i){var o=new r.WT(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o}function a(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function s(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}var u;u=i()},384:function(e,t,n){var r,i=n(5570).default;!function(o,a,s,u){"use strict";var l,c=["","webkit","Moz","MS","ms","o"],h=a.createElement("div"),f=Math.round,p=Math.abs,d=Date.now;function v(e,t,n){return setTimeout(E(e,n),t)}function m(e,t,n){return!!Array.isArray(e)&&(g(e,n[t],n),!0)}function g(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==u)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function y(e,t,n){var r="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",i=o.console&&(o.console.warn||o.console.log);return i&&i.call(o.console,r,n),e.apply(this,arguments)}}l="function"!=typeof Object.assign?function(e){if(e===u||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==u&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var _=y((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&e[r[i]]===u)&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),b=y((function(e,t){return _(e,t,!0)}),"merge","Use `assign`.");function x(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&l(r,n)}function E(e,t){return function(){return e.apply(t,arguments)}}function S(e,t){return"function"==i(e)?e.apply(t&&t[0]||u,t):e}function A(e,t){return e===u?t:e}function T(e,t,n){g(M(t),(function(t){e.addEventListener(t,n,!1)}))}function C(e,t,n){g(M(t),(function(t){e.removeEventListener(t,n,!1)}))}function w(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function R(e,t){return e.indexOf(t)>-1}function M(e){return e.trim().split(/\s+/g)}function k(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function L(e){return Array.prototype.slice.call(e,0)}function O(e,t,n){for(var r=[],i=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];k(i,a)<0&&r.push(e[o]),i[o]=a,o++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function P(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),o=0;o<c.length;){if((r=(n=c[o])?n+i:t)in e)return r;o++}return u}var I=1;function N(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||o}var D="ontouchstart"in o,B=P(o,"PointerEvent")!==u,F=D&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),U="touch",z="mouse",G=24,j=["x","y"],V=["clientX","clientY"];function H(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){S(e.options.enable,[e])&&n.handler(t)},this.init()}function W(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,o=1&t&&r-i==0,a=12&t&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=Z(t));i>1&&!n.firstMultiple?n.firstMultiple=Z(t):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,l=t.center=X(r);t.timeStamp=d(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=Q(s,l),t.distance=K(s,l),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},o=e.prevInput||{};1!==t.eventType&&4!==o.eventType||(i=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y});t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=q(t.deltaX,t.deltaY);var c=Y(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=p(c.x)>p(c.y)?c.x:c.y,t.scale=a?(h=a.pointers,f=r,K(f[0],f[1],V)/K(h[0],h[1],V)):1,t.rotation=a?function(e,t){return Q(t[1],t[0],V)+Q(e[1],e[0],V)}(a.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,o,a=e.lastInterval||t,s=t.timeStamp-a.timeStamp;if(8!=t.eventType&&(s>25||a.velocity===u)){var l=t.deltaX-a.deltaX,c=t.deltaY-a.deltaY,h=Y(s,l,c);r=h.x,i=h.y,n=p(h.x)>p(h.y)?h.x:h.y,o=q(l,c),e.lastInterval=t}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=o}(n,t);var h,f;var v=e.element;w(t.srcEvent.target,v)&&(v=t.srcEvent.target);t.target=v}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function Z(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:f(e.pointers[n].clientX),clientY:f(e.pointers[n].clientY)},n++;return{timeStamp:d(),pointers:t,center:X(t),deltaX:e.deltaX,deltaY:e.deltaY}}function X(e){var t=e.length;if(1===t)return{x:f(e[0].clientX),y:f(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:f(n/t),y:f(r/t)}}function Y(e,t,n){return{x:t/e||0,y:n/e||0}}function q(e,t){return e===t?1:p(e)>=p(t)?e<0?2:4:t<0?8:16}function K(e,t,n){n||(n=j);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function Q(e,t,n){n||(n=j);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}H.prototype={handler:function(){},init:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(N(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(N(this.element),this.evWin,this.domHandler)}};var $={mousedown:1,mousemove:2,mouseup:4},J="mousedown",ee="mousemove mouseup";function te(){this.evEl=J,this.evWin=ee,this.pressed=!1,H.apply(this,arguments)}x(te,H,{handler:function(e){var t=$[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:z,srcEvent:e}))}});var ne={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},re={2:U,3:"pen",4:z,5:"kinect"},ie="pointerdown",oe="pointermove pointerup pointercancel";function ae(){this.evEl=ie,this.evWin=oe,H.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}o.MSPointerEvent&&!o.PointerEvent&&(ie="MSPointerDown",oe="MSPointerMove MSPointerUp MSPointerCancel"),x(ae,H,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=ne[r],o=re[e.pointerType]||e.pointerType,a=o==U,s=k(t,e.pointerId,"pointerId");1&i&&(0===e.button||a)?s<0&&(t.push(e),s=t.length-1):12&i&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(s,1))}});var se={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ue="touchstart",le="touchstart touchmove touchend touchcancel";function ce(){this.evTarget=ue,this.evWin=le,this.started=!1,H.apply(this,arguments)}function he(e,t){var n=L(e.touches),r=L(e.changedTouches);return 12&t&&(n=O(n.concat(r),"identifier",!0)),[n,r]}x(ce,H,{handler:function(e){var t=se[e.type];if(1===t&&(this.started=!0),this.started){var n=he.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:U,srcEvent:e})}}});var fe={touchstart:1,touchmove:2,touchend:4,touchcancel:8},pe="touchstart touchmove touchend touchcancel";function de(){this.evTarget=pe,this.targetIds={},H.apply(this,arguments)}function ve(e,t){var n=L(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=L(e.changedTouches),s=[],u=this.target;if(o=n.filter((function(e){return w(e.target,u)})),1===t)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),12&t&&delete r[a[i].identifier],i++;return s.length?[O(o.concat(s),"identifier",!0),s]:void 0}x(de,H,{handler:function(e){var t=fe[e.type],n=ve.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:U,srcEvent:e})}});function me(){H.apply(this,arguments);var e=E(this.handler,this);this.touch=new de(this.manager,e),this.mouse=new te(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function ge(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ye.call(this,t)):12&e&&ye.call(this,t)}function ye(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function _e(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(t-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}x(me,H,{handler:function(e,t,n){var r=n.pointerType==U,i=n.pointerType==z;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)ge.call(this,t,n);else if(i&&_e.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var be=P(h.style,"touchAction"),xe=be!==u,Ee="compute",Se="auto",Ae="manipulation",Te="none",Ce="pan-x",we="pan-y",Re=function(){if(!xe)return!1;var e={},t=o.CSS&&o.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||o.CSS.supports("touch-action",n)})),e}();function Me(e,t){this.manager=e,this.set(t)}Me.prototype={set:function(e){e==Ee&&(e=this.compute()),xe&&this.manager.element.style&&Re[e]&&(this.manager.element.style[be]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){S(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(R(e,Te))return Te;var t=R(e,Ce),n=R(e,we);if(t&&n)return Te;if(t||n)return t?Ce:we;if(R(e,Ae))return Ae;return Se}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=R(r,Te)&&!Re[Te],o=R(r,we)&&!Re[we],a=R(r,Ce)&&!Re[Ce];if(i){var s=1===e.pointers.length,u=e.distance<2,l=e.deltaTime<250;if(s&&u&&l)return}if(!a||!o)return i||o&&6&n||a&&n&G?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var ke=32;function Le(e){this.options=l({},this.defaults,e||{}),this.id=I++,this.manager=null,this.options.enable=A(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Oe(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function Pe(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function Ie(e,t){var n=t.manager;return n?n.get(e):e}function Ne(){Le.apply(this,arguments)}function De(){Ne.apply(this,arguments),this.pX=null,this.pY=null}function Be(){Ne.apply(this,arguments)}function Fe(){Le.apply(this,arguments),this._timer=null,this._input=null}function Ue(){Ne.apply(this,arguments)}function ze(){Ne.apply(this,arguments)}function Ge(){Le.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function je(e,t){return(t=t||{}).recognizers=A(t.recognizers,je.defaults.preset),new Ve(e,t)}Le.prototype={defaults:{},set:function(e){return l(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(m(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=Ie(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return m(e,"dropRecognizeWith",this)||(e=Ie(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(m(e,"requireFailure",this))return this;var t=this.requireFail;return-1===k(t,e=Ie(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(m(e,"dropRequireFailure",this))return this;e=Ie(e,this);var t=k(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+Oe(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+Oe(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=ke},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=l({},e);if(!S(this.options.enable,[this,t]))return this.reset(),void(this.state=ke);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},x(Ne,Le,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(8&n||!i)?16|t:r||i?4&n?8|t:2&t?4|t:2:ke}}),x(De,Ne,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push(we),e&G&&t.push(Ce),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,o=e.deltaX,a=e.deltaY;return i&t.direction||(6&t.direction?(i=0===o?1:o<0?2:4,n=o!=this.pX,r=Math.abs(e.deltaX)):(i=0===a?1:a<0?8:16,n=a!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return Ne.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Pe(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),x(Be,Ne,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Te]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),x(Fe,Le,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Se]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!i)this.reset();else if(1&e.eventType)this.reset(),this._timer=v((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return ke},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}}),x(Ue,Ne,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Te]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),x(ze,Ne,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return De.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:n&G&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&p(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=Pe(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),x(Ge,Le,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ae]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=e.eventType)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||K(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=v((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return ke},failTimeout:function(){return this._timer=v((function(){this.state=ke}),this.options.interval,this),ke},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),je.VERSION="2.0.7",je.defaults={domEvents:!1,touchAction:Ee,enable:!0,inputTarget:null,inputClass:null,preset:[[Ue,{enable:!1}],[Be,{enable:!1},["rotate"]],[ze,{direction:6}],[De,{direction:6},["swipe"]],[Ge],[Ge,{event:"doubletap",taps:2},["tap"]],[Fe]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Ve(e,t){var n;this.options=l({},je.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(B?ae:F?de:D?me:te))(n,W),this.touchAction=new Me(this,this.options.touchAction),He(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function He(e,t){var n,r=e.element;r.style&&(g(e.options.cssProps,(function(i,o){n=P(r.style,o),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}Ve.prototype={set:function(e){return l(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),o++}},get:function(e){if(e instanceof Le)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(m(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(m(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=k(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==u&&t!==u){var n=this.handlers;return g(M(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(e!==u){var n=this.handlers;return g(M(e),(function(e){t?n[e]&&n[e].splice(k(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=a.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&He(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(je,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:ke,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:G,DIRECTION_ALL:30,Manager:Ve,Input:H,TouchAction:Me,TouchInput:de,MouseInput:te,PointerEventInput:ae,TouchMouseInput:me,SingleTouchInput:ce,Recognizer:Le,AttrRecognizer:Ne,Tap:Ge,Pan:De,Swipe:ze,Pinch:Be,Rotate:Ue,Press:Fe,on:T,off:C,each:g,merge:b,extend:_,assign:l,inherit:x,bindFn:E,prefixed:P}),(void 0!==o?o:"undefined"!=typeof self?self:{}).Hammer=je,(r=function(){return je}.call(t,n,t,e))===u||(e.exports=r)}(window,document)},91:function(e,t){t.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?i-1:0,f=n?-1:1,p=e[t+h];for(h+=f,o=p&(1<<-c)-1,p>>=-c,c+=s;c>0;o=256*o+e[t+h],h+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+e[t+h],h+=f,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=l}return(p?-1:1)*a*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(t*u-1)*Math.pow(2,i),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;e[n+p]=255&a,p+=d,a/=256,l-=8);e[n+p-d]|=128*v}},5118:function(e,t,n){var r=n(6229)(n(2674),"DataView");e.exports=r},6368:function(e,t,n){var r=n(7338),i=n(6485),o=n(3134),a=n(4138),s=n(3769);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},3593:function(e,t,n){var r=n(8461),i=n(8658),o=n(6575),a=n(7272),s=n(4490);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},1962:function(e,t,n){var r=n(6229)(n(2674),"Map");e.exports=r},2275:function(e,t,n){var r=n(159),i=n(8870),o=n(3357),a=n(5175),s=n(308);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},3551:function(e,t,n){var r=n(6229)(n(2674),"Promise");e.exports=r},7222:function(e,t,n){var r=n(6229)(n(2674),"Set");e.exports=r},4366:function(e,t,n){var r=n(2275),i=n(1168),o=n(9231);function a(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}a.prototype.add=a.prototype.push=i,a.prototype.has=o,e.exports=a},6166:function(e,t,n){var r=n(3593),i=n(6688),o=n(3673),a=n(1142),s=n(6507),u=n(3414);function l(e){var t=this.__data__=new r(e);this.size=t.size}l.prototype.clear=i,l.prototype.delete=o,l.prototype.get=a,l.prototype.has=s,l.prototype.set=u,e.exports=l},3048:function(e,t,n){var r=n(2674).Symbol;e.exports=r},9523:function(e,t,n){var r=n(2674).Uint8Array;e.exports=r},1553:function(e,t,n){var r=n(6229)(n(2674),"WeakMap");e.exports=r},2319:function(e){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},5422:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}},7362:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}},2893:function(e,t,n){var r=n(4342);e.exports=function(e,t){return!!(null==e?0:e.length)&&r(e,t,0)>-1}},104:function(e){e.exports=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}},8146:function(e,t,n){var r=n(725),i=n(5697),o=n(1509),a=n(9341),s=n(1377),u=n(4434),l=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),c=!n&&i(e),h=!n&&!c&&a(e),f=!n&&!c&&!h&&u(e),p=n||c||h||f,d=p?r(e.length,String):[],v=d.length;for(var m in e)!t&&!l.call(e,m)||p&&("length"==m||h&&("offset"==m||"parent"==m)||f&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||s(m,v))||d.push(m);return d}},5527:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}},917:function(e){e.exports=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}},223:function(e){e.exports=function(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}},3953:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},4953:function(e){e.exports=function(e){return e.split("")}},1307:function(e){var t=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;e.exports=function(e){return e.match(t)||[]}},777:function(e,t,n){var r=n(1366),i=n(4831);e.exports=function(e,t,n){(void 0!==n&&!i(e[t],n)||void 0===n&&!(t in e))&&r(e,t,n)}},7722:function(e,t,n){var r=n(1366),i=n(4831),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var a=e[t];o.call(e,t)&&i(a,n)&&(void 0!==n||t in e)||r(e,t,n)}},5731:function(e,t,n){var r=n(4831);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},4213:function(e,t,n){var r=n(3051),i=n(5829);e.exports=function(e,t){return e&&r(t,i(t),e)}},3949:function(e,t,n){var r=n(3051),i=n(3028);e.exports=function(e,t){return e&&r(t,i(t),e)}},1366:function(e,t,n){var r=n(7256);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},2162:function(e){e.exports=function(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e}},9142:function(e,t,n){var r=n(6166),i=n(5422),o=n(7722),a=n(4213),s=n(3949),u=n(5210),l=n(4660),c=n(6370),h=n(6840),f=n(9395),p=n(2378),d=n(3651),v=n(1131),m=n(4427),g=n(4160),y=n(1509),_=n(9341),b=n(4129),x=n(8032),E=n(8871),S=n(5829),A=n(3028),T="[object Arguments]",C="[object Function]",w="[object Object]",R={};R[T]=R["[object Array]"]=R["[object ArrayBuffer]"]=R["[object DataView]"]=R["[object Boolean]"]=R["[object Date]"]=R["[object Float32Array]"]=R["[object Float64Array]"]=R["[object Int8Array]"]=R["[object Int16Array]"]=R["[object Int32Array]"]=R["[object Map]"]=R["[object Number]"]=R[w]=R["[object RegExp]"]=R["[object Set]"]=R["[object String]"]=R["[object Symbol]"]=R["[object Uint8Array]"]=R["[object Uint8ClampedArray]"]=R["[object Uint16Array]"]=R["[object Uint32Array]"]=!0,R["[object Error]"]=R[C]=R["[object WeakMap]"]=!1,e.exports=function e(t,n,M,k,L,O){var P,I=1&n,N=2&n,D=4&n;if(M&&(P=L?M(t,k,L,O):M(t)),void 0!==P)return P;if(!x(t))return t;var B=y(t);if(B){if(P=v(t),!I)return l(t,P)}else{var F=d(t),U=F==C||"[object GeneratorFunction]"==F;if(_(t))return u(t,I);if(F==w||F==T||U&&!L){if(P=N||U?{}:g(t),!I)return N?h(t,s(P,t)):c(t,a(P,t))}else{if(!R[F])return L?t:{};P=m(t,F,I)}}O||(O=new r);var z=O.get(t);if(z)return z;O.set(t,P),E(t)?t.forEach((function(r){P.add(e(r,n,M,r,t,O))})):b(t)&&t.forEach((function(r,i){P.set(i,e(r,n,M,i,t,O))}));var G=B?void 0:(D?N?p:f:N?A:S)(t);return i(G||t,(function(r,i){G&&(r=t[i=r]),o(P,i,e(r,n,M,i,t,O))})),P}},8199:function(e,t,n){var r=n(8032),i=Object.create,o=function(){function e(){}return function(t){if(!r(t))return{};if(i)return i(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=o},1761:function(e){e.exports=function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}},8123:function(e,t,n){var r=n(8419)();e.exports=r},484:function(e,t,n){var r=n(2773),i=n(7415);e.exports=function(e,t){for(var n=0,o=(t=r(t,e)).length;null!=e&&n<o;)e=e[i(t[n++])];return n&&n==o?e:void 0}},8569:function(e,t,n){var r=n(917),i=n(1509);e.exports=function(e,t,n){var o=t(e);return i(e)?o:r(o,n(e))}},4371:function(e,t,n){var r=n(3048),i=n(4835),o=n(5090),a=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?i(e):o(e)}},4342:function(e,t,n){var r=n(1761),i=n(9711),o=n(4171);e.exports=function(e,t,n){return t==t?o(e,t,n):r(e,i,n)}},3269:function(e){e.exports=function(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1}},6136:function(e,t,n){var r=n(4371),i=n(7605);e.exports=function(e){return i(e)&&"[object Arguments]"==r(e)}},5107:function(e,t,n){var r=n(1838),i=n(7605);e.exports=function e(t,n,o,a,s){return t===n||(null==t||null==n||!i(t)&&!i(n)?t!=t&&n!=n:r(t,n,o,a,e,s))}},1838:function(e,t,n){var r=n(6166),i=n(4614),o=n(1978),a=n(581),s=n(3651),u=n(1509),l=n(9341),c=n(4434),h="[object Arguments]",f="[object Array]",p="[object Object]",d=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,v,m,g){var y=u(e),_=u(t),b=y?f:s(e),x=_?f:s(t),E=(b=b==h?p:b)==p,S=(x=x==h?p:x)==p,A=b==x;if(A&&l(e)){if(!l(t))return!1;y=!0,E=!1}if(A&&!E)return g||(g=new r),y||c(e)?i(e,t,n,v,m,g):o(e,t,b,n,v,m,g);if(!(1&n)){var T=E&&d.call(e,"__wrapped__"),C=S&&d.call(t,"__wrapped__");if(T||C){var w=T?e.value():e,R=C?t.value():t;return g||(g=new r),m(w,R,n,v,g)}}return!!A&&(g||(g=new r),a(e,t,n,v,m,g))}},4314:function(e,t,n){var r=n(3651),i=n(7605);e.exports=function(e){return i(e)&&"[object Map]"==r(e)}},9711:function(e){e.exports=function(e){return e!=e}},8025:function(e,t,n){var r=n(5229),i=n(8683),o=n(8032),a=n(6817),s=/^\[object .+?Constructor\]$/,u=Function.prototype,l=Object.prototype,c=u.toString,h=l.hasOwnProperty,f=RegExp("^"+c.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(r(e)?f:s).test(a(e))}},2364:function(e,t,n){var r=n(3651),i=n(7605);e.exports=function(e){return i(e)&&"[object Set]"==r(e)}},8811:function(e,t,n){var r=n(4371),i=n(862),o=n(7605),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!a[r(e)]}},1329:function(e,t,n){var r=n(9369),i=n(677),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=[];for(var n in Object(e))o.call(e,n)&&"constructor"!=n&&t.push(n);return t}},7629:function(e,t,n){var r=n(8032),i=n(9369),o=n(4202),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=i(e),n=[];for(var s in e)("constructor"!=s||!t&&a.call(e,s))&&n.push(s);return n}},1765:function(e,t,n){var r=n(6166),i=n(777),o=n(8123),a=n(6430),s=n(8032),u=n(3028),l=n(151);e.exports=function e(t,n,c,h,f){t!==n&&o(n,(function(o,u){if(f||(f=new r),s(o))a(t,n,u,c,e,h,f);else{var p=h?h(l(t,u),o,u+"",t,n,f):void 0;void 0===p&&(p=o),i(t,u,p)}}),u)}},6430:function(e,t,n){var r=n(777),i=n(5210),o=n(5713),a=n(4660),s=n(4160),u=n(5697),l=n(1509),c=n(3446),h=n(9341),f=n(5229),p=n(8032),d=n(5304),v=n(4434),m=n(151),g=n(2034);e.exports=function(e,t,n,y,_,b,x){var E=m(e,n),S=m(t,n),A=x.get(S);if(A)r(e,n,A);else{var T=b?b(E,S,n+"",e,t,x):void 0,C=void 0===T;if(C){var w=l(S),R=!w&&h(S),M=!w&&!R&&v(S);T=S,w||R||M?l(E)?T=E:c(E)?T=a(E):R?(C=!1,T=i(S,!0)):M?(C=!1,T=o(S,!0)):T=[]:d(S)||u(S)?(T=E,u(E)?T=g(E):p(E)&&!f(E)||(T=s(S))):C=!1}C&&(x.set(S,T),_(T,S,y,b,x),x.delete(S)),r(e,n,T)}}},9377:function(e){e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},187:function(e,t,n){var r=n(5527),i=n(4342),o=n(3269),a=n(7794),s=n(4660),u=Array.prototype.splice;e.exports=function(e,t,n,l){var c=l?o:i,h=-1,f=t.length,p=e;for(e===t&&(t=s(t)),n&&(p=r(e,a(n)));++h<f;)for(var d=0,v=t[h],m=n?n(v):v;(d=c(p,m,d,l))>-1;)p!==e&&u.call(p,d,1),u.call(e,d,1);return e}},8673:function(e,t,n){var r=n(4430),i=n(8458),o=n(3734);e.exports=function(e,t){return o(i(e,t,r),e+"")}},4414:function(e,t,n){var r=n(8757),i=n(7256),o=n(4430),a=i?function(e,t){return i(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:o;e.exports=a},9425:function(e){e.exports=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o}},725:function(e){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},6332:function(e,t,n){var r=n(3048),i=n(5527),o=n(1509),a=n(113),s=r?r.prototype:void 0,u=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return i(t,e)+"";if(a(t))return u?u.call(t):"";var n=t+"";return"0"==n&&1/t==-Infinity?"-0":n}},8079:function(e,t,n){var r=n(8031),i=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(i,""):e}},7794:function(e){e.exports=function(e){return function(t){return e(t)}}},696:function(e,t,n){var r=n(4366),i=n(2893),o=n(104),a=n(5471),s=n(1534),u=n(9010);e.exports=function(e,t,n){var l=-1,c=i,h=e.length,f=!0,p=[],d=p;if(n)f=!1,c=o;else if(h>=200){var v=t?null:s(e);if(v)return u(v);f=!1,c=a,d=new r}else d=t?[]:p;e:for(;++l<h;){var m=e[l],g=t?t(m):m;if(m=n||0!==m?m:0,f&&g==g){for(var y=d.length;y--;)if(d[y]===g)continue e;t&&d.push(g),p.push(m)}else c(d,g,n)||(d!==p&&d.push(g),p.push(m))}return p}},5471:function(e){e.exports=function(e,t){return e.has(t)}},2773:function(e,t,n){var r=n(1509),i=n(990),o=n(8573),a=n(4301);e.exports=function(e,t){return r(e)?e:i(e,t)?[e]:o(a(e))}},9074:function(e,t,n){var r=n(9425);e.exports=function(e,t,n){var i=e.length;return n=void 0===n?i:n,!t&&n>=i?e:r(e,t,n)}},1141:function(e,t,n){var r=n(9523);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},5210:function(e,t,n){e=n.nmd(e);var r=n(5570).default,i=n(2674),o="object"==r(t)&&t&&!t.nodeType&&t,a=o&&"object"==r(e)&&e&&!e.nodeType&&e,s=a&&a.exports===o?i.Buffer:void 0,u=s?s.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=u?u(n):new e.constructor(n);return e.copy(r),r}},4415:function(e,t,n){var r=n(1141);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}},4833:function(e){var t=/\w*$/;e.exports=function(e){var n=new e.constructor(e.source,t.exec(e));return n.lastIndex=e.lastIndex,n}},5178:function(e,t,n){var r=n(3048),i=r?r.prototype:void 0,o=i?i.valueOf:void 0;e.exports=function(e){return o?Object(o.call(e)):{}}},5713:function(e,t,n){var r=n(1141);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},4660:function(e){e.exports=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}},3051:function(e,t,n){var r=n(7722),i=n(1366);e.exports=function(e,t,n,o){var a=!n;n||(n={});for(var s=-1,u=t.length;++s<u;){var l=t[s],c=o?o(n[l],e[l],l,n,e):void 0;void 0===c&&(c=e[l]),a?i(n,l,c):r(n,l,c)}return n}},6370:function(e,t,n){var r=n(3051),i=n(7510);e.exports=function(e,t){return r(e,i(e),t)}},6840:function(e,t,n){var r=n(3051),i=n(7093);e.exports=function(e,t){return r(e,i(e),t)}},9365:function(e,t,n){var r=n(2674)["__core-js_shared__"];e.exports=r},2772:function(e,t,n){var r=n(8673),i=n(3469);e.exports=function(e){return r((function(t,n){var r=-1,o=n.length,a=o>1?n[o-1]:void 0,s=o>2?n[2]:void 0;for(a=e.length>3&&"function"==typeof a?(o--,a):void 0,s&&i(n[0],n[1],s)&&(a=o<3?void 0:a,o=1),t=Object(t);++r<o;){var u=n[r];u&&e(t,u,r,a)}return t}))}},8419:function(e){e.exports=function(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var u=a[e?s:++i];if(!1===n(o[u],u,o))break}return t}}},2269:function(e,t,n){var r=n(9074),i=n(5166),o=n(4361),a=n(4301);e.exports=function(e){return function(t){t=a(t);var n=i(t)?o(t):void 0,s=n?n[0]:t.charAt(0),u=n?r(n,1).join(""):t.slice(1);return s[e]()+u}}},8136:function(e,t,n){var r=n(223),i=n(4175),o=n(8307),a=RegExp("['’]","g");e.exports=function(e){return function(t){return r(o(i(t).replace(a,"")),e,"")}}},1534:function(e,t,n){var r=n(7222),i=n(5323),o=n(9010),a=r&&1/o(new r([,-0]))[1]==1/0?function(e){return new r(e)}:i;e.exports=a},5003:function(e,t,n){var r=n(9377)({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"});e.exports=r},7256:function(e,t,n){var r=n(6229),i=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=i},4614:function(e,t,n){var r=n(4366),i=n(3953),o=n(5471);e.exports=function(e,t,n,a,s,u){var l=1&n,c=e.length,h=t.length;if(c!=h&&!(l&&h>c))return!1;var f=u.get(e),p=u.get(t);if(f&&p)return f==t&&p==e;var d=-1,v=!0,m=2&n?new r:void 0;for(u.set(e,t),u.set(t,e);++d<c;){var g=e[d],y=t[d];if(a)var _=l?a(y,g,d,t,e,u):a(g,y,d,e,t,u);if(void 0!==_){if(_)continue;v=!1;break}if(m){if(!i(t,(function(e,t){if(!o(m,t)&&(g===e||s(g,e,n,a,u)))return m.push(t)}))){v=!1;break}}else if(g!==y&&!s(g,y,n,a,u)){v=!1;break}}return u.delete(e),u.delete(t),v}},1978:function(e,t,n){var r=n(3048),i=n(9523),o=n(4831),a=n(4614),s=n(4943),u=n(9010),l=r?r.prototype:void 0,c=l?l.valueOf:void 0;e.exports=function(e,t,n,r,l,h,f){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!h(new i(e),new i(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var p=s;case"[object Set]":var d=1&r;if(p||(p=u),e.size!=t.size&&!d)return!1;var v=f.get(e);if(v)return v==t;r|=2,f.set(e,t);var m=a(p(e),p(t),r,l,h,f);return f.delete(e),m;case"[object Symbol]":if(c)return c.call(e)==c.call(t)}return!1}},581:function(e,t,n){var r=n(9395),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,o,a,s){var u=1&n,l=r(e),c=l.length;if(c!=r(t).length&&!u)return!1;for(var h=c;h--;){var f=l[h];if(!(u?f in t:i.call(t,f)))return!1}var p=s.get(e),d=s.get(t);if(p&&d)return p==t&&d==e;var v=!0;s.set(e,t),s.set(t,e);for(var m=u;++h<c;){var g=e[f=l[h]],y=t[f];if(o)var _=u?o(y,g,f,t,e,s):o(g,y,f,e,t,s);if(!(void 0===_?g===y||a(g,y,n,o,s):_)){v=!1;break}m||(m="constructor"==f)}if(v&&!m){var b=e.constructor,x=t.constructor;b==x||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof x&&x instanceof x||(v=!1)}return s.delete(e),s.delete(t),v}},2619:function(e,t,n){var r=n(5570).default,i="object"==(void 0===n.g?"undefined":r(n.g))&&n.g&&n.g.Object===Object&&n.g;e.exports=i},9395:function(e,t,n){var r=n(8569),i=n(7510),o=n(5829);e.exports=function(e){return r(e,o,i)}},2378:function(e,t,n){var r=n(8569),i=n(7093),o=n(3028);e.exports=function(e){return r(e,o,i)}},728:function(e,t,n){var r=n(8709);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},6229:function(e,t,n){var r=n(8025),i=n(4344);e.exports=function(e,t){var n=i(e,t);return r(n)?n:void 0}},4212:function(e,t,n){var r=n(3431)(Object.getPrototypeOf,Object);e.exports=r},4835:function(e,t,n){var r=n(3048),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(e){}var i=a.call(e);return r&&(t?e[s]=n:delete e[s]),i}},7510:function(e,t,n){var r=n(7362),i=n(7317),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(e){return null==e?[]:(e=Object(e),r(a(e),(function(t){return o.call(e,t)})))}:i;e.exports=s},7093:function(e,t,n){var r=n(917),i=n(4212),o=n(7510),a=n(7317),s=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)r(t,o(e)),e=i(e);return t}:a;e.exports=s},3651:function(e,t,n){var r=n(5118),i=n(1962),o=n(3551),a=n(7222),s=n(1553),u=n(4371),l=n(6817),c="[object Map]",h="[object Promise]",f="[object Set]",p="[object WeakMap]",d="[object DataView]",v=l(r),m=l(i),g=l(o),y=l(a),_=l(s),b=u;(r&&b(new r(new ArrayBuffer(1)))!=d||i&&b(new i)!=c||o&&b(o.resolve())!=h||a&&b(new a)!=f||s&&b(new s)!=p)&&(b=function(e){var t=u(e),n="[object Object]"==t?e.constructor:void 0,r=n?l(n):"";if(r)switch(r){case v:return d;case m:return c;case g:return h;case y:return f;case _:return p}return t}),e.exports=b},4344:function(e){e.exports=function(e,t){return null==e?void 0:e[t]}},5166:function(e){var t=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return t.test(e)}},5395:function(e){var t=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;e.exports=function(e){return t.test(e)}},7338:function(e,t,n){var r=n(4604);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},6485:function(e){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},3134:function(e,t,n){var r=n(4604),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(t,e)?t[e]:void 0}},4138:function(e,t,n){var r=n(4604),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:i.call(t,e)}},3769:function(e,t,n){var r=n(4604);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},1131:function(e){var t=Object.prototype.hasOwnProperty;e.exports=function(e){var n=e.length,r=new e.constructor(n);return n&&"string"==typeof e[0]&&t.call(e,"index")&&(r.index=e.index,r.input=e.input),r}},4427:function(e,t,n){var r=n(1141),i=n(4415),o=n(4833),a=n(5178),s=n(5713);e.exports=function(e,t,n){var u=e.constructor;switch(t){case"[object ArrayBuffer]":return r(e);case"[object Boolean]":case"[object Date]":return new u(+e);case"[object DataView]":return i(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(e,n);case"[object Map]":case"[object Set]":return new u;case"[object Number]":case"[object String]":return new u(e);case"[object RegExp]":return o(e);case"[object Symbol]":return a(e)}}},4160:function(e,t,n){var r=n(8199),i=n(4212),o=n(9369);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:r(i(e))}},1377:function(e,t,n){var r=n(5570).default,i=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var n=r(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&i.test(e))&&e>-1&&e%1==0&&e<t}},3469:function(e,t,n){var r=n(5570).default,i=n(4831),o=n(248),a=n(1377),s=n(8032);e.exports=function(e,t,n){if(!s(n))return!1;var u=r(t);return!!("number"==u?o(n)&&a(t,n.length):"string"==u&&t in n)&&i(n[t],e)}},990:function(e,t,n){var r=n(5570).default,i=n(1509),o=n(113),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;e.exports=function(e,t){if(i(e))return!1;var n=r(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!o(e))||(s.test(e)||!a.test(e)||null!=t&&e in Object(t))}},8709:function(e,t,n){var r=n(5570).default;e.exports=function(e){var t=r(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},8683:function(e,t,n){var r,i=n(9365),o=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!o&&o in e}},9369:function(e){var t=Object.prototype;e.exports=function(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||t)}},8461:function(e){e.exports=function(){this.__data__=[],this.size=0}},8658:function(e,t,n){var r=n(5731),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0)&&(n==t.length-1?t.pop():i.call(t,n,1),--this.size,!0)}},6575:function(e,t,n){var r=n(5731);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},7272:function(e,t,n){var r=n(5731);e.exports=function(e){return r(this.__data__,e)>-1}},4490:function(e,t,n){var r=n(5731);e.exports=function(e,t){var n=this.__data__,i=r(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},159:function(e,t,n){var r=n(6368),i=n(3593),o=n(1962);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},8870:function(e,t,n){var r=n(728);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},3357:function(e,t,n){var r=n(728);e.exports=function(e){return r(this,e).get(e)}},5175:function(e,t,n){var r=n(728);e.exports=function(e){return r(this,e).has(e)}},308:function(e,t,n){var r=n(728);e.exports=function(e,t){var n=r(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},4943:function(e){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}},5843:function(e,t,n){var r=n(87);e.exports=function(e){var t=r(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}},4604:function(e,t,n){var r=n(6229)(Object,"create");e.exports=r},677:function(e,t,n){var r=n(3431)(Object.keys,Object);e.exports=r},4202:function(e){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},6959:function(e,t,n){e=n.nmd(e);var r=n(5570).default,i=n(2619),o="object"==r(t)&&t&&!t.nodeType&&t,a=o&&"object"==r(e)&&e&&!e.nodeType&&e,s=a&&a.exports===o&&i.process,u=function(){try{var e=a&&a.require&&a.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=u},5090:function(e){var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},3431:function(e){e.exports=function(e,t){return function(n){return e(t(n))}}},8458:function(e,t,n){var r=n(2319),i=Math.max;e.exports=function(e,t,n){return t=i(void 0===t?e.length-1:t,0),function(){for(var o=arguments,a=-1,s=i(o.length-t,0),u=Array(s);++a<s;)u[a]=o[t+a];a=-1;for(var l=Array(t+1);++a<t;)l[a]=o[a];return l[t]=n(u),r(e,this,l)}}},2674:function(e,t,n){var r=n(5570).default,i=n(2619),o="object"==("undefined"==typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,a=i||o||Function("return this")();e.exports=a},151:function(e){e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},1168:function(e){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},9231:function(e){e.exports=function(e){return this.__data__.has(e)}},9010:function(e){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},3734:function(e,t,n){var r=n(4414),i=n(8990)(r);e.exports=i},8990:function(e){var t=Date.now;e.exports=function(e){var n=0,r=0;return function(){var i=t(),o=16-(i-r);if(r=i,o>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(void 0,arguments)}}},6688:function(e,t,n){var r=n(3593);e.exports=function(){this.__data__=new r,this.size=0}},3673:function(e){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},1142:function(e){e.exports=function(e){return this.__data__.get(e)}},6507:function(e){e.exports=function(e){return this.__data__.has(e)}},3414:function(e,t,n){var r=n(3593),i=n(1962),o=n(2275);e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!i||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(e,t),this.size=n.size,this}},4171:function(e){e.exports=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}},4361:function(e,t,n){var r=n(4953),i=n(5166),o=n(9962);e.exports=function(e){return i(e)?o(e):r(e)}},8573:function(e,t,n){var r=n(5843),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,a=r((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(i,(function(e,n,r,i){t.push(r?i.replace(o,"$1"):n||e)})),t}));e.exports=a},7415:function(e,t,n){var r=n(113);e.exports=function(e){if("string"==typeof e||r(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}},6817:function(e){var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},8031:function(e){var t=/\s/;e.exports=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n}},9962:function(e){var t="\\ud800-\\udfff",n="["+t+"]",r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",i="\\ud83c[\\udffb-\\udfff]",o="[^"+t+"]",a="(?:\\ud83c[\\udde6-\\uddff]){2}",s="[\\ud800-\\udbff][\\udc00-\\udfff]",u="(?:"+r+"|"+i+")"+"?",l="[\\ufe0e\\ufe0f]?",c=l+u+("(?:\\u200d(?:"+[o,a,s].join("|")+")"+l+u+")*"),h="(?:"+[o+r+"?",r,a,s,n].join("|")+")",f=RegExp(i+"(?="+i+")|"+h+c,"g");e.exports=function(e){return e.match(f)||[]}},9515:function(e){var t="\\ud800-\\udfff",n="\\u2700-\\u27bf",r="a-z\\xdf-\\xf6\\xf8-\\xff",i="A-Z\\xc0-\\xd6\\xd8-\\xde",o="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",a="["+o+"]",s="\\d+",u="["+n+"]",l="["+r+"]",c="[^"+t+o+s+n+r+i+"]",h="(?:\\ud83c[\\udde6-\\uddff]){2}",f="[\\ud800-\\udbff][\\udc00-\\udfff]",p="["+i+"]",d="(?:"+l+"|"+c+")",v="(?:"+p+"|"+c+")",m="(?:['’](?:d|ll|m|re|s|t|ve))?",g="(?:['’](?:D|LL|M|RE|S|T|VE))?",y="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",_="[\\ufe0e\\ufe0f]?",b=_+y+("(?:\\u200d(?:"+["[^"+t+"]",h,f].join("|")+")"+_+y+")*"),x="(?:"+[u,h,f].join("|")+")"+b,E=RegExp([p+"?"+l+"+"+m+"(?="+[a,p,"$"].join("|")+")",v+"+"+g+"(?="+[a,p+d,"$"].join("|")+")",p+"?"+d+"+"+m,p+"+"+g,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",s,x].join("|"),"g");e.exports=function(e){return e.match(E)||[]}},5057:function(e,t,n){var r=n(4254),i=n(8136)((function(e,t,n){return t=t.toLowerCase(),e+(n?r(t):t)}));e.exports=i},4254:function(e,t,n){var r=n(4301),i=n(3002);e.exports=function(e){return i(r(e).toLowerCase())}},6812:function(e,t,n){var r=n(2162),i=n(5772);e.exports=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=i(n))==n?n:0),void 0!==t&&(t=(t=i(t))==t?t:0),r(i(e),t,n)}},4412:function(e,t,n){var r=n(9142);e.exports=function(e){return r(e,5)}},8757:function(e){e.exports=function(e){return function(){return e}}},4654:function(e,t,n){var r=n(8032),i=n(734),o=n(5772),a=Math.max,s=Math.min;e.exports=function(e,t,n){var u,l,c,h,f,p,d=0,v=!1,m=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var n=u,r=l;return u=l=void 0,d=t,h=e.apply(r,n)}function _(e){return d=e,f=setTimeout(x,t),v?y(e):h}function b(e){var n=e-p;return void 0===p||n>=t||n<0||m&&e-d>=c}function x(){var e=i();if(b(e))return E(e);f=setTimeout(x,function(e){var n=t-(e-p);return m?s(n,c-(e-d)):n}(e))}function E(e){return f=void 0,g&&u?y(e):(u=l=void 0,h)}function S(){var e=i(),n=b(e);if(u=arguments,l=this,p=e,n){if(void 0===f)return _(p);if(m)return clearTimeout(f),f=setTimeout(x,t),y(p)}return void 0===f&&(f=setTimeout(x,t)),h}return t=o(t)||0,r(n)&&(v=!!n.leading,c=(m="maxWait"in n)?a(o(n.maxWait)||0,t):c,g="trailing"in n?!!n.trailing:g),S.cancel=function(){void 0!==f&&clearTimeout(f),d=0,u=p=l=f=void 0},S.flush=function(){return void 0===f?h:E(i())},S}},4175:function(e,t,n){var r=n(5003),i=n(4301),o=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,a=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");e.exports=function(e){return(e=i(e))&&e.replace(o,r).replace(a,"")}},4831:function(e){e.exports=function(e,t){return e===t||e!=e&&t!=t}},3903:function(e,t,n){var r=n(484);e.exports=function(e,t,n){var i=null==e?void 0:r(e,t);return void 0===i?n:i}},4430:function(e){e.exports=function(e){return e}},5697:function(e,t,n){var r=n(6136),i=n(7605),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(e){return i(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},1509:function(e){var t=Array.isArray;e.exports=t},248:function(e,t,n){var r=n(5229),i=n(862);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},3446:function(e,t,n){var r=n(248),i=n(7605);e.exports=function(e){return i(e)&&r(e)}},5189:function(e,t,n){var r=n(4371),i=n(7605);e.exports=function(e){return!0===e||!1===e||i(e)&&"[object Boolean]"==r(e)}},9341:function(e,t,n){e=n.nmd(e);var r=n(5570).default,i=n(2674),o=n(6282),a="object"==r(t)&&t&&!t.nodeType&&t,s=a&&"object"==r(e)&&e&&!e.nodeType&&e,u=s&&s.exports===a?i.Buffer:void 0,l=(u?u.isBuffer:void 0)||o;e.exports=l},8243:function(e,t,n){var r=n(5107);e.exports=function(e,t){return r(e,t)}},5229:function(e,t,n){var r=n(4371),i=n(8032);e.exports=function(e){if(!i(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},862:function(e){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},4129:function(e,t,n){var r=n(4314),i=n(7794),o=n(6959),a=o&&o.isMap,s=a?i(a):r;e.exports=s},3714:function(e){e.exports=function(e){return null==e}},8904:function(e,t,n){var r=n(4371),i=n(7605);e.exports=function(e){return"number"==typeof e||i(e)&&"[object Number]"==r(e)}},8032:function(e,t,n){var r=n(5570).default;e.exports=function(e){var t=r(e);return null!=e&&("object"==t||"function"==t)}},7605:function(e,t,n){var r=n(5570).default;e.exports=function(e){return null!=e&&"object"==r(e)}},5304:function(e,t,n){var r=n(4371),i=n(4212),o=n(7605),a=Function.prototype,s=Object.prototype,u=a.toString,l=s.hasOwnProperty,c=u.call(Object);e.exports=function(e){if(!o(e)||"[object Object]"!=r(e))return!1;var t=i(e);if(null===t)return!0;var n=l.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)==c}},8871:function(e,t,n){var r=n(2364),i=n(7794),o=n(6959),a=o&&o.isSet,s=a?i(a):r;e.exports=s},5128:function(e,t,n){var r=n(4371),i=n(1509),o=n(7605);e.exports=function(e){return"string"==typeof e||!i(e)&&o(e)&&"[object String]"==r(e)}},113:function(e,t,n){var r=n(5570).default,i=n(4371),o=n(7605);e.exports=function(e){return"symbol"==r(e)||o(e)&&"[object Symbol]"==i(e)}},4434:function(e,t,n){var r=n(8811),i=n(7794),o=n(6959),a=o&&o.isTypedArray,s=a?i(a):r;e.exports=s},5437:function(e){e.exports=function(e){return void 0===e}},5829:function(e,t,n){var r=n(8146),i=n(1329),o=n(248);e.exports=function(e){return o(e)?r(e):i(e)}},3028:function(e,t,n){var r=n(8146),i=n(7629),o=n(248);e.exports=function(e){return o(e)?r(e,!0):i(e)}},87:function(e,t,n){var r=n(2275);function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(i.Cache||r),n}i.Cache=r,e.exports=i},870:function(e,t,n){var r=n(1765),i=n(2772)((function(e,t,n){r(e,t,n)}));e.exports=i},1276:function(e,t,n){var r=n(1765),i=n(2772)((function(e,t,n,i){r(e,t,n,i)}));e.exports=i},5323:function(e){e.exports=function(){}},734:function(e,t,n){var r=n(2674);e.exports=function(){return r.Date.now()}},3361:function(e,t,n){var r=n(8673)(n(7832));e.exports=r},7832:function(e,t,n){var r=n(187);e.exports=function(e,t){return e&&e.length&&t&&t.length?r(e,t):e}},7317:function(e){e.exports=function(){return[]}},6282:function(e){e.exports=function(){return!1}},2788:function(e,t,n){var r=n(4654),i=n(8032);e.exports=function(e,t,n){var o=!0,a=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return i(n)&&(o="leading"in n?!!n.leading:o,a="trailing"in n?!!n.trailing:a),r(e,t,{leading:o,maxWait:t,trailing:a})}},5772:function(e,t,n){var r=n(8079),i=n(8032),o=n(113),a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,u=/^0o[0-7]+$/i,l=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var n=s.test(e);return n||u.test(e)?l(e.slice(2),n?2:8):a.test(e)?NaN:+e}},2034:function(e,t,n){var r=n(3051),i=n(3028);e.exports=function(e){return r(e,i(e))}},4301:function(e,t,n){var r=n(6332);e.exports=function(e){return null==e?"":r(e)}},3214:function(e,t,n){var r=n(696);e.exports=function(e){return e&&e.length?r(e):[]}},3002:function(e,t,n){var r=n(2269)("toUpperCase");e.exports=r},8307:function(e,t,n){var r=n(1307),i=n(5395),o=n(4301),a=n(9515);e.exports=function(e,t,n){return e=o(e),void 0===(t=n?void 0:t)?i(e)?a(e):r(e):e.match(t)||[]}},3093:function(e,t,n){"use strict";e.exports=i;var r=n(91);function i(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,a=1/o,s="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function u(e){return e.type===i.Bytes?e.readVarint()+e.pos:e.pos+1}function l(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function c(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function h(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function f(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function p(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function d(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function v(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function m(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function g(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function y(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function _(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function b(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function x(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function E(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,e(i,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=b(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=E(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=b(this.buf,this.pos)+b(this.buf,this.pos+4)*o;return this.pos+=8,e},readSFixed64:function(){var e=b(this.buf,this.pos)+E(this.buf,this.pos+4)*o;return this.pos+=8,e},readFloat:function(){var e=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(e,t,n){var r,i,o=n.buf;if(i=o[n.pos++],r=(112&i)>>4,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(127&i)<<3,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(127&i)<<10,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(127&i)<<17,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(127&i)<<24,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(1&i)<<31,i<128)return l(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&s?function(e,t,n){return s.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){var r="",i=t;for(;i<n;){var o,a,s,u=e[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(o=e[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==i.Bytes)return e.push(this.readVarint(t));var n=u(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==i.Bytes)return e.push(this.readSVarint());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==i.Bytes)return e.push(this.readBoolean());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==i.Bytes)return e.push(this.readFloat());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==i.Bytes)return e.push(this.readDouble());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==i.Bytes)return e.push(this.readFixed32());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==i.Bytes)return e.push(this.readSFixed32());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==i.Bytes)return e.push(this.readFixed64());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==i.Bytes)return e.push(this.readSFixed64());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===i.Varint)for(;this.buf[this.pos++]>127;);else if(t===i.Bytes)this.pos=this.readVarint()+this.pos;else if(t===i.Fixed32)this.pos+=4;else{if(t!==i.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),x(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),x(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),x(this.buf,-1&e,this.pos),x(this.buf,Math.floor(e*a),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),x(this.buf,-1&e,this.pos),x(this.buf,Math.floor(e*a),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,r;e>=0?(n=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,r=r+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos]=127&e}(n,0,t),function(e,t){var n=(7&e)<<4;if(t.buf[t.pos++]|=n|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var r,i,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&c(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),r.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),r.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&c(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,i.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,h,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,f,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,v,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,p,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,d,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,m,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,g,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,y,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,_,t)},writeBytesField:function(e,t){this.writeTag(e,i.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,i.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,i.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,i.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},7473:function(e,t,n){var r,i,o,a=n(4828),s=n(4528).default,u=n(8798).default,l=n(5570).default;o=function(){"use strict";function e(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var t=function(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null};function n(e,t){return e>t?1:e<t?-1:0}function r(e,n,r){for(var i=new t(null,null),o=i,a=i;;){var s=r(e,n.key);if(s<0){if(null===n.left)break;if(r(e,n.left.key)<0){var u=n.left;if(n.left=u.right,u.right=n,null===(n=u).left)break}a.left=n,a=n,n=n.left}else{if(!(s>0))break;if(null===n.right)break;if(r(e,n.right.key)>0&&(u=n.right,n.right=u.left,u.left=n,null===(n=u).right))break;o.right=n,o=n,n=n.right}}return o.right=n.left,a.left=n.right,n.left=i.right,n.right=i.left,n}function i(e,n,i,o){var a=new t(e,n);if(null===i)return a.left=a.right=null,a;var s=o(e,(i=r(e,i,o)).key);return s<0?(a.left=i.left,a.right=i,i.left=null):s>=0&&(a.right=i.right,a.left=i,i.right=null),a}function o(e,t,n){var i=null,o=null;if(t){var a=n((t=r(e,t,n)).key,e);0===a?(i=t.left,o=t.right):a<0?(o=t.right,t.right=null,i=t):(i=t.left,t.left=null,o=t)}return{left:i,right:o}}function l(e,t,n,r,i){if(e){r(t+(n?"└── ":"├── ")+i(e)+"\n");var o=t+(n?"    ":"│   ");e.left&&l(e.left,o,!1,r,i),e.right&&l(e.right,o,!0,r,i)}}var c=function(){function a(e){void 0===e&&(e=n),this._root=null,this._size=0,this._comparator=e}return a.prototype.insert=function(e,t){return this._size++,this._root=i(e,t,this._root,this._comparator)},a.prototype.add=function(e,n){var i=new t(e,n);null===this._root&&(i.left=i.right=null,this._size++,this._root=i);var o=this._comparator,a=r(e,this._root,o),s=o(e,a.key);return 0===s?this._root=a:(s<0?(i.left=a.left,i.right=a,a.left=null):s>0&&(i.right=a.right,i.left=a,a.right=null),this._size++,this._root=i),this._root},a.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},a.prototype._remove=function(e,t,n){var i;return null===t?null:0===n(e,(t=r(e,t,n)).key)?(null===t.left?i=t.right:(i=r(e,t.left,n)).right=t.right,this._size--,i):t},a.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=r(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},a.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return t;t=r<0?t.left:t.right}return null},a.prototype.find=function(e){return this._root&&(this._root=r(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},a.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1},a.prototype.forEach=function(e,t){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),e.call(t,n),n=n.right):i=!0;return this},a.prototype.range=function(e,t,n,r){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,t)>0)break;if(o(a.key,e)>=0&&n.call(r,a))return this;a=a.right}return this},a.prototype.keys=function(){var e=[];return this.forEach((function(t){var n=t.key;return e.push(n)})),e},a.prototype.values=function(){var e=[];return this.forEach((function(t){var n=t.data;return e.push(n)})),e},a.prototype.min=function(){return this._root?this.minNode(this._root).key:null},a.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},a.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},a.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},a.prototype.at=function(e){for(var t=this._root,n=!1,r=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),r===e)return t;r++,t=t.right}else n=!0;return null},a.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?(n=t,t=t.left):t=t.right}return n},a.prototype.prev=function(e){var t=this._root,n=null;if(null!==e.left){for(n=e.left;n.right;)n=n.right;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?t=t.left:(n=t,t=t.right)}return n},a.prototype.clear=function(){return this._root=null,this._size=0,this},a.prototype.toList=function(){return function(e){for(var n=e,r=[],i=!1,o=new t(null,null),a=o;!i;)n?(r.push(n),n=n.left):r.length>0?n=(n=a=a.next=r.pop()).right:i=!0;return a.next=null,o.next}(this._root)},a.prototype.load=function(e,n,r){void 0===n&&(n=[]),void 0===r&&(r=!1);var i=e.length,o=this._comparator;if(r&&p(e,n,0,i-1,o),null===this._root)this._root=h(e,n,0,i),this._size=i;else{var a=function(e,n,r){for(var i=new t(null,null),o=i,a=e,s=n;null!==a&&null!==s;)r(a.key,s.key)<0?(o.next=a,a=a.next):(o.next=s,s=s.next),o=o.next;return null!==a?o.next=a:null!==s&&(o.next=s),i.next}(this.toList(),function(e,n){for(var r=new t(null,null),i=r,o=0;o<e.length;o++)i=i.next=new t(e[o],n[o]);return i.next=null,r.next}(e,n),o);i=this._size+i,this._root=f({head:a},0,i)}return this},a.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),a.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return l(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},a.prototype.update=function(e,t,n){var a=this._comparator,s=o(e,this._root,a),u=s.left,l=s.right;a(e,t)<0?l=i(t,n,l,a):u=i(t,n,u,a),this._root=function(e,t,n){return null===t?e:(null===e||((t=r(e.key,t,n)).left=e),t)}(u,l,a)},a.prototype.split=function(e){return o(e,this._root,this._comparator)},a.prototype[Symbol.iterator]=function(){var t,n,r;return e(this,(function(e){switch(e.label){case 0:t=this._root,n=[],r=!1,e.label=1;case 1:return r?[3,6]:null===t?[3,2]:(n.push(t),t=t.left,[3,5]);case 2:return 0===n.length?[3,4]:[4,t=n.pop()];case 3:return e.sent(),t=t.right,[3,5];case 4:r=!0,e.label=5;case 5:return[3,1];case 6:return[2]}}))},a}();function h(e,n,r,i){var o=i-r;if(o>0){var a=r+Math.floor(o/2),s=e[a],u=n[a],l=new t(s,u);return l.left=h(e,n,r,a),l.right=h(e,n,a+1,i),l}return null}function f(e,t,n){var r=n-t;if(r>0){var i=t+Math.floor(r/2),o=f(e,t,i),a=e.head;return a.left=o,e.head=e.head.next,a.right=f(e,i+1,n),a}return null}function p(e,t,n,r,i){if(!(n>=r)){for(var o=e[n+r>>1],a=n-1,s=r+1;;){do{a++}while(i(e[a],o)<0);do{s--}while(i(e[s],o)>0);if(a>=s)break;var u=e[a];e[a]=e[s],e[s]=u,u=t[a],t[a]=t[s],t[s]=u}p(e,t,n,s,i),p(e,t,s+1,r,i)}}var d=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},v=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x;return{ll:{x:n,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:r,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}}},m=Number.EPSILON;void 0===m&&(m=Math.pow(2,-52));var g=m*m,y=function(e,t){if(-m<e&&e<m&&-m<t&&t<m)return 0;var n=e-t;return n*n<g*e*t?0:e<t?-1:1},_=function(){function e(){s(this,e),this.reset()}return u(e,[{key:"reset",value:function(){this.xRounder=new b,this.yRounder=new b}},{key:"round",value:function(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}]),e}(),b=function(){function e(){s(this,e),this.tree=new c,this.round(0)}return u(e,[{key:"round",value:function(e){var t=this.tree.add(e),n=this.tree.prev(t);if(null!==n&&0===y(t.key,n.key))return this.tree.remove(e),n.key;var r=this.tree.next(t);return null!==r&&0===y(t.key,r.key)?(this.tree.remove(e),r.key):e}}]),e}(),x=new _,E=134217729;function S(e,t,n,r,i){var o,a,s,u,l=t[0],c=r[0],h=0,f=0;c>l==c>-l?(o=l,l=t[++h]):(o=c,c=r[++f]);var p=0;if(h<e&&f<n)for(c>l==c>-l?(s=o-((a=l+o)-l),l=t[++h]):(s=o-((a=c+o)-c),c=r[++f]),o=a,0!==s&&(i[p++]=s);h<e&&f<n;)c>l==c>-l?(s=o-((a=o+l)-(u=a-o))+(l-u),l=t[++h]):(s=o-((a=o+c)-(u=a-o))+(c-u),c=r[++f]),o=a,0!==s&&(i[p++]=s);for(;h<e;)s=o-((a=o+l)-(u=a-o))+(l-u),l=t[++h],o=a,0!==s&&(i[p++]=s);for(;f<n;)s=o-((a=o+c)-(u=a-o))+(c-u),c=r[++f],o=a,0!==s&&(i[p++]=s);return 0===o&&0!==p||(i[p++]=o),p}function A(e){return new Float64Array(e)}var T=A(4),C=A(8),w=A(12),R=A(16),M=A(4);function k(e,t,n,r,i,o){var a=(t-o)*(n-i),s=(e-i)*(r-o),u=a-s,l=Math.abs(a+s);return Math.abs(u)>=33306690738754716e-32*l?u:-function(e,t,n,r,i,o,a){var s,u,l,c,h,f,p,d,v,m,g,y,_,b,x,A,k,L,O=e-i,P=n-i,I=t-o,N=r-o;h=(x=(d=O-(p=(f=E*O)-(f-O)))*(m=N-(v=(f=E*N)-(f-N)))-((b=O*N)-p*v-d*v-p*m))-(g=x-(k=(d=I-(p=(f=E*I)-(f-I)))*(m=P-(v=(f=E*P)-(f-P)))-((A=I*P)-p*v-d*v-p*m))),T[0]=x-(g+h)+(h-k),h=(_=b-((y=b+g)-(h=y-b))+(g-h))-(g=_-A),T[1]=_-(g+h)+(h-A),h=(L=y+g)-y,T[2]=y-(L-h)+(g-h),T[3]=L;var D=function(e,t){for(var n=t[0],r=1;r<e;r++)n+=t[r];return n}(4,T),B=22204460492503146e-32*a;if(D>=B||-D>=B)return D;if(s=e-(O+(h=e-O))+(h-i),l=n-(P+(h=n-P))+(h-i),u=t-(I+(h=t-I))+(h-o),c=r-(N+(h=r-N))+(h-o),0===s&&0===u&&0===l&&0===c)return D;if(B=11093356479670487e-47*a+33306690738754706e-32*Math.abs(D),(D+=O*c+N*s-(I*l+P*u))>=B||-D>=B)return D;h=(x=(d=s-(p=(f=E*s)-(f-s)))*(m=N-(v=(f=E*N)-(f-N)))-((b=s*N)-p*v-d*v-p*m))-(g=x-(k=(d=u-(p=(f=E*u)-(f-u)))*(m=P-(v=(f=E*P)-(f-P)))-((A=u*P)-p*v-d*v-p*m))),M[0]=x-(g+h)+(h-k),h=(_=b-((y=b+g)-(h=y-b))+(g-h))-(g=_-A),M[1]=_-(g+h)+(h-A),h=(L=y+g)-y,M[2]=y-(L-h)+(g-h),M[3]=L;var F=S(4,T,4,M,C);h=(x=(d=O-(p=(f=E*O)-(f-O)))*(m=c-(v=(f=E*c)-(f-c)))-((b=O*c)-p*v-d*v-p*m))-(g=x-(k=(d=I-(p=(f=E*I)-(f-I)))*(m=l-(v=(f=E*l)-(f-l)))-((A=I*l)-p*v-d*v-p*m))),M[0]=x-(g+h)+(h-k),h=(_=b-((y=b+g)-(h=y-b))+(g-h))-(g=_-A),M[1]=_-(g+h)+(h-A),h=(L=y+g)-y,M[2]=y-(L-h)+(g-h),M[3]=L;var U=S(F,C,4,M,w);h=(x=(d=s-(p=(f=E*s)-(f-s)))*(m=c-(v=(f=E*c)-(f-c)))-((b=s*c)-p*v-d*v-p*m))-(g=x-(k=(d=u-(p=(f=E*u)-(f-u)))*(m=l-(v=(f=E*l)-(f-l)))-((A=u*l)-p*v-d*v-p*m))),M[0]=x-(g+h)+(h-k),h=(_=b-((y=b+g)-(h=y-b))+(g-h))-(g=_-A),M[1]=_-(g+h)+(h-A),h=(L=y+g)-y,M[2]=y-(L-h)+(g-h),M[3]=L;var z=S(U,w,4,M,R);return R[z-1]}(e,t,n,r,i,o,l)}var L=function(e,t){return e.x*t.y-e.y*t.x},O=function(e,t){return e.x*t.x+e.y*t.y},P=function(e,t,n){var r=k(e.x,e.y,t.x,t.y,n.x,n.y);return r>0?-1:r<0?1:0},I=function(e){return Math.sqrt(O(e,e))},N=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return O(i,r)/I(i)/I(r)},D=function(e,t,n){return 0===t.y?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},B=function(e,t,n){return 0===t.x?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},F=function(){function e(t,n){s(this,e),void 0===t.events?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=n}return u(e,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var t=e.point.events,n=0,r=t.length;n<r;n++){var i=t[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,t=0;t<e;t++){var n=this.point.events[t];if(void 0===n.segment.consumedBy)for(var r=t+1;r<e;r++){var i=this.point.events[r];void 0===i.consumedBy&&n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],t=0,n=this.point.events.length;t<n;t++){var r=this.point.events[t];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}},{key:"getLeftmostComparator",value:function(e){var t=this,n=new Map,r=function(r){var i,o,a,s,u,l=r.otherSE;n.set(r,{sine:(i=t.point,o=e.point,a=l.point,s={x:o.x-i.x,y:o.y-i.y},u={x:a.x-i.x,y:a.y-i.y},L(u,s)/I(u)/I(s)),cosine:N(t.point,e.point,l.point)})};return function(e,t){n.has(e)||r(e),n.has(t)||r(t);var i=n.get(e),o=i.sine,a=i.cosine,s=n.get(t),u=s.sine,l=s.cosine;return o>=0&&u>=0?a<l?1:a>l?-1:0:o<0&&u<0?a<l?-1:a>l?1:0:u<o?-1:u>o?1:0}}}],[{key:"compare",value:function(t,n){var r=e.comparePoints(t.point,n.point);return 0!==r?r:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:z.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}}]),e}(),U=0,z=function(){function e(t,n,r,i){s(this,e),this.id=++U,this.leftSE=t,t.segment=this,t.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=t,this.rings=r,this.windings=i}return u(e,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var t=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;var i=(e.y-t.y)/r.y,o=t.x+i*r.x;if(e.x===o)return 0;var a=(e.x-t.x)/r.x,s=t.y+a*r.y;return e.y===s?0:e.y<s?-1:1}},{key:"getIntersection",value:function(e){var t=this.bbox(),n=e.bbox(),r=v(t,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,a=e.leftSE.point,s=e.rightSE.point,u=d(t,a)&&0===this.comparePoint(a),l=d(n,i)&&0===e.comparePoint(i),c=d(t,s)&&0===this.comparePoint(s),h=d(n,o)&&0===e.comparePoint(o);if(l&&u)return h&&!c?o:!h&&c?s:null;if(l)return c&&i.x===s.x&&i.y===s.y?null:i;if(u)return h&&o.x===a.x&&o.y===a.y?null:a;if(h&&c)return null;if(h)return o;if(c)return s;var f=function(e,t,n,r){if(0===t.x)return B(n,r,e.x);if(0===r.x)return B(e,t,n.x);if(0===t.y)return D(n,r,e.y);if(0===r.y)return D(e,t,n.y);var i=L(t,r);if(0==i)return null;var o={x:n.x-e.x,y:n.y-e.y},a=L(o,t)/i,s=L(o,r)/i;return{x:(e.x+s*t.x+(n.x+a*r.x))/2,y:(e.y+s*t.y+(n.y+a*r.y))/2}}(i,this.vector(),a,e.vector());return null===f?null:d(r,f)?x.round(f.x,f.y):null}},{key:"split",value:function(t){var n=[],r=void 0!==t.events,i=new F(t,!0),o=new F(t,!1),a=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var s=new e(i,a,this.rings.slice(),this.windings.slice());return F.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),F.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}},{key:"consume",value:function(t){for(var n=this,r=t;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=e.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var a=n;n=r,r=a}for(var s=0,u=r.rings.length;s<u;s++){var l=r.rings[s],c=r.windings[s],h=n.rings.indexOf(l);-1===h?(n.rings.push(l),n.windings.push(c)):n.windings[h]+=c}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var a=this.rings[i],s=this.windings[i],u=t.indexOf(a);-1===u?(t.push(a),n.push(s)):n[u]+=s}for(var l=[],c=[],h=0,f=t.length;h<f;h++)if(0!==n[h]){var p=t[h],d=p.poly;if(-1===c.indexOf(d))if(p.isExterior)l.push(d);else{-1===c.indexOf(d)&&c.push(d);var v=l.indexOf(p.poly);-1!==v&&l.splice(v,1)}}for(var m=0,g=l.length;m<g;m++){var y=l[m].multiPoly;-1===r.indexOf(y)&&r.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(K.type){case"union":var n=0===e.length,r=0===t.length;this._isInResult=n!==r;break;case"intersection":var i,o;e.length<t.length?(i=e.length,o=t.length):(i=t.length,o=e.length),this._isInResult=o===K.numMultiPolys&&i<o;break;case"xor":var a=Math.abs(e.length-t.length);this._isInResult=a%2==1;break;case"difference":var s=function(e){return 1===e.length&&e[0].isSubject};this._isInResult=s(e)!==s(t);break;default:throw new Error("Unrecognized operation type found ".concat(K.type))}return this._isInResult}}],[{key:"compare",value:function(e,t){var n=e.leftSE.point.x,r=t.leftSE.point.x,i=e.rightSE.point.x,o=t.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var a=e.leftSE.point.y,s=t.leftSE.point.y,u=e.rightSE.point.y,l=t.rightSE.point.y;if(n<r){if(s<a&&s<u)return 1;if(s>a&&s>u)return-1;var c=e.comparePoint(t.leftSE.point);if(c<0)return 1;if(c>0)return-1;var h=t.comparePoint(e.rightSE.point);return 0!==h?h:-1}if(n>r){if(a<s&&a<l)return-1;if(a>s&&a>l)return 1;var f=t.comparePoint(e.leftSE.point);if(0!==f)return f;var p=e.comparePoint(t.rightSE.point);return p<0?1:p>0?-1:1}if(a<s)return-1;if(a>s)return 1;if(i<o){var d=t.comparePoint(e.rightSE.point);if(0!==d)return d}if(i>o){var v=e.comparePoint(t.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(i!==o){var m=u-a,g=i-n,y=l-s,_=o-r;if(m>g&&y<_)return 1;if(m<g&&y>_)return-1}return i>o?1:i<o||u<l?-1:u>l?1:e.id<t.id?-1:e.id>t.id?1:0}},{key:"fromRing",value:function(t,n,r){var i,o,a,s=F.comparePoints(t,n);if(s<0)i=t,o=n,a=1;else{if(!(s>0))throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));i=n,o=t,a=-1}return new e(new F(i,!0),new F(o,!1),[r],[a])}}]),e}(),G=function(){function e(t,n,r){if(s(this,e),!Array.isArray(t)||0===t.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],"number"!=typeof t[0][0]||"number"!=typeof t[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=x.round(t[0][0],t[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,a=1,u=t.length;a<u;a++){if("number"!=typeof t[a][0]||"number"!=typeof t[a][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=x.round(t[a][0],t[a][1]);l.x===o.x&&l.y===o.y||(this.segments.push(z.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}i.x===o.x&&i.y===o.y||this.segments.push(z.fromRing(o,i,this))}return u(e,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.segments.length;t<n;t++){var r=this.segments[t];e.push(r.leftSE),e.push(r.rightSE)}return e}}]),e}(),j=function(){function e(t,n){if(s(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new G(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=t.length;r<i;r++){var o=new G(t[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=n}return u(e,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),t=0,n=this.interiorRings.length;t<n;t++)for(var r=this.interiorRings[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),e}(),V=function(){function e(t,n){if(s(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof t[0][0][0]&&(t=[t])}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=t.length;r<i;r++){var o=new j(t[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=n}return u(e,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++)for(var r=this.polys[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),e}(),H=function(){function e(t){s(this,e),this.events=t;for(var n=0,r=t.length;n<r;n++)t[n].segment.ringOut=this;this.poly=null}return u(e,[{key:"getGeom",value:function(){for(var e=this.events[0].point,t=[e],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==P(i,e,o)&&(t.push(i),e=i)}if(1===t.length)return null;var a=t[0],s=t[1];0===P(a,e,s)&&t.shift(),t.push(t[0]);for(var u=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:t.length-1,c=this.isExteriorRing()?t.length:-1,h=[],f=l;f!=c;f+=u)h.push([t[f].x,t[f].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],t=1,n=this.events.length;t<n;t++){var r=this.events[t];F.compare(e,r)>0&&(e=r)}for(var i=e.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}],[{key:"factory",value:function(t){for(var n=[],r=0,i=t.length;r<i;r++){var o=t[r];if(o.isInResult()&&!o.ringOut){for(var a=null,s=o.leftSE,u=o.rightSE,l=[s],c=s.point,h=[];a=s,s=u,l.push(s),s.point!==c;)for(;;){var f=s.getAvailableLinkedEvents();if(0===f.length){var p=l[0].point,d=l[l.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===f.length){u=f[0].otherSE;break}for(var v=null,m=0,g=h.length;m<g;m++)if(h[m].point===s.point){v=m;break}if(null===v){h.push({index:l.length,point:s.point});var y=s.getLeftmostComparator(a);u=f.sort(y)[0].otherSE;break}var _=h.splice(v)[0],b=l.splice(_.index);b.unshift(b[0].otherSE),n.push(new e(b.reverse()))}n.push(new e(l))}}return n}}]),e}(),W=function(){function e(t){s(this,e),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return u(e,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(var t=0,n=this.interiorRings.length;t<n;t++){var r=this.interiorRings[t].getGeom();null!==r&&e.push(r)}return e}}]),e}(),Z=function(){function e(t){s(this,e),this.rings=t,this.polys=this._composePolys(t)}return u(e,[{key:"getGeom",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++){var r=this.polys[t].getGeom();null!==r&&e.push(r)}return e}},{key:"_composePolys",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];if(!i.poly)if(i.isExteriorRing())t.push(new W(i));else{var o=i.enclosingRing();o.poly||t.push(new W(o)),o.poly.addInterior(i)}}return t}}]),e}(),X=function(){function e(t){s(this,e);var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.compare;this.queue=t,this.tree=new c(n),this.segments=[]}return u(e,[{key:"process",value:function(e){var t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;var r=e.isLeft?this.tree.add(t):this.tree.find(t);if(!r)throw new Error("Unable to find segment #".concat(t.id," ")+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> ")+"[".concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"in SweepLine tree.");for(var i=r,o=r,a=void 0,s=void 0;void 0===a;)null===(i=this.tree.prev(i))?a=null:void 0===i.key.consumedBy&&(a=i.key);for(;void 0===s;)null===(o=this.tree.next(o))?s=null:void 0===o.key.consumedBy&&(s=o.key);if(e.isLeft){var u=null;if(a){var l=a.getIntersection(t);if(null!==l&&(t.isAnEndpoint(l)||(u=l),!a.isAnEndpoint(l)))for(var c=this._splitSafely(a,l),h=0,f=c.length;h<f;h++)n.push(c[h])}var p=null;if(s){var d=s.getIntersection(t);if(null!==d&&(t.isAnEndpoint(d)||(p=d),!s.isAnEndpoint(d)))for(var v=this._splitSafely(s,d),m=0,g=v.length;m<g;m++)n.push(v[m])}if(null!==u||null!==p){var y=null;y=null===u?p:null===p||F.comparePoints(u,p)<=0?u:p,this.queue.remove(t.rightSE),n.push(t.rightSE);for(var _=t.split(y),b=0,x=_.length;b<x;b++)n.push(_[b])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&s){var E=a.getIntersection(s);if(null!==E){if(!a.isAnEndpoint(E))for(var S=this._splitSafely(a,E),A=0,T=S.length;A<T;A++)n.push(S[A]);if(!s.isAnEndpoint(E))for(var C=this._splitSafely(s,E),w=0,R=C.length;w<R;w++)n.push(C[w])}}this.tree.remove(t)}return n}},{key:"_splitSafely",value:function(e,t){this.tree.remove(e);var n=e.rightSE;this.queue.remove(n);var r=e.split(t);return r.push(n),void 0===e.consumedBy&&this.tree.add(e),r}}]),e}(),Y=void 0!==a&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,q=void 0!==a&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,K=new(function(){function e(){s(this,e)}return u(e,[{key:"run",value:function(e,t,n){K.type=e,x.reset();for(var r=[new V(t,!0)],i=0,o=n.length;i<o;i++)r.push(new V(n[i],!1));if(K.numMultiPolys=r.length,"difference"===K.type)for(var a=r[0],s=1;s<r.length;)null!==v(r[s].bbox,a.bbox)?s++:r.splice(s,1);if("intersection"===K.type)for(var u=0,l=r.length;u<l;u++)for(var h=r[u],f=u+1,p=r.length;f<p;f++)if(null===v(h.bbox,r[f].bbox))return[];for(var d=new c(F.compare),m=0,g=r.length;m<g;m++)for(var y=r[m].getSweepEvents(),_=0,b=y.length;_<b;_++)if(d.insert(y[_]),d.size>Y)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).");for(var E=new X(d),S=d.size,A=d.pop();A;){var T=A.key;if(d.size===S){var C=T.segment;throw new Error("Unable to pop() ".concat(T.isLeft?"left":"right"," SweepEvent ")+"[".concat(T.point.x,", ").concat(T.point.y,"] from segment #").concat(C.id," ")+"[".concat(C.leftSE.point.x,", ").concat(C.leftSE.point.y,"] -> ")+"[".concat(C.rightSE.point.x,", ").concat(C.rightSE.point.y,"] from queue."))}if(d.size>Y)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(E.segments.length>q)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");for(var w=E.process(T),R=0,M=w.length;R<M;R++){var k=w[R];void 0===k.consumedBy&&d.insert(k)}S=d.size,A=d.pop()}x.reset();var L=H.factory(E.segments);return new Z(L).getGeom()}}]),e}()),Q={union:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return K.run("union",e,n)},intersection:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return K.run("intersection",e,n)},xor:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return K.run("xor",e,n)},difference:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return K.run("difference",e,n)}};return Q},"object"===l(t)?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},4828:function(e){var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var s,u=[],l=!1,c=-1;function h(){l&&s&&(l=!1,s.length?u=s.concat(u):c=-1,u.length&&f())}function f(){if(!l){var e=a(h);l=!0;for(var t=u.length;t;){for(s=u,u=[];++c<t;)s&&s[c].run();c=-1,t=u.length}s=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function d(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||l||a(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=d,r.addListener=d,r.once=d,r.off=d,r.removeListener=d,r.removeAllListeners=d,r.emit=d,r.prependListener=d,r.prependOnceListener=d,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},5171:function(e,t,n){var r,i,o,a=n(5570).default;o=function(){"use strict";var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},n="\n";function r(e){var t=new Error("(regl) "+e);throw console.error(t),t}function i(e,t){e||r(t)}function o(e){return e?": "+e:""}function s(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"===a(e);case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"===a(e)}}function u(e,t,n){t.indexOf(e)<0&&r("invalid value"+o(n)+". must be one of: "+t)}var l=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function c(e,t){for(e+="";e.length<t;)e=" "+e;return e}function h(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function f(e,t){this.number=e,this.line=t,this.errors=[]}function p(e,t,n){this.file=e,this.line=t,this.message=n}function d(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function v(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function m(e,t){var n,r=e.split("\n"),i=1,o=0,a={unknown:new h,0:new h};a.unknown.name=a[0].name=t||d(),a.unknown.lines.push(new f(0,""));for(var s=0;s<r.length;++s){var u=r[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(l[2]);c&&(i=0|c[1],c[2]&&((o=0|c[2])in a||(a[o]=new h)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);p&&(a[o].name=p[1]?(n=p[2],"undefined"!=typeof atob?atob(n):"base64:"+n):p[2])}a[o].lines.push(new f(i++,u))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function g(e){e._commandRef=d()}function y(e,t){var n=v();r(e+" in command "+(t||d())+("unknown"===n?"":" called from "+n))}function _(e,t,n,r){s(e,t)||y("invalid parameter type"+o(n)+". expected "+t+", got "+a(e),r||d())}var b=33071,x={};function E(e,t){return 32820===e||32819===e||33635===e?2:34042===e?4:x[e]*t}function S(e){return!(e&e-1||!e)}x[5120]=x[5121]=1,x[5122]=x[5123]=x[36193]=x[33635]=x[32819]=x[32820]=2,x[5124]=x[5125]=x[5126]=x[34042]=4;var A=t(i,{optional:function(e){e()},raise:r,commandRaise:y,command:function(e,t,n){e||y(t,n||d())},parameter:function(e,t,n){e in t||r("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||y("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join(),r||d())},constructor:function(e){Object.keys(e).forEach((function(e){l.indexOf(e)<0&&r('invalid regl constructor argument "'+e+'". must be one of '+l)}))},type:function(e,t,n){s(e,t)||r("invalid parameter type"+o(n)+". expected "+t+", got "+a(e))},commandType:_,isTypedArray:function(t,n){e(t)||r("invalid parameter type"+o(n)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||r("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")},oneOf:u,shaderError:function(e,t,r,o,a){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(t),u=o===e.FRAGMENT_SHADER?"fragment":"vertex";_(r,"string",u+" shader source must be a string",a);var l=m(r,a),h=function(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new p(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new p("unknown",0,e))}})),t}(s);!function(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}(l,h),Object.keys(l).forEach((function(e){var t=l[e];if(t.hasErrors){var r=[""],i=[""];o("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){o(c(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(e.line+n,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(r){var i=r.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];i=a[2],"assign"===s&&(s="="),t=Math.max(e.line.indexOf(s,t),0)}else t=0;o(c("| ",6)),o(c("^^^",t+3)+n,"font-weight:bold"),o(c("| ",6)),o(i+n,"font-weight:bold")})),o(c("| ",6)+n)}else o(c(e.number,4)+"|  "),o(e.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function o(e,t){r.push(e),i.push(t||"")}})),i.raise("Error compiling "+u+" shader, "+l[0].name)}},linkError:function(e,t,r,o,a){if(!e.getProgramParameter(t,e.LINK_STATUS)){var s=e.getProgramInfoLog(t),u=m(r,a),l='Error linking program with vertex shader, "'+m(o,a)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+l+"\n%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(l+n+s),i.raise(l)}},callSite:v,saveCommandRef:g,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}g(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?u(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):u(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:d,texture2D:function(e,t,n){var r,o=t.width,a=t.height,s=t.channels;i(o>0&&o<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),e.wrapS===b&&e.wrapT===b||i(S(o)&&S(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==o&&1!==a&&i(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(i(S(o)&&S(a),"texture must be a square power of 2 to support mipmapping"),i(t.mipmask===(o<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&i(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),i(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var l=o>>r,c=a>>r;i(t.mipmask&1<<r,"missing mipmap data");var h=u[r];if(i(h.width===l&&h.height===c,"invalid shape for mip images"),i(h.format===t.format&&h.internalformat===t.internalformat&&h.type===t.type,"incompatible type for mip image"),h.compressed);else if(h.data){var f=Math.ceil(E(h.type,s)*l/h.unpackAlignment)*h.unpackAlignment;i(h.data.byteLength===f*c,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else e.genMipmaps||i(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&i(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,r){var o=e.width,a=e.height,s=e.channels;i(o>0&&o<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),i(o===a,"cube map must be square"),i(t.wrapS===b&&t.wrapT===b,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];i(l.width===o&&l.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(i(!l.compressed,"can not generate mipmap for compressed textures"),i(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,h=0;h<16;++h){var f=c[h];if(f){var p=o>>h,d=a>>h;i(l.mipmask&1<<h,"missing mipmap data"),i(f.width===p&&f.height===d,"invalid shape for mip images"),i(f.format===e.format&&f.internalformat===e.internalformat&&f.type===e.type,"incompatible type for mip image"),f.compressed||(f.data?i(f.data.byteLength===p*d*Math.max(E(f.type,s),f.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):f.element||f.copy)}}}}}),T=0;function C(e,t){this.id=T++,this.type=e,this.data=t}function w(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function R(e){if(0===e.length)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&('"'===t||"'"===t))return['"'+w(e.substr(1,e.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return R(e.substr(0,r.index)).concat(R(r[1])).concat(R(e.substr(r.index+r[0].length)));var i=e.split(".");if(1===i.length)return['"'+w(e)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(R(i[a]));return o}function M(e){return"["+R(e).join("][")+"]"}var k={DynamicVariable:C,define:function(e,t){return new C(e,M(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof C},unbox:function(e,t){return"function"==typeof e?new C(0,e):e},accessor:M},L={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},O="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function P(e){return"string"==typeof e?e.split():(A(Array.isArray(e),"invalid extension array"),e)}function I(e){return"string"==typeof e?(A("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function N(e){var n,r,i,o,s,u=e||{},l={},c=[],h=[],f="undefined"==typeof window?1:window.devicePixelRatio,p=!1,d=function(e){e&&A.raise(e)},v=function(){};if("string"==typeof u?(A("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(u),A(n,"invalid query string for element")):"object"===a(u)?"string"==typeof(s=u).nodeName&&"function"==typeof s.appendChild&&"function"==typeof s.getBoundingClientRect?n=u:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(u)?i=(o=u).canvas:(A.constructor(u),"gl"in u?o=u.gl:"canvas"in u?i=I(u.canvas):"container"in u&&(r=I(u.container)),"attributes"in u&&(l=u.attributes,A.type(l,"object","invalid context attributes")),"extensions"in u&&(c=P(u.extensions)),"optionalExtensions"in u&&(h=P(u.optionalExtensions)),"onDone"in u&&(A.type(u.onDone,"function","invalid or missing onDone callback"),d=u.onDone),"profile"in u&&(p=!!u.profile),"pixelRatio"in u&&(f=+u.pixelRatio,A(f>0,"invalid pixel ratio"))):A.raise("invalid arguments to regl"),n&&("canvas"===n.nodeName.toLowerCase()?i=n:r=n),!o){if(!i){A("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var m=function(e,n,r){var i,o=document.createElement("canvas");function a(){var n=window.innerWidth,i=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();n=a.right-a.left,i=a.bottom-a.top}o.width=r*n,o.height=r*i,t(o.style,{width:n+"px",height:i+"px"})}return t(o.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(o),e===document.body&&(o.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}}}(r||document.body,0,f);if(!m)return null;i=m.canvas,v=m.onDestroy}void 0===l.premultipliedAlpha&&(l.premultipliedAlpha=!0),o=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,l)}return o?{gl:o,canvas:i,container:r,extensions:c,optionalExtensions:h,pixelRatio:f,profile:p,onDone:d,onDestroy:v}:(v(),d("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function D(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function B(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function F(){var e=D(8,(function(){return[]}));function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[B(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[B(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case 5120:r=new Int8Array(t(n),0,n);break;case 5121:r=new Uint8Array(t(n),0,n);break;case 5122:r=new Int16Array(t(2*n),0,n);break;case 5123:r=new Uint16Array(t(2*n),0,n);break;case 5124:r=new Int32Array(t(4*n),0,n);break;case 5125:r=new Uint32Array(t(4*n),0,n);break;case 5126:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var U=F();U.zero=F();var z=3553,G=6408,j=5126,V=36160;function H(t){return!!t&&"object"===a(t)&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var W=function(e){return Object.keys(e).map((function(t){return e[t]}))},Z={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||U.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],a);break;case 2:!function(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}(e,t[0],t[1],a);break;case 3:X(e,t[0],t[1],t[2],a,0);break;default:Y(e,t,0,a,0)}return a}};function X(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var u=e[s],l=0;l<n;++l)for(var c=u[l],h=0;h<r;++h)i[a++]=c[h]}function Y(e,t,n,r,i){for(var o=1,a=n+1;a<t.length;++a)o*=t[a];var s=t[n];if(t.length-n==4){var u=t[n+1],l=t[n+2],c=t[n+3];for(a=0;a<s;++a)X(e[a],u,l,c,r,i),i+=o}else for(a=0;a<s;++a)Y(e[a],t,n+1,r,i),i+=o}var q={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},K={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Q={dynamic:35048,stream:35040,static:35044},$=Z.flatten,J=Z.shape,ee=5121,te=5126,ne=[];function re(e){return 0|q[Object.prototype.toString.call(e)]}function ie(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function oe(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)e[s++]=t[i*u+o*l+a]}ne[5120]=1,ne[5122]=2,ne[5124]=4,ne[5121]=1,ne[5123]=2,ne[5125]=4,ne[5126]=4;var ae={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},se=5121,ue=5123,le=5125,ce=34963,he=new Float32Array(1),fe=new Uint32Array(he.buffer);function pe(e){for(var t=U.allocType(5123,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{he[0]=e[n];var r=fe[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var s=-14-o;t[n]=i+(a+1024>>s)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function de(t){return Array.isArray(t)||e(t)}var ve=function(e){return!(e&e-1||!e)},me=3553,ge=34069,ye=6408,_e=6406,be=6407,xe=6409,Ee=6410,Se=32855,Ae=6402,Te=34041,Ce=35904,we=35906,Re=36193,Me=33776,ke=33777,Le=33778,Oe=33779,Pe=5121,Ie=5123,Ne=5125,De=5126,Be=33071,Fe=9728,Ue=9984,ze=9987,Ge=4352,je=33984,Ve=[Ue,9986,9985,ze],He=[0,xe,Ee,be,ye],We={};function Ze(e){return"[object "+e+"]"}We[6409]=We[6406]=We[6402]=1,We[34041]=We[6410]=2,We[6407]=We[35904]=3,We[6408]=We[35906]=4;var Xe=Ze("HTMLCanvasElement"),Ye=Ze("OffscreenCanvas"),qe=Ze("CanvasRenderingContext2D"),Ke=Ze("ImageBitmap"),Qe=Ze("HTMLImageElement"),$e=Ze("HTMLVideoElement"),Je=Object.keys(q).concat([Xe,Ye,qe,Ke,Qe,$e]),et=[];et[5121]=1,et[5126]=4,et[36193]=2,et[5123]=2,et[5125]=4;var tt=[];function nt(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function rt(e){return!!Array.isArray(e)&&!(0===e.length||!de(e[0]))}function it(e){return Object.prototype.toString.call(e)}function ot(e){return it(e)===Xe}function at(e){return it(e)===Ye}function st(e){if(!e)return!1;var t=it(e);return Je.indexOf(t)>=0||nt(e)||rt(e)||H(e)}function ut(e){return 0|q[Object.prototype.toString.call(e)]}function lt(e,t){return U.allocType(e.type===Re?De:e.type,t)}function ct(e,t){e.type===Re?(e.data=pe(t),U.freeType(t)):e.data=t}function ht(e,t,n,r,i,o){var a;if(a=void 0!==tt[e]?tt[e]:We[e]*et[t],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function ft(n,r,i,o,s,u,l){var c={"don't care":Ge,"dont care":Ge,nice:4354,fast:4353},h={repeat:10497,clamp:Be,mirror:33648},f={nearest:Fe,linear:9729},p=t({mipmap:ze,"nearest mipmap nearest":Ue,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":ze},f),d={none:0,browser:37444},v={uint8:Pe,rgba4:32819,rgb565:33635,"rgb5 a1":32820},m={alpha:_e,luminance:xe,"luminance alpha":Ee,rgb:be,rgba:ye,rgba4:32854,"rgb5 a1":Se,rgb565:36194},g={};r.ext_srgb&&(m.srgb=Ce,m.srgba=we),r.oes_texture_float&&(v.float32=v.float=De),r.oes_texture_half_float&&(v.float16=v["half float"]=Re),r.webgl_depth_texture&&(t(m,{depth:Ae,"depth stencil":Te}),t(v,{uint16:Ie,uint32:Ne,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&t(g,{"rgb s3tc dxt1":Me,"rgba s3tc dxt1":ke,"rgba s3tc dxt3":Le,"rgba s3tc dxt5":Oe}),r.webgl_compressed_texture_atc&&t(g,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&t(g,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(g["rgb etc1"]=36196);var y=Array.prototype.slice.call(n.getParameter(34467));Object.keys(g).forEach((function(e){var t=g[e];y.indexOf(t)>=0&&(m[e]=t)}));var _=Object.keys(m);i.textureFormats=_;var b=[];Object.keys(m).forEach((function(e){var t=m[e];b[t]=e}));var x=[];Object.keys(v).forEach((function(e){var t=v[e];x[t]=e}));var E=[];Object.keys(f).forEach((function(e){E[f[e]]=e}));var S=[];Object.keys(p).forEach((function(e){var t=p[e];S[t]=e}));var T=[];Object.keys(h).forEach((function(e){T[h[e]]=e}));var C=_.reduce((function(e,t){var n=m[t];return n===xe||n===_e||n===xe||n===Ee||n===Ae||n===Te||r.ext_srgb&&(n===Ce||n===we)?e[n]=n:n===Se||t.indexOf("rgba")>=0?e[n]=ye:e[n]=be,e}),{});function w(){this.internalformat=ye,this.format=ye,this.type=Pe,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function R(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function M(e,t){if("object"===a(t)&&t){if("premultiplyAlpha"in t&&(A.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(A.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(A.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(A.parameter(t.colorSpace,d,"invalid colorSpace"),e.colorSpace=d[t.colorSpace]),"type"in t){var n=t.type;A(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),A(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),A(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),A.parameter(n,v,"invalid texture type"),e.type=v[n]}var o=e.width,s=e.height,u=e.channels,l=!1;"shape"in t?(A(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],s=t.shape[1],3===t.shape.length&&(u=t.shape[2],A(u>0&&u<=4,"invalid number of channels"),l=!0),A(o>=0&&o<=i.maxTextureSize,"invalid width"),A(s>=0&&s<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=s=t.radius,A(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,A(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(s=t.height,A(s>=0&&s<=i.maxTextureSize,"invalid height")),"channels"in t&&(u=t.channels,A(u>0&&u<=4,"invalid number of channels"),l=!0)),e.width=0|o,e.height=0|s,e.channels=0|u;var c=!1;if("format"in t){var h=t.format;A(r.webgl_depth_texture||!("depth"===h||"depth stencil"===h),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),A.parameter(h,m,"invalid texture format");var f=e.internalformat=m[h];e.format=C[f],h in v&&("type"in t||(e.type=v[h])),h in g&&(e.compressed=!0),c=!0}!l&&c?e.channels=We[e.format]:l&&!c?e.channels!==He[e.format]&&(e.format=e.internalformat=He[e.channels]):c&&l&&A(e.channels===We[e.format],"number of channels inconsistent with specified format")}}function k(e){n.pixelStorei(37440,e.flipY),n.pixelStorei(37441,e.premultiplyAlpha),n.pixelStorei(37443,e.colorSpace),n.pixelStorei(3317,e.unpackAlignment)}function L(){w.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function O(t,n){var r=null;if(st(n)?r=n:n&&(A.type(n,"object","invalid pixel data type"),M(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),st(n.data)&&(r=n.data)),A(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){A(!r,"can not specify copy and data field for the same texture");var o=s.viewportWidth,a=s.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||a-t.yOffset,t.needsCopy=!0,A(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<a&&t.width>0&&t.width<=o&&t.height>0&&t.height<=a,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==Pe||(t.type=ut(r));else if(nt(r))t.channels=t.channels||4,function(e,t){var n=t.length;switch(e.type){case Pe:case Ie:case Ne:case De:var r=U.allocType(e.type,n);r.set(t),e.data=r;break;case Re:e.data=pe(t);break;default:A.raise("unsupported texture type, must specify a typed array")}}(t,r),t.alignment=1,t.needsFree=!0;else if(H(r)){var u=r.data;Array.isArray(u)||t.type!==Pe||(t.type=ut(u));var l,c,h,f,p,d,v=r.shape,m=r.stride;3===v.length?(h=v[2],d=m[2]):(A(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,d=1),l=v[0],c=v[1],f=m[0],p=m[1],t.alignment=1,t.width=l,t.height=c,t.channels=h,t.format=t.internalformat=He[h],t.needsFree=!0,function(e,t,n,r,i,o){for(var a=e.width,s=e.height,u=e.channels,l=lt(e,a*s*u),c=0,h=0;h<s;++h)for(var f=0;f<a;++f)for(var p=0;p<u;++p)l[c++]=t[n*f+r*h+i*p+o];ct(e,l)}(t,u,f,p,d,r.offset)}else if(ot(r)||at(r)||it(r)===qe)ot(r)||at(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return it(e)===Ke}(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(e){return it(e)===Qe}(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(function(e){return it(e)===$e}(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(rt(r)){var g=t.width||r[0].length,y=t.height||r.length,_=t.channels;_=de(r[0][0])?_||r[0][0].length:_||1;for(var b=Z.shape(r),x=1,E=0;E<b.length;++E)x*=b[E];var S=lt(t,x);Z.flatten(r,b,"",S),ct(t,S),t.alignment=1,t.width=g,t.height=y,t.channels=_,t.format=t.internalformat=He[_],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===De?A(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===Re&&A(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function P(e,t,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,l=e.type,c=e.width,h=e.height;k(e),i?n.texImage2D(t,r,u,u,l,i):e.compressed?n.compressedTexImage2D(t,r,s,c,h,0,a):e.needsCopy?(o(),n.copyTexImage2D(t,r,u,e.xOffset,e.yOffset,c,h,0)):n.texImage2D(t,r,u,c,h,0,u,l,a||null)}function I(e,t,r,i,a){var s=e.element,u=e.data,l=e.internalformat,c=e.format,h=e.type,f=e.width,p=e.height;k(e),s?n.texSubImage2D(t,a,r,i,c,h,s):e.compressed?n.compressedTexSubImage2D(t,a,r,i,l,f,p,u):e.needsCopy?(o(),n.copyTexSubImage2D(t,a,r,i,e.xOffset,e.yOffset,f,p)):n.texSubImage2D(t,a,r,i,f,p,c,h,u)}var N=[];function D(){return N.pop()||new L}function B(e){e.needsFree&&U.freeType(e.data),L.call(e),N.push(e)}function F(){w.call(this),this.genMipmaps=!1,this.mipmapHint=Ge,this.mipmask=0,this.images=Array(16)}function z(e,t,n){var r=e.images[0]=D();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function G(e,t){var n=null;if(st(t))R(n=e.images[0]=D(),e),O(n,t),e.mipmask=1;else if(M(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)R(n=e.images[i]=D(),e),n.width>>=i,n.height>>=i,O(n,r[i]),e.mipmask|=1<<i;else R(n=e.images[0]=D(),e),O(n,t),e.mipmask=1;R(e,e.images[0]),!e.compressed||e.internalformat!==Me&&e.internalformat!==ke&&e.internalformat!==Le&&e.internalformat!==Oe||A(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function j(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;P(n[r],t,r)}}var V=[];function X(){var e=V.pop()||new F;w.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function Y(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&B(t[n]),t[n]=null;V.push(e)}function q(){this.minFilter=Fe,this.magFilter=Fe,this.wrapS=Be,this.wrapT=Be,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ge}function K(e,t){if("min"in t){var n=t.min;A.parameter(n,p),e.minFilter=p[n],Ve.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;A.parameter(r,f),e.magFilter=f[r]}var o=e.wrapS,s=e.wrapT;if("wrap"in t){var u=t.wrap;"string"==typeof u?(A.parameter(u,h),o=s=h[u]):Array.isArray(u)&&(A.parameter(u[0],h),A.parameter(u[1],h),o=h[u[0]],s=h[u[1]])}else{if("wrapS"in t){var l=t.wrapS;A.parameter(l,h),o=h[l]}if("wrapT"in t){var d=t.wrapT;A.parameter(d,h),s=h[d]}}if(e.wrapS=o,e.wrapT=s,"anisotropic"in t){var v=t.anisotropic;A("number"==typeof v&&v>=1&&v<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var m=!1;switch(a(t.mipmap)){case"string":A.parameter(t.mipmap,c,"invalid mipmap hint"),e.mipmapHint=c[t.mipmap],e.genMipmaps=!0,m=!0;break;case"boolean":m=e.genMipmaps=t.mipmap;break;case"object":A(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,m=!0;break;default:A.raise("invalid mipmap type")}m&&!("min"in t)&&(e.minFilter=Ue)}}function Q(e,t){n.texParameteri(t,10241,e.minFilter),n.texParameteri(t,10240,e.magFilter),n.texParameteri(t,10242,e.wrapS),n.texParameteri(t,10243,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,34046,e.anisotropic),e.genMipmaps&&(n.hint(33170,e.mipmapHint),n.generateMipmap(t))}var $=0,J={},ee=i.maxTextureUnits,te=Array(ee).map((function(){return null}));function ne(e){w.call(this),this.mipmask=0,this.internalformat=ye,this.id=$++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new q,l.profile&&(this.stats={size:0})}function re(e){n.activeTexture(je),n.bindTexture(e.target,e.texture)}function ie(){var e=te[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(me,null)}function oe(e){var t=e.texture;A(t,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(n.activeTexture(je+r),n.bindTexture(i,null),te[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete J[e.id],u.textureCount--}return t(ne.prototype,{bind:function(){var e=this;e.bindCount+=1;var t=e.unit;if(t<0){for(var r=0;r<ee;++r){var i=te[r];if(i){if(i.bindCount>0)continue;i.unit=-1}te[r]=e,t=r;break}t>=ee&&A.raise("insufficient number of texture units"),l.profile&&u.maxTextureUnits<t+1&&(u.maxTextureUnits=t+1),e.unit=t,n.activeTexture(je+t),n.bindTexture(e.target,e.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&oe(this)}}),l.profile&&(u.getTotalTextureSize=function(){var e=0;return Object.keys(J).forEach((function(t){e+=J[t].stats.size})),e}),{create2D:function(e,t){var r=new ne(me);function o(e,t){var n=r.texInfo;q.call(n);var a=X();return"number"==typeof e?z(a,0|e,"number"==typeof t?0|t:0|e):e?(A.type(e,"object","invalid arguments to regl.texture"),K(n,e),G(a,e)):z(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,R(r,a),A.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,re(r),j(a,me),Q(n,me),ie(),Y(a),l.profile&&(r.stats.size=ht(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=b[r.internalformat],o.type=x[r.type],o.mag=E[n.magFilter],o.min=S[n.minFilter],o.wrapS=T[n.wrapS],o.wrapT=T[n.wrapT],o}return J[r.id]=r,u.textureCount++,o(e,t),o.subimage=function(e,t,n,i){A(!!e,"must specify image data");var a=0|t,s=0|n,u=0|i,l=D();return R(l,r),l.width=0,l.height=0,O(l,e),l.width=l.width||(r.width>>u)-a,l.height=l.height||(r.height>>u)-s,A(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),A(a>=0&&s>=0&&a+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),A(r.mipmask&1<<u,"missing mipmap data"),A(l.data||l.element||l.needsCopy,"missing image data"),re(r),I(l,me,a,s,u),ie(),B(l),o},o.resize=function(e,t){var i=0|e,a=0|t||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,re(r);for(var s=0;r.mipmask>>s;++s){var u=i>>s,c=a>>s;if(!u||!c)break;n.texImage2D(me,s,r.format,u,c,0,r.format,r.type,null)}return ie(),l.profile&&(r.stats.size=ht(r.internalformat,r.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=r,l.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(e,t,r,o,s,c){var h=new ne(34067);J[h.id]=h,u.cubeCount++;var f=new Array(6);function p(e,t,n,r,o,s){var u,c=h.texInfo;for(q.call(c),u=0;u<6;++u)f[u]=X();if("number"!=typeof e&&e)if("object"===a(e))if(t)G(f[0],e),G(f[1],t),G(f[2],n),G(f[3],r),G(f[4],o),G(f[5],s);else if(K(c,e),M(h,e),"faces"in e){var d=e.faces;for(A(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),u=0;u<6;++u)A("object"===a(d[u])&&!!d[u],"invalid input for cube map face"),R(f[u],h),G(f[u],d[u])}else for(u=0;u<6;++u)G(f[u],e);else A.raise("invalid arguments to cube map");else{var v=0|e||1;for(u=0;u<6;++u)z(f[u],v,v)}for(R(h,f[0]),i.npotTextureCube||A(ve(h.width)&&ve(h.height),"your browser does not support non power or two texture dimensions"),c.genMipmaps?h.mipmask=(f[0].width<<1)-1:h.mipmask=f[0].mipmask,A.textureCube(h,c,f,i),h.internalformat=f[0].internalformat,p.width=f[0].width,p.height=f[0].height,re(h),u=0;u<6;++u)j(f[u],ge+u);for(Q(c,34067),ie(),l.profile&&(h.stats.size=ht(h.internalformat,h.type,p.width,p.height,c.genMipmaps,!0)),p.format=b[h.internalformat],p.type=x[h.type],p.mag=E[c.magFilter],p.min=S[c.minFilter],p.wrapS=T[c.wrapS],p.wrapT=T[c.wrapT],u=0;u<6;++u)Y(f[u]);return p}return p(e,t,r,o,s,c),p.subimage=function(e,t,n,r,i){A(!!t,"must specify image data"),A("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=D();return R(u,h),u.width=0,u.height=0,O(u,t),u.width=u.width||(h.width>>s)-o,u.height=u.height||(h.height>>s)-a,A(h.type===u.type&&h.format===u.format&&h.internalformat===u.internalformat,"incompatible format for texture.subimage"),A(o>=0&&a>=0&&o+u.width<=h.width&&a+u.height<=h.height,"texture.subimage write out of bounds"),A(h.mipmask&1<<s,"missing mipmap data"),A(u.data||u.element||u.needsCopy,"missing image data"),re(h),I(u,ge+e,o,a,s),ie(),B(u),p},p.resize=function(e){var t=0|e;if(t!==h.width){p.width=h.width=t,p.height=h.height=t,re(h);for(var r=0;r<6;++r)for(var i=0;h.mipmask>>i;++i)n.texImage2D(ge+r,i,h.format,t>>i,t>>i,0,h.format,h.type,null);return ie(),l.profile&&(h.stats.size=ht(h.internalformat,h.type,p.width,p.height,!1,!0)),p}},p._reglType="textureCube",p._texture=h,l.profile&&(p.stats=h.stats),p.destroy=function(){h.decRef()},p},clear:function(){for(var e=0;e<ee;++e)n.activeTexture(je+e),n.bindTexture(me,null),te[e]=null;W(J).forEach(oe),u.cubeCount=0,u.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<ee;++e){var t=te[e];t&&(t.bindCount=0,t.unit=-1,te[e]=null)}W(J).forEach((function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===me)n.texImage2D(me,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(ge+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);Q(e.texInfo,e.target)}))}}}tt[32854]=2,tt[32855]=2,tt[36194]=2,tt[34041]=4,tt[33776]=.5,tt[33777]=.5,tt[33778]=1,tt[33779]=1,tt[35986]=.5,tt[35987]=1,tt[34798]=1,tt[35840]=.5,tt[35841]=.25,tt[35842]=.5,tt[35843]=.25,tt[36196]=.5;var pt=36161,dt=32854,vt=[];function mt(e,t,n){return vt[e]*t*n}vt[32854]=2,vt[32855]=2,vt[36194]=2,vt[33189]=2,vt[36168]=1,vt[34041]=4,vt[35907]=4,vt[34836]=16,vt[34842]=8,vt[34843]=6;var gt=36160,yt=36161,_t=3553,bt=34069,xt=[6407,6408],Et=[];Et[6408]=4,Et[6407]=3;var St=[];St[5121]=1,St[5126]=4,St[36193]=2;var At=[32854,32855,36194,35907,34842,34843,34836],Tt={};function Ct(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}Tt[36053]="complete",Tt[36054]="incomplete attachment",Tt[36057]="incomplete dimensions",Tt[36055]="incomplete, missing attachment",Tt[36061]="unsupported";var wt=5121,Rt=5126;function Mt(t,n,r,i,o,a,s){function u(u){var l;null===n.next?(A(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=wt):(A(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(A(l===wt||l===Rt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),l===Rt&&A(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):A(l===wt,"Reading from a framebuffer is only allowed for the type 'uint8'"));var c=0,h=0,f=i.framebufferWidth,p=i.framebufferHeight,d=null;e(u)?d=u:u&&(A.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,h=0|u.y,A(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),A(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),f=0|(u.width||i.framebufferWidth-c),p=0|(u.height||i.framebufferHeight-h),d=u.data||null),d&&(l===wt?A(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):l===Rt&&A(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),A(f>0&&f+c<=i.framebufferWidth,"invalid width for read pixels"),A(p>0&&p+h<=i.framebufferHeight,"invalid height for read pixels"),r();var v=f*p*4;return d||(l===wt?d=new Uint8Array(v):l===Rt&&(d=d||new Float32Array(v))),A.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),A(d.byteLength>=v,"data buffer for regl.read() too small"),t.pixelStorei(3333,4),t.readPixels(c,h,f,p,6408,l,d),d}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=u(e)})),t}(e):u(e)}}function kt(e){return Array.prototype.slice.call(e)}function Lt(e){return kt(e).join("")}var Ot="xyzw".split(""),Pt="dither",It="blend.enable",Nt="blend.color",Dt="blend.equation",Bt="blend.func",Ft="depth.enable",Ut="depth.func",zt="depth.range",Gt="depth.mask",jt="colorMask",Vt="cull.enable",Ht="cull.face",Wt="frontFace",Zt="lineWidth",Xt="polygonOffset.enable",Yt="polygonOffset.offset",qt="sample.alpha",Kt="sample.enable",Qt="sample.coverage",$t="stencil.enable",Jt="stencil.mask",en="stencil.func",tn="stencil.opFront",nn="stencil.opBack",rn="scissor.enable",on="scissor.box",an="viewport",sn="profile",un="framebuffer",ln="vert",cn="frag",hn="elements",fn="primitive",pn="count",dn="offset",vn="instances",mn="vao",gn="Width",yn="Height",_n=un+gn,bn=un+yn,xn=an+gn,En=an+yn,Sn="drawingBuffer",An=Sn+gn,Tn=Sn+yn,Cn=[Bt,Dt,en,tn,nn,Qt,an,on,Yt],wn=34962,Rn=5126,Mn=35664,kn=35665,Ln=35666,On=5124,Pn=35667,In=35668,Nn=35669,Dn=35670,Bn=35671,Fn=35672,Un=35673,zn=35674,Gn=35675,jn=35676,Vn=35678,Hn=35680,Wn=1028,Zn=1029,Xn=2305,Yn=7680,qn={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Kn=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Qn={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},$n={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Jn={frag:35632,vert:35633},er={cw:2304,ccw:Xn};function tr(t){return Array.isArray(t)||e(t)||H(t)}function nr(e){return e.sort((function(e,t){return e===an?-1:t===an?1:e<t?-1:1}))}function rr(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function ir(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function or(e){return new rr(!1,!1,!1,e)}function ar(e,t){var n=e.type;if(0===n){var r=e.data.length;return new rr(!0,r>=1,r>=2,t)}if(4===n){var i=e.data;return new rr(i.thisDep,i.contextDep,i.propDep,t)}return new rr(3===n,2===n,1===n,t)}var sr=new rr(!1,!1,!1,(function(){}));function ur(e,n,r,i,o,s,u,l,c,h,f,p,d,v,m){var g=h.Record,y={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(y.min=32775,y.max=32776);var _=r.angle_instanced_arrays,b=r.webgl_draw_buffers,x={dirty:!0,profile:m.profile},E={},S=[],T={},C={};function w(e){return e.replace(".","_")}function R(e,t,n){var r=w(e);S.push(e),E[r]=x[r]=!!n,T[r]=t}function M(e,t,n){var r=w(e);S.push(e),Array.isArray(n)?(x[r]=n.slice(),E[r]=n.slice()):x[r]=E[r]=n,C[r]=t}R(Pt,3024),R(It,3042),M(Nt,"blendColor",[0,0,0,0]),M(Dt,"blendEquationSeparate",[32774,32774]),M(Bt,"blendFuncSeparate",[1,0,1,0]),R(Ft,2929,!0),M(Ut,"depthFunc",513),M(zt,"depthRange",[0,1]),M(Gt,"depthMask",!0),M(jt,jt,[!0,!0,!0,!0]),R(Vt,2884),M(Ht,"cullFace",Zn),M(Wt,Wt,Xn),M(Zt,Zt,1),R(Xt,32823),M(Yt,"polygonOffset",[0,0]),R(qt,32926),R(Kt,32928),M(Qt,"sampleCoverage",[1,!1]),R($t,2960),M(Jt,"stencilMask",-1),M(en,"stencilFunc",[519,0,-1]),M(tn,"stencilOpSeparate",[Wn,Yn,Yn,Yn]),M(nn,"stencilOpSeparate",[Zn,Yn,Yn,Yn]),R(rn,3089),M(on,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),M(an,an,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var L={gl:e,context:d,strings:n,next:E,current:x,draw:p,elements:s,buffer:o,shader:f,attributes:h.state,vao:h,uniforms:c,framebuffer:l,extensions:r,timer:v,isBufferArgs:tr},O={primTypes:ae,compareFuncs:Qn,blendFuncs:qn,blendEquations:y,stencilOps:$n,glTypes:K,orientationType:er};A.optional((function(){L.isArrayLike=de})),b&&(O.backBuffer=[Zn],O.drawBuffer=D(i.maxDrawbuffers,(function(e){return 0===e?[0]:D(e,(function(e){return 36064+e}))})));var P=0;function I(){var e=function(){var e=0,n=[],r=[];function i(){var n=[],r=[];return t((function(){n.push.apply(n,kt(arguments))}),{def:function(){var t="v"+e++;return r.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,kt(arguments)),n.push(";")),t},toString:function(){return Lt([r.length>0?"var "+r.join(",")+";":"",Lt(n)])}})}function o(){var e=i(),n=i(),r=e.toString,o=n.toString;function a(t,r){n(t,r,"=",e.def(t,r),";")}return t((function(){e.apply(e,kt(arguments))}),{def:e.def,entry:e,exit:n,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+o()}})}var a=i(),s={};return{global:a,link:function(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var o="g"+e++;return n.push(o),r.push(t),o},block:i,proc:function(e,n){var r=[];function i(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var a=0;a<n;++a)i();var u=o(),l=u.toString;return s[e]=t(u,{arg:i,toString:function(){return Lt(["function(",r.join(),"){",l(),"}"])}})},scope:o,cond:function(){var e=Lt(arguments),n=o(),r=o(),i=n.toString,a=r.toString;return t(n,{then:function(){return n.apply(n,kt(arguments)),this},else:function(){return r.apply(r,kt(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),Lt(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',a,"return {"];Object.keys(s).forEach((function(t){e.push('"',t,'":',s[t].toString(),",")})),e.push("}");var t=Lt(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}}}(),r=e.link,i=e.global;e.id=P++,e.batchId="0";var o=r(L),a=e.shared={props:"a0"};Object.keys(L).forEach((function(e){a[e]=i.def(o,".",e)})),A.optional((function(){e.CHECK=r(A),e.commandStr=A.guessCommand(),e.command=r(e.commandStr),e.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},O.invalidBlendCombinations=Kn}));var s=e.next={},u=e.current={};Object.keys(C).forEach((function(e){Array.isArray(x[e])&&(s[e]=i.def(a.next,".",e),u[e]=i.def(a.current,".",e))}));var l=e.constants={};Object.keys(O).forEach((function(e){l[e]=i.def(JSON.stringify(O[e]))})),e.invoke=function(t,n){switch(n.type){case 0:var i=["this",a.context,a.props,e.batchId];return t.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case 1:return t.def(a.props,n.data);case 2:return t.def(a.context,n.data);case 3:return t.def("this",n.data);case 4:return n.data.append(e,t),n.data.ref}},e.attribCache={};var c={};return e.scopeAttrib=function(e){var t=n.id(e);if(t in c)return c[t];var i=h.scope[t];return i||(i=h.scope[t]=new g),c[t]=r(i)},e}function N(e,t,u,c,p){var d=e.static,v=e.dynamic;A.optional((function(){var e=[un,ln,cn,hn,fn,dn,pn,vn,sn,mn].concat(S);function t(t){Object.keys(t).forEach((function(t){A.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',p.commandStr)}))}t(d),t(v)}));var m=function(e,t){var n=e.static;if("string"==typeof n[cn]&&"string"==typeof n[ln]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)A("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(e,t),b=function(e,t){var n=e.static,r=e.dynamic;if(un in n){var i=n[un];return i?(i=l.getFramebuffer(i),A.command(i,"invalid framebuffer object"),or((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+_n,n+".width"),t.set(o,"."+bn,n+".height"),n}))):or((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+_n,r+"."+An),t.set(r,"."+bn,r+"."+Tn),"null"}))}if(un in r){var o=r[un];return ar(o,(function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");A.optional((function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")})),t.set(i,".next",a);var s=r.context;return t.set(s,"."+_n,a+"?"+a+".width:"+s+"."+An),t.set(s,"."+bn,a+"?"+a+".height:"+s+"."+Tn),a}))}return null}(e),x=function(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];A.commandType(o,"object","invalid "+e,n.commandStr);var a,s,u=!0,l=0|o.x,c=0|o.y;return"width"in o?(a=0|o.width,A.command(a>=0,"invalid "+e,n.commandStr)):u=!1,"height"in o?(s=0|o.height,A.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new rr(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",_n,"-",l));var i=s;return"height"in o||(i=t.def(n,".",bn,"-",c)),[l,c,r,i]}))}if(e in i){var h=i[e],f=ar(h,(function(t,n){var r=t.invoke(n,h);A.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",_n,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",bn,"-",a,")");return A.optional((function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)})),[o,a,s,u]}));return t&&(f.thisDep=f.thisDep||t.thisDep,f.contextDep=f.contextDep||t.contextDep,f.propDep=f.propDep||t.propDep),f}return t?new rr(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",_n),t.def(n,".",bn)]})):null}var a=o(an);if(a){var s=a;a=new rr(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,"."+xn,n[2]),t.set(r,"."+En,n[3]),n}))}return{viewport:a,scissor_box:o(on)}}(e,b,p),E=function(e,t){var n=e.static,r=e.dynamic,i=function(){if(hn in n){var e=n[hn];tr(e)?e=s.getElements(s.create(e,!0)):e&&(e=s.getElements(e),A.command(e,"invalid elements",t.commandStr));var i=or((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return i.value=e,i}if(hn in r){var o=r[hn];return ar(o,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,a=e.invoke(t,o),s=t.def("null"),u=t.def(r,"(",a,")"),l=e.cond(u).then(s,"=",i,".createStream(",a,");").else(s,"=",i,".getElements(",a,");");return A.optional((function(){e.assert(l.else,"!"+a+"||"+s,"invalid elements")})),t.entry(l),t.exit(e.cond(u).then(i,".destroyStream(",s,");")),e.ELEMENTS=s,s}))}return null}();function o(e,o){if(e in n){var a=0|n[e];return A.command(!o||a>=0,"invalid "+e,t.commandStr),or((function(e,t){return o&&(e.OFFSET=a),a}))}if(e in r){var s=r[e];return ar(s,(function(t,n){var r=t.invoke(n,s);return o&&(t.OFFSET=r,A.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}return o&&i?or((function(e,t){return e.OFFSET="0",0})):null}var a=o(dn,!0);return{elements:i,primitive:function(){if(fn in n){var e=n[fn];return A.commandParameter(e,ae,"invalid primitve",t.commandStr),or((function(t,n){return ae[e]}))}if(fn in r){var o=r[fn];return ar(o,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,o);return A.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(ae))})),t.def(n,"[",r,"]")}))}return i?ir(i)?i.value?or((function(e,t){return t.def(e.ELEMENTS,".primType")})):or((function(){return 4})):new rr(i.thisDep,i.contextDep,i.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",4)})):null}(),count:function(){if(pn in n){var e=0|n[pn];return A.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),or((function(){return e}))}if(pn in r){var o=r[pn];return ar(o,(function(e,t){var n=e.invoke(t,o);return A.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(i){if(ir(i)){if(i)return a?new rr(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return A.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):or((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var s=or((function(){return-1}));return A.optional((function(){s.MISSING=!0})),s}var u=new rr(i.thisDep||a.thisDep,i.contextDep||a.contextDep,i.propDep||a.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return A.optional((function(){u.DYNAMIC=!0})),u}return null}(),instances:o(vn,!1),offset:a}}(e,p),T=function(e,t){var n=e.static,r=e.dynamic,o={};return S.forEach((function(e){var s=w(e);function u(t,i){if(e in n){var a=t(n[e]);o[s]=or((function(){return a}))}else if(e in r){var u=r[e];o[s]=ar(u,(function(e,t){return i(e,t,e.invoke(t,u))}))}}switch(e){case Vt:case It:case Pt:case $t:case Ft:case rn:case Xt:case qt:case Kt:case Gt:return u((function(n){return A.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return A.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case Ut:return u((function(n){return A.commandParameter(n,Qn,"invalid "+e,t.commandStr),Qn[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return A.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(Qn))})),n.def(i,"[",r,"]")}));case zt:return u((function(e){return A.command(de(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return A.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case Bt:return u((function(e){A.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return A.commandParameter(n,qn,s+".srcRGB",t.commandStr),A.commandParameter(r,qn,s+".srcAlpha",t.commandStr),A.commandParameter(i,qn,s+".dstRGB",t.commandStr),A.commandParameter(o,qn,s+".dstAlpha",t.commandStr),A.command(-1===Kn.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[qn[n],qn[i],qn[r],qn[o]]}),(function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return A.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(qn))})),s}A.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");A.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),l=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),l,n.def(i,"[",o("dst","Alpha"),"]")]}));case Dt:return u((function(n){return"string"==typeof n?(A.commandParameter(n,y,"invalid "+e,t.commandStr),[y[n],y[n]]):"object"===a(n)?(A.commandParameter(n.rgb,y,e+".rgb",t.commandStr),A.commandParameter(n.alpha,y,e+".alpha",t.commandStr),[y[n.rgb],y[n.alpha]]):void A.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return A.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(y))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case Nt:return u((function(e){return A.command(de(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),D(4,(function(t){return+e[t]}))}),(function(e,t,n){return A.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),D(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case Jt:return u((function(e){return A.commandType(e,"number",s,t.commandStr),0|e}),(function(e,t,n){return A.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case en:return u((function(n){A.commandType(n,"object",s,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return A.commandParameter(r,Qn,e+".cmp",t.commandStr),A.commandType(i,"number",e+".ref",t.commandStr),A.commandType(o,"number",e+".mask",t.commandStr),[Qn[r],i,o]}),(function(e,t,n){var r=e.constants.compareFuncs;return A.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Yn),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case tn:case nn:return u((function(n){A.commandType(n,"object",s,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return A.commandParameter(r,$n,e+".fail",t.commandStr),A.commandParameter(i,$n,e+".zfail",t.commandStr),A.commandParameter(o,$n,e+".zpass",t.commandStr),[e===nn?Zn:Wn,$n[r],$n[i],$n[o]]}),(function(t,n,r){var i=t.constants.stencilOps;function o(o){return A.optional((function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys($n))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",Yn)}return A.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[e===nn?Zn:Wn,o("fail"),o("zfail"),o("zpass")]}));case Yt:return u((function(e){A.commandType(e,"object",s,t.commandStr);var n=0|e.factor,r=0|e.units;return A.commandType(n,"number",s+".factor",t.commandStr),A.commandType(r,"number",s+".units",t.commandStr),[n,r]}),(function(t,n,r){return A.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Ht:return u((function(e){var n=0;return"front"===e?n=Wn:"back"===e&&(n=Zn),A.command(!!n,s,t.commandStr),n}),(function(e,t,n){return A.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',Wn,":",Zn)}));case Zt:return u((function(e){return A.command("number"==typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return A.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case Wt:return u((function(e){return A.commandParameter(e,er,s,t.commandStr),er[e]}),(function(e,t,n){return A.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?2304:'+Xn)}));case jt:return u((function(e){return A.command(de(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return A.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),D(4,(function(e){return"!!"+n+"["+e+"]"}))}));case Qt:return u((function(e){A.command("object"===a(e)&&e,s,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return A.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return A.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),o}(e,p),C=function(e,t,r){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=n.id(i[e]);A.optional((function(){f.shader(Jn[e],t,A.guessCommand())}));var r=or((function(){return t}));return r.id=t,r}if(e in o){var a=o[e];return ar(a,(function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return A.optional((function(){n(t.shared.shader,".shader(",Jn[e],",",i,",",t.command,");")})),i}))}return null}var s,u=a(cn),l=a(ln),c=null;return ir(u)&&ir(l)?(c=f.program(l.id,u.id,null,r),s=or((function(e,t){return e.link(c)}))):s=new rr(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(e,t){var n,r=e.shared.shader;n=u?u.append(e,t):t.def(r,".",cn);var i=r+".program("+(l?l.append(e,t):t.def(r,".",ln))+","+n;return A.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:u,vert:l,progVar:s,program:c}}(e,0,m);function R(e){var t=x[e];t&&(T[e]=t)}R(an),R(w(on));var M=Object.keys(T).length>0,k={framebuffer:b,draw:E,shader:C,state:T,dirty:M,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(k.profile=function(e){var t,n=e.static,r=e.dynamic;if(sn in n){var i=!!n[sn];(t=or((function(e,t){return i}))).enable=i}else if(sn in r){var o=r[sn];t=ar(o,(function(e,t){return e.invoke(t,o)}))}return t}(e),k.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=or((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=or((function(e){return e.link(o)})):"framebuffer"===a||"framebufferCube"===a?(A.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=or((function(e){return e.link(o.color[0])}))):A.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else de(o)?r=or((function(t){return t.global.def("[",D(o.length,(function(n){return A.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]})),"]")})):A.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=ar(t,(function(e,n){return e.invoke(n,t)}))})),i}(u,p),k.drawVAO=k.scopeVAO=function(e,t){var n=e.static,r=e.dynamic;if(mn in n){var i=n[mn];return null!==i&&null===h.getVAO(i)&&(i=h.createVAO(i)),or((function(e){return e.link(h.getVAO(i))}))}if(mn in r){var o=r[mn];return ar(o,(function(e,t){var n=e.invoke(t,o);return t.def(e.shared.vao+".getVAO("+n+")")}))}return null}(e),!k.drawVAO&&C.program&&!m&&r.angle_instanced_arrays){var L=!0,O=C.program.attributes.map((function(e){var n=t.static[e];return L=L&&!!n,n}));if(L&&O.length>0){var P=h.getVAO(h.createVAO(O));k.drawVAO=new rr(null,null,null,(function(e,t){return e.link(P)})),k.useVAO=!0}}return m?k.useVAO=!0:k.attributes=function(e,t){var r=e.static,i=e.dynamic,s={};return Object.keys(r).forEach((function(e){var i=r[e],u=n.id(e),l=new g;if(tr(i))l.state=1,l.buffer=o.getBuffer(o.create(i,wn,!1,!0)),l.type=0;else{var c=o.getBuffer(i);if(c)l.state=1,l.buffer=c,l.type=0;else if(A.command("object"===a(i)&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var h=i.constant;l.buffer="null",l.state=2,"number"==typeof h?l.x=h:(A.command(de(h)&&h.length>0&&h.length<=4,"invalid constant for attribute "+e,t.commandStr),Ot.forEach((function(e,t){t<h.length&&(l[e]=h[t])})))}else{c=tr(i.buffer)?o.getBuffer(o.create(i.buffer,wn,!1,!0)):o.getBuffer(i.buffer),A.command(!!c,'missing buffer for attribute "'+e+'"',t.commandStr);var f=0|i.offset;A.command(f>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var p=0|i.stride;A.command(p>=0&&p<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var d=0|i.size;A.command(!("size"in i)||d>0&&d<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var v=!!i.normalized,m=0;"type"in i&&(A.commandParameter(i.type,K,"invalid type for attribute "+e,t.commandStr),m=K[i.type]);var y=0|i.divisor;"divisor"in i&&(A.command(0===y||_,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),A.command(y>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),A.optional((function(){var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){A.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),l.buffer=c,l.state=1,l.size=d,l.normalized=v,l.type=m||c.dtype,l.offset=f,l.stride=p,l.divisor=y}}s[e]=or((function(e,t){var n=e.attribCache;if(u in n)return n[u];var r={isStream:!1};return Object.keys(l).forEach((function(e){r[e]=l[e]})),l.buffer&&(r.buffer=e.link(l.buffer),r.type=r.type||r.buffer+".dtype"),n[u]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];s[e]=ar(t,(function(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;A.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var l={isStream:r.def(!1)},c=new g;c.state=1,Object.keys(c).forEach((function(e){l[e]=r.def(""+c[e])}));var h=l.buffer,f=l.type;function p(e){r(l[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",h,"=",u,".createStream(",wn,",",i,");",f,"=",h,".dtype;","}else{",h,"=",u,".getBuffer(",i,");","if(",h,"){",f,"=",h,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",2,";","if(typeof "+i+'.constant === "number"){',l[Ot[0]],"=",i,".constant;",Ot.slice(1).map((function(e){return l[e]})).join("="),"=0;","}else{",Ot.map((function(e,t){return l[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",h,"=",u,".createStream(",wn,",",i,".buffer);","}else{",h,"=",u,".getBuffer(",i,".buffer);","}",f,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",h,".dtype;",l.normalized,"=!!",i,".normalized;"),p("size"),p("offset"),p("stride"),p("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",h,");","}"),l}))})),s}(t,p),k.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=or((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=ar(t,(function(e,n){return e.invoke(n,t)}))})),r}(c),k}function B(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(o){t.save(r,"."+o);var a=n[o];i(r,".",o,"=",a.append(e,t),";")})),t(i)}function F(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;b&&(i=t.def(o.extensions,".webgl_draw_buffers"));var u,l=e.constants,c=l.drawBuffer,h=l.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",a,".bindFramebuffer(",36160,",",u,".framebuffer);"),b&&t(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",36160,",null);"),b&&t(i,".drawBuffersWEBGL(",h,");"),t("}",s,".cur=",u,";"),r||t("}")}function U(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,u=r.next,l=e.cond(s,".dirty");S.forEach((function(t){var r,c,h=w(t);if(!(h in n.state))if(h in a){r=a[h],c=o[h];var f=D(x[h].length,(function(e){return l.def(r,"[",e,"]")}));l(e.cond(f.map((function(e,t){return e+"!=="+c+"["+t+"]"})).join("||")).then(i,".",C[h],"(",f,");",f.map((function(e,t){return c+"["+t+"]="+e})).join(";"),";"))}else{r=l.def(u,".",h);var p=e.cond(r,"!==",s,".",h);l(p),h in T?p(e.cond(r).then(i,".enable(",T[h],");").else(i,".disable(",T[h],");"),s,".",h,"=",r,";"):p(i,".",C[h],"(",r,");",s,".",h,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),t(l)}function z(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;nr(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(e,t);if(T[i]){var c=T[i];ir(u)?t(s,l?".enable(":".disable(",c,");"):t(e.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),t(a,".",i,"=",l,";")}else if(de(l)){var h=o[i];t(s,".",C[i],"(",l,");",l.map((function(e,t){return h+"["+t+"]="+e})).join(";"),";")}else t(s,".",C[i],"(",l,");",a,".",i,"=",l,";")}}))}function G(e,t){_&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function j(e,t,n,r,i){var o,a,s,u=e.shared,l=e.stats,c=u.current,h=u.timer,f=n.profile;function p(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function d(e){e(o=t.def(),"=",p(),";"),"string"==typeof i?e(l,".count+=",i,";"):e(l,".count++;"),v&&(r?e(a=t.def(),"=",h,".getNumPendingQueries();"):e(h,".beginQuery(",l,");"))}function m(e){e(l,".cpuTime+=",p(),"-",o,";"),v&&(r?e(h,".pushScopeStats(",a,",",h,".getNumPendingQueries(),",l,");"):e(h,".endQuery();"))}function g(e){var n=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",n,";")}if(f){if(ir(f))return void(f.enable?(d(t),m(t.exit),g("true")):g("false"));g(s=f.append(e,t))}else s=t.def(c,".profile");var y=e.block();d(y),t("if(",s,"){",y,"}");var _=e.block();m(_),t.exit("if(",s,"){",_,"}")}function V(e,t,n,r,i){var o=e.shared;r.forEach((function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(e,t)}else{if(!i(sr))return;var l=e.scopeAttrib(s);A.optional((function(){e.assert(t,l+".state","missing attribute "+s)})),a={},Object.keys(new g).forEach((function(e){a[e]=t.def(l,".",e)}))}!function(n,r,i){var a=o.gl,s=t.def(n,".location"),u=t.def(o.attributes,"[",s,"]"),l=i.state,c=i.buffer,h=[i.x,i.y,i.z,i.w],f=["buffer","normalized","offset","stride"];function p(){t("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",u,".type!==",o,"||",u,".size!==",n,"||",f.map((function(e){return u+"."+e+"!=="+i[e]})).join("||"),"){",a,".bindBuffer(",wn,",",c,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",f.map((function(e){return u+"."+e+"="+i[e]+";"})).join(""),"}"),_){var l=i.divisor;t("if(",u,".divisor!==",l,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function d(){t("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",Ot.map((function(e,t){return u+"."+e+"!=="+h[t]})).join("||"),"){",a,".vertexAttrib4f(",s,",",h,");",Ot.map((function(e,t){return u+"."+e+"="+h[t]+";"})).join(""),"}")}1===l?p():2===l?d():(t("if(",l,"===",1,"){"),p(),t("}else{"),d(),t("}"))}(e.link(r),function(e){switch(e){case Mn:case Pn:case Bn:return 2;case kn:case In:case Fn:return 3;case Ln:case Nn:case Un:return 4;default:return 1}}(r.info.type),a)}))}function H(e,t,r,i,o){for(var a,s=e.shared,u=s.gl,l=0;l<i.length;++l){var c,h=i[l],f=h.name,p=h.info.type,d=r.uniforms[f],v=e.link(h)+".location";if(d){if(!o(d))continue;if(ir(d)){var m=d.value;if(A.command(null!=m,'missing uniform "'+f+'"',e.commandStr),p===Vn||p===Hn){A.command("function"==typeof m&&(p===Vn&&("texture2d"===m._reglType||"framebuffer"===m._reglType)||p===Hn&&("textureCube"===m._reglType||"framebufferCube"===m._reglType)),"invalid texture for uniform "+f,e.commandStr);var g=e.link(m._texture||m.color[0]._texture);t(u,".uniform1i(",v,",",g+".bind());"),t.exit(g,".unbind();")}else if(p===zn||p===Gn||p===jn){A.optional((function(){A.command(de(m),"invalid matrix for uniform "+f,e.commandStr),A.command(p===zn&&4===m.length||p===Gn&&9===m.length||p===jn&&16===m.length,"invalid length for matrix uniform "+f,e.commandStr)}));var y=e.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])"),_=2;p===Gn?_=3:p===jn&&(_=4),t(u,".uniformMatrix",_,"fv(",v,",false,",y,");")}else{switch(p){case Rn:A.commandType(m,"number","uniform "+f,e.commandStr),a="1f";break;case Mn:A.command(de(m)&&2===m.length,"uniform "+f,e.commandStr),a="2f";break;case kn:A.command(de(m)&&3===m.length,"uniform "+f,e.commandStr),a="3f";break;case Ln:A.command(de(m)&&4===m.length,"uniform "+f,e.commandStr),a="4f";break;case Dn:A.commandType(m,"boolean","uniform "+f,e.commandStr),a="1i";break;case On:A.commandType(m,"number","uniform "+f,e.commandStr),a="1i";break;case Bn:case Pn:A.command(de(m)&&2===m.length,"uniform "+f,e.commandStr),a="2i";break;case Fn:case In:A.command(de(m)&&3===m.length,"uniform "+f,e.commandStr),a="3i";break;case Un:case Nn:A.command(de(m)&&4===m.length,"uniform "+f,e.commandStr),a="4i"}t(u,".uniform",a,"(",v,",",de(m)?Array.prototype.slice.call(m):m,");")}continue}c=d.append(e,t)}else{if(!o(sr))continue;c=t.def(s.uniforms,"[",n.id(f),"]")}p===Vn?t("if(",c,"&&",c,'._reglType==="framebuffer"){',c,"=",c,".color[0];","}"):p===Hn&&t("if(",c,"&&",c,'._reglType==="framebufferCube"){',c,"=",c,".color[0];","}"),A.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+f+'".  '+r)}function r(e){n("typeof "+c+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){n(s.isArrayLike+"("+c+")&&"+c+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function o(t){n("typeof "+c+'==="function"&&'+c+'._reglType==="texture'+(3553===t?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(p){case On:r("number");break;case Pn:i(2);break;case In:i(3);break;case Nn:i(4);break;case Rn:r("number");break;case Mn:i(2);break;case kn:i(3);break;case Ln:i(4);break;case Dn:r("boolean");break;case Bn:i(2);break;case Fn:i(3);break;case Un:case zn:i(4);break;case Gn:i(9);break;case jn:i(16);break;case Vn:o(3553);break;case Hn:o(34067)}}));var b=1;switch(p){case Vn:case Hn:var x=t.def(c,"._texture");t(u,".uniform1i(",v,",",x,".bind());"),t.exit(x,".unbind();");continue;case On:case Dn:a="1i";break;case Pn:case Bn:a="2i",b=2;break;case In:case Fn:a="3i",b=3;break;case Nn:case Un:a="4i",b=4;break;case Rn:a="1f";break;case Mn:a="2f",b=2;break;case kn:a="3f",b=3;break;case Ln:a="4f",b=4;break;case zn:a="Matrix2fv";break;case Gn:a="Matrix3fv";break;case jn:a="Matrix4fv"}if(t(u,".uniform",a,"(",v,","),"M"===a.charAt(0)){var E=Math.pow(p-zn+2,2),S=e.global.def("new Float32Array(",E,")");t("false,(Array.isArray(",c,")||",c," instanceof Float32Array)?",c,":(",D(E,(function(e){return S+"["+e+"]="+c+"["+e+"]"})),",",S,")")}else t(b>1?D(b,(function(e){return c+"["+e+"]"})):c);t(");")}}function W(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw,u=function(){var i,u=s.elements,l=t;return u?((u.contextDep&&r.contextDynamic||u.propDep)&&(l=n),i=u.append(e,l)):i=l.def(a,".",hn),i&&l("if("+i+")"+o+".bindBuffer(34963,"+i+".buffer.buffer);"),i}();function l(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var c,h,f=l(fn),p=l(dn),d=function(){var i,o=s.count,u=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(e,u),A.optional((function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",pn),A.optional((function(){e.assert(u,i+">=0","missing vertex count")}))),i}();if("number"==typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");_&&(c=l(vn),h=e.instancing);var v=u+".type",m=s.elements&&ir(s.elements);function g(){function e(){n(h,".drawElementsInstancedANGLE(",[f,d,v,p+"<<(("+v+"-5121)>>1)",c],");")}function t(){n(h,".drawArraysInstancedANGLE(",[f,p,d,c],");")}u?m?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}function y(){function e(){n(o+".drawElements("+[f,d,v,p+"<<(("+v+"-5121)>>1)"]+");")}function t(){n(o+".drawArrays("+[f,p,d]+");")}u?m?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}_&&("number"!=typeof c||c>=0)?"string"==typeof c?(n("if(",c,">0){"),g(),n("}else if(",c,"<0){"),y(),n("}")):g():y()}function Z(e,t,n,r,i){var o=I(),a=o.proc("body",i);return A.optional((function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)})),_&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function X(e,t,n,r){G(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),V(e,t,n,r.attributes,(function(){return!0}))),H(e,t,n,r.uniforms,(function(){return!0})),W(e,t,t,n)}function Y(e,t,n,r){function i(){return!0}e.batchId="a1",G(e,t),V(e,t,n,r.attributes,i),H(e,t,n,r.uniforms,i),W(e,t,t,n)}function q(e,t,n,r){G(e,t);var i=n.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var s=e.scope(),u=e.scope();function l(e){return e.contextDep&&i||e.propDep}function c(e){return!l(e)}if(t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",u,"}",s.exit),n.needsContext&&B(e,u,n.context),n.needsFramebuffer&&F(e,u,n.framebuffer),z(e,u,n.state,l),n.profile&&l(n.profile)&&j(e,u,n,!1,!0),r)n.useVAO?n.drawVAO?l(n.drawVAO)?u(e.shared.vao,".setVAO(",n.drawVAO.append(e,u),");"):s(e.shared.vao,".setVAO(",n.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),V(e,s,n,r.attributes,c),V(e,u,n,r.attributes,l)),H(e,s,n,r.uniforms,c),H(e,u,n,r.uniforms,l),W(e,s,u,n);else{var h=e.global.def("{}"),f=n.shader.progVar.append(e,u),p=u.def(f,".id"),d=u.def(h,"[",p,"]");u(e.shared.gl,".useProgram(",f,".program);","if(!",d,"){",d,"=",h,"[",p,"]=",e.link((function(t){return Z(Y,e,n,t,2)})),"(",f,");}",d,".call(this,a0[",o,"],",o,");")}}function Q(e,t,n){var r=t.static[n];if(r&&function(e){if("object"===a(e)&&!de(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(k.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),s=!1,u=!1,l=!1,c=e.global.def("{}");o.forEach((function(t){var n=r[t];if(k.isDynamic(n)){"function"==typeof n&&(n=r[t]=k.unbox(n));var o=ar(n,null);s=s||o.thisDep,l=l||o.propDep,u=u||o.contextDep}else{switch(i(c,".",t,"="),a(n)){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new k.DynamicVariable(4,{thisDep:s,contextDep:u,propDep:l,ref:c,append:function(e,t){o.forEach((function(n){var i=r[n];if(k.isDynamic(i)){var o=e.invoke(t,i);t(c,".",n,"=",o,";")}}))}}),delete t.static[n]}}return{next:E,current:x,procs:function(){var e=I(),t=e.proc("poll"),n=e.proc("refresh"),o=e.block();t(o),n(o);var a,s=e.shared,u=s.gl,l=s.next,c=s.current;o(c,".dirty=false;"),F(e,t),F(e,n,null,!0),_&&(a=e.link(_)),r.oes_vertex_array_object&&n(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var h=0;h<i.maxAttributes;++h){var f=n.def(s.attributes,"[",h,"]"),p=e.cond(f,".buffer");p.then(u,".enableVertexAttribArray(",h,");",u,".bindBuffer(",wn,",",f,".buffer.buffer);",u,".vertexAttribPointer(",h,",",f,".size,",f,".type,",f,".normalized,",f,".stride,",f,".offset);").else(u,".disableVertexAttribArray(",h,");",u,".vertexAttrib4f(",h,",",f,".x,",f,".y,",f,".z,",f,".w);",f,".buffer=null;"),n(p),_&&n(a,".vertexAttribDivisorANGLE(",h,",",f,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(T).forEach((function(r){var i=T[r],a=o.def(l,".",r),s=e.block();s("if(",a,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",c,".",r,"=",a,";"),n(s),t("if(",a,"!==",c,".",r,"){",s,"}")})),Object.keys(C).forEach((function(r){var i,a,s=C[r],h=x[r],f=e.block();if(f(u,".",s,"("),de(h)){var p=h.length;i=e.global.def(l,".",r),a=e.global.def(c,".",r),f(D(p,(function(e){return i+"["+e+"]"})),");",D(p,(function(e){return a+"["+e+"]="+i+"["+e+"];"})).join("")),t("if(",D(p,(function(e){return i+"["+e+"]!=="+a+"["+e+"]"})).join("||"),"){",f,"}")}else i=o.def(l,".",r),a=o.def(c,".",r),f(i,");",c,".",r,"=",i,";"),t("if(",i,"!==",a,"){",f,"}");n(f)})),e.compile()}(),compile:function(e,t,r,i,o){var a=I();a.stats=a.link(o),Object.keys(t.static).forEach((function(e){Q(a,t,e)})),Cn.forEach((function(t){Q(a,e,t)}));var s=N(e,t,r,i,a);return function(e,t){var n=e.proc("draw",1);G(e,n),B(e,n,t.context),F(e,n,t.framebuffer),U(e,n,t),z(e,n,t.state),j(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)X(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(n){return Z(X,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(a,s),function(e,t){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(n){var o=t.shader[n];o&&r.set(i.shader,"."+n,o.append(e,r))}B(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),nr(Object.keys(t.state)).forEach((function(n){var o=t.state[n].append(e,r);de(o)?o.forEach((function(t,i){r.set(e.next[n],"["+i+"]",t)})):r.set(i.next,"."+n,o)})),j(e,r,t,!0,!0),[hn,dn,pn,vn,fn].forEach((function(n){var o=t.draw[n];o&&r.set(i.draw,"."+n,""+o.append(e,r))})),Object.keys(t.uniforms).forEach((function(o){r.set(i.uniforms,"["+n.id(o)+"]",t.uniforms[o].append(e,r))})),Object.keys(t.attributes).forEach((function(n){var i=t.attributes[n].append(e,r),o=e.scopeAttrib(n);Object.keys(new g).forEach((function(e){r.set(o,"."+e,i[e])}))})),t.scopeVAO&&r.set(i.vao,".targetVAO",t.scopeVAO.append(e,r)),a(ln),a(cn),Object.keys(t.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}(a,s),function(e,t){var n=e.proc("batch",2);e.batchId="0",G(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(B(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||F(e,n,o)):F(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),U(e,n,t),z(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||j(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)q(e,n,t,null);else{var l=u.append(e,n);if(n(e.shared.gl,".useProgram(",l,".program);"),t.shader.program)q(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var c=e.global.def("{}"),h=n.def(l,".id"),f=n.def(c,"[",h,"]");n(e.cond(f).then(f,".call(this,a0,a1);").else(f,"=",c,"[",h,"]=",e.link((function(n){return Z(q,e,t,n,2)})),"(",l,");",f,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(a,s),a.compile()}}}var lr=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(e){a.push(e)}var u=[];function l(e,t,n){var r=a.pop()||new o;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,u.push(r)}var c=[],h=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),l(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:l,update:function(){var e,n,o=i.length;if(0!==o){h.length=Math.max(h.length,o+1),c.length=Math.max(c.length,o+1),c[0]=0,h[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var l=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(l,34919)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(l,34918),r(l)):i[e++]=l,c[n+1]=a,h[n+1]=e}for(i.length=e,e=0,n=0;n<u.length;++n){var f=u[n],p=f.startQueryIndex,d=f.endQueryIndex;f.sum+=c[d]-c[p];var v=h[p],m=h[d];m===v?(f.stats.gpuTime+=f.sum/1e6,s(f)):(f.startQueryIndex=v,f.endQueryIndex=m,u[e++]=f)}u.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},cr="webglcontextlost",hr="webglcontextrestored";function fr(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(n){var r=N(n);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),s=i.isContextLost(),u=function(e,t){var n={};function r(t){A.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=e.getExtension(i)}catch(e){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}(i,r);if(!u)return null;var l,c,h=(l={"":0},c=[""],{id:function(e){var t=l[e];return t||(t=l[e]=c.length,c.push(e),t)},str:function(e){return c[e]}}),f={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},p=u.extensions,d=lr(0,p),v=O(),m=i.drawingBufferWidth,g=i.drawingBufferHeight,y={tick:0,time:0,viewportWidth:m,viewportHeight:g,framebufferWidth:m,framebufferHeight:g,drawingBufferWidth:m,drawingBufferHeight:g,pixelRatio:r.pixelRatio},_=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(z,a),e.texImage2D(z,0,G,1,1,0,G,j,null);var s=e.createFramebuffer();if(e.bindFramebuffer(V,s),e.framebufferTexture2D(V,36064,z,a,0),e.bindTexture(z,null),36053!==e.checkFramebufferStatus(V))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=U.allocType(j,4);e.readPixels(0,0,1,1,G,j,u),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===u[0]),U.freeType(u)}}var l=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=e.createTexture(),h=U.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,c),e.texImage2D(34069,0,G,3,3,0,G,5121,h),U.freeType(h),e.bindTexture(34067,null),e.deleteTexture(c),l=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:l}}(i,p),b=function(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=ee,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){h(this)};var u=[];function l(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function c(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||te,n.length>0)if(Array.isArray(n[0])){s=J(n);for(var c=1,h=1;h<s.length;++h)c*=s[h];t.dimension=c,l(t,u=$(n,s,t.dtype),r),a?t.persistentData=u:U.freeType(u)}else if("number"==typeof n[0]){t.dimension=o;var f=U.allocType(t.dtype,n.length);ie(f,n),l(t,f,r),a?t.persistentData=f:U.freeType(f)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||re(n[0])||te,l(t,u=$(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=u:U.freeType(u)):A.raise("invalid buffer data")}else if(e(n))t.dtype=i||re(n),t.dimension=o,l(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(H(n)){s=n.shape;var p=n.stride,d=n.offset,v=0,m=0,g=0,y=0;1===s.length?(v=s[0],m=1,g=p[0],y=0):2===s.length?(v=s[0],m=s[1],g=p[0],y=p[1]):A.raise("invalid shape"),t.dtype=i||re(n.data)||te,t.dimension=m;var _=U.allocType(t.dtype,v*m);oe(_,n.data,v,m,g,y,d),l(t,_,r),a?t.persistentData=_:U.freeType(_)}else n instanceof ArrayBuffer?(t.dtype=ee,t.dimension=o,l(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):A.raise("invalid buffer data")}function h(e){n.bufferCount--,i(e);var r=e.buffer;A(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:function(i,o,u,l){n.bufferCount++;var f=new s(o);function p(n){var i=35044,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||H(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(A.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(A(null===o||Array.isArray(o)||e(o)||H(o),"invalid data for buffer"),o=n.data),"usage"in n&&(A.parameter(n.usage,Q,"invalid buffer usage"),i=Q[n.usage]),"type"in n&&(A.parameter(n.type,K,"invalid buffer type"),s=K[n.type]),"dimension"in n&&(A.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(A.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),f.bind(),o?c(f,o,i,s,u,l):(a&&t.bufferData(f.type,a,i),f.dtype=s||ee,f.usage=i,f.dimension=u,f.byteLength=a),r.profile&&(f.stats.size=f.byteLength*ne[f.dtype]),p}function d(e,n){A(n+e.byteLength<=f.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+f.byteLength),t.bufferSubData(f.type,n,e)}return a[f.id]=f,u||p(i),p._reglType="buffer",p._buffer=f,p.subdata=function(t,n){var r,i=0|(n||0);if(f.bind(),e(t)||t instanceof ArrayBuffer)d(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=U.allocType(f.dtype,t.length);ie(o,t),d(o,i),U.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=J(t);var a=$(t,r,f.dtype);d(a,i),U.freeType(a)}else A.raise("invalid buffer data")}else if(H(t)){r=t.shape;var s=t.stride,u=0,l=0,c=0,h=0;1===r.length?(u=r[0],l=1,c=s[0],h=0):2===r.length?(u=r[0],l=r[1],c=s[0],h=s[1]):A.raise("invalid shape");var v=Array.isArray(t.data)?f.dtype:re(t.data),m=U.allocType(v,u*l);oe(m,t.data,u,l,c,h,t.offset),d(m,i),U.freeType(m)}else A.raise("invalid data for buffer subdata");return p},r.profile&&(p.stats=f.stats),p.destroy=function(){h(f)},p},createStream:function(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),c(n,t,35040,0,1,!1),n},destroyStream:function(e){u.push(e)},clear:function(){W(a).forEach(h),u.forEach(h)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){W(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))},_initBuffer:c}}(i,f,r,(function(e){return x.destroyBuffer(e)})),x=function(t,n,r,i,o){for(var a=r.maxAttributes,s=new Array(a),u=0;u<a;++u)s[u]=new Ct;var l=0,c={},h={Record:Ct,scope:{},state:s,currentVAO:null,targetVAO:null,restore:f()?function(){f()&&W(c).forEach((function(e){e.refresh()}))}:function(){},createVAO:function(t){var r=new d;function s(t){A(Array.isArray(t),"arguments to vertex array constructor must be an array"),A(t.length<a,"too many attributes"),A(t.length>0,"must specify at least one attribute");for(var i=0;i<r.buffers.length;++i)r.buffers[i].destroy();r.buffers.length=0;var u=r.attributes;u.length=t.length;for(var l=0;l<t.length;++l){var c=t[l],h=u[l]=new Ct;if(Array.isArray(c)||e(c)||H(c)){var f=o.create(c,34962,!1,!0);h.buffer=o.getBuffer(f),h.size=0|h.buffer.dimension,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,h.divisor=0,h.state=1,r.buffers.push(f)}else o.getBuffer(c)?(h.buffer=o.getBuffer(c),h.size=0|h.buffer.dimension,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,h.divisor=0,h.state=1):o.getBuffer(c.buffer)?(h.buffer=o.getBuffer(c.buffer),h.size=0|(+c.size||h.buffer.dimension),h.normalized=!!c.normalized||!1,"type"in c?(A.parameter(c.type,K,"invalid buffer type"),h.type=K[c.type]):h.type=h.buffer.dtype,h.offset=0|(c.offset||0),h.stride=0|(c.stride||0),h.divisor=0|(c.divisor||0),h.state=1,A(h.size>=1&&h.size<=4,"size must be between 1 and 4"),A(h.offset>=0,"invalid offset"),A(h.stride>=0&&h.stride<=255,"stride must be between 0 and 255"),A(h.divisor>=0,"divisor must be positive"),A(!h.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in c?(A(l>0,"first attribute must not be a constant"),h.x=+c.x||0,h.y=+c.y||0,h.z=+c.z||0,h.w=+c.w||0,h.state=2):A(!1,"invalid attribute spec for location "+l)}return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){r.destroy()},s._vao=r,s._reglType="vao",s(t)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(e){for(var n=0;n<s.length;++n){var r=s[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}},setVAO:f()?function(e){if(e!==h.currentVAO){var t=f();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),h.currentVAO=e}}:function(e){if(e!==h.currentVAO){if(e)e.bindAttrs();else for(var n=p(),r=0;r<s.length;++r){var i=s[r];i.buffer?(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}h.currentVAO=e}},clear:f()?function(){W(c).forEach((function(e){e.destroy()}))}:function(){}};function f(){return n.oes_vertex_array_object}function p(){return n.angle_instanced_arrays}function d(){this.id=++l,this.attributes=[];var e=f();this.vao=e?e.createVertexArrayOES():null,c[this.id]=this,this.buffers=[]}return d.prototype.bindAttrs=function(){for(var e=p(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(34962,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<a;++o)t.disableVertexAttribArray(o)},d.prototype.refresh=function(){var e=f();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),h.currentVAO=this)},d.prototype.destroy=function(){if(this.vao){var e=f();this===h.currentVAO&&(h.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}c[this.id]&&(delete c[this.id],i.vaoCount-=1)},h}(i,p,_,f,b),E=function(t,n,r,i){var o={},a=0,s={uint8:se,uint16:ue};function u(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=4,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=le),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(i,o,a,s,u,l,c){var h;if(i.buffer.bind(),o){var f=c;c||e(o)&&(!H(o)||e(o.data))||(f=n.oes_element_index_uint?le:ue),r._initBuffer(i.buffer,o,a,f,3)}else t.bufferData(ce,l,a),i.buffer.dtype=h||se,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=l;if(h=c,!c){switch(i.buffer.dtype){case se:case 5120:h=se;break;case ue:case 5122:h=ue;break;case le:case 5124:h=le;break;default:A.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,A(h!==le||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=u;p<0&&(p=i.buffer.byteLength,h===ue?p>>=1:h===le&&(p>>=2)),i.vertCount=p;var d=s;if(s<0){d=4;var v=i.buffer.dimension;1===v&&(d=0),2===v&&(d=1),3===v&&(d=4)}i.primType=d}function h(e){i.elementsCount--,A(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,n){var o=r.create(null,ce,!0),a=new u(o._buffer);function l(t){if(t)if("number"==typeof t)o(t),a.primType=4,a.vertCount=0|t,a.type=se;else{var n=null,r=35044,i=-1,u=-1,h=0,f=0;Array.isArray(t)||e(t)||H(t)?n=t:(A.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,A(Array.isArray(n)||e(n)||H(n),"invalid data for element buffer")),"usage"in t&&(A.parameter(t.usage,Q,"invalid element buffer usage"),r=Q[t.usage]),"primitive"in t&&(A.parameter(t.primitive,ae,"invalid element buffer primitive"),i=ae[t.primitive]),"count"in t&&(A("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(A.parameter(t.type,s,"invalid buffer type"),f=s[t.type]),"length"in t?h=0|t.length:(h=u,f===ue||5122===f?h*=2:f!==le&&5124!==f||(h*=4))),c(a,n,r,i,u,h,f)}else o(),a.primType=4,a.vertCount=0,a.type=se;return l}return i.elementsCount++,l(t),l._reglType="elements",l._elements=a,l.subdata=function(e,t){return o.subdata(e,t),l},l.destroy=function(){h(a)},l},createStream:function(e){var t=l.pop();return t||(t=new u(r.create(null,ce,!0,!1)._buffer)),c(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){l.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){W(o).forEach(h)}}}(i,p,b,f),S=function(e,t,n,r){var i={},o={};function a(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function s(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function u(n,r,a){var s=35632===n?i:o,u=s[r];if(!u){var l=t.str(r);u=e.createShader(n),e.shaderSource(u,l),e.compileShader(u),A.shaderError(e,u,l,n,a),s[r]=u}return u}var l={},c=[],h=0;function f(e,t){this.id=h++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],r.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(n,i,o){var l,c,h=u(35632,n.fragId),f=u(35633,n.vertId),p=n.program=e.createProgram();if(e.attachShader(p,h),e.attachShader(p,f),o)for(l=0;l<o.length;++l){var d=o[l];e.bindAttribLocation(p,d[0],d[1])}e.linkProgram(p),A.linkError(e,p,t.str(n.fragId),t.str(n.vertId),i);var v=e.getProgramParameter(p,35718);r.profile&&(n.stats.uniformsCount=v);var m=n.uniforms;for(l=0;l<v;++l)if(c=e.getActiveUniform(p,l))if(c.size>1)for(var g=0;g<c.size;++g){var y=c.name.replace("[0]","["+g+"]");s(m,new a(y,t.id(y),e.getUniformLocation(p,y),c))}else s(m,new a(c.name,t.id(c.name),e.getUniformLocation(p,c.name),c));var _=e.getProgramParameter(p,35721);r.profile&&(n.stats.attributesCount=_);var b=n.attributes;for(l=0;l<_;++l)(c=e.getActiveAttrib(p,l))&&s(b,new a(c.name,t.id(c.name),e.getAttribLocation(p,c.name),c))}return r.profile&&(n.getMaxUniformsCount=function(){var e=0;return c.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},n.getMaxAttributesCount=function(){var e=0;return c.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);W(i).forEach(t),i={},W(o).forEach(t),o={},c.forEach((function(t){e.deleteProgram(t.program)})),c.length=0,l={},n.shaderCount=0},program:function(e,t,r,i){A.command(e>=0,"missing vertex shader",r),A.command(t>=0,"missing fragment shader",r);var o=l[t];o||(o=l[t]={});var a=o[e];if(a&&!i)return a;var s=new f(t,e);return n.shaderCount++,p(s,r,i),a||(o[e]=s),c.push(s),s},restore:function(){i={},o={};for(var e=0;e<c.length;++e)p(c[e],null,c[e].attributes.map((function(e){return[e.location,e.name]})))},shader:u,frag:-1,vert:-1}}(i,h,f,r),T=ft(i,p,_,(function(){R.procs.poll()}),y,f,r),C=function(e,t,n,r,i){var o={rgba4:dt,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var s=[];Object.keys(o).forEach((function(e){var t=o[e];s[t]=e}));var u=0,l={};function c(e){this.id=u++,this.refCount=1,this.renderbuffer=e,this.format=dt,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function h(t){var n=t.renderbuffer;A(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(pt,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete l[t.id],r.renderbufferCount--}return c.prototype.decRef=function(){--this.refCount<=0&&h(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(l).forEach((function(t){e+=l[t].stats.size})),e}),{create:function(t,u){var h=new c(e.createRenderbuffer());function f(t,r){var u=0,l=0,c=dt;if("object"===a(t)&&t){var p=t;if("shape"in p){var d=p.shape;A(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape"),u=0|d[0],l=0|d[1]}else"radius"in p&&(u=l=0|p.radius),"width"in p&&(u=0|p.width),"height"in p&&(l=0|p.height);"format"in p&&(A.parameter(p.format,o,"invalid renderbuffer format"),c=o[p.format])}else"number"==typeof t?(u=0|t,l="number"==typeof r?0|r:u):t?A.raise("invalid arguments to renderbuffer constructor"):u=l=1;if(A(u>0&&l>0&&u<=n.maxRenderbufferSize&&l<=n.maxRenderbufferSize,"invalid renderbuffer size"),u!==h.width||l!==h.height||c!==h.format)return f.width=h.width=u,f.height=h.height=l,h.format=c,e.bindRenderbuffer(pt,h.renderbuffer),e.renderbufferStorage(pt,c,u,l),A(0===e.getError(),"invalid render buffer format"),i.profile&&(h.stats.size=mt(h.format,h.width,h.height)),f.format=s[h.format],f}return l[h.id]=h,r.renderbufferCount++,f(t,u),f.resize=function(t,r){var o=0|t,a=0|r||o;return o===h.width&&a===h.height||(A(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),f.width=h.width=o,f.height=h.height=a,e.bindRenderbuffer(pt,h.renderbuffer),e.renderbufferStorage(pt,h.format,o,a),A(0===e.getError(),"invalid render buffer format"),i.profile&&(h.stats.size=mt(h.format,h.width,h.height))),f},f._reglType="renderbuffer",f._renderbuffer=h,i.profile&&(f.stats=h.stats),f.destroy=function(){h.decRef()},f},clear:function(){W(l).forEach(h)},restore:function(){W(l).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(pt,t.renderbuffer),e.renderbufferStorage(pt,t.format,t.width,t.height)})),e.bindRenderbuffer(pt,null)}}}(i,p,_,f,r),w=function(e,n,r,i,o,s){var u={cur:null,next:null,dirty:!1,setFBO:null},l=["rgba"],c=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&c.push("srgba"),n.ext_color_buffer_half_float&&c.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&c.push("rgba32f");var h=["uint8"];function f(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function p(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function d(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);A(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;A(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function v(t,n){n&&(n.texture?e.framebufferTexture2D(gt,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(gt,t,yt,n.renderbuffer._renderbuffer.renderbuffer))}function m(e){var t=_t,n=null,r=null,i=e;"object"===a(e)&&(i=e.data,"target"in e&&(t=0|e.target)),A.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,A(t===_t)):"textureCube"===o?(n=i,A(t>=bt&&t<34075,"invalid cube map target")):"renderbuffer"===o?(r=i,t=yt):A.raise("invalid regl object for attachment"),new f(t,n,r)}function g(e,t,n,r,a){if(n){var s=i.create2D({width:e,height:t,format:r,type:a});return s._texture.refCount=0,new f(_t,s,null)}var u=o.create({width:e,height:t,format:r});return u._renderbuffer.refCount=0,new f(yt,null,u)}function y(e){return e&&(e.texture||e.renderbuffer)}function _(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&h.push("half float","float16"),n.oes_texture_float&&h.push("float","float32");var b=0,x={};function E(){this.id=b++,x[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function S(e){e.colorAttachments.forEach(p),p(e.depthAttachment),p(e.stencilAttachment),p(e.depthStencilAttachment)}function T(t){var n=t.framebuffer;A(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,s.framebufferCount--,delete x[t.id]}function C(t){var n;e.bindFramebuffer(gt,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)v(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(gt,36064+n,_t,null,0);e.framebufferTexture2D(gt,33306,_t,null,0),e.framebufferTexture2D(gt,36096,_t,null,0),e.framebufferTexture2D(gt,36128,_t,null,0),v(36096,t.depthAttachment),v(36128,t.stencilAttachment),v(33306,t.depthStencilAttachment);var o=e.checkFramebufferStatus(gt);e.isContextLost()||36053===o||A.raise("framebuffer configuration not supported, status = "+Tt[o]),e.bindFramebuffer(gt,u.next?u.next.framebuffer:null),u.cur=u.next,e.getError()}function w(e,i){var o=new E;function a(e,t){var i;A(u.next!==o,"can not update framebuffer which is currently in use");var s=0,f=0,p=!0,v=!0,_=null,b=!0,x="rgba",E="uint8",T=1,w=null,R=null,M=null,k=!1;if("number"==typeof e)s=0|e,f=0|t||s;else if(e){A.type(e,"object","invalid arguments for framebuffer");var L=e;if("shape"in L){var O=L.shape;A(Array.isArray(O)&&O.length>=2,"invalid shape for framebuffer"),s=O[0],f=O[1]}else"radius"in L&&(s=f=L.radius),"width"in L&&(s=L.width),"height"in L&&(f=L.height);("color"in L||"colors"in L)&&(_=L.color||L.colors,Array.isArray(_)&&A(1===_.length||n.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in L&&(T=0|L.colorCount,A(T>0,"invalid color buffer count")),"colorTexture"in L&&(b=!!L.colorTexture,x="rgba4"),"colorType"in L&&(E=L.colorType,b?(A(n.oes_texture_float||!("float"===E||"float32"===E),"you must enable OES_texture_float in order to use floating point framebuffer objects"),A(n.oes_texture_half_float||!("half float"===E||"float16"===E),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===E||"float16"===E?(A(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f"):"float"!==E&&"float32"!==E||(A(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f"),A.oneOf(E,h,"invalid color type")),"colorFormat"in L&&(x=L.colorFormat,l.indexOf(x)>=0?b=!0:c.indexOf(x)>=0?b=!1:b?A.oneOf(L.colorFormat,l,"invalid color format for texture"):A.oneOf(L.colorFormat,c,"invalid color format for renderbuffer"))),("depthTexture"in L||"depthStencilTexture"in L)&&(k=!(!L.depthTexture&&!L.depthStencilTexture),A(!k||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in L&&("boolean"==typeof L.depth?p=L.depth:(w=L.depth,v=!1)),"stencil"in L&&("boolean"==typeof L.stencil?v=L.stencil:(R=L.stencil,p=!1)),"depthStencil"in L&&("boolean"==typeof L.depthStencil?p=v=L.depthStencil:(M=L.depthStencil,p=!1,v=!1))}else s=f=1;var P=null,I=null,N=null,D=null;if(Array.isArray(_))P=_.map(m);else if(_)P=[m(_)];else for(P=new Array(T),i=0;i<T;++i)P[i]=g(s,f,b,x,E);A(n.webgl_draw_buffers||P.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),A(P.length<=r.maxColorAttachments,"too many color attachments, not supported"),s=s||P[0].width,f=f||P[0].height,w?I=m(w):p&&!v&&(I=g(s,f,k,"depth","uint32")),R?N=m(R):v&&!p&&(N=g(s,f,!1,"stencil","uint8")),M?D=m(M):!w&&!R&&v&&p&&(D=g(s,f,k,"depth stencil","depth stencil")),A(!!w+!!R+!!M<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var B=null;for(i=0;i<P.length;++i)if(d(P[i],s,f),A(!P[i]||P[i].texture&&xt.indexOf(P[i].texture._texture.format)>=0||P[i].renderbuffer&&At.indexOf(P[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),P[i]&&P[i].texture){var F=Et[P[i].texture._texture.format]*St[P[i].texture._texture.type];null===B?B=F:A(B===F,"all color attachments much have the same number of bits per pixel.")}return d(I,s,f),A(!I||I.texture&&6402===I.texture._texture.format||I.renderbuffer&&33189===I.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),d(N,s,f),A(!N||N.renderbuffer&&36168===N.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),d(D,s,f),A(!D||D.texture&&34041===D.texture._texture.format||D.renderbuffer&&34041===D.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),S(o),o.width=s,o.height=f,o.colorAttachments=P,o.depthAttachment=I,o.stencilAttachment=N,o.depthStencilAttachment=D,a.color=P.map(y),a.depth=y(I),a.stencil=y(N),a.depthStencil=y(D),a.width=o.width,a.height=o.height,C(o),a}return s.framebufferCount++,a(e,i),t(a,{resize:function(e,t){A(u.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return a;for(var i=o.colorAttachments,s=0;s<i.length;++s)_(i[s],n,r);return _(o.depthAttachment,n,r),_(o.stencilAttachment,n,r),_(o.depthStencilAttachment,n,r),o.width=a.width=n,o.height=a.height=r,C(o),a},_reglType:"framebuffer",_framebuffer:o,destroy:function(){T(o),S(o)},use:function(e){u.setFBO({framebuffer:a},e)}})}return t(u,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof E)return t}return null},create:w,createCube:function(e){var o=Array(6);function a(e){var r;A(o.indexOf(u.next)<0,"can not update framebuffer which is currently in use");var s,c={color:null},f=0,p=null,d="rgba",v="uint8",m=1;if("number"==typeof e)f=0|e;else if(e){A.type(e,"object","invalid arguments for framebuffer");var g=e;if("shape"in g){var y=g.shape;A(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),A(y[0]===y[1],"cube framebuffer must be square"),f=y[0]}else"radius"in g&&(f=0|g.radius),"width"in g?(f=0|g.width,"height"in g&&A(g.height===f,"must be square")):"height"in g&&(f=0|g.height);("color"in g||"colors"in g)&&(p=g.color||g.colors,Array.isArray(p)&&A(1===p.length||n.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in g&&(m=0|g.colorCount,A(m>0,"invalid color buffer count")),"colorType"in g&&(A.oneOf(g.colorType,h,"invalid color type"),v=g.colorType),"colorFormat"in g&&(d=g.colorFormat,A.oneOf(g.colorFormat,l,"invalid color format for texture"))),"depth"in g&&(c.depth=g.depth),"stencil"in g&&(c.stencil=g.stencil),"depthStencil"in g&&(c.depthStencil=g.depthStencil)}else f=1;if(p)if(Array.isArray(p))for(s=[],r=0;r<p.length;++r)s[r]=p[r];else s=[p];else{s=Array(m);var _={radius:f,format:d,type:v};for(r=0;r<m;++r)s[r]=i.createCube(_)}for(c.color=Array(s.length),r=0;r<s.length;++r){var b=s[r];A("function"==typeof b&&"textureCube"===b._reglType,"invalid cube map"),f=f||b.width,A(b.width===f&&b.height===f,"invalid cube map shape"),c.color[r]={target:bt,data:s[r]}}for(r=0;r<6;++r){for(var x=0;x<s.length;++x)c.color[x].target=bt+r;r>0&&(c.depth=o[0].depth,c.stencil=o[0].stencil,c.depthStencil=o[0].depthStencil),o[r]?o[r](c):o[r]=w(c)}return t(a,{width:f,height:f,color:s})}return a(e),t(a,{faces:o,resize:function(e){var t,n=0|e;if(A(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(e){e.destroy()}))}})},clear:function(){W(x).forEach(T)},restore:function(){u.cur=null,u.next=null,u.dirty=!0,W(x).forEach((function(t){t.framebuffer=e.createFramebuffer(),C(t)}))}})}(i,p,_,T,C,f),R=ur(i,h,p,_,b,E,0,w,{},x,S,{elements:null,primitive:4,count:-1,offset:0,instances:-1},y,d,r),M=Mt(i,w,R.procs.poll,y,o,p,_),P=R.next,I=i.canvas,D=[],B=[],F=[],Z=[r.onDestroy],X=null;function Y(){if(0===D.length)return d&&d.update(),void(X=null);X=L.next(Y),_e();for(var e=D.length-1;e>=0;--e){var t=D[e];t&&t(y,null,0)}i.flush(),d&&d.update()}function q(){!X&&D.length>0&&(X=L.next(Y))}function he(){X&&(L.cancel(Y),X=null)}function fe(e){e.preventDefault(),s=!0,he(),B.forEach((function(e){e()}))}function pe(e){i.getError(),s=!1,u.restore(),S.restore(),b.restore(),T.restore(),C.restore(),w.restore(),x.restore(),d&&d.restore(),R.procs.refresh(),q(),F.forEach((function(e){e()}))}function de(e){function n(e){var t={},n={};return Object.keys(e).forEach((function(r){var i=e[r];k.isDynamic(i)?n[r]=k.unbox(i,r):t[r]=i})),{dynamic:n,static:t}}A(!!e,"invalid args to regl({...})"),A.type(e,"object","invalid args to regl({...})");var r=n(e.context||{}),i=n(e.uniforms||{}),o=n(e.attributes||{}),a=n(function(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach((function(r){n[e+"."+r]=t[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(n.vao=e.vao),n}(e)),u={gpuTime:0,cpuTime:0,count:0},l=R.compile(a,o,i,r,u),c=l.draw,h=l.batch,f=l.scope,p=[];return t((function(e,t){var n;if(s&&A.raise("context lost"),"function"==typeof e)return f.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)f.call(this,null,t,n);else{if(!Array.isArray(e))return f.call(this,e,t,0);for(n=0;n<e.length;++n)f.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return h.call(this,function(e){for(;p.length<e;)p.push(null);return p}(0|e),0|e)}else{if(!Array.isArray(e))return c.call(this,e);if(e.length)return h.call(this,e,e.length)}}),{stats:u})}I&&(I.addEventListener(cr,fe,!1),I.addEventListener(hr,pe,!1));var ve=w.setFBO=de({framebuffer:k.define.call(null,1,"framebuffer")});function me(e,t){var n=0;R.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(i.clearDepth(+t.depth),n|=256),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=1024),A(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function ge(e){return A.type(e,"function","regl.frame() callback must be a function"),D.push(e),q(),{cancel:function(){var t=fr(D,e);A(t>=0,"cannot cancel a frame twice"),D[t]=function e(){var t=fr(D,e);D[t]=D[D.length-1],D.length-=1,D.length<=0&&he()}}}}function ye(){var e=P.viewport,t=P.scissor_box;e[0]=e[1]=t[0]=t[1]=0,y.viewportWidth=y.framebufferWidth=y.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,y.viewportHeight=y.framebufferHeight=y.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function _e(){y.tick+=1,y.time=xe(),ye(),R.procs.poll()}function be(){ye(),R.procs.refresh(),d&&d.update()}function xe(){return(O()-v)/1e3}be();var Ee=t(de,{clear:function(e){if(A("object"===a(e)&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)ve(t({framebuffer:e.framebuffer.faces[n]},e),me);else ve(e,me);else me(0,e)},prop:k.define.bind(null,1),context:k.define.bind(null,2),this:k.define.bind(null,3),draw:de({}),buffer:function(e){return b.create(e,34962,!1,!1)},elements:function(e){return E.create(e,!1)},texture:T.create2D,cube:T.createCube,renderbuffer:C.create,framebuffer:w.create,framebufferCube:w.createCube,vao:x.createVAO,attributes:o,frame:ge,on:function(e,t){var n;switch(A.type(t,"function","listener callback must be a function"),e){case"frame":return ge(t);case"lost":n=B;break;case"restore":n=F;break;case"destroy":n=Z;break;default:A.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:_,hasExtension:function(e){return _.extensions.indexOf(e.toLowerCase())>=0},read:M,destroy:function(){D.length=0,he(),I&&(I.removeEventListener(cr,fe),I.removeEventListener(hr,pe)),S.clear(),w.clear(),C.clear(),T.clear(),E.clear(),b.clear(),x.clear(),d&&d.clear(),Z.forEach((function(e){e()}))},_gl:i,_refresh:be,poll:function(){_e(),d&&d.update()},now:xe,stats:f});return r.onDone(null,Ee),Ee}},"object"===a(t)?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},4068:function(e,t,n){var r,i,o,a=n(5570).default;o=function(){"use strict";function e(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;t(n,r,u,o,a,s%2),e(n,r,i,o,u-1,s+1),e(n,r,i,u+1,a,s+1)}}function t(e,r,i,o,a,s){for(;a>o;){if(a-o>600){var u=a-o+1,l=i-o+1,c=Math.log(u),h=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*h*(u-h)/u)*(l-u/2<0?-1:1);t(e,r,i,Math.max(o,Math.floor(i-l*h/u+f)),Math.min(a,Math.floor(i+(u-l)*h/u+f)),s)}var p=r[2*i+s],d=o,v=a;for(n(e,r,o,i),r[2*a+s]>p&&n(e,r,o,a);d<v;){for(n(e,r,d,v),d++,v--;r[2*d+s]<p;)d++;for(;r[2*v+s]>p;)v--}r[2*o+s]===p?n(e,r,o,v):n(e,r,++v,a),v<=i&&(o=v+1),i<=v&&(a=v-1)}}function n(e,t,n,i){r(e,n,i),r(t,2*n,2*i),r(t,2*n+1,2*i+1)}function r(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function i(e,t,n,r){var i=e-n,o=t-r;return i*i+o*o}var o=function(e){return e[0]},a=function(e){return e[1]},s=function(t,n,r,i,s){void 0===n&&(n=o),void 0===r&&(r=a),void 0===i&&(i=64),void 0===s&&(s=Float64Array),this.nodeSize=i,this.points=t;for(var u=t.length<65536?Uint16Array:Uint32Array,l=this.ids=new u(t.length),c=this.coords=new s(2*t.length),h=0;h<t.length;h++)l[h]=h,c[2*h]=n(t[h]),c[2*h+1]=r(t[h]);e(l,c,i,0,l.length-1,0)};s.prototype.range=function(e,t,n,r){return function(e,t,n,r,i,o,a){for(var s,u,l=[0,e.length-1,0],c=[];l.length;){var h=l.pop(),f=l.pop(),p=l.pop();if(f-p<=a)for(var d=p;d<=f;d++)s=t[2*d],u=t[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(e[d]);else{var v=Math.floor((p+f)/2);s=t[2*v],u=t[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(e[v]);var m=(h+1)%2;(0===h?n<=s:r<=u)&&(l.push(p),l.push(v-1),l.push(m)),(0===h?i>=s:o>=u)&&(l.push(v+1),l.push(f),l.push(m))}}return c}(this.ids,this.coords,e,t,n,r,this.nodeSize)},s.prototype.within=function(e,t,n){return function(e,t,n,r,o,a){for(var s=[0,e.length-1,0],u=[],l=o*o;s.length;){var c=s.pop(),h=s.pop(),f=s.pop();if(h-f<=a)for(var p=f;p<=h;p++)i(t[2*p],t[2*p+1],n,r)<=l&&u.push(e[p]);else{var d=Math.floor((f+h)/2),v=t[2*d],m=t[2*d+1];i(v,m,n,r)<=l&&u.push(e[d]);var g=(c+1)%2;(0===c?n-o<=v:r-o<=m)&&(s.push(f),s.push(d-1),s.push(g)),(0===c?n+o>=v:r+o>=m)&&(s.push(d+1),s.push(h),s.push(g))}}return u}(this.ids,this.coords,e,t,n,this.nodeSize)};var u,l={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},c=Math.fround||(u=new Float32Array(1),function(e){return u[0]=+e,u[0]}),h=function(e){this.options=y(Object.create(l),e),this.trees=new Array(this.options.maxZoom+1)};function f(e,t,n,r,i){return{x:c(e),y:c(t),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function p(e,t){var n=e.geometry.coordinates,r=n[0],i=n[1];return{x:c(m(r)),y:c(g(i)),zoom:1/0,index:t,parentId:-1}}function d(e){return{type:"Feature",id:e.id,properties:v(e),geometry:{type:"Point",coordinates:[(r=e.x,360*(r-.5)),(t=e.y,n=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var t,n,r}function v(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return y(y({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function m(e){return e/360+.5}function g(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function y(e,t){for(var n in t)e[n]=t[n];return e}function _(e){return e.x}function b(e){return e.y}return h.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,o=t.nodeSize;n&&console.time("total time");var a="prepare "+e.length+" points";n&&console.time(a),this.points=e;for(var u=[],l=0;l<e.length;l++)e[l].geometry&&u.push(p(e[l],l));this.trees[i+1]=new s(u,_,b,o,Float32Array),n&&console.timeEnd(a);for(var c=i;c>=r;c--){var h=+Date.now();u=this._cluster(u,c),this.trees[c]=new s(u,_,b,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",c,u.length,+Date.now()-h)}return n&&console.timeEnd("total time"),this},h.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],t),s=this.getClusters([-180,r,i,o],t);return a.concat(s)}for(var u=this.trees[this._limitZoom(t)],l=[],c=0,h=u.range(m(n),g(o),m(i),g(r));c<h.length;c+=1){var f=h[c],p=u.points[f];l.push(p.numPoints?d(p):this.points[p.index])}return l},h.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[t];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=l[u],h=i.points[c];h.parentId===e&&s.push(h.numPoints?d(h):this.points[h.index])}if(0===s.length)throw new Error(r);return s},h.prototype.getLeaves=function(e,t,n){t=t||10,n=n||0;var r=[];return this._appendLeaves(r,e,t,n,0),r},h.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,l=(n+1+s)/i,c={features:[]};return this._addTileFeatures(r.range((t-s)/i,u,(t+1+s)/i,l),r.points,t,n,i,c),0===t&&this._addTileFeatures(r.range(1-s/i,u,1,l),r.points,i,n,i,c),t===i-1&&this._addTileFeatures(r.range(0,u,s/i,l),r.points,-1,n,i,c),c.features.length?c:null},h.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t},h.prototype._appendLeaves=function(e,t,n,r,i){for(var o=0,a=this.getChildren(t);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(e,u.cluster_id,n,r,i):i<r?i++:e.push(s),e.length===n)break}return i},h.prototype._addTileFeatures=function(e,t,n,r,i,o){for(var a=0,s=e;a<s.length;a+=1){var u=t[s[a]],l=u.numPoints,c=void 0,h=void 0,f=void 0;if(l)c=v(u),h=u.x,f=u.y;else{var p=this.points[u.index];c=p.properties,h=m(p.geometry.coordinates[0]),f=g(p.geometry.coordinates[1])}var d={type:1,geometry:[[Math.round(this.options.extent*(h*i-n)),Math.round(this.options.extent*(f*i-r))]],tags:c},y=void 0;l?y=u.id:this.options.generateId?y=u.index:this.points[u.index].id&&(y=this.points[u.index].id),void 0!==y&&(d.id=y),o.features.push(d)}},h.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))},h.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,u=i/(o*Math.pow(2,t)),l=0;l<e.length;l++){var c=e[l];if(!(c.zoom<=t)){c.zoom=t;for(var h=this.trees[t+1],p=h.within(c.x,c.y,u),d=c.numPoints||1,v=d,m=0,g=p;m<g.length;m+=1){var y=g[m],_=h.points[y];_.zoom>t&&(v+=_.numPoints||1)}if(v>d&&v>=s){for(var b=c.x*d,x=c.y*d,E=a&&d>1?this._map(c,!0):null,S=(l<<5)+(t+1)+this.points.length,A=0,T=p;A<T.length;A+=1){var C=T[A],w=h.points[C];if(!(w.zoom<=t)){w.zoom=t;var R=w.numPoints||1;b+=w.x*R,x+=w.y*R,w.parentId=S,a&&(E||(E=this._map(c,!0)),a(E,this._map(w)))}}c.parentId=S,n.push(f(b/v,x/v,S,v,E))}else if(n.push(c),v>1)for(var M=0,k=p;M<k.length;M+=1){var L=k[M],O=h.points[L];O.zoom<=t||(O.zoom=t,n.push(O))}}}return n},h.prototype._getOriginId=function(e){return e-this.points.length>>5},h.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},h.prototype._map=function(e,t){if(e.numPoints)return t?y({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?y({},r):r},h},"object"===a(t)?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},6325:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(e){try{var t,n=(t=(t=document.getElementsByTagName("script"))[t.length-1]).getAttribute("data-injectcss");if(!(t=t.getAttribute("data-disable-injectsvg"))){var r,i,o,a,s;if(n&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(t){console&&console.log(t)}}r=function(){var t,n=document.createElement("div");n.innerHTML=e._iconfont_svg_string_3580659,(n=n.getElementsByTagName("svg")[0])&&(n.setAttribute("aria-hidden","true"),n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.overflow="hidden",(t=document.body).firstChild?function(e,t){t.parentNode.insertBefore(e,t)}(n,t.firstChild):t.appendChild(n))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(r,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),r()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(o=r,a=e.document,s=!1,function e(){try{a.documentElement.doScroll("left")}catch(t){return void setTimeout(e,50)}u()}(),a.onreadystatechange=function(){"complete"==a.readyState&&(a.onreadystatechange=null,u())})}function u(){s||(s=!0,o())}}catch(i){}}(window)},5012:function(t){"use strict";t.exports=e},9427:function(e){"use strict";e.exports=t},1451:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},2659:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},4218:function(e,t,n){var r=n(1451);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},6626:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},9989:function(e){function t(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=e.apply(n,r);function s(e){t(a,i,o,s,u,"next",e)}function u(e){t(a,i,o,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},4528:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},1088:function(e,t,n){var r=n(6842),i=n(5597);function o(t,n,a){return i()?(e.exports=o=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=o=function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&r(o,n.prototype),o},e.exports.__esModule=!0,e.exports.default=e.exports),o.apply(null,arguments)}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},8798:function(e,t,n){var r=n(6157);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},6970:function(e,t,n){var r=n(2482);e.exports=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}},e.exports.__esModule=!0,e.exports.default=e.exports},9913:function(e,t,n){var r=n(378),i=n(5597),o=n(4776);e.exports=function(e){var t=i();return function(){var n,i=r(e);if(t){var a=r(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return o(this,n)}},e.exports.__esModule=!0,e.exports.default=e.exports},9057:function(e,t,n){var r=n(6157);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},746:function(e,t,n){var r=n(2677);function i(){return"undefined"!=typeof Reflect&&Reflect.get?(e.exports=i=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=i=function(e,t,n){var i=r(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},e.exports.__esModule=!0,e.exports.default=e.exports),i.apply(this,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},378:function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},7267:function(e,t,n){var r=n(6842);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},8621:function(e){e.exports=function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}},e.exports.__esModule=!0,e.exports.default=e.exports},5597:function(e){e.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},2977:function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},926:function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports},9811:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},7404:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},1448:function(e,t,n){var r=n(9057);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e},e.exports.__esModule=!0,e.exports.default=e.exports},2760:function(e,t,n){var r=n(1424);e.exports=function(e,t){if(null==e)return{};var n,i,o=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o},e.exports.__esModule=!0,e.exports.default=e.exports},1424:function(e){e.exports=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i},e.exports.__esModule=!0,e.exports.default=e.exports},4776:function(e,t,n){var r=n(5570).default,i=n(6626);e.exports=function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},9558:function(e,t,n){var r=n(5570).default;function i(){"use strict";e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},o=Object.prototype,a=o.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},u="function"==typeof Symbol?Symbol:{},l=u.iterator||"@@iterator",c=u.asyncIterator||"@@asyncIterator",h=u.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(t){f=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var i=t&&t.prototype instanceof _?t:_,o=Object.create(i.prototype),a=new O(r||[]);return s(o,"_invoke",{value:R(e,n,a)}),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=p;var v="suspendedStart",m="executing",g="completed",y={};function _(){}function b(){}function x(){}var E={};f(E,l,(function(){return this}));var S=Object.getPrototypeOf,A=S&&S(S(P([])));A&&A!==o&&a.call(A,l)&&(E=A);var T=x.prototype=_.prototype=Object.create(E);function C(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(i,o,s,u){var l=d(e[i],e,o);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==r(h)&&a.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(h).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,u)}))}u(l.arg)}var i;s(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}})}function R(e,n,r){var i=v;return function(o,a){if(i===m)throw new Error("Generator is already running");if(i===g){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=M(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===v)throw i=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=m;var l=d(e,n,r);if("normal"===l.type){if(i=r.done?g:"suspendedYield",l.arg===y)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=g,r.method="throw",r.arg=l.arg)}}}function M(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,M(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=d(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function P(e){if(e||""===e){var n=e[l];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(a.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(r(e)+" is not iterable")}return b.prototype=x,s(T,"constructor",{value:x,configurable:!0}),s(x,"constructor",{value:b,configurable:!0}),b.displayName=f(x,h,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,f(e,h,"GeneratorFunction")),e.prototype=Object.create(T),e},n.awrap=function(e){return{__await:e}},C(w.prototype),f(w.prototype,c,(function(){return this})),n.AsyncIterator=w,n.async=function(e,t,r,i,o){void 0===o&&(o=Promise);var a=new w(p(e,t,r,i),o);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},C(T),f(T,h,"Generator"),f(T,l,(function(){return this})),f(T,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=P,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(L),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=a.call(o,"catchLoc"),l=a.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),L(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;L(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},n}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},6842:function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},3100:function(e,t,n){var r=n(2659),i=n(926),o=n(2482),a=n(9811);e.exports=function(e,t){return r(e)||i(e,t)||o(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},2677:function(e,t,n){var r=n(378);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},4479:function(e,t,n){var r=n(4218),i=n(2977),o=n(2482),a=n(7404);e.exports=function(e){return r(e)||i(e)||o(e)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},2579:function(e,t,n){var r=n(5570).default;e.exports=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},6157:function(e,t,n){var r=n(5570).default,i=n(2579);e.exports=function(e){var t=i(e,"string");return"symbol"==r(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},5570:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},2482:function(e,t,n){var r=n(1451);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},9845:function(e,t,n){var r=n(378),i=n(6842),o=n(8621),a=n(1088);function s(t){var n="function"==typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!o(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},2928:function(e,t,n){"use strict";n.d(t,{DL:function(){return c},Ht:function(){return f},Tu:function(){return s},tw:function(){return l},uf:function(){return u},vi:function(){return h},yu:function(){return a},zL:function(){return o}});n(5570);var r=6371008.8,i={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*r,kilometers:6371.0088,kilometres:6371.0088,meters:r,metres:r,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:r/1852,radians:1,yards:6967335.223679999};function o(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function a(e,t,n){void 0===n&&(n={});for(var r=0,i=e;r<i.length;r++){var a=i[r];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return o({type:"Polygon",coordinates:e},t,n)}function s(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return o({type:"LineString",coordinates:e},t,n)}function u(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function l(e,t,n){return void 0===n&&(n={}),o({type:"MultiPolygon",coordinates:e},t,n)}function c(e,t){void 0===t&&(t="kilometers");var n=i[t];if(!n)throw new Error(t+" units is invalid");return e*n}function h(e){return 180*(e%(2*Math.PI))/Math.PI}function f(e){return e%360*Math.PI/180}},1772:function(e,t,n){"use strict";n.d(t,{r7:function(){return r},wA:function(){return i}});n(2928);function r(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function i(e){return"Feature"===e.type?e.geometry:e}},1612:function(e,t,n){"use strict";n.d(t,{nG:function(){return a},pZ:function(){return i}});var r=n(2928);function i(e,t,n){if(null!==e)for(var r,o,a,s,u,l,c,h,f=0,p=0,d=e.type,v="FeatureCollection"===d,m="Feature"===d,g=v?e.features.length:1,y=0;y<g;y++){u=(h=!!(c=v?e.features[y].geometry:m?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var _=0;_<u;_++){var b=0,x=0;if(null!==(s=h?c.geometries[_]:c)){l=s.coordinates;var E=s.type;switch(f=!n||"Polygon"!==E&&"MultiPolygon"!==E?0:1,E){case null:break;case"Point":if(!1===t(l,p,y,b,x))return!1;p++,b++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(!1===t(l[r],p,y,b,x))return!1;p++,"MultiPoint"===E&&b++}"LineString"===E&&b++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(o=0;o<l[r].length-f;o++){if(!1===t(l[r][o],p,y,b,x))return!1;p++}"MultiLineString"===E&&b++,"Polygon"===E&&x++}"Polygon"===E&&b++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(x=0,o=0;o<l[r].length;o++){for(a=0;a<l[r][o].length-f;a++){if(!1===t(l[r][o][a],p,y,b,x))return!1;p++}x++}b++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===i(s.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(e,t){var n,r,i,o,a,s,u,l,c,h,f=0,p="FeatureCollection"===e.type,d="Feature"===e.type,v=p?e.features.length:1;for(n=0;n<v;n++){for(s=p?e.features[n].geometry:d?e.geometry:e,l=p?e.features[n].properties:d?e.properties:{},c=p?e.features[n].bbox:d?e.bbox:void 0,h=p?e.features[n].id:d?e.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,f,l,c,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],f,l,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,f,l,c,h))return!1;f++}}function a(e,t){o(e,(function(e,n,i,o,a){var s,u=null===e?null:e.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==t((0,r.zL)(e,i,{bbox:o,id:a}),n,0)&&void 0}switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<e.coordinates.length;l++){var c={type:s,coordinates:e.coordinates[l]};if(!1===t((0,r.zL)(c,i),n,l))return!1}}))}}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={id:e,loaded:!1,exports:{}};return n[e].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e};var o={};return function(){"use strict";i.r(o),i.d(o,{AJAXError:function(){return c.Uj},BKDRHash:function(){return c.e2},BaiduMap:function(){return u.Gp},BaseLayer:function(){return s.zi},BaseMapService:function(){return u.zr},BaseMapWrapper:function(){return u.rh},BaseModel:function(){return s.gq},CanvasLayer:function(){return s.mM},CanvasUpdateType:function(){return s.Fy},CityBuildingLayer:function(){return s.Rf},DOM:function(){return c.SO},Earth:function(){return u.IY},EarthLayer:function(){return s.fJ},FrequencyController:function(){return c.iH},GaodeMap:function(){return u.lg},GaodeMapV1:function(){return u.nb},GaodeMapV2:function(){return u.DP},GeometryLayer:function(){return s.VR},GoogleMap:function(){return u.b6},HeatmapLayer:function(){return s.zP},ImageLayer:function(){return s.Q8},LRUCache:function(){return c.z6},LineLayer:function(){return s.Ie},LinearDir:function(){return s.cA},LoadTileDataStatus:function(){return c.Qj},Map:function(){return u.D5},MapLibre:function(){return u.H0},MapType:function(){return u.T},Mapbox:function(){return u.pc},MaskLayer:function(){return s.$1},PointLayer:function(){return s.ns},PolygonLayer:function(){return s.dW},RasterLayer:function(){return s.YY},Satistics:function(){return c.a5},Scene:function(){return l.x},SceneConifg:function(){return c.SA},SizeUnitType:function(){return s.xg},Source:function(){return e.default},SourceTile:function(){return c.LZ},TMap:function(){return u.Qs},TencentMap:function(){return u.yh},TextureBlend:function(){return s.qy},TileDebugLayer:function(){return s.sh},TileLayer:function(){return s.Im},TilesetManager:function(){return c.nx},UpdateTileStrategy:function(){return c.dD},Viewport:function(){return u.l_},WindLayer:function(){return s.vo},aProjectFlat:function(){return c.Z},amap2Project:function(){return c.TG},amap2UnProject:function(){return c.S8},anchorTranslate:function(){return c.rQ},anchorType:function(){return c.bV},applyAnchorClass:function(){return c.zi},bBoxToBounds:function(){return c.ds},bindAll:function(){return c.Ev},boundsContains:function(){return c.oO},calAngle:function(){return c.mt},calDistance:function(){return c.Lw},calculateCentroid:function(){return c.SI},calculatePointsCenterAndRadius:function(){return c.Rx},decodePickingColor:function(){return c.W0},defaultValue:function(){return c.LS},djb2hash:function(){return c.h8},encodePickingColor:function(){return c.Z6},expandUrl:function(){return c.Gk},extent:function(){return c.We},flow:function(){return c.ls},formatImage:function(){return c.Co},generateCatRamp:function(){return c.hj},generateColorRamp:function(){return c.Cl},generateCustomRamp:function(){return c.Oc},generateLinearRamp:function(){return c.M4},generateQuantizeRamp:function(){return c.NJ},getAngle:function(){return c._O},getArrayBuffer:function(){return c.ks},getBBoxFromPoints:function(){return c.Ol},getCullFace:function(){return c.fj},getData:function(){return c.Yu},getDefaultDomain:function(){return c.ZB},getImage:function(){return c.gJ},getJSON:function(){return c.xA},getProtocolAction:function(){return c.Y3},getReferrer:function(){return c.an},getTileIndices:function(){return c.rJ},getTileWarpXY:function(){return c.qD},getURLFromTemplate:function(){return c.z0},getWMTSURLFromTemplate:function(){return c.jG},guid:function(){return c.M8},isAndroid:function(){return c.Dt},isColor:function(){return c.D5},isImageBitmap:function(){return c.fg},isPC:function(){return c.Ro},isURLTemplate:function(){return c.Xj},isWorker:function(){return c.hJ},isiOS:function(){return c.Tt},latitude:function(){return c.pq},lineAtOffset:function(){return c.LT},lineAtOffsetAsyc:function(){return c.wj},lineStyleType:function(){return s.zW},lngLatInExtent:function(){return c.if},lngLatToMeters:function(){return c.vP},lnglatDistance:function(){return c.yM},lodashUtil:function(){return c.rU},longitude:function(){return c.MS},makeXMLHttpRequestPromise:function(){return c.LF},metersToLngLat:function(){return c.Uv},normalize:function(){return c.Fv},osmLonLat2TileXY:function(){return c.RV},osmTileXY2LonLat:function(){return c.cN},padBounds:function(){return c.yA},postData:function(){return c.qC},project:function(){return c.iV},rgb2arr:function(){return c.CI},sameOrigin:function(){return c._0},tileToBounds:function(){return c.Dv},tranfrormCoord:function(){return c.Jo},unProjectFlat:function(){return c.ih},validateLngLat:function(){return c.Fb},version:function(){return h.i}});var e=i(8368),t=i(4278),n={};for(var r in t)["default","Source"].indexOf(r)<0&&(n[r]=function(e){return t[e]}.bind(0,r));i.d(o,n);var a=i(3292);n={};for(var r in a)["default","Source","ExportImage","Fullscreen","GeoLocate","LayerSwitch","Logo","MapTheme","MouseLocation","Scale","Swipe","Zoom","LayerPopup","Popup","Marker","MarkerLayer","ButtonControl","Control","PopperControl","PositionType","SelectControl"].indexOf(r)<0&&(n[r]=function(e){return a[e]}.bind(0,r));i.d(o,n);var s=i(1903),u=i(8088),l=i(8677),c=i(6490),h=i(8115)}(),o}()}));